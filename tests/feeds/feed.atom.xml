<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>MattStauffer.co</title>
    <link href="https://mattstauffer.co/blog"/>
    <link type="application/atom+xml" rel="self" href="https://mattstauffer.co/blog/feed"/>
    <updated>2017-09-03T01:43:21+00:00</updated>
    <id>https://mattstauffer.co/blog/feed</id>
    <author>
        <name>Matt Stauffer</name>
    </author>
    <entry>
        <id>https://mattstauffer.co/blog/real-time-automatic-facades-in-laravel-5-4</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/real-time-automatic-facades-in-laravel-5-4"/>
        <title>Real-time (automatic) Facades in Laravel 5.4</title>
        <published>2017-08-22T00:00:00+00:00</published>
        <updated>2017-08-22T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel 5.4 introduced a new feature called “rea...</summary>
        <content type="html"><![CDATA[
        <p>Laravel 5.4 introduced a new feature called “real-time facades”, which provide the convenience of facades, defined real-time instead of in classes. Taylor <a href="https://twitter.com/taylorotwell/status/814944242158149632">tweeted</a> about it, but I wanted to explain what they are and how they work.</p>
<h2>A quick introduction to facades in Laravel</h2>
<blockquote>
<p>Already know how facades work? Skip to <a href="#whats-new">what’s new</a>.</p>
</blockquote>
<p>If you’re not familiar with facades in Laravel, they’re shortcut classes that provide static access to non-static methods on service classes bound to Laravel’s container. Phew, that’s a mouthful; let’s take a look at some real code.</p>
<p>For instance, if I want get something from the session, here’s one way to do it in Laravel:</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use Illuminate\Session\SessionManager;

class ThingController extends Controller
{
    protected $session;

    public function __construct(SessionManager $session)
    {
        $this-&gt;session = $session;
    }

    public function doThing()
    {
        $importantValue = $this-&gt;session-&gt;get('important');
    }
}</code></pre>
<p>… or in a view:</p>
<pre><code class="language-php">Your user ID is: {{ app('Illuminate\Session\SessionManager')-&gt;get('important') }}</code></pre>
<p>However, this means you have to inject a session instance anywhere you’re going to use it. This isn’t a big issue, but especially in views and sometimes controllers (especially before controllers were namespaced), this hasn’t always the most convenient. The <code>app()</code> helper also makes it easier, as you can see in the view example. But facades make that even easier:</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\Session;

public function ThingController extends Controller
{
    public function doThing()
    {
        $importantValue = Session::get('important');
    }
}</code></pre>
<p>… or in a view:</p>
<pre><code class="language-php">Your user ID is: {{ Session::get('important') }}</code></pre>
<p>The facade works like this: </p>
<pre><code class="language-php">class Session extends Facade
{
    protected static function getFacadeAccessor()
    {
        return 'session';
    }
}</code></pre>
<p>This is telling the container this: “When I use a static method on the <code>Session</code>  facade, call it on an instance of <code>app('session')</code>”. The facade functionality pulls an instance out of the container and calls the method directly on that.</p>
<p>Good? Good. Let’s cover what a real-time facade is.</p>
<p><a id="whats-new"></a></p>
<h2>Introducing real-time facades</h2>
<p>Real-time facades let you create your own facades on the fly. Instead of having to create a facade class like the <code>Session</code> facade class I referenced above, you can use a class as its own facade by adding <code>Facades\</code> to the beginning of its own namespace.</p>
<p>Let’s say I have a class called Charts that has a <code>burndown()</code> method:</p>
<pre><code class="language-php">&lt;?php

namespace App;

class Charts
{
    protected $dep;

    public function __construct(SomeDependency $dep)
    {
        $this-&gt;dep = $dep;
    }

    public function burndown()
    {
        return 'stuff here' . $this-&gt;dep-&gt;stuff();
    }
}</code></pre>
<p>There’s nothing special about this class. Here’s how we would normally use it in a view:</p>
<pre><code class="language-php">&lt;h2&gt;Burndown&lt;/h2&gt;
{{ app(App\Charts::class)-&gt;burndown() }}</code></pre>
<p>Now, let’s make it a facade, just by changing the namespace:</p>
<pre><code class="language-php">&lt;h2&gt;Burndown&lt;/h2&gt;
{{ Facades\App\Charts::burndown() }}</code></pre>
<p>Or, in a class, from this:</p>
<pre><code class="language-php">&lt;?php

namespace App\Stuff;

use App\Charts;

class ThingDoer
{
    private $charts;

    public function __construct(Charts $charts)
    {
        $this-&gt;charts = $charts;
    }

    public function doThing()
    {
        $this-&gt;charts-&gt;burndown();
    }
}</code></pre>
<p>to this:</p>
<pre><code class="language-php">&lt;?php

namespace App\Stuff;

use Facades\App\Charts;

class ThingDoer
{
    public function doThing()
    {
        Charts::burndown();
    }
}</code></pre>
<h2>Post::conclude()</h2>
<p>That’s all. Just a quick and simple way to create a facade on the fly. One more tool in your terseness arsenal.</p>
<p>You might be asking yourself, &quot;why all the fuss for something so simple?&quot; In terms of its terseness, it definitely has a lot of value in some contexts and negligible impact in others. What if I told you, though, that you could use real-time façades to make your code <em>more</em> testable?</p>
<p>Taylor <a href="https://medium.com/@taylorotwell/expressive-code-real-time-facades-41c442914291">wrote a great post</a> explaining how he uses real-time facades in his Forge code, and how it's now more testable as a result.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-collections-higher-order-messaging-and-when-method-in-laravel-5-4</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-collections-higher-order-messaging-and-when-method-in-laravel-5-4"/>
        <title>Laravel Collections’ higher order messaging and &quot;when&quot; method in Laravel 5.4</title>
        <published>2017-08-17T00:00:00+00:00</published>
        <updated>2017-08-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">It seems like it was just last year that collectio...</summary>
        <content type="html"><![CDATA[
        <p>It seems like it was just last year that collection pipelines took over the Laravel world. Taylor had introduced collections to Laravel a while back but they sat somewhat under-appreciated until Adam Wathan wrote his book <a href="https://adamwathan.me/refactoring-to-collections/">Refactoring to Collections</a> about how they can transform the way you write a lot of your PHP code.</p>
<p>In Laravel 5.4, collections got a few boosts. Let’s take a look at a few.</p>
<h2>Higher Order Messaging</h2>
<p>The biggest-name change is “higher order messaging”, an object-oriented design pattern described first in 2005 (<a href="http://www.metaobject.com/papers/Higher_Order_Messaging_OOPSLA_2005.pdf">“Higher Order Messaging”</a>)  and later implemented in Ruby (<a href="http://natpryce.com/articles/000535.html">Mistaeks I Hav Made: Higher Order Messaging in Ruby</a>) by Nat Pryce, co-author of <a href="http://amzn.to/2vYumLm">GOOS</a>.</p>
<h3>What is Higher Order Messaging?</h3>
<p>The best way to understand Higher Order Messaging is to walk through an example. I’m going to take the idea and shape of the code directly from Nat Pryce’s article, but adapt them for PHP and make them a little easier to follow. Thanks to Nat for his original writing.</p>
<h4>Nat’s Claimants</h4>
<p>We have a collection of <code>Claimant</code>s who are receiving benefits from the government. A claimant has a <code>name</code>, a <code>gender</code>, an <code>age</code>, and an integer <code>benefits</code> that represents the total of their weekly monetary benefits.</p>
<p>Let’s say we want to add $50 a week to the <code>benefits</code> total for every claimant who is retired. We’re using the <code>receiveBenefits()</code> method to increase the <code>benefits</code> value.</p>
<p>First, we can iterate over it procedurally;</p>
<pre><code class="language-php">foreach ($claimants as $claimant) {
    if ($claimant-&gt;is_retired) {
        $claimant-&gt;receiveBenefit(50);
    }
}</code></pre>
<p>The revolution that hit the Laravel world over the last year introduces the idea of <em>higher-order functions</em>, or functions which take a Closure, and how they can be used in collection pipelines. Here’s the same call using a collection pipeline:</p>
<pre><code class="language-php">collect($claimants)-&gt;filter(function ($claimant) {
    return $claimant-&gt;is_retired;
})-&gt;each(function ($claimant) {
    $claimant-&gt;receiveBenefit(50);
});</code></pre>
<p>Great. If you’ve read Adam’s book or watched his course this isn’t news. But let’s take a look at the next step—not higher-order <em>functions</em>, but what is called higher-order <em>messages</em>:</p>
<pre><code class="language-php">collect($claimants)-&gt;filter-&gt;is_retired-&gt;each-&gt;receiveBenefit(50);</code></pre>
<p>As Nat defines them:</p>
<blockquote>
<p>A higher order message is a message that takes another message as an &quot;argument&quot;. It defines how that message is forwarded on to one or more objects and how the responses are collated and returned to the sender. They fit well with collections; a single higher order message can perform a query or update of all the objects in a collection.</p>
</blockquote>
<p>If all this talk of messages seems foreign, it would be worth reading up a bit on the idea of OOP as “<a href="https://en.wikipedia.org/wiki/Message_passing">message passing</a>”. In short, when Nat is talking about messages here he’s (sort of) referring to method calls as “messages” which you assemble together in a sort of language — “claimants (filter is retired) each receive benefits” isn’t a perfect English sentence, but it’s definitely a series of messages sent to the claimants collection, not a bunch of implementation details.</p>
<p>I think Nat’s post does the best job of explaining the benefit we’re getting by converting this code sample to use higher order messaging:</p>
<blockquote>
<p>[T]he code using higher order messages most succinctly expresses the business rule being executed. It expresses what is being performed and hides the details of how.</p>
</blockquote>
<h3>Using Higher Order Messaging with Laravel’s collection pipelines</h3>
<p>You can already get a taste of how it works from my examples above. Essentially, instead of calling a collection method like <code>filter()</code> and giving it a Closure that returns the property from each object, you call each method (message) one after another and the Higher Order Messaging collection pipeline reads your intent and makes it work. </p>
<p>It’s a little hard to describe perfectly—how are both &quot;filter&quot; <em>and</em> &quot;is_retired&quot; messages? Essentially, when you call collection methods like <code>filter</code> using their higher order messaging syntax (<code>$collection-&gt;filter</code> instead of <code>$collection-&gt;filter(...)</code>) they’re now set to expect the next string in the call stack to be a “message” passed to them. If I’m <code>filter</code> being called in a higher order messaging context, I expect the next string down the call stack to be a property or method that I’ll call on each item for my <code>filter</code> truthiness test.</p>
<h4>An example</h4>
<pre><code class="language-php">class Person
{
    public $isAdmin;

    public function __construct($isAdmin)
    {
        $this-&gt;isAdmin = $isAdmin;
    }

    public function isAdmin()
    {
        return (bool) $this-&gt;isAdmin;
    }
}

$people = collect([new Person(false), new Person(true)]);

// Filter against a prop
$people-&gt;filter-&gt;isAdmin;

// ... same as:
$people-&gt;filter(function ($person) {
    return $person-&gt;isAdmin;
});

// Filter against a method
$people-&gt;filter-&gt;isAdmin();

// ... same as:
$people-&gt;filter(function ($person) {
    return $person-&gt;isAdmin();
});</code></pre>
<p>So, practically, higher order messaging in Laravel collections simplifies a few extremely common syntaxes for passing properties or methods into collection methods like <code>filter</code> and <code>each</code>.  These changes make the code simpler and more expressive and everyone wins.</p>
<h2>Collection@when</h2>
<p>If you’re not familiar with the already-existing <code>pipe()</code> method in Laravel’s collections, here’s how it works: the <code>pipe()</code> method’s Closure is passed the entire current collection as a parameter, and whatever you return from that Closure will replace the collection.</p>
<pre><code class="language-php">return collect($peopleArray)
    -&gt;sort('age')
    -&gt;pipe(function ($people) {
        // Final collection is run through the transformer
        // and then the output of that is returned
        return app('peopleTransformer')-&gt;transform($people);
    });</code></pre>
<p>The new <code>when()</code> method is the same, except it’s conditional. To understand the <code>when()</code> method, just take the <code>pipe()</code> method and (in your head) modify it to it accept a first parameter; if that parameter is truthy, run the second parameter Closure as a <code>pipe()</code> method. If it’s falsey, ignore the entire <code>when()</code> call and keep moving. That’s the <code>when()</code> method.</p>
<pre><code class="language-php">return collect($peopleArray)
    -&gt;sort('age')
    -&gt;when(request()-&gt;wantsJson(), function ($people) {
        // Final collection is run through the transformer
        // and then the output of that is returned
        return app('peopleTransformer')-&gt;transform($people);
    });</code></pre>
<h2>Collection@end</h2>
<p>That’s it! More ways collection pipelines can make your code cleaner, terser, more expressive, and more elegant.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravels-tap-higher-order-tap-and-collection-tap</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-laravels-tap-higher-order-tap-and-collection-tap"/>
        <title>Introducing Laravel’s tap, “higher order” tap, and collection tap</title>
        <published>2017-08-15T00:00:00+00:00</published>
        <updated>2017-08-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you follow Adam Wathan at all, you’ve seen hi...</summary>
        <content type="html"><![CDATA[
        <p>If you follow Adam Wathan at all, you’ve seen him use his favorite function, <code>tap()</code>, dozens of times in his videos. But what does it actually do?</p>
<p><code>tap()</code> was introduced in Laravel 5.3 and got some power boosts in 5.4. Let’s take a look at what it is and what it does.</p>
<h2>Defining <code>tap()</code></h2>
<pre><code class="language-php">function tap($value, $callback)
{
   $callback($value);

   return $value;
}</code></pre>
<p>That’s what the <code>tap()</code> function originally looked like&mdash;it's gotten a few small improvements since then, but let's start at the basics. </p>
<p>It’s really simple, right? So why is everyone so excited?</p>
<p>Let’s look at what it does: Take a value, pass that value into some form of callback, and then return the value.</p>
<h2>An example using <code>tap()</code></h2>
<p>Here’s what it looks like to refactor something to use <code>tap()</code>.</p>
<p>First, let’s take a common pattern:</p>
<pre><code class="language-php">public function generateUseAndReturnThing($input)
{
    $thing = $this-&gt;thingFromInput($input);

    $this-&gt;doActionToThing($thing);

    return $thing;
}</code></pre>
<p>We take some input, make a thing from it, perform some actions with that thing, and then finally return the thing that we generated.</p>
<p>So, remember, <code>tap()</code> takes a value, acts on it, and then returns it. That means we can identify a potential place to use <code>tap()</code> here; we’re acting on a value (<code>$thing</code>) and then returning that same value.</p>
<p>That’s our key to watch out for. Consider that a code smell that hints at a potential use for <code>tap()</code> usage: using temporary variables just for the sake of returning later.</p>
<p>So, let’s make this use <code>tap()</code> instead.</p>
<pre><code class="language-php">public function generateUseAndReturnThing($input)
{
    return tap($this-&gt;thingFromInput($input), function ($thing) {
        $this-&gt;doActionToThing($thing);
    });
}</code></pre>
<p>Let’s walk through what we’ve changed here.</p>
<p>First, we are no longer assigning the output of <code>$this-&gt;thingFromInput($input)</code> to a temporary variable; we’re instead passing it directly as the “value” to <code>tap()</code>.</p>
<p>Second, we know the “value” (that is, the first parameter you send to <code>tap()</code>) is provided as a parameter to our callback function, so we pass in a closure that takes the “value” <code>$thing</code> as its parameter.</p>
<p>Third, we operate on our value. </p>
<p>And fourth, we close out our tap function. The final return of the <code>tap()</code> function is the originally-passed value (the output of <code>$this-&gt;thingFromInput($input)</code>) so this is what is returned from our <code>generateUseAndReturnThing()</code> method.</p>
<h3>Evaluating the refactor</h3>
<p>How much did that help? What did it bring us?</p>
<p>Before we ask those questions, let’s read a few words from a recent post by Taylor Otwell about Tap (<a href="https://medium.com/@taylorotwell/tap-tap-tap-1fc6fc1f93a6">Tap, Tap, Tap</a>). Remember also that Taylor and Adam Wathan are the ones who originally popularized <code>tap()</code>&mdash;think of their influences and values.</p>
<blockquote>
<p>On first glance, this Ruby inspired function is pretty odd. … I find it often lets me write terse, one-line operations that would normally require temporary variables or additional lines.</p>
</blockquote>
<p>This isn’t allowing us to do things we couldn’t do before.</p>
<p>Instead, it’s helping us write terser code, with less temporary variables and less lines of code.</p>
<h2>A few real life examples</h2>
<p>In Taylor’s article he gave an example of how he’s using Tap in the Laravel core.</p>
<h3>Eloquent create</h3>
<pre><code class="language-php">public function create(array $attributes = [])
{
    return tap($this-&gt;newModelInstance($attributes), function ($instance) {
        $instance-&gt;save();
    });
}</code></pre>
<p>This is the <code>create()</code> method on Eloquent models. To understand its value, let’s take a look at what this same method call would look like without <code>tap()</code>:</p>
<pre><code class="language-php">public function create(array $attributes = [])
{
    $instance = $this-&gt;newModelInstance($attribtues);

    $instance-&gt;save();

    return $instance;
}</code></pre>
<p>We’re dropping the need for the <code>$instance</code> temporary variable and wrapping the instantiation, <code>save()</code> call, and the return of the instance itself up into the core workflow of the <code>tap()</code> function.</p>
<h3>Decorate response middleware</h3>
<p>Here’s another really practical use case. One of the most common workflows for writing middleware in Laravel looks a bit like this:</p>
<pre><code class="language-php">public function handle($request, Closure $next)
{
    $response = $next($request);

    $this-&gt;decorateResponseSomehow($response);

    return $response;
}</code></pre>
<p>We can now refactor this using <code>tap()</code>:</p>
<pre><code class="language-php">public function handle($request, Closure $next)
{
    return tap($next($request), function ($response) {
        $this-&gt;decorateResponseSomehow($response);
    });
}</code></pre>
<h3>Shortcut without affecting the value</h3>
<p>There’s another interesting use case that I came across in <a href="http://derekmd.com/2017/02/laravel-tap/">Derek MacDonald’s article on Tap</a>; Derek found that the <code>AuthenticateSession</code> middleware now uses <code>tap()</code>, but not quite the way I described it above.</p>
<pre><code class="language-php">public function handle($request, Closure $next)
{
    return tap($next($request), function () use ($request) {
        $this-&gt;storePasswordHashInSession($request);
    });
}</code></pre>
<p>Notice anything different?  Here’s what that call would look like before <code>tap()</code>:</p>
<pre><code class="language-php">public function handle($request, Closure $next)
{
    $response = $next($request);

    $this-&gt;storePasswordHashInSession($request);

    return $response;
}</code></pre>
<p>Unlike in my example, the Closure isn’t actually performing any operations working with the “value” (the result of <code>$next($request)</code>). Instead, this method uses <code>tap</code> because it still saves us from needing to save <code>$response</code> as a temporary variable before storing the hash.</p>
<h2>“Higher order” tap</h2>
<p>In Laravel 5.4, the <code>tap()</code> function got a new use case. Most of the examples I’ve shown up until this point have been calling an outside method on our value:</p>
<pre><code class="language-php">return tap($thing, function ($thing) {
    $this-&gt;doSomethingToThing($thing);
});</code></pre>
<p>But there are other times where you want to call a method on the object itself; in these cases, the benefit of using <code>tap()</code> is just to return the object when the method we're calling on the object would normally return something else—for example, Eloquent models' <code>update()</code> method returns a boolean.</p>
<p>That converts this call:</p>
<pre><code class="language-php">$user-&gt;update([
    'name' =&gt; $name,
    'age' =&gt; $age,
]);

return $user;</code></pre>
<p>into this:</p>
<pre><code class="language-php">return tap($user, function ($user) {
    $user-&gt;update([
        'name' =&gt; $name,
        'age' =&gt; $age,
    ]);
});</code></pre>
<p>As you can see, this isn’t quite as much of an improvement as our previous refactorings-with-<code>tap</code> were. But in 5.4, you can now use <code>tap()</code> to call methods on the tapped object, and those methods&mdash;even if they natively return something other than the object&mdash;will return the object. Here’s how:</p>
<pre><code class="language-php">return tap($user)-&gt;update([
    'name' =&gt; $name,
    'age' =&gt; $age,
]);</code></pre>
<p>Now that’s clean.</p>
<h2>Collection tap in Laravel 5.4</h2>
<p>In Laravel 5.4, we got the <code>tap()</code> method in our collections as well. Using <code>tap()</code> inline temporarily pauses your collection pipeline and passes you an instance of the collection itself, but once your <code>tap</code> Closure has executed, the pipeline continues as if nothing had happened.</p>
<p>Note that whatever you <code>return</code> from your <code>tap</code> method is just thrown away. This isn’t for returns; it’s for debugging with <code>var_dump</code> or for writing to a log or for performing some separate action.</p>
<pre><code class="language-php">return collect($peopleArray)
    -&gt;sortBy('name')
    -&gt;tap(function ($people) {
        // Useful for debugging
        var_dump($people);
    })
    -&gt;filter(function ($person) {
        return $person-&gt;syncable === true;
    })
    -&gt;tap(function ($people) {
        // Useful for performing some operation without 
        // requiring a temporary variable
        app('thirdPartyService')-&gt;syncPeople($people);
    });</code></pre>
<p>My first response was to compare this method to <code>pipe()</code> and <code>each()</code>, but they’re different in that <code>each()</code> is passed each of the items in the collection one at a time where <code>tap()</code> is passed the entire collection; and <code>pipe()</code> modifies the collection to be whatever you return from the method, whereas <code>tap()</code> discards your return.</p>
<h2>Tap to the end</h2>
<p>I’m a huge fan of anything that makes our code simpler to read for developers down the road. I’m also a huge fan of coding practices that make our code more expressive and that avoid unnecessary extra code.</p>
<p><code>tap()</code>, and collection pipelines before it, are strange in that, when they’re first introduced to your programming lexicon, there’s a cost; until you wrap your head around how <code>tap()</code> works, it’s actually more cognitive work than not using <code>tap()</code>. Same with collection pipelines.</p>
<p>Just like collection pipelines, I’ve also seen people get so excited about <code>tap()</code> that they use it everywhere—often in places where it doesn’t belong. Just because something is new, doesn’t mean you should use it everywhere.</p>
<p>All those caveats having been given, though, I do think <code>tap()</code> has a place in our programming vocabulary, and I’m glad it’s here to stay. Just search for <code>tap()</code> in the Laravel codebase and you can see how many places Taylor and others are putting <code>tap()</code> to good use.</p>
<p>I hope this longer writeup of <code>tap()</code> has helped it really click in your brain. Let me know <a href="https://twitter.com/stauffermatt">on Twitter</a> if anything in this article isn't clear.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/new-laravel-5-5-features-recap-from-laracon-us-2017</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/new-laravel-5-5-features-recap-from-laracon-us-2017"/>
        <title>New Laravel 5.5 Features: Recap from Laracon US 2017</title>
        <published>2017-07-25T00:00:00+00:00</published>
        <updated>2017-07-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Timeline: releasing August-ish; around Eu
            Frontend...
        </summary>
        <content type="html"><![CDATA[
        <p>Timeline: releasing August-ish; around Eu</p>
<h2>Frontend presets</h2>
<ul>
<li><code>php artisan preset react</code>; default React components</li>
<li><code>php artisan preset none</code>; axis &amp; blank Sass</li>
</ul>
<h2>New routing options</h2>
<ul>
<li><code>Route::view('/welcome', 'welcome')</code> returns welcome view
<ul>
<li>Works with route caching!</li>
</ul></li>
<li><code>Route::redirect('home', 'dashboard')</code> returns redirect to another URI</li>
</ul>
<h2>Blade::if</h2>
<ul>
<li>Simple creation of conditional Blade directives</li>
<li>e.g. <code>Blade::if('public', function () { return app()-&gt;context()-&gt;isPublic(); });</code></li>
<li>Generates: <code>@public</code> / <code>@endpublic</code></li>
</ul>
<h2>Renderable mailable</h2>
<ul>
<li>Return a mailable from a route to preview it</li>
</ul>
<pre><code class="language-php">Route::get('preview', function () {
    return MyMailable;
});</code></pre>
<h2>Renderable Exceptions</h2>
<ul>
<li><code>report()</code> method on exceptions define how to report it</li>
<li><code>render()</code> method on exceptions define how to render it</li>
</ul>
<pre><code class="language-php">class MyException extends Exception
{
    public function report()
    {
        // send wherever
    }

    public function render()
    {
        return view('error-or-whatever');
    }
}</code></pre>
<h2>Responsable interface</h2>
<ul>
<li>Implement Responsable interface; class must provide <code>toResponse()</code> method which shows how to convert this object to a response</li>
</ul>
<pre><code class="language-php">class Thing implements Responsable
{
    public function toResponse()
    {
        return 'This is a great response! ' . $this-&gt;id;
    }
}</code></pre>
<h2>One-off Notifications</h2>
<p>(a.k.a. Anonymous notifications)</p>
<pre><code class="language-php">// Easy way to notify people who aren't in your system as Notifiable
Notification::route('mail', 'taylor@laravel.com')
    -&gt;notify(new App\Notifications\NotifyThingHappened);</code></pre>
<h2>Validation improvements</h2>
<ul>
<li>Return validated data from <code>$this-&gt;validate()</code></li>
<li>Custom validation &quot;rule&quot; classes; <code>php artisan make:rule</code>
<ul>
<li><code>passes()</code> returns boolean; receives name and value</li>
<li><code>message()</code> returns error message if needed</li>
</ul></li>
</ul>
<p>Use:</p>
<pre><code class="language-php">$this-&gt;validate([
    'myfield' =&gt; [
        'string',
        'required',
        new App\Rules\MyValidationRule
    ]
);</code></pre>
<h2>TrustedProxy package brought internally</h2>
<p>If you have a proxy in front of your app like a CloudFlare proxy or something else that provides the SSL which then at your proxy, Laravel currently cannot correctly detect that it's an HTTP request. It's getting requests from port 80 instead of port 443.</p>
<p>TrustProxies Middleware, extending Fideloper's TrustedProxy, teaches the system how to trust the proxy that their forwarded headers (including those identifying that it's SSL) are trustworthy. </p>
<p><code>$proxies</code> property on the middleware allows you to define which proxies are trusted.</p>
<h2>Migrate:fresh</h2>
<ul>
<li>Ignores the <code>down</code> migrations and just wipes the whole database before re-<code>up</code>ing.</li>
</ul>
<h2>New database migration trait</h2>
<ul>
<li>Previously we used <code>DatabaseMigrations</code> and <code>DatabaseTransactions</code>; new combined way of doing it</li>
<li>Inspired by Adam Wathan (of course); migrates <em>once</em> at the start of your tests and then runs every test after that with transactions</li>
<li>Benefit: We don't have to remember to migrate every time (solved by <code>DatabaseMigrations</code>) but it's faster because we're not re-migrating every time (solved by <code>DatabaseTransactions</code>); now both in one world</li>
<li>New trait: named <code>RefreshDatabase</code></li>
</ul>
<pre><code class="language-php">// Usage
class MyTest extends TestCase
{
    use RefreshDatabase;
}</code></pre>
<h2><code>WithoutExceptionHandling</code> middleware</h2>
<ul>
<li>If doing integration testing, in the past, exceptions would just get swallowed in your tests.</li>
<li>Disabling exception handling allows exceptions to bubble up to PHPUnit so you can see what's going wrong</li>
<li>Avoids integration calls failing silently and being only fixable via log tailing</li>
</ul>
<h2>Dusk improvements</h2>
<ul>
<li>Headless by default&mdash;faster and doesn't pop up a browser every time</li>
</ul>
<h2>Package auto-discovery</h2>
<ul>
<li>Inspired/originally created by Dries Vints of Laravel.io</li>
<li>No longer have to register your service provider in the <code>config/app.php</code> provider array; now, set a block in each package's <code>composer.json</code> that teaches Laravel to discover it without any manual work</li>
<li><code>php artisan package:discover</code> runs the discovery process</li>
<li>&quot;Most of the time I install a package I just do composer require packagename and then I'm good to go. Don't have to do anything else&quot;</li>
</ul>
<h2><code>Vendor:publish</code> menu</h2>
<ul>
<li>Nice readout of all the packages and tags you could pick instead of having to manually pass in providers every time</li>
</ul>
<h2>Auto-registered console commands</h2>
<ul>
<li>No longer have to put commands in the <code>app/Console/Kernel.php</code> commands array</li>
<li>Instead, Laravel looks for all classes that are commands every time you try to run a command and finds it for you</li>
</ul>
<h2>Job chaining</h2>
<ul>
<li>Dispatch a job and then queue up other jobs to be queued up after that one is completed</li>
</ul>
<pre><code class="language-php">dispatch((new App\Jobs\PerformTask)-&gt;chain([
    new App\Jobs\AnotherTask,
    new App\Jobs\FinalTask($post)
]));</code></pre>
<h2>Better missing model handling in jobs</h2>
<ul>
<li>If you have a job that's referencing a model and that model disappears before the job is handled, the job will fail out instantly if the model does not exist</li>
<li>Previously it would try and try forever</li>
<li>If you set <code>$deleteWhenMissingModels</code> to true it just deletes itself without even failing</li>
</ul>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-horizon-a-dashboard-for-your-queues</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-laravel-horizon-a-dashboard-for-your-queues"/>
        <title>Introducing Laravel Horizon - a Dashboard for your Queues</title>
        <published>2017-07-25T00:00:00+00:00</published>
        <updated>2017-07-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">At Laracon 2017, today, Taylor introduced the late...</summary>
        <content type="html"><![CDATA[
        <p>At Laracon 2017, today, Taylor introduced the latest package in the Laravel world. Like Cashier, Scout, and Passport before it, Horizon is an open-source package that you can bring into your apps but isn't distributed with the core.</p>
<p><img src="/assets/images/content/horizon-sales-pitch.png" alt="Horizon Sales Pitch" /></p>
<blockquote>
<p>Update: After I wrote this post, Taylor also released an <a href="https://medium.com/p/introducing-laravel-horizon-4585f66e3e">intro post on Medium</a> covering a lot of these topics from the official angle. </p>
</blockquote>
<h2>What is Horizon?</h2>
<p>Horizon is a package for configuring and understanding your queues. It provides you control, insight, and analytics into the number of queues and queue workers you have, your failed jobs, and your job throughput. Horizon makes it easy to configure your queues <em>and</em> see how they're doing.</p>
<p><img src="/assets/images/content/horizon-global-overview.png" alt="Horizon Global Overview" /></p>
<h3>Code-based configuration</h3>
<p>Using code-based configuration, just like you're used to with any other Laravel apps and components, you can tell Horizon how many supervisors to run and for each define which connection they'll use, which queues they should operate on, which mechanism to use for balancing the work, and the maximum number of processes they can spin up.</p>
<p>Horizon makes it easy to define all of these settings uniquely for each environment.</p>
<pre><code class="language-php">&lt;?php

// horizon config file
[
// ...,
'environments' =&gt; 
    'production' =&gt; [
        'supervisor-1' =&gt; [
            'connection' =&gt; 'redis',
            'queue' =&gt; ['default'],
            'balance' =&gt; 'simple',
            'processes' =&gt; 10,
            'tries' =&gt; 3
        ]
    ],

    'local' =&gt; [
        'supervisor-1' =&gt; [
            'connection' =&gt; 'redis',
            'queue' =&gt; ['default', 'notifications'],
            'balance' =&gt; 'simple',
            'processes' =&gt; 20,
            'tries' =&gt; 3,
            'min-processes' =&gt; 5, // optional config
        ]
    ]

// ...

'waits' =&gt; ['redis:default' =&gt; 5] // If I read this syntax correctly, sets how long to wait before consider queue "backed up"
];</code></pre>
<h3>Commands</h3>
<p>There are a few commands you can pass to Horizon. Here are those Taylor shared:</p>
<pre><code class="language-bash">php artisan horizon:pause # pause but not stop worker
php artisan horizon:continue # resume after pause
php artisan horizon:terminate # gracefully stop during deploy process
php artisan horizon:snapshot # take a metrics snapshot; cron as often as you want</code></pre>
<h3>High-level analytics</h3>
<p>Horizon provides you with a few key metrics on your entire queue:</p>
<ul>
<li>Jobs per minute</li>
<li>Jobs in the past hour</li>
<li>Failed jobs in the past hour</li>
<li>Queue worker status</li>
<li>Total processes</li>
<li>Max wait time for your jobs</li>
<li>Max run time for your jobs</li>
<li>Max throughput for your jobs </li>
</ul>
<p>It'll also show you a list of the supervisors you have running, how many processes they're supervising, which queues they're operating on, and whether they're a balancing supervisor.</p>
<p><img src="/assets/images/content/horizon-high-level-analytics.png" alt="Horizon High-level Analytics" /></p>
<h3>Job- and queue- specific analytics</h3>
<p>Horizon provides throughput-over-time and runtime-over-time graphs for each of your individual queued jobs.</p>
<p><img src="/assets/images/content/horizon-job-specific-analytics.png" alt="Horizon Job-Specific Analytics" /></p>
<blockquote>
<p>Note: This also works for anything else that's queued. Event listeners, notifications, queued mail, etc.</p>
</blockquote>
<h3>Tags and Monitoring</h3>
<p>Horizon makes it simple to &quot;tag&quot; your queued jobs and to monitor for given tags, giving you even better insight into certain classes of jobs or certain users.</p>
<p>To tag a job, add it to the <code>tags()</code> method on the job:</p>
<pre><code class="language-php">class MyJob
{
    // ...
    public function tags()
    {
        return ['videos', 'video:' . $this-&gt;video-&gt;id];
    }
}</code></pre>
<p>Then later you can go to the tag monitoring and choose to pull <em>just</em> specific tags; e.g. customer emails having trouble with Invoice 14; you can monitor <code>Invoice:14</code> tag and just watch it for a bit to see what's happening, failing, etc.</p>
<p>If you don't provide a <code>tags</code> method, Laravel will auto-tag jobs by the Eloquent model Ids; if you have a &quot;Video&quot; eloquent model attached to your job with the ID of 4, your job will automatically get the tag <code>App\Video:4</code> applied to it.</p>
<h3>Recent jobs</h3>
<p>Horizon keeps track of the most recent queued jobs and shows all of the important information you might want to know about each: which queue they ran on, which tags they had, when they were queued, how long they took to run, and whether or not they succeeded.</p>
<p><img src="/assets/images/content/horizon-recent-jobs.png" alt="Horizon Recent Jobs" /></p>
<h3>Failed jobs</h3>
<p>For each failing job, Horizon tracks the stack trace and all of the relevant data, making it easy to understand the reason for the failure. You can also choose to retry a failed job after resolving whatever caused it to fail.</p>
<p>If you retry a job, you can see all of the additional tries after the first to see how they did (or didn't) change.</p>
<p><img src="/assets/images/content/horizon-failing-job.png" alt="Horizon Failed Job" /></p>
<p>Even if you're not monitoring a tag, you can search the &quot;Failed Jobs&quot; list for any tags&mdash;allowing you to debug after the fact. </p>
<p>Failed jobs are retained for seven days (configurable) and the ability to search their tags is retained for 48 hours. All of this metadaa is stored directly in Redis.</p>
<h3>Queue balancing strategies</h3>
<p>You may have noticed that one of the options in the configuration is &quot;balance&quot;, which is set to &quot;simple&quot; in each of the given examples. Queue balancing describes strategies to handle how Horizon splits resources between two queues.</p>
<ul>
<li><em>simple</em> splits the processes between the two, regardless of the workload</li>
<li><em>auto</em> auto-balances your queue workers based on the number of remaining jobs <em>and</em> average wait time on each queue</li>
</ul>
<h3>Notifications</h3>
<p>Horizon can send SMS or Slack messages to notify the app owner if the wait is getting long on a queue.</p>
<pre><code class="language-php">// AppServiceProvider
Horizon::routeSlackNotificationsTo('slack endpoint');
Horizon::routeSmsNotificationsTo('phone number');</code></pre>
<p>&quot;Long&quot; is defined via a &quot;waits&quot; configuration setting.</p>
<h3>Authentication</h3>
<p>On first installation, dashboard is local-only.</p>
<p>You can also choose who has access to it:</p>
<pre><code class="language-php">// AppServiceProvider
// Choose who can see the dashboard
Horizon::auth(function ($request) {
    return true;
});</code></pre>
<h2>Conclusion</h2>
<p>I'm looking forward to diving into Horizon as soon as I can get my hands on it, and I'll be sure to write up anything I haven't covered here. But as someone who runs quite a few projects that rely on queues, I'm very much looking forward to adding Horizon to everything.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/lambo-config-and-after-scripts-for-even-better-laravel-app-creation</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/lambo-config-and-after-scripts-for-even-better-laravel-app-creation"/>
        <title>Lambo &quot;config&quot; and &quot;after&quot; scripts for even better quick Laravel app creation</title>
        <published>2017-07-22T00:00:00+00:00</published>
        <updated>2017-07-22T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            If you&#039;re not familiar with Lambo, it&#039;s a command...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>If you're not familiar with <a href="https://github.com/tightenco/lambo">Lambo</a>, it's a command-line tool I built to quickly spin up a new Laravel application and take some of the most common steps you may want to at the beginning of each project. Check out our <a href="https://tighten.co/blog/lambo-quick-new-application-creation-with-laravel-and-valet">writeup on the Tighten blog</a> if you want to learn more.</p>
</blockquote>
<h2>The itch</h2>
<p>I use Lambo all the time. I create a lot of apps, yes, but I also write and teach about Laravel a lot. Before Lambo, I would hack my examples and tests into a pre-existing app to make sure things worked the way I wanted. With Lambo, I now just spin up a quick new Laravel install every time I need to test anything. I love Lambo.</p>
<p>I love the customization flags you can pass into Lambo. &quot;I want to open the code in Sublime Text, the site in Chrome, and I want to run <code>npm install</code> afterward.&quot; Cool.</p>
<p>But the switches are hard to remember; and, honestly, it's harder to remember to even type them. <code>lambo MyApplication -e subl -q imconfused -zztop</code>... more often than not I type <code>lambo MyApplication</code> and then two seconds later yell &quot;crap&quot; and CMD-c and try to re-do it with the right flags. At that point, Lambo's still faster than not-Lambo, but it's starting to bother me.</p>
<p>And, of course, there are still some common tasks that you could never perform with Lambo&mdash;for example, installing your <a href="https://mattstauffer.co/blog/what-packages-do-you-install-on-every-laravel-application-you-create">use-on-every-app packages</a>.</p>
<h2>Introducing the <code>config</code> file</h2>
<p>So, I made an issue. I had some discussion with folks who take a look at Lambo's issues, and we came up with the idea of a config file that lets you set your defaults.</p>
<p>Thanks to <a href="https://twitter.com/_cpb">@_cpb</a>, you can create a <code>config</code> file (which lives in <code>~/.lambo/config</code>) that's a <code>.env</code>-style set of key/value pairs. Each key represents one of the variables that is toggled by one of the command-line flags. This way, you do't have to remember to always set your code editor; just set it once in <code>config</code> and it sticks.</p>
<p>Just upgrade to the latest (<code>composer global update tightenco/lambo</code>) and then create a config file (<code>lambo make-config</code>). Here's mine:</p>
<pre><code class="language-bash">#!/usr/bin/env bash

PROJECTPATH="."
MESSAGE="Initial commit."
DEVELOP=false
AUTH=false
NODE=true
CODEEDITOR=subl
BROWSER=""
LINK=false</code></pre>
<p>Edit that file and its flags will be passed to every new application you create with Lambo.</p>
<h2>Introducing the <code>after</code> file</h2>
<p>That covers you for remembering the config flags. But what about <em>other</em> operations you take every time you spin up a site?</p>
<p>We have you covered for that, too. Once again, I opened up an issue, we had some conversation, and a different contributer <a href="https://twitter.com/quickliketurtle">@quickliketurtle</a> wrote the actual code. You can now create an <code>after</code> script (<code>~/.lambo/after</code>), a shell script that runs after Lambo's normal processes, and you can define literally anything you want in there.</p>
<p>Here's what mine looks like:</p>
<pre><code class="language-bash">#!/usr/bin/env bash

# Install additional composer dependencies
echo "Installing Composer Dependencies"
composer require barryvdh/laravel-debugbar

# Copy standard files from ~/.lambo/includes into every new project
echo "Copying Include Files"
cp -R ~/.lambo/includes/ $PROJECTPATH

# Add a git commit after given modifications
echo "Committing after modifications to Git"
git add .
git commit -am "Initialize Composer dependencies and additional files."</code></pre>
<p>Just like with the config file, upgrade Lambo (<code>composer global update tightenco/lambo</code>) and then create an <code>after</code> file (<code>lambo make-after</code>). Edit that file and it will run every time after Lambo runs.</p>
<p>I put a <code>nitpick.json</code> file in that <code>includes/</code> directory so my <a href="https://nitpick-ci.com/">Nitpick</a> config is set up right on every project I start.</p>
<p>Now it's easier than ever to use Lambo to spin up the perfect Laravel application, every time.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/what-packages-do-you-install-on-every-laravel-application-you-create</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/what-packages-do-you-install-on-every-laravel-application-you-create"/>
        <title>What packages do you install on every Laravel application you create?</title>
        <published>2017-07-18T00:00:00+00:00</published>
        <updated>2017-07-18T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In preparation for my upcoming talk at Laracon 201...</summary>
        <content type="html"><![CDATA[
        <p>In preparation for my upcoming <a href="http://customlaravel.com/">talk</a> at <a href="https://laracon.us/">Laracon 2017</a>, which I'm titling &quot;Custom Laravel,&quot; I asked a quick question on Twitter to my followers:</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Laravel devs: what are the packages you install on *every* app?</p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/885666786036899840">July 14, 2017</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I wanted to know for my talk, but I was also just curious for my own purposes. Are there any packages I should check out that everyone else already knows about?</p>
<p>Here's what I found, in order of the number of recommendations I received:</p>
<h2>Nearly unanimous support ❤️❤️❤️❤️</h2>
<p>Dang, y'all love these packages.</p>
<ul>
<li><strong><a href="https://github.com/barryvdh/laravel-debugbar">Laravel Debugbar</a></strong><br>
Makes it simple to add the PHP Debugbar, customized and colored for Laravel, to your applications. Dive deep into your call stack, views, database queries, etc.</li>
<li><strong><a href="https://github.com/barryvdh/laravel-ide-helper">Laravel IDE Helper</a></strong><br>
Teach your IDE (PHPStorm; I doubt any other IDEs reference it, but I'm not sure) how to handle autocompletion and docblocks for Laravel.</li>
<li><strong><a href="https://github.com/LaravelCollective/html">LaravelCollective HTML</a></strong><br>
Laravel's form and HTML generators, archived by the Laravel Collective. Most beloved because of form model binding.</li>
</ul>
<h2>Well-loved packages ❤️❤️❤️</h2>
<p>They don't necessarily work on every app, but these still came very highly recommended.</p>
<ul>
<li><a href="https://github.com/thephpleague/fractal">Fractal</a> or <a href="https://github.com/spatie/laravel-fractal">Laravel-Fractal</a> (for making APIs)</li>
<li><a href="https://github.com/Intervention/image">Intervention Image</a> (for modifying and creating images)</li>
<li><a href="https://github.com/laravel/dusk">Laravel Dusk</a> (for browser-based testing)</li>
<li><a href="https://github.com/doctrine/dbal">Doctrine DBAL</a> (for better database modifications)</li>
</ul>
<h2>Received a few recommendations ❤️❤️</h2>
<p>These had two or three recommendations&mdash;enough to pique my interest, but clearly not globally installed.</p>
<ul>
<li><a href="https://github.com/appstract/laravel-opcache">Appstract Opcache</a></li>
<li><a href="https://github.com/spatie/laravel-backup">Laravel-Backup</a></li>
<li><a href="https://github.com/yajra/laravel-datatables">Yajra Datatables</a></li>
<li><a href="https://github.com/phpspec/phpspec">PHPSpec</a></li>
<li><a href="https://github.com/squizlabs/PHP_CodeSniffer">PHP CodeSniffer</a></li>
<li><a href="https://github.com/phpmd/phpmd">PHPMD</a></li>
<li><a href="https://github.com/filp/whoops">Whoops</a></li>
<li><a href="https://github.com/andersao/l5-repository">Laravel 5 Repositories</a></li>
<li><a href="https://github.com/laracasts/flash">Laracasts Flash</a></li>
<li>Exception handlers (<a href="https://github.com/bugsnag/bugsnag-laravel">Bugsnag</a>/<a href="https://github.com/jenssegers/laravel-rollbar">Rollbar</a>/<a href="https://github.com/getsentry/sentry-laravel">Sentry</a>)</li>
</ul>
<h2>Just one recommendation ❤️</h2>
<p>It's hard to just ignore someone who went to the effort to compose a tweet. Here you go, folks. Only one recommendation for each of these; but someone, somewhere, wanted to recommend it.</p>
<ul>
<li><a href="https://github.com/spatie/Laravel-permission">Laravel Permission</a></li>
<li><a href="https://github.com/itsgoingd/clockwork">Clockwork</a></li>
<li><a href="https://github.com/spatie/laravel-tinker-tools">Laravel Tinker Tools</a></li>
<li><a href="https://github.com/Codeception/Codeception">Codeception</a></li>
<li><a href="https://github.com/barryvdh/laravel-dompdf">Laravel DOM-PDF</a></li>
<li><a href="https://github.com/Maatwebsite/Laravel-Excel">Laravel Excel</a></li>
<li><a href="https://github.com/deployphp/deployer">Deployer</a></li>
<li><a href="https://github.com/antonioribeiro/laravelcs">LaravelCS</a></li>
<li><a href="https://github.com/sebastianbergmann/phpcpd">PHPCPD</a></li>
<li><a href="https://github.com/spatie/laravel-tail">Laravel Tail</a></li>
<li><a href="https://packagist.org/packages/rap2hpoutre/laravel-log-viewer">Laravel 5 log Viewer</a></li>
<li><a href="https://github.com/antonioribeiro/health">Health Monitor</a></li>
<li><a href="https://github.com/lubusIN/laravel-decomposer">Laravel Decomposer</a></li>
</ul>
<blockquote>
<p>Note: I ignored a few recommendations that were extremely context-specific (Mongo) or which were recommended by the package author. :)</p>
</blockquote>
<h2>Skeletons</h2>
<p>A few folks instead pointed to publicly available app skeletons, each of which has their own unique set of packages and customizations:</p>
<ul>
<li><a href="https://github.com/sebastiaanluca/laravel-skeleton-5.4">Sebastiaan Luca - Skeleton</a></li>
<li><a href="https://github.com/rappasoft/laravel-5-boilerplate">Rappasoft Laravel 5 Boilerplate</a></li>
<li><a href="https://github.com/spatie/skeleton-php">Spatie Laravel Skeleton</a></li>
</ul>
<p>At Tighten, we currently don't use a skeleton, but I do have some cool news to share at Laracon that will show how easy it is to do some of this same work, even without a skeleton.</p>
<h2>... Elsewhere</h2>
<p>There's another post Eric Barnes linked me to where Mike Erickson asked people their <em>one</em> favorite package&mdash;similar to this question, but not quite the same. Check it out: <a href="https://laravel-news.com/favorite-package-for-all-projects">What is the one package you install in all Laravel projects?</a></p>
<p>It looks like they found the same thing as I did: Debugbar and IDE helper are the winners in our community. If you haven't checked them out, be sure to do so!</p>
<h2>Outro</h2>
<p>Did I miss any absolutely vital packages here? <a href="https://twitter.com/stauffermatt">Let me know on Twitter</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/elsewhere-a-brief-introduction-to-progressive-web-apps</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/elsewhere-a-brief-introduction-to-progressive-web-apps"/>
        <title>Elsewhere: A brief introduction to Progressive Web Apps</title>
        <published>2017-06-08T00:00:00+00:00</published>
        <updated>2017-06-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Over on the Tighten blog I wrote up an extensive i...</summary>
        <content type="html"><![CDATA[
        <p>Over on the Tighten blog I wrote up an extensive introduction to Progressive Web Apps. Later in the series I'll actually teach you how to create your own. Check it out!</p>
<blockquote>
<p>Within the last year or two I've watched references to service workers and PWAs, or Progressive Web Apps, go from never-heard-of-them to every-other-tweet. So! Let's go learn. What is a PWA? What's their history, purpose, and value? Why do we care?</p>
</blockquote>
<p><a href="https://blog.tighten.co/a-brief-introduction-to-progressive-web-apps-or-pwas">Tighten Blog: A Brief Introduction to Progressive Web Apps, or PWAs</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/what-happens-to-laravel-if-taylor-otwell-disappears</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/what-happens-to-laravel-if-taylor-otwell-disappears"/>
        <title>What happens to Laravel if Taylor Otwell disappears?</title>
        <published>2017-05-05T00:00:00+00:00</published>
        <updated>2017-05-05T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">After we talked a bit about enterprise apps on the...</summary>
        <content type="html"><![CDATA[
        <p>After we <a href="http://www.laravelpodcast.com/episodes/68236-episode-53-bigger-better">talked a bit about enterprise apps on the Laravel Podcast the other day</a> , a few folks in the Laravel community have been talking about what makes a tool <em>enterprise-ready</em>.
I have a lot of thoughts about support plans, SLAs, and other such features of &quot;enterprise-readiness&quot;, but I'll save those for a later date. Today, let's talk about the easiest-to-dismiss concern: <em>What happens if Taylor disappears suddenly?</em></p>
<p>This question brings up the point that, unlike a framework backed by a company, a framework backed by an individual relies on that individual's desire and ability to keep the project running. What happens if Taylor decides he wants to retire and be a goat farmer?</p>
<p>I'd like to share a few points in response to this concern.</p>
<blockquote>
<p>Note: I also <a href="http://www.fiveminutegeekshow.com/19">recorded a Five-Minute Geek Show about this</a> back in 2015.</p>
</blockquote>
<h2>There is a plan</h2>
<p>Most simply, I think the majority of people with this concern have never stopped to just look whether this has been considered. It has. For a long time.</p>
<p>Taylor even shared <a href="https://www.reddit.com/r/laravel/comments/3bewjn/what_happens_to_laravel_if_taylor_otwell_is/csljobh/">his answer on Reddit</a> about a year ago:</p>
<p><img src="/assets/images/content/taylor-bus-reddit.png" alt="Taylor answering this question on Reddit" /></p>
<p><em>If anything ever happens to Taylor, Jeffrey Way of Laracasts will take over.</em> Jeffrey has been here since almost the beginning, has access to everything he needs to keep the products and the framework running, and is a great developer and teacher with a vision for the framework.</p>
<h2>Laravel, LLC</h2>
<p>Many folks have also said that what they really want is a <em>company</em> instead of a <em>person</em>.</p>
<p>Well, here ya go: Taylor may be the primary creator and maintainer of Laravel, the open source framework, but the ecosystem of tools around Laravel is managed by Laravel, LLC, a company with an owner (Taylor) and an employee (Mohamed Said). If Taylor ever disappears, the company still exists. It still has a flow of revenue and an employee to run it.</p>
<p>Sure, the company doesn't have 500 employees, but it is also not just tied to Taylor's personal social security number and brain. There are systems and structures in place, already.</p>
<h2>See: CodeIgniter</h2>
<p>Let's say there weren't a plan, and Taylor did disappear. Let's say Laravel, LLC and Mohamed didn't exist. Let's say the <em>formal</em> plan for Jeffrey to take over weren't already in place.</p>
<p>If, in that <em>non-existent</em> circumstance, Taylor disappeared, Laravel Forge and Envoyer and Spark would be effectively end-of-lifed.</p>
<p>... and, just like when EllisLab completely dropped the ball on CodeIgniter for many years, the community of contributors and users of the framework would continue to develop it, adding new features. If necessary, frameworks would fork off of Laravel and at least one would start as a near-mirror. Laravel itself would get security updates and bug fixes by the massive community of people who submit pull requests to the framework <em>every day</em>.</p>
<h2>Tighten etc.</h2>
<p>I can't specifically speak for other consultancies who use Laravel, but Tighten has already committed time, effort, and finances to support the ongoing development of Laravel. This wouldn't stop if Taylor disappeared. Ideologically, we want the work to move forward and would do what we could to support the work and the community of Laravel.</p>
<p>But for those of you who may pooh pooh our ideological goals, there are also pragmatic reasons for us to actively work for the good of Laravel. We love the tool. There's a reason it's the tool we pick for the majority of our projects: it's a fantastic tool and a fantastic ecosystem. We make money using Laravel. We have no interest in it going away and we're committed to seeing it succeed.</p>
<h2>And on and on...</h2>
<p>There's plenty more, and I hope to find some time to write more posts about other aspects of Laravel's enterprise readiness or non-readiness. But this is the simplest, easiest to address, so I hope we can stop bringing it up and call this handled. Good? Good.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/how-to-set-up-your-laravel-application-for-zero-downtime-envoyer-capistrano-deploys
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-set-up-your-laravel-application-for-zero-downtime-envoyer-capistrano-deploys"/>
        <title>How to set up your Laravel application for zero-downtime (Envoyer/Capistrano) deploys</title>
        <published>2017-03-29T00:00:00+00:00</published>
        <updated>2017-03-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve ever worked with Capistrano or Envoyer, ...</summary>
        <content type="html"><![CDATA[
        <p>If you've ever worked with Capistrano or Envoyer, you've probably seen a directory structure in your webroot that looks something like this:  </p>
<pre><code>root root   4096 Mar 29 18:44 .
root root   4096 Mar 28 14:15 ..
root root   47   Mar 29 14:54 current -&gt; ./releases/1490824249
root root   4096 Mar 29 14:50 releases</code></pre>
<p>Where you're expecting to see your webroot containing your Git repository, instead it's this weird structure. What gives?</p>
<h2>A brief introduction to Capistrano-style zero-downtime deploys</h2>
<p>The reason you're getting zero-downtime deploy from these tools is because the entire deploy process—clone, composer install, etc.—doesn't happen in the directory that is currently serving your site. Instead, each new release gets its own separate &quot;release&quot; directory, all while your site is still being served from its current &quot;release&quot; directory.</p>
<pre><code>- current -&gt; ./releases/1490802721 * apache/nginx serves from this directory
- releases
    - 1490802133 (the new release you're building right now)
    - 1490802721 (latest complete release)
    - 1490803081 (a little bit older release)
    - 1490824249 (an even older release)</code></pre>
<p>All of these release directories are just subdirectories of <code>releases</code>. Each directory here represents one of your deploys, and each directory individually has everything needed to serve your site. Your web server points to <code>yourproject/current/public</code> and therefore the &quot;currently served&quot; release is just that which has a symlink pointed at it from <code>yourproject/current</code>.</p>
<p>So, once the build process is complete for each new release, your deploy tool will delete the <code>current</code> symlink and create a new <code>current</code> symlink that points to your latest release. Boom. Now that release is live.</p>
<h2>Caveats</h2>
<p>In general, Laravel is no different from any other project in that this style of deployment works great. In fact, a tool provided by Taylor Otwell, <a href="https://mattstauffer.co/blog/introducing-envoyer.io">Envoyer</a>, is predicated around this release style.</p>
<p>However, every tool has a different set of caveats around how to handle them well in zero-downtime settings. Here's why:</p>
<p>There are always some things that you want to persist between releases. Most of it lives in databases and caches, which is fine—nothing's wiping your database on every deploy. But some isn't. Take the <code>storage</code> folder; do you want to wipe that every time you push a new release? Naw. What about the <code>.env</code> file? Definitely naw. So there are a few quick tricks.</p>
<h2>How to set up your deploy for Laravel</h2>
<p>Remember: If you use Envoyer, this is all handled for you. But if you don't, here's what to do.</p>
<ol>
<li>Clone your release into a new release folder. This should be handled by your deploy tool.</li>
<li><code>composer install -o --no-interaction</code></li>
<li><code>php artisan migrate --no-interaction --force</code></li>
<li><em>(optional, if you don't commit your built scripts)</em> <code>npm install</code> (or <code>yarn</code>) and either <code>gulp --production</code> (Elixir) or <code>npm run production</code> (Mix)</li>
<li><code>rm -rf storage &amp;&amp; ln -s ../../storage ./</code><br />
(Delete the <code>storage</code> directory and symlink it to a <code>storage</code> folder in the parent)</li>
<li><code>ln -s ../../.env ./</code><br />
(Symlink the <code>.env</code> file to a <code>.env</code> file in the parent)</li>
<li><code>php artisan route:cache</code></li>
<li><code>php artisan config:cache</code></li>
<li>Update the <code>current</code> symlink to your new release. This should be handled by your deploy tool.</li>
<li><code>php artisan queue:restart</code><br />
(Restart the queue.)</li>
</ol>
<p>This is all you need to do on every deploy. As you can tell, you'll end up with a root directory that looks a bit more like this:</p>
<pre><code>root root   4096 Mar 29 18:44 .
root root   4096 Mar 28 14:15 ..
root root   1033 Mar 29 18:44 .env
root root   47   Mar 29 14:54 current -&gt; ./releases/1490824249
root root   4096 Mar 29 14:50 releases
root root   4096 Mar 29 14:51 storage</code></pre>
<p>And, of course, you'll need to create the <code>.env</code> file and the <code>storage</code> directory and subdirectories <em>before</em> you run your build script for the first time.</p>
<p>But that's it! You're now ready to go! Get deploying!</p>
<h2>Postscript</h2>
<p>Looking for a list of steps to take on every deploy, regardless of whether or not it's Capistrano?</p>
<pre><code class="language-bash">composer install -o --no-interactions
php artisan migrate --no-interaction --force
yarn &amp;&amp; npm run production
php artisan route:cache
php artisan config:cache
php artisan queue:restart</code></pre>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/removing-all-vue-dependencies-from-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/removing-all-vue-dependencies-from-laravel"/>
        <title>Removing all Vue dependencies from Laravel</title>
        <published>2017-03-14T00:00:00+00:00</published>
        <updated>2017-03-14T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">The recent versions of Laravel have come with some...</summary>
        <content type="html"><![CDATA[
        <p>The recent versions of Laravel have come with some very minor Vue dependencies out of the box. They're easy to remove, but you may have not actually tried that yet, or you might be worried you're going to leave something sitting there. So, here's a quick tip on how to remove all Vue dependencies in a new Laravel install in a few easy steps.</p>
<h2>1. Install Laravel</h2>
<pre><code>laravel new my-react-project
cd my-react-project</code></pre>
<h2>2. Drop Vue from <code>package.json</code></h2>
<p>Here's what the <code>devDependencies</code> section of the default <code>package.json</code> looks right now:</p>
<pre><code class="language-javascript">{
  "devDependencies": {
    "axios": "^0.15.3",
    "bootstrap-sass": "^3.3.7",
    "cross-env": "^3.2.3",
    "jquery": "^3.1.1",
    "laravel-mix": "^0.8.3",
    "lodash": "^4.17.4",
    "vue": "^2.1.10"
  }
}
</code></pre>
<p>You'll definitely want to drop this entry:</p>
<pre><code>    "vue": "^2.1.10"</code></pre>
<p>If you want, you can also drop <a href="https://github.com/mzabriskie/axios">Axios</a> (a fantastic, framework-agnostic, HTTP client) and <a href="https://lodash.com/">Lodash</a> (a simple JS library providing collection support and other convenient tools augmenting JS's somewhat sparse API).</p>
<p>You can drop jQuery and Bootstrap-sass, if you won't be using them, and if you're not a Windows user you can drop <code>cross-env</code>.</p>
<blockquote>
<p>Note: if you drop the <code>cross-env</code> dependency, you also have to remove the string &quot;cross-env &quot; from the beginning of each of the <code>scripts</code> lines (e.g. <code>cross-env NODE_ENV=...</code> becomes <code>NODE_ENV=...</code>).</p>
</blockquote>
<p>So, if you wanted a brand new project that uses Mix but no other dependencies, here's what your <code>package.json</code> would look like:</p>
<pre><code class="language-javascript">{
  "private": true,
  "scripts": {
    "dev": "NODE_ENV=development node_modules/webpack/bin/webpack.js --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js",
    "watch": "NODE_ENV=development node_modules/webpack/bin/webpack.js --watch --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js",
    "watch-poll": "NODE_ENV=development node_modules/webpack/bin/webpack.js --watch --watch-poll --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js",
    "hot": "NODE_ENV=development node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --hot --config=node_modules/laravel-mix/setup/webpack.config.js",
    "production": "NODE_ENV=production node_modules/webpack/bin/webpack.js --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js"
  },
  "devDependencies": {
    "laravel-mix": "^0.8.3"
  }
}</code></pre>
<p>Once you modify your <code>package.json</code> file, if you're using Yarn, you'll want to update your <code>yarn.lock</code> file:</p>
<pre><code class="language-bash">yarn upgrade</code></pre>
<h2>3. Drop the bootstrap and the sample component</h2>
<p>In <code>resources/assets/js/app.js</code>, our default script requires a bootstrap and sets up a sample Vue component. Here's what it looks like right now (with comments removed):</p>
<pre><code class="language-javascript">require('./bootstrap');

Vue.component('example', require('./components/Example.vue'));

const app = new Vue({
    el: '#app'
});</code></pre>
<p>If you are dropping all the other dependencies as well (Axios, jQuery, Lodash, etc.) you can just delete all the code in <code>app.js</code>, and delete the bootstrap (<code>resources/assets/js/bootstrap.js</code>) and the sample Vue component (<code>resources/assets/js/components/Example.vue</code>).</p>
<p>If you're planning to keep all the non-Vue components, you'll want to delete the Vue lines of <code>app.js</code>, and then modify the bootstrap. Open <code>resources/assets/js/bootstrap.js</code> and drop this line: <code>window.Vue = require('vue');</code>.</p>
<h2>Conclusion</h2>
<p>That's it! You've wiped all the Vue out of the app and optionally all the other dependencies.</p>
<p>In case you're like me and want all the other dependencies but just not Vue some times, here's a short task list for that:</p>
<ol>
<li>Delete Vue from <code>package.json</code></li>
<li>Delete the <code>Vue.component(...</code> line and the <code>const app = new Vue({</code> block from <code>resources/assets/js/app.js</code></li>
<li>Delete <code>window.Vue = require('vue');</code> from <code>resources/assets/js/bootstrap.js</code></li>
<li>Delete the <code>resources/assets/js/components</code> directory</li>
</ol>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-work-with-google-spreadsheets-in-php</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-work-with-google-spreadsheets-in-php"/>
        <title>How to work with Google Spreadsheets in PHP</title>
        <published>2017-03-07T00:00:00+00:00</published>
        <updated>2017-03-07T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I had the pleasure of writing a guest post at Twil...</summary>
        <content type="html"><![CDATA[
        <p>I had the pleasure of writing a <a href="https://www.twilio.com/blog/2017/03/google-spreadsheets-and-php.html">guest post at Twilio's blog</a> this week, focusing on how to read, insert, update, and delete data in Google Spreadsheets using PHP. It's not Laravel-specific, but throwing in a service provider would simplify the sample code up quite a bit. Check it out!</p>
<p><img src="https://www.twilio.com/blog/wp-content/uploads/2017/03/php-and-sheets.png" alt="Google Spreadsheets and PHP graphic" /></p>
<blockquote>
<p>Have you ever needed to pull some data from a Google Spreadsheet? My default in the past would be to export the data and upload it to the app directly, but it turns out it’s not very difficult to read directly from Google Spreadsheets using the Google Drive API.</p>
</blockquote>
<p><strong><a href="https://www.twilio.com/blog/2017/03/google-spreadsheets-and-php.html">Twilio - Google Spreadsheets and PHP</a></strong></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-mix-new-in-laravel-5-4</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-laravel-mix-new-in-laravel-5-4"/>
        <title>Introducing Laravel Mix (new in Laravel 5.4)</title>
        <published>2017-02-08T00:00:00+00:00</published>
        <updated>2017-02-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel Mix. The same and yet entirely different f...</summary>
        <content type="html"><![CDATA[
        <p>Laravel Mix. The same and yet entirely different from Laravel Elixir.</p>
<p>If you're not familiar with Laravel Elixir, it's a wrapper around Gulp that makes it really simple to handle common build steps—CSS pre-processing like Sass and Less, JavaScript processing like Browserify and Webpack, and more. </p>
<p>In Laravel 5.4, Elixir has been replaced by a new project called <a href="https://laravel.com/docs/5.4/mix">Mix</a>. The tools have the same end goals, but go about it in very different ways.</p>
<h2>What's so new about Mix?</h2>
<p>If you take a look at the default files for Elixir and Mix, you'll see they're very similar:</p>
<pre><code class="language-javascript">// Elixir's gulpfile.js
const elixir = require('laravel-elixir');

require('laravel-elixir-vue-2');

elixir((mix) =&gt; {
    mix.sass('app.js')
        .webpack('app.js');
});</code></pre>
<pre><code class="language-javascript">// Mix's webpack.mix.js
const { mix } = require('laravel-mix');

mix.js('resources/assets/js/app.js', 'public/js')
   .sass('resources/assets/sass/app.scss', 'public/css');</code></pre>
<p>Looks pretty similar, right? Sure, Elixir's calls are happening in an anonymous function, and Mix seems to prefer explicitly providing the source and destination, but we're doing pretty much the same thing here.</p>
<p>There's one big difference you'll experience on day one: where with Elixir you ran using either <code>gulp</code> or <code>gulp watch</code>, with Mix you'll run <code>npm run dev</code> or <code>npm run watch</code> . (You can also run <code>npm run hot</code> for &quot;HMR&quot;, or Hot Module Reloading, which &quot;hot reloads&quot; your Vue files but not other assets; or <code>npm run production</code> to generate your assets with production settings like minification).</p>
<h2>The default files and folder structure</h2>
<p>Just like with Elixir, your default Sass file will be in <code>resources/assets/sass/app.scss</code> (and the file is exactly the same), and just like with Elixir your default JS file will be in <code>resources/assets/js/app.js</code> (and the file is exactly the same—to learn more about the new-to-5.3 Vue-based structure, check out <a href="https://mattstauffer.co/blog/using-vue-in-laravel-5-3-with-the-vue-bootstrap-and-sample-component">my post about frontend structure in 5.3</a>).</p>
<p>If you dig into the bootstrap file that's included in <code>app.js</code> (<code>resources/assets/js/bootstrap.js</code>), you'll see that we're setting our <code>X-CSRF-TOKEN</code> using Axios instead of Vue-Resource (Vue-Resource <a href="https://medium.com/the-vue-point/retiring-vue-resource-871a82880af4">was retired in 2016</a>).</p>
<p>If you run <code>npm run dev</code> on a Mix project, this is what you'll see:</p>
<p><img src="/assets/images/content/default-mix-output.png" alt="Default Mix output" /></p>
<p>Our generated files end up in the same place by default that they did with Elixir: <code>public/css/app.css</code> and <code>public/js/app.js</code>.</p>
<h2>The primary Mix methods</h2>
<p>As you've already seen, you can easily mix Sass and JS; Sass, predictably, runs on your Sass file(s) and outputs them as CSS. The JS method gives you access to ES2015, <code>.vue</code> (Vueify) compilation, production minification, and a host of other processing on your JavaScript files.</p>
<p>You can also mix Less:</p>
<pre><code class="language-javascript">mix.less('resources/assets/less/app.less', 'public/css');</code></pre>
<p>You can combine files together:</p>
<pre><code class="language-javascript">mix.combine([
    'public/css/vendor/jquery-ui-one-thing.css',
    'public/css/vendor/jquery-ui-another-thing.css'
], 'public/css/vendor.css');</code></pre>
<p>You can copy files or directories:</p>
<pre><code class="language-javascript">mix.copy('node_modules/jquery-ui/some-theme-thing.css', 'public/css/some-jquery-ui-theme-thing.css');
mix.copy('node_modules/jquery-ui/css', 'public/css/jquery-ui');</code></pre>
<p>Unlike Elixir, source maps are now disabled by default, but you can bring them back:</p>
<pre><code class="language-javascript">mix.sourceMaps();</code></pre>
<p>Operating system notifications are enabled by default, but if you don't want them to run, you can disable with the <code>disableNotifications()</code> method.</p>
<h2><code>Mix.manifest.json</code> and cache-busting</h2>
<p>If you're familiar with Elixir, you might notice one thing in that output image above that is a little different from Elixir: Mix is generating a manifest file out of the box (<code>public/mix-manifest.json</code>). Elixir also generated a manifest file (<code>public/build/rev-manifest.json</code>), but it would only generate it if you explicitly enabled the cache-busting (versioning) feature. Mix generates it regardless.</p>
<p>If you're not familiar, these manifest files are maps between a file path (e.g. <code>/js/app.js</code>) and the path for the versioned copy of that file (something like <code>/js/app-86ff5d31a2.js</code>). That way you can have simple references in your HTLM (<code>&lt;script src="{{ mix('js/app.js') }}"&gt;</code>) that point to your versioned files.</p>
<p>Unlike Elixir, however, Mix generates this file even if you're not using cache busting, but it's just a direct map:</p>
<pre><code class="language-javascript">{
  "/js/app.js": "/js/app.js",
  "/css/app.css": "/css/app.css"
}</code></pre>
<p>Another interesting change for those who've used Elixir before: your built files now end up in their normal output directories, not a separate <code>build</code> directory; so your versioned JS file, for example, will live in <code>public/js/app-86ff5d31a2.js</code>.</p>
<p>To enable cache busting in Mix, just append <code>.version()</code> in your Mix file:</p>
<pre><code class="language-javascript">mix.js('resources/assets/js/app.js', 'public/js')
    .sass('resources/assets/sass/app.scss', 'public/css')
    .version();</code></pre>
<p>This is a lot simpler than passing the actual file names like you had to in Elixir.</p>
<h2>The <code>mix()</code> helper</h2>
<p>As I mentioned above, the frontend helper you'll want to use to reference your assets is now <code>mix()</code> instead of <code>elixir()</code>, but it still functions exactly the same.  If you use Mix, you'll want to remove these lines in the default Laravel template:</p>
<pre><code>    &lt;link href="/css/app.css" rel="stylesheet"&gt;
    ...
    &lt;script src="/js/app.js"&gt;&lt;/script&gt;</code></pre>
<p>And replace them with these:</p>
<pre><code>    &lt;link href="{{ mix('/css/app.css') }}" rel="stylesheet"&gt;
    ...
    &lt;script src="{{ mix('/js/app.js') }}"&gt;&lt;/script&gt;</code></pre>
<p>Remember, this function just looks that string up in <code>mix-manifest.json</code> and returns the mapped build file. It's only necessary when you're using cache busting, but it doesn't hurt to just use it by default, because that'll make it a lot easier to add cache busting down the road if you want it.</p>
<h2>Code splitting</h2>
<p>Webpack is exciting to many people in part because of the intelligence it offers about the structure of your code. I don't yet fully understand–and Mix doesn't handle out of the box–anything like tree shaking, but it does make it simple to differentiate your custom code (which might change often) from your vendor code (which shouldn't), making it far less likely that your users will have to refresh all of your vendor code every time you push a new build.</p>
<p>To take advantage of this feature, you'll want to use the <code>extract()</code> function, which allows you to define that a given set of libraries or modules (keyed by the same string they're keyed in npm and <code>require()</code> statements) will be extracted into a separate build file named <code>vendor.js</code>:</p>
<pre><code class="language-javascript">mix.js('resources/assets/js/app.js', 'public/js')
    .extract(['vue', 'jquery']);</code></pre>
<p>In this circumstance, Mix has now generated three files for me: <code>public/js/app.js</code>, <code>public/js/vendor.js</code>, and a third Webpack-specific file, <code>public/js/manifest.js</code>. I need to import all three, <em>in this order</em>, in order for it to work:</p>
<pre><code>&lt;script src="{{ mix('/js/manifest.js') }}"&gt;&lt;/script&gt;
&lt;script src="{{ mix('/js/vendor.js') }}"&gt;&lt;/script&gt;
&lt;script src="{{ mix('/js/app.js') }}"&gt;&lt;/script&gt;</code></pre>
<p>If you're using cache busting, and you make changes to your app-specific code, your <code>vendor.js</code> file will now still remain cached, and only your app-specific code will be cache busted–making your site load much faster.</p>
<h2>Custom Webpack configuration</h2>
<p>If you're interested in adding your own custom Webpack configuration, you can; just pass your Webpack configuration in:</p>
<pre><code class="language-javascript">mix.webpackConfig({
    resolve: {
        modules: [
            path.resolve(__dirname, 'vendor/laravel/spark/resources/assets/js')
        ]
    }
});</code></pre>
<p>(I'm not a Webpack guru, so I'm just going to paste that example in straight from the docs.)</p>
<h2>Conditional stuff</h2>
<p>Let's say you're interested in doing some conditional cleverness in your Webpack file. Maybe you want to copy one thing when <code>production</code> is run but not other times. How exactly would you do that?</p>
<p>The first place I looked was the Node environment object, which we have access to as <code>process.env</code>. We can check any values there–including any global environment variables on your system, which may open up an interesting opportunity, so we could conditionally check the <code>process.env.NODE_ENV</code> value:</p>
<pre><code class="language-javascript">if (process.env.NODE_ENV == 'production') {
    mix.webpackConfig({ ... });
}</code></pre>
<p>But after reading the source, I could tell <code>NODE_ENV</code> was not intended to be the primary check; instead, there's a configuration object with an <code>inProduction</code> flag on it. This isn't documented, so use with caution, but you can update the import at the top of your Webpack file and then use that config object:</p>
<pre><code class="language-javascript">const { mix, config } = require('laravel-mix');

if (config.inProduction) {
    mix.webpackConfig({ ... });    
}</code></pre>
<h2>Default dependencies</h2>
<p>You can take a look at your <code>package.json</code> and see the list of dependencies that are included with each project. Remember, these are just those that are pulled by the default <code>app.js</code> and <code>bootstrap.js</code>, but you can just delete the references out of <code>app.js</code> and <code>package.json</code> and re-run <code>npm install</code> and they won't end up in your final files.</p>
<ul>
<li><a href="https://www.npmjs.com/package/axios">Axios</a> (a beautiful and simple HTTP client)</li>
<li><a href="https://www.npmjs.com/package/bootstrap-sass">Bootstrap Sass</a> (used by the default <code>app.scss</code> file to pull Bootstrap styles in)</li>
<li><a href="https://www.npmjs.com/package/jquery">jQuery</a></li>
<li><a href="https://www.npmjs.com/package/lodash">Lodash</a> (Underscore but better)</li>
<li><a href="https://www.npmjs.com/package/vue">Vue 2</a></li>
</ul>
<h2>In conclusion</h2>
<p>Laravel Mix is a build tool that replaces Laravel Elixir. It has almost the same API, but is based on Webpack instead of Gulp. The end. Go build great things.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/moving-tech-forward-with-gomix-express-and-google-spreadsheets</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/moving-tech-forward-with-gomix-express-and-google-spreadsheets"/>
        <title>Moving tech forward with Gomix, Express, and Google Spreadsheets</title>
        <published>2017-02-06T00:00:00+00:00</published>
        <updated>2017-02-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I&#039;m a frontend and PHP developer and a left-leanin...</summary>
        <content type="html"><![CDATA[
        <p>I'm a frontend and PHP developer and a left-leaning moderate. I don't write Node and I don't get involved in political causes. At least, not until now. This is the brief story of how I was inspired to create <a href="https://tech-forward.com/">Tech Forward</a> and how I learned <a href="https://gomix.com/">Gomix</a> and Express to do it.</p>
<h2>The backstory (skip if you just want to read about the tech)</h2>
<p>I've spent the last five to ten years trying to make small changes for the good of the world by working in the relationships I already have, in person and online, to help White Americans become more engaged and interested in working toward justice. A little bit at a time, over coffee or surprisingly decent Facebook comment threads.</p>
<p>On November 9th, my wife turned to me and said: &quot;Matt, it's time for you to stop trying to change individual people on Facebook and go do something real.&quot; Ouch. But she was right.</p>
<p>Right around that time <a href="https://twitter.com/deray">DeRay Mckesson</a> put out a call to programmers who wanted to help work for social change. I responded, as did quite a few others, and I met DeRay and <a href="https://twitter.com/samswey">Sam</a> and <a href="https://twitter.com/aditij">Aditi</a> and a few other incredible individuals really making a difference. Over the span of a few weeks I had the chance to work on <a href="https://resistancemanual.org/">The Resistance Manual</a> and a few other great projects.</p>
<p>During this time I've had no less than a dozen friends in tech ask me, &quot;How can I as a technologist contribute to social progress?&quot; I wanted to make that question as easy to answer as possible, and I knew there are far more projects out there than just those we were working on at StayWoke. So I decided to catalog them all in one space.</p>
<h2>The tech stack</h2>
<p>The <a href="https://github.com/mattstauffer/tech-forward/tree/03c66ca5801eb3cedfb6d2959e0d753d12735ed0">first version of the site</a> was a static site, hosted using GitHub pages, pulling its data using JavaScript from locally-hosted JSON files. The idea here was to make it easy for folks to contribute: make a GitHub pull request updating the JSON and we'll handle the rest.</p>
<p>The problem is, JSON isn't <em>that</em> user-friendly, and pull requests aren't either. I wanted to keep the same spirit of GitHub pages–simple, easy to spin up, editable by anyone–but on a dynamic server. Turns out, the answer is <a href="https://gomix.com/">Gomix</a> (formerly Hyperdev).</p>
<p>Gomix is a platform that makes it absurdly easy to spin up a new app (static HTML or Node) and see it online instantly. You can also invite your friends to collaborate, and the moment you make a change in the editor, your site updates. So, at this point I'm using Gomix and Node, and Express is an easy pick.</p>
<p><img src="/assets/images/content/gomix-interface.png" alt="A screenshot of the Gomix interface" /></p>
<p>I strongly considered using Firebase for data storage, but the Gomix team linked me to <a href="https://gomix.com/#!/project/data-dashboard">this Gomix site using Google Spreadsheets as the backing data source</a> and I really wanted to try it out.</p>
<p>So we've now settled: I'll take my old HTML and JavaScript, but instead of the JavaScript loading its data from JSON files, I'll run an Express app on Gomix pulling the data from Google Spreadsheets and output its data in a JSON format. No big deal.</p>
<h2>Starting the project on Gomix</h2>
<p>Gomix treats your code as a shareable document which can be collaborated on and &quot;remixed,&quot; or copied into a new project–like GitHub's forking, but with no ties to the original app. Hit &quot;remix&quot; on any public Gomix project and it'll copy all its code into a new project that you own with a randomly generated name.</p>
<p><img src="/assets/images/content/gomix-remix-this.png" alt="Gomix "Remix this" icon" /></p>
<p>So the first thing I did was &quot;remix&quot; that data dashboard app. Why start from scratch, especially as someone who's literally never written Node code in my life? The code for accessing Google Spreadsheets looks like this:</p>
<pre><code class="language-javascript">const GoogleSpreadsheets = require('google-spreadsheets')

GoogleSpreadsheets({
  key: 'google spreadsheet id here'
}, function(err, spreadsheet) {
  spreadsheet.worksheets[0].cells({
    range: 'R1C1:R20C9'
  }, function(err, result) {
    // result is the entire sheet within the provided range
  })
})</code></pre>
<p>And, if you've never worked with Express before, you teach the server how to run it using the <code>start</code> script key in <code>package.json</code>:</p>
<pre><code class="language-javascript">{
  ...,
  "scripts": {
    "start": "node server.js"
  },
  ...
}</code></pre>
<p>Now, we just edit <code>server.js</code> (simplified version here to give the gist of it):  </p>
<pre><code class="language-javascript">const express = require('express')
const app = express()

app.get('/', function (request, response) {
  response.sendFile(__dirname + '/views/index.html')
})

// listen for requests :)
const listener = app.listen(3030, function () {
  console.log('Your app is listening on port ' + listener.address().port)
})</code></pre>
<p>If you have your dependencies set up right, the above app can viewed at <code>localhost:3030</code> by simply running <code>npm install &amp;&amp; npm start</code> on your command line. It's brilliantly simple.</p>
<h2>Getting our data working</h2>
<p>So we have a working Express app. It's running on Gomix, so literally every time I edit the files, Gomix updates the server and it's completely accessible at my staging URL. I know how to pull data from Google Spreadsheets.</p>
<p>All that remained was getting my data into Google Spreadsheets and running some transformations over the returned data to structure it like JSON so my pre-existing JavaScript could consume it. It looked a little bit like this:</p>
<pre><code class="language-javascript">// server.js
const json = require('./controllers/json')

app.get('/data/orgs.json', json.orgs)
// ... repeat for tools, projects, resources, data sources</code></pre>
<pre><code class="language-javascript">// controllers/json.js
const orgs = (req, res) =&gt; {
    // get all the data from the "Organizations" sheet in our Google Spreadsheet
    // transform all the data
    // return it as JSON
}
// ...repeat

export {
    orgs
}</code></pre>
<p>And here's what my spreadsheet is shaped like (this is the organizations sheet):</p>
<p><img src="/assets/images/content/Screen-Shot-2017-02-05-at-12.26.10-AM.png" alt="Screenshot of Google Spreadsheets" /></p>
<p>We now have <code>tech-forward-2.gomix.me/data/orgs.json</code> returning JSON cobbled together from our Google Spreadsheets data. It was easy after that to set up a few Google Forms allowing people to suggest additions to the app (and it was intermediately difficult to <a href="https://blog.fogcreek.com/how-to-configure-a-custom-domain-for-hyperdev-projects/">set up a custom domain</a>, but they tell me that will be easier very soon).</p>
<h2>Final steps</h2>
<p>So, I launched the project and everything worked great. However, I heard from a few folks that the way I had implemented the JavaScript loading left screen reader users out in the cold, so yesterday I re-wrote the app to pass the Google Spreadsheets data directly to the view, dropping the AJAX entirely.</p>
<p>It made the app load much slower, but it was surprisingly easy to implement; I just set Express up to use Handlebars as its templating engine (which I had already been using on the frontend, so I could copy exactly the same templates with no changes) and passed the data directly into the views.</p>
<p>A little bit later, I googled &quot;node express cache&quot; and landed on <a href="https://goenning.net/2016/02/10/simple-server-side-cache-for-expressjs/">Simple server-side cache for Express.js</a>, and about 20 minutes later I had a 1-minute cache set up on the Google Spreadsheets calls.</p>
<p>You can <a href="https://gomix.com/#!/project/tech-forward-2">see all of the code on Gomix</a>, remix it yourself, or <a href="https://github.com/mattstauffer/tech-forward-gomix">see the backup on GitHub</a>.</p>
<p>That's it. It took me a few late-night coding sessions, a bit of Googling, and I have my first production Express app, consuming and caching data from Google Spreadsheets, hosted on Gomix. Beautiful.</p>
<blockquote>
<p>Important thanks: I learned everything I know about Express by reading code from my friend <a href="https://about.me/pascal">Pascal</a> who learned Express about a week before I did. Also, thanks to DeRay and StayWoke for bringing me in and thanks to the entire Gomix team for being awesome.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-dusk-new-in-laravel-5-4</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-laravel-dusk-new-in-laravel-5-4"/>
        <title>Introducing Laravel Dusk (new in Laravel 5.4)</title>
        <published>2017-02-03T00:00:00+00:00</published>
        <updated>2017-02-03T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you follow anyone in the Laravel world on Twitt...</summary>
        <content type="html"><![CDATA[
        <p>If you follow anyone in the Laravel world on Twitter, or if you listen to the Laravel Podcast, you know by now that Laravel Dusk is the new face of application testing in the Laravel world.</p>
<h2>The background of application testing in Laravel</h2>
<p>First, a quick refresher: while everyone talking about testing uses words a little bit differently, it's pretty well agreed that Unit tests are responsible for testing little chunks of code (a single method on a single class, for example) in isolation, whereas Application tests (similar, or the same as, integration tests) test the entire application as a whole.</p>
<p>Since Jeffrey Way's &quot;Integrated&quot; package was <a href="https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-powerful-integration-tests-in-a-few-lines">brought into the core in Laravel 5.1</a>, we've had access to methods like <code>-&gt;visit()</code>, <code>-&gt;get()</code>, <code>-&gt;see()</code>, etc.—making it seem like we were describing the actions of a browser visiting the site. This really transformed our ability to write application tests, making calls like this possible:  </p>
<pre><code class="language-php">    /** @test */
    public function cta_link_functions()
    {
        $this-&gt;visit('/sales-page')
            -&gt;click('Try it now!')
            -&gt;see('Sign up for trial')
            -&gt;onPage('trial-signup');
    }</code></pre>
<p>In the background, it was really PHP spinning up a request, passing it through our application, crawling the DOM, and then making more requests until the chain is done. There was no browser. But it felt like it.</p>
<h2>The problem with the old way</h2>
<p>What if any of your application's functionality relied on JavaScript, though? Sorry. Out of luck. Because this isn't a real browser, it didn't know or care about your JavaScript.</p>
<p>Over time, the desire to use and test JavaScript components in our Laravel apps grew, and so did the discontent that there was a growing number of o applications that were un-testable using the tools Laravel provided out of the box.</p>
<h2>The solution: Laravel Dusk</h2>
<p>With Dusk, Taylor has completely re-written how application testing works in Laravel. Everything is now based on a tool called <a href="https://sites.google.com/a/chromium.org/chromedriver/home">ChromeDriver</a>, which is a standalone server that actually controls Chrome/Chromium. When you write application tests, Dusk sends your commands to ChromeDriver, which then spins up Chrome to run your tests in the browser and then reports back the results.</p>
<p>All of the non-application testing aspects of Laravel–its unit testing functionalities, and HTTP-request-based tests like <code>$this-&gt;get()</code>–are still using the same code they always were. But the more advanced features like <code>$this-&gt;visit()</code> just don't work at all out of the box. It's up to you to pull in an application testing package. You can either pull in Dusk (<code>composer require laravel/dusk --dev</code>) or you can pull in the pre-5.4 application testing package (<code>composer require laravel/browser-kit-testing --dev</code>).</p>
<blockquote>
<p>Note: if you pull in Browser Kit Testing, you'll need to modify your <code>TestCase</code> to extend <code>Laravel\BrowserKitTesting\TestCase</code> instead of <code>Illuminate\Foundation\Testing\TestCase</code>. Upgrading your test suite from a pre-5.4 app? Check out Adam Wathan's <a href="https://adamwathan.me/2017/02/02/upgrading-your-test-suite-for-laravel-54/">Upgrading Your Test Suite for Laravel 5.4</a>.</p>
</blockquote>
<h3>Getting started with Dusk</h3>
<p>Once you've brought Dusk into your application (<code>composer require laravel/dusk --dev</code>), you'll need to register the service provider. You could add it to the list of service providers in <code>config/app.php</code>, but that's not actually safe–Dusk, for the purpose of testing, opens up a lot of manual overrides that you don't want on your production site. Instead, conditionally register it in the <code>register</code> method of <code>AppServiceProvider</code>:</p>
<pre><code class="language-php">// AppServiceProvider
use Laravel\Dusk\DuskServiceProvider;

...

public function register()
{
    if ($this-&gt;app-&gt;environment('local', 'testing')) {
        $this-&gt;app-&gt;register(DuskServiceProvider::class);
    }
}</code></pre>
<p>Now we need to install Dusk, which will create a <code>tests/Browser</code> directory.</p>
<pre><code class="language-bash">php artisan dusk:install</code></pre>
<p>You may never have used the <code>APP_URL</code> key in your <code>.env</code> file—it's often not actually necessary for many applications–but you'll need to set it now, since Dusk relies on it to visit your application. This will have to be an actually-accessible URL, because, remember, this is a real browser we're working with.</p>
<p>We now run our tests using <code>php artisan dusk</code>, which can accept any arguments that PHPUnit can–for example, <code>php artisan dusk --filter=the_big_button_works</code>.</p>
<h3>Writing our first Dusk test</h3>
<p>Let's say I want to write a Dusk test just like our application test we looked at earlier–click a button and make sure it takes me where I want to go. Let's write.</p>
<pre><code>php artisan dusk:make BigButtonTest</code></pre>
<p>Let's open <code>tests/Browser/BigButtonTest.php</code> and see what we get by default:  </p>
<pre><code class="language-php">&lt;?php

namespace Tests\Browser;

use Tests\DuskTestCase;
use Illuminate\Foundation\Testing\DatabaseMigrations;

class BigButtonTest extends DuskTestCase
{
    /**
     * A Dusk test example.
     *
     * @return void
     */
    public function testExample()
    {
        $this-&gt;browse(function ($browser) {
            $browser-&gt;visit('/')
                    -&gt;assertSee('Laravel');
        });
    }
}</code></pre>
<p>A few things you'll notice that are different from what we're used to.</p>
<p>First, we have namespaces in our tests now! This is actually true in 5.4 whether or not you're using Dusk; by default there are two namespaces for our tests, <code>Tests\Unit</code> and <code>Tests\Feature</code>.</p>
<p>Second, <code>DatabaseTransactions</code> and <code>WithoutMiddleware</code> aren't imported by default anymore.</p>
<p>Third, we're no longer calling <code>$this-&gt;visit</code> directly. We're now doing all of our testing in a closure in the context of the <code>browse()</code> function, which encapsulates our Dusk calls.</p>
<p>Fourth, some of the methods available to us have been renamed to be a little more consistent with other assertions–for example, <code>see()</code> is now <code>assertSee()</code>.</p>
<p>Before we do anything else, let's just run our test. Remember, that's <code>php artisan dusk</code>.</p>
<p><img src="/assets/images/content/dusk.gif" alt="Dusk running" /></p>
<p>Did you see that? Real. Browser. Windows.</p>
<p>Let's make this do what it did before:  </p>
<pre><code class="language-php">$this-&gt;browse(function ($browser) {
    $browser-&gt;visit('/sales-page')
        -&gt;clickLink('Try it now!')
        -&gt;assertSee('Sign up for trial')
        -&gt;assertPathIs('/trial-signup');
});</code></pre>
<p>OK. We can do what we once could do. This is good. But what's new?</p>
<h2>New interactions</h2>
<p>There are so many new features and new ways of interacting that I'm going to have to point you to the <a href="https://laravel.com/docs/5.4/dusk">docs</a> to learn everything. But here are a few pieces that are really distinctly different from how application testing used to work, so you can get a sense of what we're working with here.</p>
<h3>Getting and setting the text, value, or attributes of elements on the page</h3>
<p>It's possible to get or set the value (the &quot;value&quot; property) and get the text (text contents) or attribute of any element on the page given its jQuery-style selector.</p>
<pre><code class="language-php">// Get or set
$inputValue = $browser-&gt;value('#name-input');
$browser-&gt;value('#email-input', 'matt@matt.com');

// Get
$welcomeDivValue = $browser-&gt;value('.welcome-text');
$buttonDataTarget = $browser-&gt;attribute('.button', 'data-target');</code></pre>
<h3>Interacting with forms and other page elements</h3>
<p>Interacting with forms is very similar to what it was like previously, but let's cover it briefly. First, you can choose the name of the field if you'd like, <em>or</em> a jQuery-style selector.</p>
<pre><code class="language-php">$browser-&gt;type('email', 'matt@matt.com');
$browser-&gt;type('#name-input', 'matt');</code></pre>
<p>You can clear any values:</p>
<pre><code class="language-php">$browser-&gt;clear('password');</code></pre>
<p>You can select a dropdown value:</p>
<pre><code class="language-php">$browser-&gt;select('plan', 'premium');</code></pre>
<p>You can check a checkbox or radio button:</p>
<pre><code class="language-php">$browser-&gt;check('agree');
$browser-&gt;uncheck('mailing-list');
$browser-&gt;radio('referred-by', 'friend');</code></pre>
<p>You can attach files:  </p>
<pre><code class="language-php">$browser-&gt;attach('profile-picture', __DIR__ . '/photos/user.jpg');</code></pre>
<p>And you can even perform more complex keyboard- and mouse-based interactions:  </p>
<pre><code class="language-php">// type 'hype' while holding the command key
$browser-&gt;keys('#magic-box', ['{command}', 'hype']);

$browser-&gt;click('#randomize');

$browser-&gt;mouseover('.hover-me');

$browser-&gt;drag('#tag__awesome', '.approved-tags');</code></pre>
<p>Finally, we can scope any of our actions to a particular form or section of the site we're working on:  </p>
<pre><code class="language-php">$browser-&gt;with('.sign-up-form', function ($form) {
    $form-&gt;type('name', 'Jim')
        -&gt;clickLink('Go');
});</code></pre>
<h3>Waiting</h3>
<p>This is probably the most foreign concept in Dusk. Because this is a real browser, it actually has to load all of the external assets on the page–which means your content may not be ready.</p>
<p>There are a few methods that help you work around this. First, you can just pause the test manually:  </p>
<pre><code class="language-php">// Pause for 500ms
$browser-&gt;pause(500);</code></pre>
<p>More commonly, you can wait (by default, up to 5 seconds) until a given element either appears or disappears:</p>
<pre><code class="language-php">$browser-&gt;waitFor('.chat-box');

// wait a maximum of 2 seconds for the chat box to appear
$browser-&gt;waitFor('.chat-box', 2);

$browser-&gt;waitUntilMissing('.loading');
$browser-&gt;waitForText('You have arrived!');
$browser-&gt;waitForLink('Proceed');

// wait and scope
$browser-&gt;whenAvailable('.chat-box'), function ($chatBox) {
    $chatBox-&gt;assertSee('What is your message?')
        -&gt;type('message', 'Hello!')
        -&gt;press('Send');
});

// wait until JavaScript expression returns true
$browser-&gt;waitUntil('App.initialized');</code></pre>
<h3>Creating multiple browsers</h3>
<p>Taking an example from the docs, what if you want to test that a websocket-based chat works? Just use two separate browser sessions:  </p>
<pre><code class="language-php">$this-&gt;browse(function ($first, $second) {
    $first-&gt;loginAs(User::find(1))
          -&gt;visit('/home')
          -&gt;waitForText('Message');

    $second-&gt;loginAs(User::find(2))
           -&gt;visit('/home')
           -&gt;waitForText('Message')
           -&gt;type('message', 'Hey Taylor')
           -&gt;press('Send');

    $first-&gt;waitForText('Hey Taylor')
          -&gt;assertSee('Jeffrey Way');
});</code></pre>
<p>As you can see, if you ask for more parameters in your <code>browse()</code> closure, each will be passed a new browser session that you can interact with.</p>
<p>Our first browser logs in as user 1, visits the home route, and then waits (for up to 5 seconds) until it sees the text &quot;Message,&quot; which in this test is representing the chat box appearing on the page. Next, our other user logs in as user 2, visits the home route, waits to see the chat box, and then types a message into it and hits send. Finally, our original user watches for that message to come through and asserts that the name of the second user (which we are presuming is named &quot;Jeffrey Way&quot;) shows up.</p>
<p>Also note that <code>loginAs</code>, which used to be named <code>be()</code> or <code>actingAs()</code>, can take either a <code>User</code> instance or a user ID.</p>
<h2>New assertions</h2>
<p>Most of the assertions in Dusk are the same as before, but many have new names, and there are a few new ones. Check the whole list <a href="https://laravel.com/docs/5.4/dusk#available-assertions">here</a>, but here are a few notable new assertions:  </p>
<pre><code class="language-php">$browser-&gt;assertTitle('My App - Home');
$browser-&gt;assertTitleContains('My New Blog Post');
$browser-&gt;assertVisible('.chat-box');
$browser-&gt;assertMissing('.loading');</code></pre>
<h2>Dusk Pages</h2>
<p>Reading longer and more complex sets of Dusk interactions can be hard to follow at times, so there's an optional concept called a Page that makes it easy to group functionality in your Dusk tests. A page represents a URL that can be used to navigate to it, a set of assertions that can be run to make sure the browser is still on this page, and a set of nicknames for common selectors.</p>
<h3>Creating a Page</h3>
<p>To make a page, use the <code>dusk:page</code> Artisan command:  </p>
<pre><code class="language-bash">php artisan dusk:page Dashboard</code></pre>
<p>Here's what that generates for us:  </p>
<pre><code class="language-php">&lt;?php

namespace Tests\Browser\Pages;

use Laravel\Dusk\Browser;
use Laravel\Dusk\Page as BasePage;

class Dashboard extends BasePage
{
    /**
     * Get the URL for the page.
     *
     * @return string
     */
    public function url()
    {
        return '/';
    }

    /**
     * Assert that the browser is on the page.
     *
     * @return void
     */
    public function assert(Browser $browser)
    {
        $browser-&gt;assertPathIs($this-&gt;url());
    }

    /**
     * Get the element shortcuts for the page.
     *
     * @return array
     */
    public function elements()
    {
        return [
            '@element' =&gt; '#selector',
        ];
    }
}</code></pre>
<p>The <code>url()</code> method is clear: it tells how to navigate <em>to</em> this page. The <code>assert()</code> method is also relatively clear: &quot;Consider me still on this page as long as this assertion passes.&quot;</p>
<p>The <code>elements()</code> array makes it possible to create shorthand selectors you can use to refer to elements any time your browser is &quot;on&quot; this page. Here's a way we might choose to fill this out:  </p>
<pre><code class="language-php">class Dashboard extends BasePage
{
    public function url()
    {
        return '/dashboard';
    }

    public function assert(Browser $browser)
    {
        $browser-&gt;assertPathIs($this-&gt;url());
    }

    public function elements()
    {
        return [
            '@createPost' =&gt; '#create-new-post-button',
            '@graphs' =&gt; '.dashboard__graphs',
        ];
    }
}</code></pre>
<p>You can also manually create custom methods for interactions on each page. For example, one common behavior in your tests might be to set a few dropdowns and then click a &quot;filter&quot; button. Let's make it:</p>
<pre><code class="language-php">// Dashboard
public function filterGraph($browser, $filterStatus)
{
    $browser-&gt;select('filterBy', $filterStatus)
        -&gt;select('limit', 'one-month')
        -&gt;press('Filter');
}</code></pre>
<h3>Using a Page</h3>
<p>There are a few different ways we can use a Page. First, we can visit it, which both directs the browser to it and also loads our shorthand selectors:</p>
<pre><code class="language-php">use Tests\Browser\Pages\Dashboard;
...

$browser-&gt;visit(new Dashboard)
    -&gt;assertSee('@graphs');</code></pre>
<p>But what if we're already <em>on</em> this page because we clicked a button somewhere else? The <code>on()</code> method loads up our Page:</p>
<pre><code class="language-php">use Tests\Browser\Pages\Dashboard;
...

$browser-&gt;visit('/)
    -&gt;type('email', 'matt@matt.com')
    -&gt;type('password', 'secret')
    -&gt;press('Log in')
    -&gt;on(new Dashboard)
    -&gt;assertSee('@graphs');</code></pre>
<p>Finally, here's how we use our custom methods:</p>
<pre><code class="language-php">$browser-&gt;visit(new Dashboard)
    -&gt;filterBy('donors')
    -&gt;assertSee('Sally');</code></pre>
<h3>Global shorthand selectors</h3>
<p>You can also create global shorthand selectors you can use anywhere in your site in the default <code>tests/Browser/Pages/Page</code> Page, which is loaded on every page. Just add them to its <code>siteElements()</code> method.</p>
<pre><code class="language-php">// tests/Browser/Pages/Page
public static function siteElements()
{
    return [
        '@openChat' =&gt; '#chat-box__open-button',
    ];
}</code></pre>
<h2>Miscellany</h2>
<p>OK, so you've seen how powerful this all is. A few side notes.</p>
<p>First, you can create a custom Dusk environment file at <code>.env.dusk.local</code> (or <code>.env.dusk.whateverEnvironmentYouWantToTest</code>).</p>
<p>Second, some of the methods require jQuery to select content on the page. Dusk will check whether your page loads jQuery, and if not, will inject it for you during the tests.</p>
<p>Finally, any time a test fails, Dusk will take a screenshot of the failed page for you and put it in the <code>tests\Browser\Screenshots</code> directory. You'll see exactly what the page looks like:  </p>
<p><img src="/assets/images/content/failure-testExample-0.png" alt="A failed Dusk test screenshot" /></p>
<h2>Clude-con</h2>
<p>That's all, folks. Enjoy! Remember, you can still keep writing the tests you've always written–and you can even pull in the old testing package, if you'd prefer. But there's a whole new world open to you now. Try it out a bit.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/defining-console-commands-via-closure-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/defining-console-commands-via-closure-in-laravel-5-3"/>
        <title>Defining console commands via closure in Laravel 5.3</title>
        <published>2017-01-30T00:00:00+00:00</published>
        <updated>2017-01-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Before Laravel 5.3, defining an Artisan console co...</summary>
        <content type="html"><![CDATA[
        <p>Before Laravel 5.3, defining an Artisan console command—something like <code>php artisan sync:dates</code>—required you to create a new class for that command and register it in the Console Kernel. This is fine, but sometimes it feels like overkill for what might end up just being a single line of functional code.</p>
<p>As of Laravel 5.3, you'll notice that there's a new method in the <code>Console/Kernel.php</code> file named <code>commands()</code>, and it loads a new file at <code>routes/console.php</code>. This new &quot;console routes&quot; file allows us to define Artisan console commands with a single Closure instead the prior &quot;define a class then register it in the console Kernel&quot; flow. Much faster, much easier.</p>
<p>So, open up <code>routes/console.php</code> and you'll already see a sample command:</p>
<pre><code class="language-php">Artisan::command('inspire', function () {
    $this-&gt;comment(Inspiring::quote());
})-&gt;describe('Display an inspiring quote');</code></pre>
<p>As you can see, we have a new fluent builder for defining Artisan commands. We've got the <code>signature</code> (&quot;inspire&quot;), the <code>handle()</code> (the closure), and the <code>description</code> (&quot;Display an inspiring quote&quot;).</p>
<p>What if we have a parameter, or if we want to inject a dependency? It works just like it did with the old syntax.</p>
<pre><code class="language-php">Artisan::command('sync:conference {id}', function (JoindIn $joindin) {
    $joindin-&gt;syncConference($this-&gt;argument('id'));
})-&gt;describe('Sync a given conference from JoindIn');</code></pre>
<p>But here's something else interesting you can do that you can't with traditional Artisan command definition: you can take your signature arguments as parameters in the Closure, which is much more like what you'd expect if you were new to Laravel:</p>
<pre><code class="language-php">Artisan::command('sync:conference {id}', function ($id, JoindIn $joindin) {
    $joindin-&gt;syncConference($id);
})-&gt;describe('Sync a given conference from JoindIn');</code></pre>
<p>As you can see, we now have a simpler, more convenient, more fluent, and more compact way to define Artisan commands. Boom.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/what-to-do-when-your-linux-web-server-says-its-out-of-space-but-it-isnt-inodes-and-linux-headers-oh-my
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/what-to-do-when-your-linux-web-server-says-its-out-of-space-but-it-isnt-inodes-and-linux-headers-oh-my"/>
        <title>What to do when your Linux web server says it&#039;s out of space--but it isn&#039;t (inodes and linux
            headers, oh my!)
        </title>
        <published>2017-01-18T00:00:00+00:00</published>
        <updated>2017-01-18T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">The story (skip if you&#039;re stressing)
            The default c...
        </summary>
        <content type="html"><![CDATA[
        <h2>The story (skip if you're stressing)</h2>
<p>The default configuration for many Linux server setups—including that for Laravel Forge-created servers—leaves a lot of old Linux headers sitting around every time your system downloads upgrades. Folders like <code>linux-headers-3.13.0-53-generic (3.13.0-53.89)</code>, just full of hundreds and thousands of files, slowly taking over your server.</p>
<p>Normally this is no problem. The files are tiny. The server I'm working on right now has 30GB of disk space and 20GB free.</p>
<p>But this morning I started getting a series of tweets about my site being down. Thankfully, this isn't the first time I've hit this error, so it was an easy fix. But still, these tweets are no fun:</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Think you have a permissions issue on your site, bud. <a href="https://t.co/lUAS9hWrru">pic.twitter.com/lUAS9hWrru</a></p>&mdash; Craig Thompson (@Migweld) <a href="https://twitter.com/Migweld/status/821676061318643715">January 18, 2017</a></blockquote>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Something has broken mate. Just as i was researching! <a href="https://t.co/G02r0Kjlsv">pic.twitter.com/G02r0Kjlsv</a></p>&mdash; Mads Jürgensen (@InctorMads) <a href="https://twitter.com/InctorMads/status/821697414239256576">January 18, 2017</a></blockquote>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> heads up! your blog fails to write cache file. Permissions or full disk issue, maybe?</p>&mdash; Damiano Venturin (@damko) <a href="https://twitter.com/damko/status/821645677658861569">January 18, 2017</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>These and a dozen more. Ouch. But I'm not out of disk space. What's going on?</p>
<p>Turns out, there's something most folks never run into: your server doesn't just have limited <em>space</em>; it also has a limited number of &quot;<a href="https://en.wikipedia.org/wiki/Inode">inodes</a>&quot;, which are essentially the objects that represent a file or a directory. Most people never run into this limit, because it's an absurdly high number. But there's something fun about the Linux headers I mentioned before: while they're tiny, there are thousands and thousands and thousands of them.</p>
<h2>Is this your problem?</h2>
<p>Here's how you know this is your problem: you're constantly seeing errors on your server that the server is out of disk space and can't do simple things like tab-autocomplete your typing, but when you check, you have plenty of space:</p>
<pre><code class="language-bash">$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/vda1        30G  3.4G   25G  12% /</code></pre>
<p>What's your next step to verify this is really your problem? Check your inodes:</p>
<pre><code class="language-bash">$ df -i
Filesystem      Inodes   IUsed IFree IUse% Mounted on
/dev/vda1      1966080 1966080 0     100%  /</code></pre>
<p>If you see 100% <code>IUse%</code> (or close to it), then this is indeed your problem: You have too many files and folders (inodes) on your machine.</p>
<h2>The fix</h2>
<p>There are two ways to fix this. First, you could manually look through your whole server to try to find the offending directories and figure out where they're coming from, and then manage them. Here's a <a href="https://www.ivankuznetsov.com/2010/02/no-space-left-on-device-running-out-of-inodes.html">great article</a> describing how to do that, and you should try this option if the second option doesn't work.</p>
<p>Second, you could take my word that if you're on my blog, there's a really good chance you're hitting this error because <code>apt-get</code> doesn't auto-remove old, unused packages, and this issue is likely happening because of extra, unused Linux header packages.</p>
<p>If your system lets you run this command, you're good to go:</p>
<pre><code class="language-bash">sudo apt-get autoremove -y</code></pre>
<p>This will tell <code>apt-get</code> to remove anything it's installed that's currently not in use. That means all those old Linux headers—and plenty of other no-longer-needed depedencies.</p>
<p>However, you might not be able to run this command—because <code>apt-get</code> needs to be able to write to your filesystem in order to do its work. If you get an error about &quot;not enough drive space&quot; here, don't fret. It's still pretty likely your issue is with those Linux headers, so let's go find them.</p>
<h3>Manually removing the Linux headers</h3>
<pre><code class="language-bash">$ uname -r
3.13.0-43-generic</code></pre>
<p>The output of the <code>uname -r</code> command shows which version of the Linux kernel you're currently running. Remember this, because you don't want to delete this one.</p>
<p>List out the files in <code>/usr/src</code>, and find a good chunk of headers which <em>aren't</em> yours:</p>
<pre><code class="language-bash">$ cd /usr/src
$ ls -al
drwxr-xr-x 24 root root 4096 Jan 11 06:32 linux-headers-3.13.0-107
drwxr-xr-x  7 root root 4096 Jan 11 06:32 linux-headers-3.13.0-107-generic
...
drwxr-xr-x 24 root root 4096 Jan 11 06:32 linux-headers-3.13.0-43
drwxr-xr-x  7 root root 4096 Jan 11 06:32 linux-headers-3.13.0-43-generic</code></pre>
<p>All we need to do right now is delete a good chunk of them so that we can let <code>apt-get</code> handle the rest. Here's what I ran <strong>(be cautious; this is running <code>sudo rm -rf</code> on system files. Screw this up and you tank your server.)</strong></p>
<p>I noticed that I have a bunch of headers that begin with <code>linux-headers-3.13-0-9</code>, so I'll delete all of them:</p>
<pre><code class="language-bash">$ cd /usr/src
$ sudo rm -rf linux-headers-3.13.0-9*</code></pre>
<p>Good. We just dumped thousands and thousands of files, and we can now rely on <code>sudo apt-get autoremove -y</code> to clean up the rest of the system for us. Boom.</p>
<h2>How to make this not happen again</h2>
<p>The simplest answer is &quot;just run <code>sudo apt-get autoremove -y</code> every once in a while&quot;.</p>
<p>You can try to automate it, but because it requires <code>sudo</code> access, it's going to be tough and possibly dangerous. <a href="https://ubuntu-mate.community/t/automating-apt-get-update-upgrade-dist-upgrade-autoremove/770">Here's one guy</a> who tried.</p>
<h2>Thanks</h2>
<p>I've run into this a few times over the years, and I definitely need to thank <a href="http://fideloper.com/">Chris Fidao</a> (for personal help) and Ivan Kuznetsov (for his <a href="https://www.ivankuznetsov.com/2010/02/no-space-left-on-device-running-out-of-inodes.html">blog</a>) for getting me through it.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-contribute-to-an-open-source-github-project-using-your-own-fork</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-contribute-to-an-open-source-github-project-using-your-own-fork"/>
        <title>How to contribute to an open-source GitHub project using your own fork</title>
        <published>2017-01-09T00:00:00+00:00</published>
        <updated>2017-01-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I just recently joined a new open source project, ...</summary>
        <content type="html"><![CDATA[
        <p>I just recently joined a new open source project, and there were a few folks on the team who weren't familiar with how to contribute to an open source project by forking your own copy, so I wrote this up for the docs of that project. I figured I'd also share it here.</p>
<p>If you join a new open source project, it's very likely that you won't get direct access to push commits or branches up to the repository itself. So, instead, you'll fork the repo, make the changes on your version of the repo, and then &quot;pull request&quot; your changes back to the original.</p>
<p>Here are the steps to take.</p>
<h2>Forking the repo</h2>
<p>Let's use the <code>general-congress-hotline</code> project as an example. First, visit its <a href="https://github.com/StayWokeOrg/general-congress-hotline">page on GitHub</a>, and click the &quot;Fork&quot; icon in the upper right of the page.</p>
<p><img src="/assets/images/content/github-fork-button.png" alt="GitHub Fork Button" /></p>
<p>This will create a fork of the project under your user account.</p>
<h2>Cloning it locally</h2>
<p>Next, clone your local version down to your local machine.</p>
<p><img src="/assets/images/content/github-clone-button.png" alt="GitHub Clone Button" /></p>
<pre><code class="language-bash">git clone git@github.com:mattstauffer/general-congress-hotline.git</code></pre>
<p>You now have a local representation of <em>your</em> fork.</p>
<h2>Keeping in sync with the source</h2>
<p>In order to make it easy to keep your fork in sync with the original, add the original as a remote:</p>
<pre><code class="language-bash">git remote add upstream https://github.com/StayWokeOrg/general-congress-hotline.git</code></pre>
<p>If you check your remotes (<code>git remote -v</code>), you can now see that you have two &quot;remotes&quot; that your local repo is pointed towards: <code>origin</code>, which points to your repo, and <code>upstream</code>, which points to the original. We'll get to <em>why</em> in a bit.</p>
<h2>Spinning up a branch</h2>
<p>Since you want to branch from the <code>development</code> branch, make sure you're on the <code>development</code> branch and it's up-to-date with the source repo. If you just forked it, it always will be—but if there have been a lot of changes to the original repo since you forked it, yours might be out of sync. Here's how to get yours in sync:</p>
<pre><code class="language-bash">git checkout development
git fetch upstream
git merge upstream/development
git push origin development</code></pre>
<p>Now you can spin up your new branch:</p>
<pre><code class="language-bash">git checkout -b my-feature-name</code></pre>
<p>Make your changes, commit them, and push up to your <em>forked</em> repo for that branch:</p>
<pre><code class="language-bash">touch new-file.text
git add new-file.txt
git commit -m "Added new-file.text"
git push origin my-feature-name</code></pre>
<p>Now, you can create a PR in the GitHub user interface. Visit your repo on GitHub and click the &quot;New Pull Request&quot; button, and you can create your PR from there.</p>
<p><img src="/assets/images/content/github-new-pull-request-button.png" alt="GitHub new pull request button" /></p>
<p>Make sure to explain the purpose, context, and anything else necessary for reviewers to understand the PR. See GitHub's &quot;<a href="https://github.com/blog/1943-how-to-write-the-perfect-pull-request">How to write the perfect pull request</a>&quot;.</p>
<p><img src="/assets/images/content/github-sample-pr.png" alt="GitHub sample PR" /></p>
<p>That's it!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/using-vue-in-laravel-5-3-with-the-vue-bootstrap-and-sample-component</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/using-vue-in-laravel-5-3-with-the-vue-bootstrap-and-sample-component"/>
        <title>Using Vue in Laravel 5.3, with the Vue bootstrap and sample component</title>
        <published>2016-12-21T00:00:00+00:00</published>
        <updated>2016-12-21T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In Laravel 5.3, it&#039;s easier than ever to write and...</summary>
        <content type="html"><![CDATA[
        <p>In Laravel 5.3, it's easier than ever to write and use Vue components out of the box. This means 5.3 has a somewhat more opinionated default frontend stack than previous versions do. But never fear—it's easy to strip out the default components.</p>
<p>Let's explore 5.3's JavaScript stack together. Spin up a sample app using the Laravel installer (or, if you're like me, use <a href="https://github.com/tightenco/lambo">Lambo</a>) and open up the site in your favorite IDE.</p>
<h2>The default <code>package.json</code></h2>
<p>First, take a look at our <code>package.json</code>:</p>
<pre><code class="language-javascript">{
  "private": true,
  "scripts": {
    "prod": "gulp --production",
    "dev": "gulp watch"
  },
  "devDependencies": {
    "bootstrap-sass": "^3.3.7",
    "gulp": "^3.9.1",
    "jquery": "^3.1.0",
    "laravel-elixir": "^6.0.0-14",
    "laravel-elixir-vue-2": "^0.2.0",
    "laravel-elixir-webpack-official": "^1.0.2",
    "lodash": "^4.16.2",
    "vue": "^2.0.1",
    "vue-resource": "^1.0.3"
  }
}</code></pre>
<p>We're now pulling in Vue 2 and Vue Resource (which, by the way, is <a href="https://medium.com/the-vue-point/retiring-vue-resource-871a82880af4#.4tunzl1uk">being retired soon</a> and I believe will soon be replaced), and we still have jQuery and Sass and Lodash.</p>
<h2>The default Gulp file</h2>
<p>Now let's take a look at our Gulp (Elixir) file:</p>
<pre><code class="language-javascript">const elixir = require('laravel-elixir');

require('laravel-elixir-vue-2');

/*
 |--------------------------------------------------------------------------
 | Elixir Asset Management
 |--------------------------------------------------------------------------
 |
 | Elixir provides a clean, fluent API for defining some basic Gulp tasks
 | for your Laravel application. By default, we are compiling the Sass
 | file for your application as well as publishing vendor resources.
 |
 */

elixir((mix) =&gt; {
    mix.sass('app.scss')
       .webpack('app.js');
});</code></pre>
<p>Nothing too different here, other than that we're pulling in Vue at the top and we're using Webpack to minify our scripts instead of Browserify.</p>
<blockquote>
<p>Note: Taylor &amp; Jeffrey just announced this week that the next version of Elixir will be based entirely on Webpack, not Gulp, and it'll be named <a href="https://twitter.com/stauffermatt/status/811374319746093057">Mix</a>!</p>
</blockquote>
<h2>The default <code>app.js</code> file</h2>
<p>So where do we go from here? Let's take a look at <code>app.js</code> (which is in <code>resources/assets/js</code>) to see what it's doing.</p>
<pre><code class="language-javascript">/**
 * First we will load all of this project's JavaScript dependencies which
 * include Vue and Vue Resource. This gives a great starting point for
 * building robust, powerful web applications using Vue and Laravel.
 */

require('./bootstrap');

/**
 * Next, we will create a fresh Vue application instance and attach it to
 * the page. Then, you may begin adding components to this application
 * or customize the JavaScript scaffolding to fit your unique needs.
 */

Vue.component('example', require('./components/Example.vue'));

const app = new Vue({
    el: '#app'
});</code></pre>
<p>OK, so it looks like Laravel ships with a <code>bootstrap.js</code> file out of the box—we'll check that out in a second. Then we're pulling in an example Vue component, which we'll also take a look at. And it's binding our component to an element on our page with the ID of <code>app</code>.</p>
<p>Before we even look further, we can now assume that, if we compile this file and include it on our page, something like this would probably do <em>something</em>:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;div id="app"&gt;
        &lt;example&gt;&lt;/example&gt;
    &lt;/div&gt;
&lt;script src="/js/app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<h2>The default <code>bootstrap.js</code> file</h2>
<p>Let's figure out what it is actually going to do. First, we'll open up that <code>bootstrap</code> file, which is <code>resources/assets/js/bootstrap.js</code>:</p>
<pre><code class="language-javascript">window._ = require('lodash');

/**
 * We'll load jQuery and the Bootstrap jQuery plugin which provides support
 * for JavaScript based Bootstrap features such as modals and tabs. This
 * code may be modified to fit the specific needs of your application.
 */

window.$ = window.jQuery = require('jquery');
require('bootstrap-sass');

/**
 * Vue is a modern JavaScript library for building interactive web interfaces
 * using reactive data binding and reusable components. Vue's API is clean
 * and simple, leaving you to focus on building your next great project.
 */

window.Vue = require('vue');
require('vue-resource');

/**
 * We'll register a HTTP interceptor to attach the "CSRF" header to each of
 * the outgoing requests issued by this application. The CSRF middleware
 * included with Laravel will automatically verify the header's value.
 */

Vue.http.interceptors.push((request, next) =&gt; {
    request.headers.set('X-CSRF-TOKEN', Laravel.csrfToken);

    next();
});

/**
 * Echo exposes an expressive API for subscribing to channels and listening
 * for events that are broadcast by Laravel. Echo and event broadcasting
 * allows your team to easily build robust real-time web applications.
 */

// import Echo from "laravel-echo"

// window.Echo = new Echo({
//     broadcaster: 'pusher',
//     key: 'your-pusher-key'
// });</code></pre>
<p>Alright, there's a lot more going on now! We've now pulled in jQuery, Bootstrap, Vue, and Vue-Resource. We're adding the CSRF token to the headers for Vue and Vue-Resource. And there's a placeholder to make it easy to start using <a href="https://mattstauffer.co/blog/introducing-laravel-echo">Echo</a> if we want. </p>
<h2>The Example component</h2>
<p>Let's take a look at this Example component in <code>resources/assets/js/components/Example.vue</code>:</p>
<pre><code class="language-javascript">&lt;template&gt;
    &lt;div class="container"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-8 col-md-offset-2"&gt;
                &lt;div class="panel panel-default"&gt;
                    &lt;div class="panel-heading"&gt;Example Component&lt;/div&gt;

                    &lt;div class="panel-body"&gt;
                        I'm an example component!
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
    export default {
        mounted() {
            console.log('Component mounted.')
        }
    }
&lt;/script&gt;</code></pre>
<p>This is a <a href="https://blog.tighten.co/setting-up-your-first-vuejs-site-using-laravel-elixir-and-vueify">Vueify</a>-style Vue component that we can use as a sample to make our own components. You'll know it's working if you see the &quot;Example Component&quot; content on your screen.</p>
<h2>Running Yarn and Gulp</h2>
<p>So! Where do we go from here? Let's install our dependencies and run Elixir and then check the page out. We'll use Yarn (but if you don't have it, just run <code>npm install</code> instead):</p>
<pre><code class="language-bash">yarn
gulp
gulp watch</code></pre>
<h2>Changes to Blade templates</h2>
<p>How much work will we have to do to see if this actually works? Let's see what the 5.3 Blade templates look like. The default <code>welcome.blade.php</code> file doesn't reference these files at all, but the auth scaffolded files do, so run <code>php artisan make:auth</code> to publish them.</p>
<p>Now, we can take a look at our default <code>resources/views/layouts.app.blade.php</code> file:</p>
<pre><code>&lt;html&gt;
... (header stuff)
    &lt;script&gt;
        window.Laravel = &lt;?php echo json_encode([
            'csrfToken' =&gt; csrf_token(),
        ]); ?&gt;
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="app"&gt;
        .. (lots of content)
    &lt;/div&gt;

    &lt;!-- Scripts --&gt;
    &lt;script src="/js/app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>A few things of note here. First, the auth scaffolded files are pulling in <code>/js/app.js</code>, so they'll all have access to our Vue instance and all the dependencies we bound. Second, you can see that there's a base div with an ID of <code>app</code>, so that means we can use our Vue components <em>anywhere</em> within any of our templates and they'll be registered. And finally, there's a parent <code>window.Laravel</code> JavaScript object where you can set any useful information; with this sample, you could pull the CSRF token in any JavaScript now by simply referencing <code>Laravel.csrfToken</code>.</p>
<p>So. We've run Elixir, looked through all of our JavaScript files, and taken a look at the Blade templates that will be referencing them. Let's go see how it works!</p>
<h2>In the browser</h2>
<p>Since you're using Valet and likely spun this up with Lambo (right?) you can now visit these routes directly in your browser. I started this project with <code>lambo blogpost</code>, so I can now visit <code>http://blogpost.dev/login</code> to see what the Auth scaffold looks like.</p>
<p>Everything looks like it's working fine, I guess, so it's time for us to actually test that our Vue components are working correctly. Open up <code>resources/views/auth/login.blade.php</code> and add <code>&lt;example&gt;&lt;/example&gt;</code> anywhere within the <code>content</code> section.</p>
<p><img src="/assets/images/content/5-3-vue-components-using-example.png" alt="Using the <example> component" /></p>
<p>Save, and refresh the page.</p>
<p><img src="/assets/images/content/5-3-showing-example-component.png" alt="Showing the <example> component" /></p>
<p>There you go! You now have a fully functioning Vue stack with Bootstrap and jQuery and a sample, functioning, Vueify-style Vue component. Boom. Ready to go with almost no work.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/update-to-queue-workers-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/update-to-queue-workers-in-laravel-5-3"/>
        <title>Update to queue workers in Laravel 5.3</title>
        <published>2016-12-21T00:00:00+00:00</published>
        <updated>2016-12-21T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Queues are one of those tools in Laravel that ever...</summary>
        <content type="html"><![CDATA[
        <p>Queues are one of those tools in Laravel that everyone knows is there, but very few people understand deeply. It's understandable--Laravel is often the first place folks have run into queues, and to be honest, they're not simple. </p>
<p>Thankfully, very little has changed on a user-facing front with regard to how queues work in Laravel 5.3.</p>
<h2>Daemon as default</h2>
<p>The biggest change is that the command you would've once used to &quot;listen&quot; for queue jobs:</p>
<pre><code class="language-bash">php artisan queue:listen</code></pre>
<p>... is no longer the default. Instead, running <code>queue:work</code> as a daemon is now the default:</p>
<pre><code class="language-bash">php artisan queue:work</code></pre>
<p>This was possible in the past by running <code>php artisan queue:work --daemon</code>, but now, you don't have to pass <code>--daemon</code> (instead, pass <code>--once</code> if you want to only work on a single job), and Laravel is recommending you use <code>queue:work</code> (daemon style) instead of <code>queue:listen</code> as your default.</p>
<h2>What's the difference?</h2>
<p><code>php artisan queue:listen</code> listens to your queue and spins up the entire application every time it operates on a queue job. This is slower, but doesn't require rebooting the worker every time you push new code.</p>
<p><code>php artisan queue:work</code> keeps the application running in between jobs, which makes it faster and lighter, but you'll need to restart the listener every time you push new code. The best way to do this is to run <code>php artisan queue:restart</code> on every deploy.</p>
<h2>Supervisor</h2>
<p>It's now recommended that you run a Supervisor process on your Linux hosts to watch your queue listener and restart it if it gets stopped. The docs now have a <a href="https://laravel.com/docs/5.3/queues#supervisor-configuration">writeup on how to set up Supervisor correctly</a>.</p>
<p>Essentially, you're going to install it using <code>apt-get</code>, configure it using the <code>/etc/supervisor/conf.d</code> file, and define that the queue worker should be restarted if it fails. You can even define how many queue workers you'd like to run at a given time.</p>
<h2>Under the hood</h2>
<p>The last final change is one that's largely transparent to us as developers, but the new queue infrastructure has a different model of how the primary worker handles control of each job. It's complicated, but it gives us the benefit of the worker having a lot more control over the behavior of long-running or misbehaving queue jobs. The new system also takes advantage of PHP 7.1's  pcntl_async_signals when it's available. </p>
<p>As a reminder, you can control these long-running jobs using <code>--timeout</code> and <code>retry_after</code>; you can define that a queue worker process will kill a child process if it takes longer than a given amount of time using <code>--timeout</code>:</p>
<pre><code class="language-bash">php artisan queue:work --timeout=90</code></pre>
<p>Note that you can use this <code>timeout</code> in combination with <code>retry_after</code>, which is a setting in your queue configuration file. <code>retry_after</code> defines how long the worker should wait before assuming that a job has failed and needs to be re-added to the queue for a second try. As the docs note, make sure that your <code>retry_after</code> is at least a few seconds longer than your <code>timeout</code> so you don't get an overlap spinning up multiple copies of the same job.</p>
<h2>Conclude</h2>
<p>That's it for now! It's pretty simple and light stuff, but I think it makes the entire setup a little bit cleaner and more predictable. Good stuff. </p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/a-little-trick-for-grouping-fields-in-an-html-form</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/a-little-trick-for-grouping-fields-in-an-html-form"/>
        <title>A little trick for grouping fields in an HTML form</title>
        <published>2016-12-15T00:00:00+00:00</published>
        <updated>2016-12-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Imagine this scenario: You have a group of fields ...</summary>
        <content type="html"><![CDATA[
        <p>Imagine this scenario: You have a group of fields that represent a person. Maybe the form you're building allows you to create a company, but you also want to be able to add employees of the company.</p>
<p>You don't know how many employees your users will add, so you add a little JavaScript button that makes it possible to add more.</p>
<p>How do you name your fields?</p>
<h2>How we used to do it</h2>
<p>You probably know this is the wrong way:</p>
<pre><code>Person 1:
&lt;label&gt;First name&lt;/label&gt;
&lt;input name="first_name1"&gt;

&lt;label&gt;Last name&lt;/label&gt;
&lt;input name="last_name1"&gt;

&lt;label&gt;Email&lt;/label&gt;
&lt;input name="email1"&gt;</code></pre>
<p>To pull those out in the backend will require string manipulation—and imagine parsing out the number from that string field name when some numbers have one digit, but then all of a sudden you have 10 employees and now some of the fields have two digits at the end instead. Fail. Don't do it.</p>
<p>Here's the more common suggestion: use the field name array syntax:</p>
<pre><code>Person 1:
&lt;label&gt;First name&lt;/label&gt;
&lt;input name="first_name[]"&gt;

&lt;label&gt;Last name&lt;/label&gt;
&lt;input name="last_name[]"&gt;

&lt;label&gt;Email&lt;/label&gt;
&lt;input name="email[]"&gt;

Person 2:
&lt;label&gt;First name&lt;/label&gt;
&lt;input name="first_name[]"&gt;

&lt;label&gt;Last name&lt;/label&gt;
&lt;input name="last_name[]"&gt;

&lt;label&gt;Email&lt;/label&gt;
&lt;input name="email[]"&gt;</code></pre>
<p>This seems like a great idea, and it is—but when you parse the input on the other end, you're probably expecting something like this:</p>
<pre><code>person1 = ['Jim', 'Barber', 'jim@barber.com'];
person2 = ['Amira', 'Sayegh', 'amira@sayegh.com'];</code></pre>
<p>Sadly, that's not what you get. Instead, you get this:</p>
<pre><code>first_name = ['Jim', 'Amira'];
last_name = ['Barber', 'Sayegh'];
email_name = ['jim@barber.com', 'amira@sayegh.com'];</code></pre>
<p>Parsing that together is not awful, but it can get really clumsy—especially as you add more fields.</p>
<h2>What's this all about then</h2>
<p>Fear not! There is a better solution!</p>
<p>If you set your fields to be grouped by &quot;children&quot; of a parent field, and give each &quot;child&quot; a numeric index, they'll all returned grouped, and then they'll return the way you're expecting. So <code>people</code> is our &quot;parent field&quot;, <code>people[1]</code> is our first &quot;child&quot;, and <code>people[1][first_name]</code> is that child's first property. </p>
<pre><code>Person 1:
&lt;label&gt;First name&lt;/label&gt;
&lt;input name="people[1][first_name]"&gt;

&lt;label&gt;Last name&lt;/label&gt;
&lt;input name="people[1][last_name]"&gt;

&lt;label&gt;Email&lt;/label&gt;
&lt;input name="people[1][email]"&gt;

Person 2:
&lt;label&gt;First name&lt;/label&gt;
&lt;input name="people[2][first_name]"&gt;

&lt;label&gt;Last name&lt;/label&gt;
&lt;input name="people[2][last_name]"&gt;

&lt;label&gt;Email&lt;/label&gt;
&lt;input name="people[2][email]"&gt;</code></pre>
<p>And take a look at what we get now:</p>
<pre><code>people = [
    [
        'first_name' =&gt; 'Jim',
        'last_name' =&gt; 'Barber',
        'email' =&gt; 'jim@barber.com
    ],
    [
        'first_name' =&gt; 'Amira',
        'last_name' =&gt; 'Sayegh',
        'email' =&gt; 'amira@sayegh.com
    ]
]</code></pre>
<p>Boom, baby.</p>
<h2>Bonus</h2>
<p>Here's a quick bit of ES6 JavaScript to show one way you might want to do this:</p>
<pre><code>&lt;form method="post"&gt;
    &lt;div id="people-container"&gt;
        &lt;h3&gt;Person 1:&lt;/h3&gt;
        &lt;p&gt;
            &lt;label&gt;First name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[1][first_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Last name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[1][last_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Email&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[1][email]"&gt;
        &lt;/p&gt;

        &lt;h3&gt;Person 2:&lt;/h3&gt;
        &lt;p&gt;
            &lt;label&gt;First name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[2][first_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Last name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[2][last_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Email&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[2][email]"&gt;
        &lt;/p&gt;
    &lt;/div&gt;

    &lt;a href="javascript:;" id="add-new-person"&gt;Add new person&lt;/a&gt;

    &lt;p&gt;
        &lt;input type="submit"&gt;
    &lt;/p&gt;
&lt;/form&gt;

&lt;script&gt;
let i = 3;
document.getElementById('add-new-person').onclick = function () {
    let template = `
        &lt;h3&gt;Person ${i}:&lt;/h3&gt;
        &lt;p&gt;
            &lt;label&gt;First name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[${i}][first_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Last name&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[${i}][last_name]"&gt;
        &lt;/p&gt;

        &lt;p&gt;
            &lt;label&gt;Email&lt;/label&gt;&lt;br&gt;
            &lt;input name="people[${i}][email]"&gt;
        &lt;/p&gt;`;

    let container = document.getElementById('people-container');
    let div = document.createElement('div');
    div.innerHTML = template;
    container.appendChild(div);

    i++;
}
&lt;/script&gt;</code></pre>
<p>On CodePen: </p>
<p data-height="298" data-theme-id="dark" data-slug-hash="zoMyyW" data-default-tab="js,result" data-user="mattstauffer" data-embed-version="2" data-pen-title="HTML form submission with multiple sub items" class="codepen">See the Pen <a href="http://codepen.io/mattstauffer/pen/zoMyyW/">HTML form submission with multiple sub items</a> by Matt Stauffer (<a href="http://codepen.io/mattstauffer">@mattstauffer</a>) on <a href="http://codepen.io">CodePen</a>.</p>
<script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script>
<h2>Bonus</h2>
<p>I remembered that I wanted to write this article as I was listening to a great <a href="http://www.fullstackradio.com/54">Full-Stack Radio episode with Jonathan Reinink</a> where they talk about forms for an hour. It's good stuff. Take a listen.</p>
<p>Also, Adam has written a little about this same problem on his blog—but he chose to solve it on the server side instead. Take a look: <a href="https://adamwathan.me/2016/04/06/cleaning-up-form-input-with-transpose/">Cleaning up form input with transpose</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-up-running-is-launched-and-available-for-order</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-up-running-is-launched-and-available-for-order"/>
        <title>Laravel: Up &amp; Running is launched and available for order!</title>
        <published>2016-12-13T00:00:00+00:00</published>
        <updated>2016-12-13T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I&#039;ve got great news, folks—both the print and eB...</summary>
        <content type="html"><![CDATA[
        <p>I've got great news, folks—<strong>both the print and eBook versions of <a href="https://laravelupandrunning.com/">Laravel: Up &amp; Running</a> are now available at <a href="http://amzn.to/2htnr2u">Amazon</a> and <a href="http://shop.oreilly.com/product/0636920044116.do">O'Reilly</a>.</strong> They're shipping today!</p>
<hr />
<p>We had a little mixup where Amazon ran out of stock right on launch day, but it's now looking great:</p>
<p><a href="http://amzn.to/2htnr2u"><img src="/assets/images/content/lur-on-amazon.png" alt="Laravel: Up & Running on Amazon" /></a></p>
<p>As always, Amazon has the cheapest prices (at least in the U.S.) and can sell the print and eBook versions of the book.</p>
<hr />
<p>O'Reilly also has a page up for it, where you can buy the print book or any variety of eBook formats:</p>
<p><a href="http://shop.oreilly.com/product/0636920044116.do"><img src="/assets/images/content/lur-on-oreilly.png" alt="Laravel: Up & Running on O'Reilly" /></a></p>
<hr />
<p>Folks who pre-ordered are just now starting to get their print copies, starting in the U.K. and moving around the world, so I'm looking forward to finally hearing what everyone thinks.</p>
<p>I got my copy last week, and here are a few photos:</p>
<p><img src="/assets/images/content/lur-cover-shots.jpg" alt="Cover shots" /></p>
<p>Yes, that's what 454 pages looks like!</p>
<hr />
<p>Here are a few early reviews:</p>
<blockquote>
<b>***** Great content for any level of Laravel developer, new or experienced!</b><br>

This book has so many tidbits in it that helped expand my knowledge of Laravel. A huge amount of effort was put into making the content clear, understandable, and digestible. I recommend this for anyone getting started with Laravel or even as a reference for experienced users.<br><br>

- Vince Mitchell
</blockquote>
<blockquote>
<b>***** The best laravel book so far</b><br>

I tried several books regarding laravel 5.3 in the last few weeks. And this is by far the best one if you are completely new to laravel like me.<br><br>

The examples are short yet concise, easy to understand and the concepts behind them are explained very well. You learn a whole lot without getting overwhelmed with huge code examples.<br><br>

While it's always best to try out all the examples in a programming book, you can read this one also without having a computer nearby and still get your head around the concepts in laravel.<br><br>

I am glad I found this book!<br><br>

- ronfrtz
</blockquote>
<blockquote>
<b>***** Even useful for veteran Laravel devs</b><br>

As a 4 years experienced developer with Laravel, I must say it was surprisingly helpful to learn some tips and tricks since we as veteran engineers think we know it all.<br><br>

This shows how much effort Matt puts into learning the underlying codebase and thus sometimes giving more detailed and easy to learn information that isn't even in the Documentation (at least at the time of the Pre Release).<br><br>

Matt is a natural teacher and has a great learning methodology.<br><br>

- Andre Sardo
</blockquote>
<hr />
<p>I'm overjoyed that this product of over a year of work is finally in people's hands. If you have it, please go rate and review it on O'Reilly or Amazon! And if you don't have it, there's no better time than now to go <a href="https://laravelupandrunning.com/">buy a copy</a>.</p>
<p>And now... back to your regularly scheduled blog. Finally!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/the-new-notification-system-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/the-new-notification-system-in-laravel-5-3"/>
        <title>The new Notification system in Laravel 5.3</title>
        <published>2016-10-19T00:00:00+00:00</published>
        <updated>2016-10-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In a previous blog post I&#039;ve covered Laravel&#039;s new...</summary>
        <content type="html"><![CDATA[
        <p>In a previous blog post I've covered <a href="https://mattstauffer.co/blog/introducing-mailables-in-laravel-5-3">Laravel's new Mailable feature</a>, which introduces some important changes to how we send mail in Laravel. I'd recommend at least skimming it if you haven't read it yet. In short, the preferred mail syntax is no longer sending mail using the &quot;classic&quot; mail closures, but instead creating a &quot;Mailable&quot; class for each message you want to send&mdash;for example, the &quot;WelcomeNewUser&quot; mailable class.</p>
<p>In Laravel 5.3, we have another new feature for communicating with our users: <strong>Notifications</strong>.</p>
<p>Think about any message that you want to send to your users where you may not care about <em>how</em> they receive the message. A password reset notification, maybe, or a &quot;you have new changes to review&quot; notification, or &quot;Someone added you as a friend.&quot; None of these are specifically better as emails; they may be just fine as SMS messages, Slack notifications, in-app popups, or myriad other means of notifications.</p>
<p>Laravel 5.3's Notification system makes it easy to set up a single class for each notification (e.g. &quot;WorkoutAssigned&quot;) which describes how to notify users of the same message using many different communication mediums, and also how to choose which medium to use for each user.</p>
<h2>Creating our first notification</h2>
<p>As always, we'll use an Artisan command to create our notifications:</p>
<pre><code class="language-bash">php artisan make:notification WorkoutAssigned</code></pre>
<p>It'll create our file at <code>app/Notifications/WorkoutAssigned.php</code>, and it will look like this:</p>
<pre><code class="language-php">&lt;?php

namespace App\Notifications;

use Illuminate\Bus\Queueable;
use Illuminate\Notifications\Notification;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Messages\MailMessage;

class WorkoutAssigned extends Notification
{
    use Queueable;

    /**
     * Create a new notification instance.
     *
     * @return void
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the notification's delivery channels.
     *
     * @param  mixed  $notifiable
     * @return array
     */
    public function via($notifiable)
    {
        return ['mail'];
    }

    /**
     * Get the mail representation of the notification.
     *
     * @param  mixed  $notifiable
     * @return \Illuminate\Notifications\Messages\MailMessage
     */
    public function toMail($notifiable)
    {
        return (new MailMessage)
                    -&gt;line('The introduction to the notification.')
                    -&gt;action('Notification Action', 'https://laravel.com')
                    -&gt;line('Thank you for using our application!');
    }

    /**
     * Get the array representation of the notification.
     *
     * @param  mixed  $notifiable
     * @return array
     */
    public function toArray($notifiable)
    {
        return [
            //
        ];
    }
}</code></pre>
<h2>The Anatomy of a Notification</h2>
<p>Let's take a look at what we have here. First, the constructor, where we'll inject any relevant data.</p>
<pre><code class="language-php">public function __construct() {}</code></pre>
<p>Next, we have the <code>via()</code> method, which allows us to define <em>which</em> of the possible notification methods each individual instance will be sent using. Return an array of notification types here and the given notification will be sent using <em>all</em> of the provided notification methods.</p>
<pre><code class="language-php">public function via($notifiable)
{
    return ['mail'];
}</code></pre>
<p>For now, we'll just keep this hard-coded, but since this is a method, you can programatically define which channel names to use&mdash;for example, allowing each user to define their notification preferences.</p>
<p>Out of the box, your notification shows how to customize a specific notification channel with the <code>toMail()</code> method. It's passed the &quot;notifiable&quot;, which we'll cover in a second, and you build a mail message and return it.</p>
<pre><code class="language-php">public function toMail($notifiable)
{
    return (new MailMessage)
        -&gt;line('The introduction to the notification.')
        -&gt;action('Notification Action', 'https://laravel.com')
        -&gt;line('Thank you for using our application!');
}</code></pre>
<p>Finally, the <code>toArray()</code> method is the basic fallback that will be referenced by any channel that you don't specifically customize&mdash;for example, the database channel.</p>
<pre><code class="language-php">public function toArray($notifiable)
{
    return [];
}</code></pre>
<p>Let's tweak this class to make a bit more sense for our &quot;Workout Assigned&quot; notification:</p>
<pre><code class="language-php">...

class WorkoutAssigned extends Notification
{
    use Queueable;

    private $workout;

    public function __construct($workout)
    {
        $this-&gt;workout = $workout;
    }

    public function via($notifiable)
    {
        return ['mail'];
    }

    public function toMail($notifiable)
    {
        return (new MailMessage)
            -&gt;line("You've been assigned a new workout!")
            -&gt;action('View workout', route('workouts.show', [$this-&gt;workout]))
            -&gt;line("Let's get going!");
    }

    public function toArray($notifiable)
    {
        return [
            'workout' =&gt; $this-&gt;workout-&gt;id
        ];
    }
}</code></pre>
<p>So we're expecting the instance to be constructed with a workout, so we can correctly notify our notifiable(s) of which workout was assigned to them.</p>
<h2>What is a Notifiable?</h2>
<p>Up until now I've been talking about notifying users. But technically any Eloquent model could be notifiable; it should just import the <code>Illuminate\Notifications\Notifiable</code> trait. You may find yourself wanting to notify a Group, a Team, a List, or any other reasonable model that you might want to send notifications to.</p>
<p>Just note that certain notification channels expect certain information available on the notifiable. For example, the mail channel expects the model to have an &quot;email&quot; property so it knows which email address to send to. You can customize how to route a given model for a given channel by adding a method like this to your model:</p>
<pre><code class="language-php">...
class Group
{
    use Notifiable;

    public function routeNotificationForMail()
    {
        return $this-&gt;owner-&gt;email;
    }
}</code></pre>
<p>The structure is <code>routeNotificationFor{CHANNELNAME}</code>, and you need to return, in this case, the email address to send to. Other notification channels will expect different things returned for their route methods.</p>
<h2>How to send a notification</h2>
<p>There are two ways to send a notification. First, you can use the Notification façade:</p>
<pre><code class="language-php">Notification::send(User::first(), new WorkoutAssigned($workout));</code></pre>
<p>The first parameter is who should be notified. You can either pass a single model instance, <em>or</em> you can pass a whole collection:</p>
<pre><code class="language-php">Notification::send(User::all(), new DowntimePlanned($date));</code></pre>
<p>The second parameter is an instance of your notification.</p>
<p>Alternatively, you can use the <code>notify()</code> method on your model that imports the <code>Notifiable</code> trait (which the default <code>User</code> class already does out of the box):</p>
<pre><code class="language-php">$user-&gt;notify(new WorkoutAssigned($workout));</code></pre>
<blockquote>
<p>Note: Before you send your first notification, go edit the new property named &quot;name&quot; in your <code>config/app.php</code> file; this will determine the name of your app which will be displayed in the header and footer of your emails.</p>
</blockquote>
<p>Here's what the mail notification looks like by default with our Workout Assigned class above:</p>
<p><img src="/assets/images/content/default-email-notification.png" alt="Default notification email screenshot" /></p>
<h2>Available channels</h2>
<p>So, what channels are available other than <code>mail</code>? Out of the box you'll get <code>database</code>, <code>broadcast</code>, <code>nexmo</code>, and <code>slack</code>, but you can look for more at the community-driven <a href="http://laravel-notification-channels.com/">Laravel Notification Channels</a> site.</p>
<p>Remember how I mentioned programmatically defining which notification channel to use for a user? Here's one way you might want to do it, from the docs:</p>
<pre><code class="language-php">public function via($notifiable)
{
    return $notifiable-&gt;prefers_sms ? ['nexmo'] : ['mail', 'database'];
}</code></pre>
<p>You could also build that logic into the user model itself:</p>
<pre><code class="language-php">// in notification
public function via($notifiable)
{
    return $notifiable-&gt;preferredNotificationChannel();
}

// in the User class
public function preferredNotificationChannel()
{
    return PresenceChecker::isOnline($this) ? ['broadcast'] : ['mail'];
}</code></pre>
<h3>Mail channel</h3>
<p>We've already taken a look at the basics of how to send a mail notification, but there's a lot more customizing you can do.</p>
<p>You can customize the subject of your email (which is, by default, parsed from the name of your notification class&mdash;e.g. &quot;WorkoutAssigned&quot; would have a subject of &quot;Workout Assigned&quot;) using the <code>subject()</code> method:</p>
<pre><code class="language-php">public function toMail($notifiable)
{
    return (new MailMessage)
        -&gt;subject('You have been assigned a new workout!')
    ...
}</code></pre>
<p>You can customize the greeting (which defaults to &quot;Hello!&quot;) using the <code>greeting()</code> method:</p>
<pre><code class="language-php">public function toMail($notifiable)
{
    return (new MailMessage)
        -&gt;greeting("Let's goooooooo!")
    ...
}</code></pre>
<p>You can use the &quot;error&quot; template, which changes everything blue to red:</p>
<pre><code class="language-php">public function toMail($notifiable)
{
    return (new MailMessage)
        -&gt;error()
    ...
}</code></pre>
<p>And finally, you can publish and customize the template used for the email:</p>
<pre><code class="language-bash">php artisan vendor:publish --tag=laravel-notifications</code></pre>
<p>The HTML &amp; plain text templates will now be available in <code>resources/views/vendor/notifications</code>.</p>
<h3>Database channel</h3>
<p>The database notification channel stores each notification in a database table, expecting you to handle them in your application however you wish.</p>
<p>You can create a migration for this table by running <code>php artisan notifications:table</code>.</p>
<p>If you don't specify a <code>toDatabase()</code> method on your Notification, Laravel will use the <code>toArray()</code> method to define the data to store for your notification. But you can also customize it; whatever you return from the <code>toDatabase()</code> or <code>toArray()</code> methods will be JSON-encoded in the <code>data</code> database column.</p>
<pre><code class="language-php">// in your notification
public function toDatabase($notifiable)
{
    return [
        'trainee_id' =&gt; $notifiable-&gt;id,
        'workout_id' =&gt; $this-&gt;workout-&gt;id
    ];
}</code></pre>
<p>You can easily get these notifications via the <code>notifications()</code> relationship that's added to your model with the <code>Notifiable</code> trait. This includes some conveniences around &quot;read&quot; vs. &quot;unread&quot; notifications; each notification has a <code>markAsRead()</code> method that you can use to update its <code>read_at</code> property, and you can scope only to &quot;unread&quot; notifications using the <code>unreadNotifications()</code> method on the model:</p>
<pre><code class="language-php">foreach ($user-&gt;notifications as $notification) {
    // do stuff

    $notification-&gt;markAsRead();
}

// later...

foreach ($user-&gt;unreadNotifications as $notification) {
    // new!
}</code></pre>
<h3>Broadcast channel</h3>
<p>If you're not yet familiar with Laravel's Event Broadcasting, you'll want to be in order to understand the broadcast channel; check out my <a href="https://mattstauffer.co/blog/broadcasting-events-with-pusher-socket-in-laravel-5.1">blog post introducing Laravel's Event Broadcasting</a>.</p>
<p>The broadcast notification channel will broadcast events with your notification's data payload to your Websocket client. It'll use the <code>{notifiableClassNameDotNotated}.{id}</code> private channel for these notifications; this means notifying user 15 would broadcast to the private channel named <code>App.User.15</code>.</p>
<p>Just like the other methods, broadcast notifications will default to getting their data structure from <code>toArray()</code> unless you specifically define a <code>toBroadcast()</code> method.</p>
<p>If you're using Laravel Echo, you can subscribe to a user's broadcast channel with code that might look a bit like this:</p>
<pre><code class="language-javascript">var userId = 15; // set elsewhere

Echo.private('App.User.' + userId)
    .notification((notification) =&gt; {
        console.log(notification);
    });</code></pre>
<h3>Nexmo channel</h3>
<p>The Nexmo channel makes it easy to send SMS notifications to your users. You'll need to set up your Nexmo credentials in <code>config/services.php</code> under the <code>nexmo</code> key, looking something like this:</p>
<pre><code class="language-php">'nexmo' =&gt; [
    'key' =&gt; env('NEXMO_KEY'),
    'secret' =&gt; env('NEXMO_SECRET'),
    'sms_from' =&gt; '15558675309',
],</code></pre>
<p>You'll need to define a <code>toNexmo()</code> method that returns an instance of <code>Illuminate\Notifications\Message\NexmoMessage</code>:</p>
<pre><code class="language-php">public function toNexmo($notifiable)
{
    return (new NexmoMessage)
        -&gt;content('Hey this is on your phone OMG');
}</code></pre>
<p>Just like the email channel looks for an <code>email</code> property on the notifiable, the Nexmo channel looks for a <code>phone_number</code> property to send the message to. You can customize this with the <code>routeNotificationForNexmo()</code> method:</p>
<pre><code class="language-php">// in the notification
public function routeNotificationForNexmo()
{
    return $this-&gt;sms_number;
}</code></pre>
<h3>Slack channel</h3>
<p>The Slack notification channel broadcasts your notifications to a Slack channel.</p>
<blockquote>
<p>Note: In order to use Slack notifications, you'll need to bring Guzzle in via Composer: <code>composer require guzzlehttp/guzzle</code></p>
</blockquote>
<p>First, go to your Slack account, &quot;Apps and Integrations&quot; section (<a href="https://{yourteam}.slack.com/apps">https://{yourteam}.slack.com/apps</a>). Choose the &quot;Incoming Webhook&quot; type and add a new configuration. You can specify which channel you want it to post to and more.</p>
<p><img src="/assets/images/content/slack-integration-config-screen.png" alt="Slack integration configuration screenshot" /></p>
<p>Grab the Webhook URL and head back to your Laravel app.</p>
<p>Your notifiable should implement a <code>routeNotificationForSlack()</code> method that returns this webhook URL:</p>
<pre><code class="language-php">public function routeNotificationForSlack()
{
    return $this-&gt;slack_webhook_url;
}</code></pre>
<p>Now let's take a look at customizing the notification. You can read more <a href="https://laravel.com/docs/5.3/notifications#slack-notifications">in the docs</a>, but here's a quick sample from the docs of what you can do with your <code>toSlack()</code> method:</p>
<pre><code class="language-php">public function toSlack($notifiable)
{
    $url = url('/invoices/' . $this-&gt;invoice-&gt;id);

    return (new SlackMessage)
        -&gt;success()
        -&gt;content('One of your invoices has been paid!')
        -&gt;attachment(function ($attachment) use ($url) {
            $attachment-&gt;title('Invoice 1322', $url)
                -&gt;fields([
                    'Title' =&gt; 'Server Expenses',
                    'Amount' =&gt; '$1,234',
                    'Via' =&gt; 'American Express',
                    'Was Overdue' =&gt; ':-1:',
                ]);
        });
}</code></pre>
<p><img src="/assets/images/content/complex-slack-notification-example.png" alt="Complex Slack notification example" /></p>
<p>You can also keep it super simple; just generate a <code>SlackMessage</code> and define at least the content:</p>
<pre><code class="language-php">public function toSlack($notifiable)
{
    return (new SlackMessage)
        -&gt;content('One of your invoices has been paid!');
}</code></pre>
<h3>Queueing notifications</h3>
<p>Any notifications that implement the <code>ShouldQueue</code> interface and import the <code>Queueable</code> trait will be pushed onto your queue instead of sent synchronously. Since most of the notification channels require sending HTTP requests, queueing notifications is pretty highly recommended.</p>
<h2>Conclusion</h2>
<p>That's it!</p>
<p>This is great. Notifications are so simple and robust, you may no longer find yourself needing to use any other notification tool (mail, Slack SDK directly, etc.)&mdash;especially when you see how many custom notification channels the community has created. It's bonkers.</p>
<p>As always, with great power comes great responsibility; make sure you're being careful with your users' time and attention and you don't go overboard with the notifications.</p>
<p>So, go forth. Notify.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/whats-up-with-laravel-up-and-running</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/whats-up-with-laravel-up-and-running"/>
        <title>What&#039;s up with Laravel: Up and Running?</title>
        <published>2016-09-02T00:00:00+00:00</published>
        <updated>2016-09-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Hey folks!
            It&#039;s been a tumultuous summer, what wit...
        </summary>
        <content type="html"><![CDATA[
        <p>Hey folks!</p>
<p>It's been a tumultuous summer, what with Stauffer Child #2 arriving and me finally finishing <a href="https://laravelupandrunning.com/">Laravel: Up and Running</a> (WOOP!).</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Here’s li’l miss, cheesing a few hours after she was born. :) <a href="https://t.co/AguGOgipys">pic.twitter.com/AguGOgipys</a></p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/759892249370988545">July 31, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>A lot of folks have been asking me about timelines for the book, so let me share what we have here.</p>
<h2>The story of our timeline</h2>
<p>First, the most important thing: I finished writing the book a few months back, which was a great moment! I tweeted about it but can't find it anywhere. But it happened, I promise.</p>
<p>I promptly printed the entire book and spent the summer editing it by hand with a Sharpie:</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Editing. Will be done with these edits by the time <a href="https://twitter.com/laravelphp">@laravelphp</a> 5.3 releases; then I write up final features &amp; print! <a href="https://t.co/dauQqatou9">pic.twitter.com/dauQqatou9</a></p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/765895906897956864">August 17, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>The big timeline constraint was Laravel 5.3. Over a year ago, when we set out to publish the book, we decided we'd release it immediately after Laravel 5.3 was announced. We expected that announcement in April; it came in August. So, that's why our original projections were off. Apologies!</p>
<p>Once Taylor announced Laravel 5.3, I quickly wrote up the new features in the book and submitted my final manuscript on Monday of this week. It's with the copyeditors right now. Yesterday I got a tentative publishing schedule from O'Reilly, which says <strong><strong>the final Ebook will be available end of October and the print edition will be available beginning of November</strong></strong>.</p>
<h2>But I want it now!</h2>
<p>I get it. I want it now too! So here are a few things to help you in the waiting process.</p>
<h3>Early access Ebook</h3>
<p>First, anyone who <a href="http://shop.oreilly.com/product/0636920044116.do">pre-orders the Ebook from O'Reilly</a> will get early access to the Ebook as it is today. Right now that's the first 12 chapters, but I've asked my editor to update that with the final (pre-copyediting) version of the book. Once she has that released, which I hope will be any day now, anyone who preorders between now and when the book is released will have access to the entire book, just without the last round of copy edits.</p>
<p>So despite &quot;October/November&quot; as the release date, you can get the book almost exactly as it will release by ordering the Ebook today. If you plan to eventually buy the Ebook, don't wait for the release; this pre-release version that's coming out any day now is 99.9% the book that will finally be released.</p>
<h3>Reviews!</h3>
<p>Freek Van der Herten was one of the folks who got an early access version of the book, and he wrote a post after reading it: <a href="https://murze.be/2016/08/things-learned-reading-laravel-running/">&quot;Things I learned from reading Laravel: Up and running&quot;</a>. You can get some of my favorite tips from the book by taking a look at his post.</p>
<p>I also wrote a post about a few tips I learned when I was writing Laravel: Up and Running: <a href="https://mattstauffer.co/blog/things-i-didnt-know-laravel-could-do">&quot;Things I didn't Know Laravel Could Do&quot;</a>.</p>
<h3>FAQ</h3>
<p>I've gotten a few questions often enough that I wanted to put them together answers to them here.</p>
<ul>
<li><strong>Who is this book for?</strong><br />
Everyone. This is one of the biggest points of confusion I've heard. The book is designed to help someone who's never written a line of Laravel code before, but as you can see from my post and Freek's, folks who work in Laravel every day still can learn a lot from it.</li>
<li><strong>What version of Laravel will this be for?</strong><br />
It's up-to-date for Laravel 5.3, but I knew that print books will sit on your shelf for years, and a new minor version of Laravel comes out every six months. So, other than the fact that little bits of syntax will change and the book might not have a new feature that is added, this book will remain relevant even when Laravel 5.4 and 5.5 and 6 and whatever else are released. I intentionally wrote the book such that its primary goal is not teaching you syntax (that's what the docs are there for!) but teaching you <em>what</em> you can do with Laravel and <em>how</em> to think about working with Laravel.</li>
<li><strong>Don't print books on technology just get out of date?</strong><br />
See the answer to the above question.</li>
<li><strong>What can this book offer that the docs can't?</strong><br />
Laravel's docs are fantastic. There's no reason to write a reference book. You <em>will</em> see a ton of documentation in the book, and some sections definitely have similarities to the docs&mdash;but that's because the docs sometimes have landed on the absolute best way to teach a subject. Here's the thing, though: the book walks you through how to get started on your next Laravel application <em>as quickly as possible</em>. I can skip things I don't think are important and tell examples that there are no space for in the docs and customize it to tell a <em>story</em> that lets you learn well. The docs sections have to each exist on their own and have to be near-exhaustive. I don't have that need in my book, and that gives me the freedom to walk you through the framework in a way that gets you <em>up and running</em> quickly.</li>
</ul>
<h2>Conclusion</h2>
<p>That's all I have for you for today! I'll be releasing a few more segments of the book soon to show you even more of what you have to look forward to. I can't wait to hear what y'all think!</p>
<p>And finally, if you haven't already, you can <a href="http://shop.oreilly.com/product/0636920044116.do">pre-order at O'Reilly today</a> or you can <a href="https://laravelupandrunning.com/">sign up to be notified when the book is released</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/directory-structure-changes-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/directory-structure-changes-in-laravel-5-3"/>
        <title>Directory structure changes in Laravel 5.3</title>
        <published>2016-08-08T00:00:00+00:00</published>
        <updated>2016-08-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">We&#039;ve already covered the new routes directory and...</summary>
        <content type="html"><![CDATA[
        <p>We've already <a href="https://mattstauffer.co/blog/routing-changes-in-laravel-5-3">covered the new <code>routes</code> directory</a> and the changes that will make to the directory structure. But there's one other directory change coming in Laravel 5.3: many of the default folders will not show up until you run a command that requires them.</p>
<p>These directories come in each new version of Laravel prior to 5.3 but are often not used, so all new installs won't have them. Here's the list of folders that are going away:</p>
<ul>
<li><code>Events</code></li>
<li><code>Jobs</code></li>
<li><code>Listeners</code></li>
<li><code>Policies</code></li>
</ul>
<p>Notice a pattern? These are directories that contain a single, more advanced class structure that aren't universal to Laravel apps. Events, Jobs, Listeners, and Policies.</p>
<p>One note: If you were used to manually creating classes for each of those structures, you may find this change adds an extra step; but if so, it's really worth considering using Artisan to create them anyway. Artisan will handle creating these directories if they don't exist, so the change should be transparent in that context.</p>
<p>For a great visual of how this change will simplify a default Laravel install, take a look at this graphic from <a href="https://laravel-news.com/2016/07/laravel-5-3-changes-app-folder/">Laravel News</a>:</p>
<p><img src="/assets/images/content/laravel-app-folder-changes.png" alt="Laravel App Folder Changes" /></p>
<p><em>(image from Laravel News post <a href="https://laravel-news.com/2016/07/laravel-5-3-changes-app-folder/">Laravel 5.3 changes the 'app' folder</a>)</em></p>
<p>There are also new folders that won't show up on a new install but might show up after you use Artisan generators: <code>app/Mail</code> for Mailables and <code>app/Notifications</code> for Notifications.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-mailables-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-mailables-in-laravel-5-3"/>
        <title>Introducing Mailables in Laravel 5.3</title>
        <published>2016-08-05T00:00:00+00:00</published>
        <updated>2016-08-05T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">For the longest time, sending mail in Laravel has ...</summary>
        <content type="html"><![CDATA[
        <p>For the longest time, sending mail in Laravel has felt clumsy compared to the relatively light APIs of most other Laravel features. Here's a mail example from the Laravel 5.2 docs:</p>
<pre><code class="language-php">Mail::send('emails.reminder', ['user' =&gt; $user], function ($m) use ($user) {
    $m-&gt;from('hello@app.com', 'Your Application');

    $m-&gt;to($user-&gt;email, $user-&gt;name)-&gt;subject('Your Reminder!');
});</code></pre>
<p>I'm not saying it's <em>awful</em>&mdash;it's still so much cleaner than its competitors--but it's often confusing to figure out what goes in the closure and what doesn't, what the parameter order is, etc.</p>
<h2>Introducing Mailables</h2>
<p>Mailables are PHP classes in Laravel 5.3 that represent a single email: &quot;NewUserWelcome&quot;, or &quot;PaymentReceipt&quot;. Now, similar to event and job dispatching, there's a simple &quot;send&quot; syntax, to which you'll pass an instance of the class that represents what you're &quot;dispatching&quot;; in this context, it's an email.</p>
<p>So now, that email above looks like this:</p>
<pre><code class="language-php">Mail::to($user)-&gt;send(new Reminder);</code></pre>
<p>Let's take a look at that <code>Reminder</code> class. First, create it with an Artisan command:</p>
<pre><code class="language-bash">php artisan make:mail Reminder</code></pre>
<p>It'll now live in <code>app/Mail</code> directory. Let's take a look at how it looks out of the box:</p>
<pre><code class="language-php">&lt;?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Mail\Mailable;
use Illuminate\Queue\SerializesModels;

class Reminder extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     *
     * @return void
     */
    public function __construct()
    {
        //
    }

    /**
     * Build the message.
     *
     * @return $this
     */
    public function build()
    {
        return $this-&gt;view('view.name');
    }
}</code></pre>
<p>All of the configuration you're used to doing in closures now takes place in the <code>build()</code> method. So let's re-create that example email again:</p>
<pre><code class="language-php">public function build()
{
    return $this-&gt;from('hello@app.com', 'Your Application')
        -&gt;subject('Your Reminder!')
        -&gt;view('emails.reminder');
}</code></pre>
<blockquote>
<p>Note: If you don't explicitly set the subject, Laravel will guess it from your class name. So if the class is named &quot;ApplicationReminder&quot;, the default subject will be &quot;Application Reminder&quot;.</p>
</blockquote>
<h3>Passing data</h3>
<p>Now, what if we want to pass some data in to the subject or into the view? That goes into the constructor:</p>
<pre><code class="language-php">Mail::to($user)-&gt;send(new Reminder($event));</code></pre>
<pre><code class="language-php">class Reminder extends Mailable
{
    public $event;

    public function __construct($event)
    {
        $this-&gt;event = $event;
    }

    public function build()
    {
        return $this-&gt;from('hello@app.com', 'Your Application')
            -&gt;subject('Event Reminder: ' . $this-&gt;event-&gt;name)
            -&gt;view('emails.reminder');
    }
}</code></pre>
<p>Any public properties on our mailable class will be made available to the view, so we can now use <code>$event</code> in the view:</p>
<pre><code class="language-php">// resources/views/emails/reminder.blade.php
&lt;h1&gt;{{ $event-&gt;name }} is coming up soon!&lt;/h1&gt;
&lt;p&gt;Lorem ipsum.&lt;/p&gt;</code></pre>
<p>But what if you'd prefer specifying the data explicitly? You can do that&mdash;pass an array to a <code>with()</code> call in <code>build()</code>:</p>
<pre><code class="language-php">public function build()
{
    return $this-&gt;from('hello@app.com', 'Your Application')
        -&gt;subject('Event Reminder: ' . $this-&gt;event-&gt;name)
        -&gt;view('emails.reminder')
        -&gt;with(['title' =&gt; $this-&gt;event-&gt;name]);
}</code></pre>
<h3>Customizing the delivery list</h3>
<p>As you can see, customizing the email itself happens in the <code>build()</code> method and customizing who's getting it happens when we call the email. Let's take a look at <code>cc</code> and <code>bcc</code>:</p>
<pre><code class="language-php">Mail::to(User::find(1))
    -&gt;cc(User::find(2))
    -&gt;bcc(User::find(3))
    -&gt;send(new Reminder);

// These methods also accept collections
Mail::to(Users::all())
    -&gt;send(new Reminder);</code></pre>
<h3>Plaintext views</h3>
<p>There's a new <code>text()</code> method to go along with the new <code>view()</code> method. You can pass it the view you want used for the plaintext version of this email:</p>
<pre><code class="language-php">public function build()
{
    return $this-&gt;view('emails.reminder')
        -&gt;text('emails.reminder_plain');
}</code></pre>
<h3>Queueing mailables</h3>
<p>One of the problems with sending mail in line with your application's execution is that it can often take a few seconds to send. Queues are the perfect answer to this. They're already easy with Laravel's pre-existing mail syntax, and it stays easy here: Just run <code>Mail::queue</code> instead of <code>Mail::send</code>.</p>
<pre><code class="language-php">Mail::to($user)-&gt;queue(new Reminder);</code></pre>
<p>You can also use <code>later</code> to specify when it should be sent:</p>
<pre><code class="language-php">$when = Carbon\Carbon::now()-&gt;addMinutes(15);

Mail::to($user)-&gt;later($when, new Reminder);</code></pre>
<h3>Attachments</h3>
<p>You'll probably get used to hearing this. Everything you can currently run within your mail closures, you can run within the <code>build()</code> method. This includes <code>attach()</code>. The first parameter is the path to the file, and the optional second parameter takes an array for customizing the details of the attached file.</p>
<pre><code class="language-php">public function build()
{
    $this-&gt;view('emails.reminders')
        -&gt;attach('/path/to/file', [
            'as' =&gt; 'name.pdf',
            'mime' =&gt; 'application/pdf',
        ]);
}</code></pre>
<p>You can also use <code>attachRaw</code> to attach raw data:</p>
<pre><code class="language-php">public function build()
{
    $this-&gt;view('emails.reminders')
        -&gt;attachRaw($this-&gt;pdf, 'name.pdf', [
            'mime' =&gt; 'application/pdf',
        ]);
}</code></pre>
<h2>Conclusions</h2>
<p>Mailables are not a drastic new feature. There's nothing you can do here that you couldn't already do with Laravel.</p>
<p>But it's one of those features you'll be glad for on a regular basis. I use mail a lot in my Laravel apps. I'm very grateful for this new system. It just makes sense.</p>
<p>The <a href="https://laravel.com/docs/master/mail">docs</a> are online now if you want to read more.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-passport</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-laravel-passport"/>
        <title>Introducing Laravel Passport</title>
        <published>2016-07-30T00:00:00+00:00</published>
        <updated>2016-07-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">API authentication can be tricky. OAuth 2 is the r...</summary>
        <content type="html"><![CDATA[
        <p>API authentication can be tricky. OAuth 2 is the reigning ruler of the various standards that you might consider, but it's complex and difficult to implement&mdash;even with the great packages available (<a href="https://packagist.org/packages/league/oauth2-server">League</a> and <a href="https://packagist.org/packages/lucadegasperi/oauth2-server-laravel">Luca</a> among them).</p>
<p>We're talking many routes, dozens of migrations, complicated configuration, and much more&mdash;even with amazing packages trying to simplify the situation as much as possible.</p>
<p>Laravel Passport is native OAuth 2 server for Laravel apps. Like Cashier and Scout, you'll bring it into your app with Composer. It uses the League OAuth2 Server package as a dependency but provides a simple, easy-to-learn and easy-to-implement syntax.</p>
<h2>Laying the groundwork in Laravel 5.2</h2>
<p>In Laravel 5.2, we got a new structure in our authentication system: multiple auth drivers. This means that, instead of there being a single auth system that is responsible for one app at a time, you can apply different auth systems to different routes (or in different environments). Out of the box, we got the same auth system we've always had <em>and</em> a new token-based auth system for APIs.</p>
<p>Laravel 5.2's token system was fine enough&mdash;but it wasn't really any more secure than normal password login. It was there, most importantly, to lay the groundwork for packages like Passport, which essentially adds a new &quot;passport&quot; driver you can use in your app to make certain routes OAuth2 authed.</p>
<h2>Installing Passport</h2>
<p>Follow these steps on any Laravel 5.3 app and you'll be on your way to the easiest OAuth 2 server possible:</p>
<ol>
<li>Install Passport via Composer.  
<pre><code class="language-bash">composer require laravel/passport</code></pre></li>
<li>Go to <code>config/app.php</code>, and add <code>Laravel\Passport\PassportServiceProvider</code> to your providers list.</li>
<li>Run the new migrations; because of 5.3's multiple migrations paths, the new Passport migrations will be included in your normal migration path.  
<pre><code class="language-bash">php artisan migrate</code></pre></li>
<li>Run <code>php artisan passport:install</code>, which will create encryption keys (local files) and personal/password grant tokens (inserted into your database)</li>
<li>Go to your <code>User</code> class and import the trait <code>Laravel\Passport\HasApiTokens</code></li>
<li>
<p>Add the OAuth2 routes: go to <code>AuthServiceProvider</code> and use <code>Laravel\Passport\Passport</code>, then in the <code>boot()</code> method run <code>Passport::routes()</code>  </p>
<pre><code class="language-php">// AuthServiceProvider
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();
}</code></pre>
</li>
<li>
<p><em>[Optional]</em> Define at least one scope in the <code>boot()</code> method of <code>AuthServiceProvider</code>, after <code>Passport::routes()</code> using <code>Passport::tokensCan</code></p>
<pre><code class="language-php">// AuthServiceProvider
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::tokensCan([
        'conference' =&gt; 'Access your conference information'
    ]);
}</code></pre>
</li>
<li>In <code>config/auth.php</code>, <code>guards.api.driver</code>; change the <code>api</code> guard to use <code>passport</code> driver instead of <code>token</code>  
<pre><code class="language-php">// config/auth.php
return [
    ...
    'guards' =&gt; [
        ...
        'api' =&gt; [
            'driver' =&gt; 'passport', // was previously 'token'
            'provider' =&gt; 'users'
        ]
    ]
];</code></pre></li>
<li>Build the Laravel auth scaffold; we'll need our users to be able to log in before we can authenticate them with Passport
<pre><code class="language-bash">php artisan make:auth</code></pre></li>
<li>Publish the Vue components, if you want to use them
<pre><code class="language-bash">php artisan vendor:publish --tag=passport-components</code></pre></li>
</ol>
<p>This is a lot, but basically we're importing that package, registering it with Laravel, setting our <code>User</code> up to authenticate using it, adding a few routes for authentication and callbacks, and defining our first scope for users to have access via.</p>
<p>At this point, you're theoretically done. The server is installed and it works. That was fast! Your routes work, and you can create your clients and tokens either via Passport's Artisan commands or by building your own administrative tool on top of Passport's API. But before you make your decision, take a look at that API and the Vue components Passport provides out of the box.</p>
<h2>Passport's management API</h2>
<p>Passport exposes a JSON API for your frontend to consume to let you manage your clients and tokens.</p>
<p>Out of the box, Passport comes with Vue components that show how you might want to interact with this API in your app. You could use these components and call it done, or you could write your own tool to interact with the API.</p>
<h2>Passport's default Vue frontend</h2>
<p>Out of the box, Passport comes with three Vue components: <code>passport-clients</code>, which shows all of the clients you've registered; <code>passport-authorized-clients</code>, which shows all of the clients you've given access to your account; and <code>passport-personal-access-tokens</code>, which shows all of the &quot;personal&quot; tokens you've created for testing the API. We can register them in <code>app.js</code>:</p>
<pre><code class="language-javascript">Vue.component(
    'passport-clients',
    require('./components/passport/Clients.vue')
);

Vue.component(
    'passport-authorized-clients',
    require('./components/passport/AuthorizedClients.vue')
);

Vue.component(
    'passport-personal-access-tokens',
    require('./components/passport/PersonalAccessTokens.vue')
);

const app = new Vue({
    el: 'body'
});</code></pre>
<p>And then use them in our HTML:</p>
<pre><code>&lt;!-- let people make clients --&gt;
&lt;passport-clients&gt;&lt;/passport-clients&gt;

&lt;!-- list of clients people have authorized to access our account --&gt;
&lt;passport-authorized-clients&gt;&lt;/passport-authorized-clients&gt;

&lt;!-- make it simple to generate a token right in the UI to play with --&gt;
&lt;passport-personal-access-tokens&gt;&lt;/passport-personal-access-tokens&gt;</code></pre>
<p>Let's walk through how they work and what they do.</p>
<p>We'll follow the example Taylor set in his talk at Laracon: We'll have a Passport-enabled server app at <code>passport.dev</code> and a consumer app at <code>consumer.dev</code>.</p>
<p>Here's what the admin panel (using the three components as shown above) will look on your Passport-enabled Laravel app:</p>
<p><img src="/assets/images/content/passport-default-components.png" alt="Screenshot of Laravel Passport default components view" /></p>
<p>Let's create a new client:</p>
<p><img src="/assets/images/content/passport-create-client.png" alt="Screenshot of Laravel Passport create client view" /></p>
<p>Once you create a client, the UI will return a &quot;secret&quot; and a &quot;client ID&quot;. Go to your consuming client (another site or app; in this example, <code>consumer.dev</code>) and put that key and ID into your configuration for your OAuth2 Client. Here's what it looked like when I created a client for &quot;Consumer.dev&quot;:</p>
<p><img src="/assets/images/content/passport-clients-list.png" alt="Screenshot of Laravel Passport clients list" /></p>
<blockquote>
<p>Never worked with OAuth 2 before? In the particular type of authentication we're working with right now, the &quot;authorization code&quot; grant, the way that a <em>client</em> identifies themselves is with a &quot;client ID&quot; (like a primary key&mdash;sometimes just <code>1</code>) and a &quot;secret&quot; (like a password or a token). Each &quot;client&quot; is something like a web site that connects to this web site's data, or a mobile client, or something else that relies on this app and needs to authenticate with it. Passport also enables &quot;password&quot; grant and &quot;personal&quot; grant.</p>
</blockquote>
<p>To test our app, we're going to build a consumer app just like Taylor did in his keynote. Remember, with any OAuth 2 situation, we have at least two apps: first, our &quot;server&quot; app that is using Passport, which is the app that will be authenticating users, and the &quot;consumer&quot; app that will be requesting the authenticating. Imagine that Twitter is your &quot;server&quot; and a twitter client you're writing is your &quot;consumer&quot;; the Twitter client wants their user to be able to authenticate with Twitter so the client can display their tweets.</p>
<p>Here's the routes file for our <code>consumer.dev</code> <em>client</em> app, based on Taylor's Laracon demo. Remember, this is the app that is CONSUMING the OAuth authentication services, not the one providing it.</p>
<pre><code class="language-php">// routes/web.php

use Illuminate\Http\Request;

// First route that user visits on consumer app
Route::get('/', function () {
    // Build the query parameter string to pass auth information to our request
    $query = http_build_query([
        'client_id' =&gt; 3,
        'redirect_uri' =&gt; 'http://consumer.dev/callback',
        'response_type' =&gt; 'code',
        'scope' =&gt; 'conference'
    ]);

    // Redirect the user to the OAuth authorization page
    return redirect('http://passport.dev/oauth/authorize?' . $query);
});

// Route that user is forwarded back to after approving on server
Route::get('callback', function (Request $request) {
    $http = new GuzzleHttp\Client;

    $response = $http-&gt;post('http://passport.dev/oauth/token', [
        'form_params' =&gt; [
            'grant_type' =&gt; 'authorization_code',
            'client_id' =&gt; 3, // from admin panel above
            'client_secret' =&gt; 'yxOJrP0L9gqbXxoxoFl5I22IytFOpeCnUXD3aE0d', // from admin panel above
            'redirect_uri' =&gt; 'http://consumer.dev/callback',
            'code' =&gt; $request-&gt;code // Get code from the callback
        ]
    ]);

    // echo the access token; normally we would save this in the DB
    return json_decode((string) $response-&gt;getBody(), true)['access_token'];
});</code></pre>
<p>When you visit <code>http://consumer.dev/</code> it builds an OAuth request URL using your client ID and scope and providing a post-auth callback URL, and then it redirects you over to the Passport site (<code>passport.dev</code>) for you to accept or reject the auth request.</p>
<p><img src="/assets/images/content/passport-approval-view.png" alt="Screenshot of Laravel Passport auth approval view" /></p>
<p>When you authorize, Passport will then redirect you back to your provided callback URL&mdash;in this case, <code>http://consumer.dev/callback</code>&mdash;and you'll now have access to your token. As you can see in the example above, you can do whatever you want with it&mdash;in this case we'll just echo it out to grab and use in a test we'll cover in a minute.</p>
<h2>Testing your token</h2>
<p>Assuming you created a client for your consumer app and then got a token for your user, let's now test out using it.</p>
<p>First, set up a route in your Passport-enabled app that we can be sure requires that the user is authenticated. The simplest option will be to return the user, which is actually already set up in your <code>routes/api.php</code> file by default:</p>
<pre><code class="language-php">// routes/api.php
Route::get('/user', function (Request $request) {
    return $request-&gt;user();
})-&gt;middleware('auth:api');</code></pre>
<p>Next, open up your favorite REST client (Postman, Paw, or manually write a query in PHP or CURL) and make a request to that route we set up: <code>http://passport.dev/api/user</code>. So that you get a useful response, be sure to set your <code>Content-Type</code> header to  <code>application/json</code> and your <code>Accept</code> header to <code>application/json</code>.</p>
<p>With no authentication, you'll receive a <code>401</code> response showing you're not authenticated:</p>
<pre><code class="language-json">{
  "error": "Unauthenticated."
}</code></pre>
<p>Now, remember how the <code>callback</code> route in our consumer app echoes the access token? Copy that token, and add a new header to your request named &quot;Authorization&quot;. Set the value equal to &quot;Bearer TOKENHERE&quot;, where TOKENHERE is your access token you copied from the <code>callback</code> route.</p>
<p>Now, you should see your actual user:</p>
<pre><code class="language-json">{
  "id": 1,
  "name": "Matt Stauffer",
  "email": "matt@mattstauffer.co",
  "created_at": "2016-09-08 10:45:00",
  "updated_at": "2016-09-08 10:45:00"
}</code></pre>
<p>That's it! You have a fully functional OAuth 2 auth API!</p>
<p>There's a few more features, though. Let's take a look.</p>
<h2>Personal tokens</h2>
<p>Passport offers a helpful tool that's not built into other OAuth 2 packages: the ability for your users to easily create tokens for <em>themselves</em> to use to test out your app. Your power users (imagine one of your users who is a developer and wants to consider your API for building an app against) don't have to create an entire second consumer app and register it for use with the authorization code grant just to test your API; instead they can create &quot;personal tokens&quot; just for testing purposes on their own accounts.</p>
<p>To use personal tokens, create a &quot;personal client&quot; once (you don't have to do this if you've already run <code>php artisan passport:install</code>):</p>
<pre><code class="language-bash">php artisan make passport:client --personal</code></pre>
<p>Now you, and any of your users, can go to the Personal Access Tokens component and hit &quot;Create New Token&quot;. At this point you're creating new tokens that have this single Personal Client listed as the client. You can delete these tokens just like you can revoke actual client tokens.</p>
<h2>Scope middleware</h2>
<p>If you're unfamiliar with the idea of scopes, they're things you can define so that a consumer can define which type of access they're requesting to your app. This allows things like &quot;user&quot; access vs &quot;full&quot; access, etc. Each scope has a name and a description, and then within the app you can define their impact.</p>
<p>We've already covered how to define a scope above. Now let's see the simplest way to define their impact: Scope middleware.</p>
<p>There are two middleware that you can add to your app. You can give them any shortcut you want, but for now we'll call them &quot;anyScope&quot; and &quot;allScopes&quot;.</p>
<p>Let's go to <code>app/Http/Kernel.php</code> and add them to the <code>$routeMiddleware</code> property:</p>
<pre><code class="language-php">// App\Http\Kernel
...
protected $routeMiddleware = [
    ...
    // you can name these whatever you want
    'anyScope' =&gt; \Laravel\Passport\Http\Middleware\CheckForAnyScope::class,
    'allScopes' =&gt; \Laravel\Passport\Http\Middleware\CheckScopes::class,
];</code></pre>
<p>Each of these middleware require you to pass one or more scope names to them. If you pass one or more scopes to &quot;anyScopes&quot;, the user will have access to that route <em>if they have granted access with any of the provided scopes</em>. If you pass one or more scopes to &quot;allScopes&quot;, the user will have access to that route <em>if they have granted access to all of the provided scopes</em>.</p>
<p>So, for example, if you want to limit users' access to routes based on whether they have the <code>conference</code> scope:</p>
<pre><code class="language-php">Route::get('/whatever', function () {
    // do stuff
})-&gt;middleware('anyScope:conference');

// Any of the given scopes
Route::get('/whatever', function () {
    // do stuff
})-&gt;middleware('anyScope:conference,otherScope');

// All of the given scopes
Route::get('/whatever', function () {
    // do stuff
})-&gt;middleware('allScopes:conference,otherScope');</code></pre>
<h2>Super-powered access to the API for frontend views</h2>
<p>If you have a frontend that's consuming this API, <em>in the same app</em>, you may not want to do the whole OAuth dance in that app. But you might still want the OAuth flow to still be available for external API consumers.</p>
<p>Passport offers a trick for <em>your</em> frontend&mdash;which has your user already authenticated via Laravel and sessions&mdash;to access your API and get around the OAuth flow.</p>
<p>Go to <code>app/Http/Kernel.php</code> and add this new middleware to <code>web</code>:</p>
<pre><code class="language-php">Laravel\Passport\Http\Middleware\CreateFreshApiToken::class,</code></pre>
<p>This adds a JWT token as a cookie to anyone who's logged in <em>using Laravel's traditional auth</em>. Using the <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#Synchronizer_.28CSRF.29_Tokens">Synchronizer token pattern</a>, Passport embeds a CSRF token into this cookie-held JWT token. Passport-auth'ed routes will first check for a traditional API token; if it doesn't exist, they'll secondarily check for one of these cookies. If this cookie exists, it will check for this embedded CSRF token to verify it.</p>
<p>So, in order to make all of your JavaScript requests authenticate to your Passport-powered API using this cookie, you'll need to add a request header to each AJAX request: set the header <code>X-CSRF-TOKEN</code> equal to the CSRF token for that page.</p>
<p>If you're using Laravel's scaffold, that'll be available as <code>Laravel.csrfToken</code>; if not, you can echo that value using the <code>csrf_token()</code> helper.</p>
<p>I know this seems a bit complex, but here's the basics: If you want your local app (maybe a Vue or React SPA) to access your API, but don't feel like programming a whole complex OAuth flow into it, <em>and</em> you want to have OAuth available to external users, Passport makes this <em>incredibly</em> simple. Powerfully simple. For more information and an example of how to set this up in Vue, check out <a href="https://laravel.com/docs/5.3/passport">the docs</a>.</p>
<h2>Conclusions</h2>
<p>I've programmed a lot of OAuth servers. It's a pain. I don't love it at all.</p>
<p>Passport is one of my favorite new features in Laravel in years. Not only does it simplify things I've always hated doing, it also adds a load of new features that I've never even thought to add to my apps. I love it, and I can't wait to use it.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-scout</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-laravel-scout"/>
        <title>Introducing Laravel Scout</title>
        <published>2016-07-29T00:00:00+00:00</published>
        <updated>2016-07-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Search tools ElasticSearch and Algolia have gained...</summary>
        <content type="html"><![CDATA[
        <p>Search tools ElasticSearch and Algolia have gained a lot of popularity in the Laravel community in the last few years as powerful tools for indexing and searching your data. Ben Corlett did a fantastic job <a href="https://www.youtube.com/watch?v=waTWeJeFp4A">introducing ElasticSearch at Laracon Eu 2014</a>, and I wrote a <a href="https://github.com/laravel/laravel.com/pull/18">pull request to Laravel.com introducing ElasticSearch-based indexing for the docs</a> in 2015. But before my PR was merged, the folks at Algolia took it and updated it to instead use Algolia (faster and with a better UI!), and that's what you'll see today if you search the Laravel docs.</p>
<p>If you take a look at my pull request or <a href="https://github.com/laravel/laravel.com/pull/37">theirs</a>, you'll see that it's not a small task to integrate fulltext search into your site. Algolia has since released a free product called Algolia DocSearch that makes it easy to <a href="https://blog.tighten.co/searchable-documentation-for-free-with-jigsaw-and-algolia-docsearch">add an Algolia search widget to documentation pages</a>. But for anything else, you're still stuck writing the integration yourself&mdash;that is, until now.</p>
<h2>Introducing Laravel Scout</h2>
<p>Scout is a driver-based fulltext search solution for Eloquent. Scout makes it easy to index and search the contents of your Eloquent models; currently it works with Algolia and ElasticSearch, but Taylor's asked for community contributions to other fulltext search services.</p>
<p>Scout is a separate Laravel package, like Cashier, that you'll need to pull in with Composer. We'll be adding traits to our models that indicate to Scout that it should listen to the events fired when instances of those models are modified and update the search index in response.</p>
<p>Take a look at this syntax for fulltext search, for finding any <code>Review</code> with the word <code>Llew</code> in it:</p>
<pre><code class="language-php">Review::search('Llew')-&gt;get();
Review::search('Llew')-&gt;paginate(20);
Review::search('Llew')-&gt;where('account_id', 2)-&gt;get();</code></pre>
<p>All that with very little configuration. That's a beautiful thing.</p>
<h2>Installing Scout</h2>
<p>First, pull in the package (once it's live, and on a Laravel 5.3 app):</p>
<pre><code class="language-bash">composer require laravel/scout</code></pre>
<p>Next, add the Scout service provider (<code>Laravel\Scout\ScoutServiceProvider::class</code>) to the <code>providers</code> section of <code>config/app.php</code>.</p>
<p>We'll want to set up our Scout configuration. Run <code>php artisan vendor:publish</code> and paste your Algolia credentials in <code>config/scout.php</code>.</p>
<p>Finally, assuming you're using Algolia, install the Algolia SDK:</p>
<pre><code class="language-bash">composer require algolia/algoliasearch-client-php</code></pre>
<h2>Marking your model for indexing</h2>
<p>Now, go to your model (we'll use <code>Review</code>, for a book review, for this example). Import the <code>Laravel\Scout\Searchable</code> trait. You can define which properties are searchable using the <code>toSearchableArray()</code> method (it defaults to mirroring <code>toArray()</code>), and define the name of the model's index using the <code>searchableAs()</code> method (it defaults to the table name).</p>
<p>Once we've done this, you can go check out your Algolia index page on their web site; when you add, update, or delete <code>Review</code> records, you'll see your Algolia index update. Just like that.</p>
<h2>Searching your index</h2>
<p>We took a look at this already, but here's a refresh of how to search:</p>
<pre><code class="language-php">// Get all records from the Review that match the term "Llew"
Review::search('Llew')-&gt;get();

// Get all records from the Review that match the term "Llew",
// limited to 20 per page and reading the ?page query parameter,
// just like Eloquent pagination
Review::search('Llew')-&gt;paginate(20);

// Get all records from the Review that match the term "Llew"
// and have an account_id field set to 2
Review::search('Llew')-&gt;where('account_id', 2)-&gt;get();</code></pre>
<p>What comes back from these searches? A Collection of Eloquent models, re-hydrated from your database. The IDs are stored in Algolia, which returns a list of matched IDs, and then Scout pulls the database records for those and returns them as Eloquent objects.</p>
<p>You don't have full access to the complexity of SQL <code>where</code> commands, but it handles a solid basic framework for comparison checks like you can see in the code samples above.</p>
<h2>Queues</h2>
<p>You can probably guess that we're now making HTTP requests to Algolia on every request that modifies any database records. That can make things slow down very quickly, so you may find yourself wanting to queue these operations&mdash;which, thankfully, is simple.</p>
<p>In <code>config/scout.php</code>, set <code>queue</code> to <code>true</code> so that these updates are set to be indexed asynchronously. We're now looking at &quot;eventual consistency&quot;; your database records will receive the updates immediately, and the updates to your search indexes will be queued and updated as fast as your queue worker allows.</p>
<h2>Special cases</h2>
<p>Let's cover some special cases.</p>
<h3>Perform operations without indexing</h3>
<p>What if you want to perform a set of operations and avoid triggering the indexing in response? Just wrap them in the <code>withoutSyncingToSearch()</code> method on your model:</p>
<pre><code class="language-php">Review::withoutSyncingToSearch(function () {
    // make a bunch of reviews, e.g.
    factory(Review::class, 10)-&gt;create();
});</code></pre>
<h3>Manually trigger indexing via code</h3>
<p>Let's say you're now ready to perform the indexes, now that some bulk operation has been successfully performed. How?</p>
<p>Just add <code>searchable()</code> to the end of any Eloquent query and it will index all of the records that were found in that query.</p>
<pre><code class="language-php">Review::all()-&gt;searchable();</code></pre>
<p>You can also choose to scope the query to only those you want to index, but it's worth noting that the indexing will insert new records and update old records, so it's not bad to let it run over some records that may be indexed already.</p>
<p>This will also work on a relationship:</p>
<pre><code class="language-php">$user-&gt;reviews()-&gt;searchable();</code></pre>
<p>You can also un-index any records with the same sort of query chaining, but just using <code>unsearchable()</code> instead:</p>
<pre><code class="language-php">Review::where('sucky', true)-&gt;unsearchable();</code></pre>
<h3>Manually trigger indexing via CLI</h3>
<p>There's an Artisan command for that.™</p>
<pre><code class="language-bash">php artisan scout:import App\\Review</code></pre>
<p>That'll chunk all of the <code>Review</code> models and index them all.</p>
<h2>Conclusion</h2>
<p>That's it! With almost no work, you now have complete full-text search running on your Eloquent models.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/5-3-feature-announcement-notes-from-laracon</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/5-3-feature-announcement-notes-from-laracon"/>
        <title>5.3 feature announcement notes from Laracon</title>
        <published>2016-07-27T00:00:00+00:00</published>
        <updated>2016-07-27T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">THIS POST IS STILL IN ACTIVE PROGRESS
            Once the vid...
        </summary>
        <content type="html"><![CDATA[
        <p><span style="font-size: 2em">THIS POST IS STILL IN ACTIVE PROGRESS</span></p>
<p>Once the videos are released I'll be able to update this post with more info, since I was on an audio-only stream for the majority of this.</p>
<hr />
<p>I'll be writing my usual longer, in-depth blog posts about each of the new 5.3 features that are releasing during Taylor's Laracon talk today, but I wanted to find a single place to write down my notes about the new features that Taylor is announcing for the first time today, so I figured, why not put it in a single blog post here?</p>
<p>This is just my notes from the live stream. I'll update this later with more info, and then will write full-length posts; this will just be casual notes.</p>
<hr />
<h2>Laravel Scout</h2>
<h3>Intro to Scout</h3>
<p>Search/ElasticSearch driver; packaged separately like Cashier. Works best with Algolia but would love community support for other drivers.</p>
<p>Model is going to have a Searchable trait.</p>
<h3>Indexing with Scout</h3>
<p>Indexes the <code>toArray()</code> function on the model and puts it up in the search index.</p>
<p>Add <code>ScoutServiceProvider</code> to <code>config/app</code> and <code>Searchable</code> trait to your model.</p>
<p>The trait hooks into Eloquent events. Listens to those events and updates your indexes in response.</p>
<h3>Special overrides/etc.</h3>
<p>Closure that allows you to override indexing:</p>
<pre><code class="language-php">Post::withoutSyncingToSearch(function () {
    // make a bunch of posts, e.g.
    factory(Post::class, 10)-&gt;create();
});</code></pre>
<p>... then later update all of those:</p>
<pre><code class="language-php">// Could just scope down the query to only those which you haven't indexed yet if you want...
Post::all()-&gt;searchable();</code></pre>
<p>Also could do: this on a relationship</p>
<pre><code class="language-php">$user-&gt;posts()-&gt;searchable();</code></pre>
<p>It's smart enough to be like &quot;upsert&quot;; it updates any that are already there, and inserts any new ones.</p>
<p>Can also remove from search:</p>
<pre><code class="language-php">// didn't catch the syntax for this one, sorry! probably something like Post::where('a', 'b')-&gt;unsearchable();</code></pre>
<h3>Queues/etc.</h3>
<p>These interactions feel slow&mdash;makes sense; these are HTTP requests going out!</p>
<p>So: in <code>config/scout.php</code> set <code>queue</code> to <code>true</code> so that these updates are set to be synced async.</p>
<pre><code class="language-bash">// not sure what this does or whether i wrote this syntax down right, feed was cutting out
php artisan scout:import App\Post</code></pre>
<h3>Searching with Scout</h3>
<p>You can seearch.. something like:</p>
<pre><code class="language-php">Post::search('Alice')-&gt;get();
Post::search('Alice')-&gt;paginate(20);
Post::search('Alice')-&gt;where('account_id', 2)-&gt;get();</code></pre>
<p>It can't do the full range of SQL where clauses, but it handles the basics.</p>
<h2>Mailables</h2>
<p>Want to simplify mail, so creating mail objects:</p>
<pre><code class="language-php">Mail::to($user)-&gt;send(new DeploymentCompleted($server));</code></pre>
<p><code>DeploymentCompleted</code> is a PHP class; it represents an email.</p>
<pre><code class="language-php">// mailable class
public function construct($server)
{
    $this-&gt;server = $server;
}

public function build()
{
    return $this-&gt;view('emails.whatever.viewname');

    // second parameter is an optional array of specific data that you want to be available to view:

    return $this-&gt;view('emails.whatever', ['explicit_data_passed' =&gt; 'abc']);
}</code></pre>
<p>Any public properties on the mailable object are accessible in the view, so you don't <em>have</em> to explicitly pass any data.</p>
<h3>Send to multiple</h3>
<pre><code class="language-php">Mail::to(User::find(1))
    -&gt;cc(User::find(2))
    -&gt;bcc(User::find(3))
    -&gt;send(new etc.);

Mail::to(Users::all())
    -&gt;send(new etc.);</code></pre>
<h3>Queueing mailables</h3>
<pre><code class="language-php">Mail::to($user)-&gt;queue(new etc.);</code></pre>
<h3>Attachments</h3>
<p>All the same methods you have within your mail closure like <code>attach</code>.</p>
<pre><code class="language-php">public function build()
{
    return this-&gt;view()-&gt;subject()-&gt;attach();
}</code></pre>
<h3>Misc</h3>
<p>Guesses subject from the class name if you don't set it explicitly. E.g. mailable class &quot;DeploymentCompleted&quot; gets auto subject &quot;Deployment Completed&quot;.</p>
<h2>Laravel's new Notification features</h2>
<h3>Intro to Notification</h3>
<p>Quick notifications. Password resets, quick links, etc.</p>
<p>Limited features. No file attachments, CCs, etc. This is <em>not</em> email.</p>
<p>Password reminder in 5.3 will use this out of the box.</p>
<pre><code class="language-php">$user-&gt;notify(new DeploymentCompleted($server));</code></pre>
<h3>Basic notification class</h3>
<pre><code class="language-php">class DeploymentCompleted
{
    public function construct($server)
    {
        $this-&gt;server = $server;
    }

    public frunction via($notifiable)
    {
        // $notifiable might be a user.. but who knows, you might want to notify a server or a slack channel or something
        // you could inspect user preferences here to decide which sort of notification they get
        // return a list of notification "drivers"
        return ['mail'];
    }

    public function message()
    {
        $this-&gt;line('You have a new deployment!')
            -&gt;action('View Deployment', 'http://laravel.com')
            -&gt;line('Check it out');
    }
}</code></pre>
<p>Notifiable trait.</p>
<p>Mail driver comes with a slick default template, responsive, etc. but you can also export/publish it into your app and customize it yourself.</p>
<p>Different states:</p>
<pre><code class="language-php">$this-&gt;line()-&gt;action()-&gt;line()-&gt;error();</code></pre>
<h3>Differentiating notification states</h3>
<p>Some drivers know how to differntiate states; some don't. For example, the <code>error</code> state in the mail driver will get a big red button instead of a big blue button. The <code>success()</code> state gets a green button.</p>
<p>New settings in <code>config/app.php</code>: <code>name</code> and <code>logo</code> for notifications.</p>
<h3>Email driver</h3>
<p>Covered above.</p>
<h3>Database driver</h3>
<p>Table that holds these notifications. Polymorphic; columns for notifiable type, id, level, intro, outro, action text, action url, has been read or not. Laravel doesn't know how to check whether it's read or not, you handle that.</p>
<p>Just add 'database' to the <code>via()</code> method and all of a sudden it's getting it; your calling code doesn't know or care which <code>via</code> driver it's gonna use.</p>
<h3>Slack driver</h3>
<p>Add <code>slack</code> to the <code>via()</code> method. Some drivers require more info. Context:</p>
<p><code>routeNotificationForSlack()</code> method on the User (or whatever else is notifiable).</p>
<p>Convention is <code>routeNotificationFor{drivernNameHere}</code>.</p>
<p>For Slack, that method should return Slack webhook URL: e.g. <code>return $this-&gt;slack_webhook_url</code>.</p>
<h3>SMS driver</h3>
<p>Add <code>nexmo</code> or <code>sms</code>, hard to tell from Taylor's audio. Add your Nexmo api keys</p>
<h3>Queueing notifications</h3>
<p>Go to the notification class and add the <code>ShouldQueue</code> trait. Now they're all queued. Boom goes the dynamite.</p>
<h2>Laravel Passport</h2>
<p>Full OAuth2 Server implementation in Laravel in like 5 minutes!!!!!!!!!</p>
<p>In Laravel 5.2, we got A) the idea of multiple auth drivers and B) the token-based authentication. Token-based auth works, it's fine, but it's more important as the ground layer for this.</p>
<h3>Basic installation of Passport</h3>
<p>Steps to use it:</p>
<ol>
<li>Install Passport via Composer.</li>
<li>Go to <code>config/app</code>, add <code>Laravel\Passport\PassportServiceProvider</code> to your providers list.</li>
<li>Run new migrations using 5.3's multiple migrations paths. Just run <code>php artisan migrate</code> and it'll include the Passport migrations too.</li>
<li>Go to your user and import trait <code>Laravel\Passport\HasApiTokens</code></li>
<li>Add routes: go to <code>AuthServiceProvider</code> and use <code>Laravel\Passport\Passport</code>, then in the <code>boot()</code> method run <code>Passport::routes()</code></li>
<li>(optionally) Add scopes in the <code>boot()</code> method of <code>AuthServiceProvider</code>, after <code>Passport::routes()</code>; e.g. <code>Passport::tokensCan(['conference' =&gt; 'Access your conference information'])</code></li>
<li><code>config/auth.php</code>, <code>guards.api.driver</code>; change the <code>api</code> guard to use <code>passport</code> driver instead of <code>token</code></li>
</ol>
<h3>Passport frontend</h3>
<p>Passport exposes a JSON API for your frontend to consume to let you manage it.</p>
<p>Comes with Vue components by default to make it easy for you to manage them, <em>if</em> you want to use them. It's just a reference but you could use if you want.</p>
<p>Three default Vue components out of the box:</p>
<pre><code class="language-html">&lt;!-- let people make clients --&gt;
&lt;passport-clients&gt;&lt;/passport-clients&gt;

&lt;!-- list of clients people have authorized to access our account --&gt;
&lt;passport-authorized-clients&gt;&lt;/passport-authorized-clients&gt;

&lt;!-- make it simple to generate a token right in the UI to play with --&gt;
&lt;passport-personal-access-tokens&gt;&lt;/passport-personal-access-tokens&gt;</code></pre>
<p>For these examples Taylor made an app at <code>http://passport.dev/</code> that has Passport installed. This app is providing the OAuth API. Then another at <code>http://example.dev/</code> that is a client, consuming it.</p>
<p>Look by default:</p>
<p><img src="/assets/images/content/laravel-passport-screenshot-components.png" alt="Screenshot of Laravel Passport default components view" /></p>
<p>Creating a client:</p>
<p><img src="/assets/images/content/laravel-passport-screenshot-create-client.png" alt="Screenshot of Laravel Passport create client view" /></p>
<p>Once you create a client, you get a secret and a client ID. Go to your consuming client (another site, etc.) and put that key and ID in there.</p>
<p>Showed a sample app that CONSUMES this API (not that provides it); lives at <code>http://consumer.dev/</code>:</p>
<pre><code class="language-php">// routes/web.php

use Illuminate\Http\Request;

Route::get('/', function () {
    $query = http_build_query([
        'client_id' =&gt; 1,
        'redirect_uri' =&gt; 'http://consumer.dev/callback',
        'response_type' =&gt; 'code',
        'scope' =&gt; 'conference'
    ]);

    return redirect('http://passport.dev/oauth/authorize?' . $query);
});

Route::get('callback', function (Request $request) {
    $http = new GuzzleHttp\Client;

    $response = $http-&gt;post('http://passport.dev/oauth/tken', [
        'form_params' =&gt; [
            'grant_type' =&gt; 'authorization-code',
            'client_id' =&gt; 1, // from admin panel above
            'client_secret' =&gt; 'abc', // from admin panel above
            'redirect_uri' =&gt; 'http://consumer.dev/callback`,
            'code' =&gt; $request-&gt;code
        ]
    ]);

    return json_decode((string) $response-&gt;getBody(), true)['access_token'];
});</code></pre>
<p>When you visit <code>http://consumer.dev/</code> it tries to authenticate, sending you over the Passport site; you get this screen:</p>
<p><img src="/assets/images/content/laravel-passport-screenshot-approval.png" alt="Screenshot of Laravel Passport auth approval view" /></p>
<p>When you authorize, takes you back to <code>http://consumer.dev/callback</code> and you have access to your token now.</p>
<p>To prove, Taylor makes a route in his passport app that just returns the authenticated user, puts it in the <code>routes/api.php</code> routes file. Calls it from Postman, pastes the JWT token from above into the <code>Authorization</code> header and calls the page, and it just works. (<code>Authorization: Bearer TOKENHERE</code>)</p>
<p>Easy to revoke applications in the UI:</p>
<p><img src="/assets/images/content/laravel-passport-screenshot-revoke-client.png" alt="Screenshot of Laravel Passport revoke token view" /></p>
<p>Keeps saying: &quot;This is not what your UI needs to look like; it's just a free reference application.&quot;</p>
<p>New in Passport that League package doesn't have: Want it to be easy to create a token in the UI to just play around with the API. Since every token is associated with a client (last one we made was associated with <code>http://consumer.dev</code>), make a personal client: <code>php artisan make passport:client --personal</code>. Then you can go to the Personal Access Tokens component and hit &quot;Create New Token&quot;. Creates them with your app (<code>passport.dev</code>) as the listed client.</p>
<h3>Scope middleware</h3>
<p>Middlewares to limit users' route access based on your scopes. Add them (whatever they are) in the HTTP kernel. scope and scopes.</p>
<p>The <code>scope</code> middleware authenticates you for a single scope; <code>scopes</code> requires all defined scopes.</p>
<pre><code class="language-php">// add to Http\Kernel $route&lt;iddleware property
// you can name it whatever you want
'scope' =&gt; \Laravel\Passport\Http\Middleware\CheckForAnyScope::class,
'scopes' =&gt; \Laravel\Passport\Http\Middleware\CheckScopes::class,</code></pre>
<p>If you want to limit the user to only access a route if they have the <code>conference</code> scope:</p>
<pre><code class="language-php">Route::get('/whatever', function () {
    // do stuff
})-&gt;middleware('scope:conference');</code></pre>
<p>Multiples can be comma separated; allows user through if they have <em>any</em> of the provided scopes: <code>-&gt;middleware('scope:conference,otherScope')</code>. If you want it to only let them through if they have <em>all</em> passed scopes, use <code>scopes:</code>-&gt;middleware('scopes:conference,otherScope')`.</p>
<h3>Super-powered access to the API for frontend views</h3>
<p>If you have a frontend that's consuming the API, you may not want to do the whole OAuth dance. But you might want the OAuth flow to still be available for external API users.</p>
<p>Trick for <em>your</em> frontend--which has your user already authenticated via Laravel and sessions--to access your API and get around the OAuth flow.</p>
<p>Go to <code>HTTP\Kernel</code> and add new middleware to <code>web</code>: </p>
<pre><code class="language-php">`Laravel\Passport\Http\Middleware\CreateFreshApiToken::class`,</code></pre>
<p>This adds a JWT token as a cookie to anyone who's logged in. Uses &quot;Synchronized token pattern&quot; to embed the CSRF token into the JWT, and require a CSRF header if you sent that cookie, and they have to match. Some kinda magic. </p>
<p>Safe because other apps can't read your cookies so they can't get your CSRF token out of the JWT token. Boom. Can make API requests if logged in without worrying about OAuth tokens.</p>
<h3>Miscellaneous</h3>
<p>&quot;My API doesn't have to be an after thought.&quot; Set the whole thing up in 15 minutes with demos.</p>
<p>Latest League package so they're JWT tokens.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/routing-changes-in-laravel-5-3</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/routing-changes-in-laravel-5-3"/>
        <title>Routing changes in Laravel 5.3</title>
        <published>2016-07-27T00:00:00+00:00</published>
        <updated>2016-07-27T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">The last few versions of Laravel have showed the w...</summary>
        <content type="html"><![CDATA[
        <p>The last few versions of Laravel have showed the way routing works shifting around a bit. This is usually a sign that we're feeling some sort of pain&mdash;something feels <em>off</em>&mdash;but haven't found the perfect solution yet. In 5.3, we may have found it.</p>
<h2>Looking back: Routing changes in 5.2</h2>
<p>In Laravel 5.2 we temporarily saw two separate route groups in <code>routes.php</code>, one for &quot;web&quot; and one for &quot;API&quot;, but that went away mid-5.2.</p>
<p>What stuck around, though, was the idea of <a href="https://mattstauffer.co/blog/middleware-groups-in-laravel-5-2">multiple middleware groups</a>, and out of the box there's one for &quot;web&quot; routes and one for &quot;API&quot; routes.</p>
<p>The &quot;web&quot; group gets everything you'd expect your normal web users to need: sessions, cookies, CSRF protection, etc. The &quot;API&quot; group is lighter, and came by default with the &quot;throttle&quot; middleware, making the case for a stateless REST API.</p>
<h2>Routing changes in 5.3</h2>
<p>In 5.3, the <code>app/Http/routes.php</code> file has now moved to the root <code>routes/</code> directory, and it's now split into two files: <code>web.php</code> and <code>api.php</code>. As you can probably guess, the routes in <code>routes/web.php</code> are wrapped with the <code>web</code> middleware group and the routes in <code>routes/api.php</code> are wrapped with the <code>api</code> middleware group.</p>
<p>There are a few benefits of this. First, we get the suggestion and easy implementation of the distinction between our web routes and our API routes. Second, it's now an application-level convention to have multiple routes files, which will likely free more developers up to feel comfortable organizing their routes file this way. And third, this moves the <code>routes</code> directory out of <code>app/</code>, which both makes the <code>routes</code> directory more accessible to new users <em>and</em> makes <code>app/</code> a fully PSR-4-autoloaded directory, which feels just a bit pure-r.</p>
<p>If you want to customize this or add your own separate routes files, check out <code>App\Providers\RouteServiceProvider</code> for inspiration:</p>
<pre><code class="language-php">...
    public function map()
    {
        $this-&gt;mapApiRoutes();

        $this-&gt;mapWebRoutes();

        //
    }

    protected function mapApiRoutes()
    {
        Route::group([
            'middleware' =&gt; ['api', 'auth:api'],
            'namespace' =&gt; $this-&gt;namespace,
            'prefix' =&gt; 'api',
        ], function ($router) {
            require base_path('routes/api.php');
        });
    }

    protected function mapWebRoutes()
    {
        Route::group([
            'namespace' =&gt; $this-&gt;namespace, 'middleware' =&gt; 'web',
        ], function ($router) {
            require base_path('routes/web.php');
        });
    }</code></pre>
<p>As you can see, there's an easy syntax for wrapping the results of any given routes file with a route group and then applying whatever prefixes or middleware or whatever else that you'd like.</p>
<p>That's it! Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/customizing-pagination-templates-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/customizing-pagination-templates-in-laravel-5-3"/>
        <title>Customizing pagination templates in Laravel 5.3</title>
        <published>2016-07-26T00:00:00+00:00</published>
        <updated>2016-07-26T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel&#039;s pagination library is brilliant, because...</summary>
        <content type="html"><![CDATA[
        <p>Laravel's pagination library is brilliant, because pagination is a common task that is a surprising amount of work to implement. In the past, if you wanted to customize your pagination templates, it was just as simple to customize your pagination template as it was to work with the rest of the pagination library.</p>
<p>However, for the sake of making the pagination library easier to extract for non-Laravel projects, Laravel 5.0 (or maybe even earlier?) introduced a much more complex&mdash;but more portable&mdash;system for pagination templates.</p>
<p>Thankfully, in Laravel 5.3, we're going to go back to how it always was: simple and easy.</p>
<h2>How pagination works in Laravel</h2>
<p>If you're not familiar, here's a quick rundown of how it works to use pagination in Laravel.</p>
<pre><code class="language-php">// routes file
Route::get('tasks', function () {
    return view('tasks.index')
        -&gt;with('tasks', Task::paginate(10));
});</code></pre>
<pre><code class="language-php">// resource/views/tasks/index.blade.php
@foreach ($tasks as $task)
    &lt;!-- echo the task or whatever --&gt;
@endforeach

{{ $tasks-&gt;links() }}</code></pre>
<p>By default, the <code>paginate()</code> method on your Eloquent objects reads the query parameters of your request and detects which page you're on. So in this example, it'll read the <code>?page</code> query parameter and grab 10 records for that page. It'll pass those 10 in, and when we <code>foreach</code> on the <code>$tasks</code> variable, we'll just be looping over those 10.</p>
<p>But if you retrieve those 10 records using <code>paginate()</code> instead of something like <code>all()</code>, you get a new method available on your <code>$tasks</code> object (or other Eloquent result) named <code>links()</code>, and this method returns the view string appropriate for showing a list of pagination buttons:</p>
<pre><code>&lt;ul class="pagination"&gt;
    &lt;li class="disabled"&gt;&lt;span&gt;&amp;laquo;&lt;/span&gt;&lt;/li&gt;

    &lt;li class="active"&gt;&lt;span&gt;1&lt;/span&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="http://53pagination.dev?page=2"&gt;2&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="http://53pagination.dev?page=3"&gt;3&lt;/a&gt;&lt;/li&gt;

    &lt;li&gt;&lt;a href="http://53pagination.dev?page=2" rel="next"&gt;&amp;raquo;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</code></pre>
<h2>Customizing the pagination template in Laravel 5.3</h2>
<p>OK, so let's finally get to the dirt. How do you customize this template in 5.3?</p>
<p>By default, the template that is rendering this can be found in the <code>Illuminate\Pagination</code> component: <code>resources/views/bootstrap-3.blade.php</code>. This is what it looks like right now:</p>
<pre><code class="language-php">&lt;ul class="pagination"&gt;
    &lt;!-- Previous Page Link --&gt;
    @if ($paginator-&gt;onFirstPage())
        &lt;li class="disabled"&gt;&lt;span&gt;&amp;laquo;&lt;/span&gt;&lt;/li&gt;
    @else
        &lt;li&gt;&lt;a href="{{ $paginator-&gt;previousPageUrl() }}" rel="prev"&gt;&amp;laquo;&lt;/a&gt;&lt;/li&gt;
    @endif

    &lt;!-- Pagination Elements --&gt;
    @foreach ($elements as $element)
        &lt;!-- "Three Dots" Separator --&gt;
        @if (is_string($element))
            &lt;li class="disabled"&gt;&lt;span&gt;{{ $element }}&lt;/span&gt;&lt;/li&gt;
        @endif

        &lt;!-- Array Of Links --&gt;
        @if (is_array($element))
            @foreach ($element as $page =&gt; $url)
                @if ($page == $paginator-&gt;currentPage())
                    &lt;li class="active"&gt;&lt;span&gt;{{ $page }}&lt;/span&gt;&lt;/li&gt;
                @else
                    &lt;li&gt;&lt;a href="{{ $url }}"&gt;{{ $page }}&lt;/a&gt;&lt;/li&gt;
                @endif
            @endforeach
        @endif
    @endforeach

    &lt;!-- Next Page Link --&gt;
    @if ($paginator-&gt;hasMorePages())
        &lt;li&gt;&lt;a href="{{ $paginator-&gt;nextPageUrl() }}" rel="next"&gt;&amp;raquo;&lt;/a&gt;&lt;/li&gt;
    @else
        &lt;li class="disabled"&gt;&lt;span&gt;&amp;raquo;&lt;/span&gt;&lt;/li&gt;
    @endif
&lt;/ul&gt;</code></pre>
<p>If you want to customize the pagination, you have two options: you can either publish the built-in view and edit it, or you can create a new file and manually link the Paginator to it.</p>
<h3>Publishing the files</h3>
<p>Probably the easiest option is to run <code>php artisan vendor:publish</code>. It'll publish the template to <code>vendor/pagination</code> and you can just edit it there. This is the preferred option unless you have some specific customization needs.</p>
<h3>Manually linking the files</h3>
<p>If you'd like to instead create your own pagination file and manually link to it, you can do that too. Create a new file that's a duplicate of that file, and modify it for your needs. Save it somewhere in <code>resources/views</code>; for now let's keep it simple and use <code>resources/views/partials/pagination.blade.php</code>.</p>
<p>Now, let's register it. Run <code>\Illuminate\Pagination\LengthAwarePaginator::defaultView('partials.paginator')</code> in the <code>boot()</code> method of a service provider.</p>
<blockquote>
<p>Note: If you'd like to customize which template is used just by a single paginator, you can pass the view name to the <code>links()</code> method: <code>{{ $users-&gt;links('partials.paginator') }}</code>.</p>
</blockquote>
<h2>Overview</h2>
<p>So, to get this entire thing to work, I took these steps:</p>
<ol>
<li>Clone the latest version of Laravel 5.3</li>
<li>Composer install</li>
<li><code>php artisan vendor:publish</code></li>
<li>Edit <code>resources/views/vendor/pagination/default.blade.php</code> and customize it to my heart's desire</li>
</ol>
<p>That's it!</p>
<blockquote>
<p>Note: These instructions show you how to customize the length-aware paginator, which is the most common. But if you're working with the simple paginator, you can customize that too. Just use the file named <code>simple-default</code> as your base instead of <code>default</code>.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/image-dimension-validation-rules-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/image-dimension-validation-rules-in-laravel-5-3"/>
        <title>Image dimension validation rules in Laravel 5.3</title>
        <published>2016-07-25T00:00:00+00:00</published>
        <updated>2016-07-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In Laravel 5.3, we have a new validation option: i...</summary>
        <content type="html"><![CDATA[
        <p>In Laravel 5.3, we have a new validation option: image dimensions for image uploads. The validation rule is called <code>dimensions</code>, and you can pass the following parameters to it:</p>
<ul>
<li><code>min_width</code>: Images narrower than this pixel width will be rejected</li>
<li><code>max_width</code>: Images wider than this pixel width will be rejected</li>
<li><code>min_height</code>: Images shorter than this pixel height will be rejected</li>
<li><code>max_height</code>: Images taller than this pixel height will be rejected</li>
<li><code>width</code>: Images not exactly this pixel width will be rejected</li>
<li><code>height</code>: Images not exactly this pixel height will be rejected</li>
<li><code>ratio</code>: Images not exactly this ratio (width/height, expressed as &quot;width/height&quot;) will be rejected</li>
</ul>
<p>You can combine any rules that make sense together. Let's take a look at a few examples. First, let's set up our base install.</p>
<pre><code class="language-php">// routes file
Route::get('/', function () {
    return view('form');
});

Route::post('/', 'ImageController@postImage');</code></pre>
<pre><code class="language-html">&lt;!--form.blade.php--&gt;
&lt;form method="POST" enctype="multipart/form-data"&gt;
    &lt;input type="file" name="avatar"&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;</code></pre>
<p>Now, let's make our <code>ImageController</code> and take a look at a few sample validations.</p>
<pre><code class="language-php">// ImageController
    public function postImage(Request $request)
    {
        $this-&gt;validate($request, [
             'avatar' =&gt; 'dimensions:min_width=250,min_height=500'
        ]);

        // or... 

        $this-&gt;validate($request, [
             'avatar' =&gt; 'dimensions:min_width=500,max_width=1500'
        ]);

        // or...

        $this-&gt;validate($request, [
             'avatar' =&gt; 'dimensions:width=100,height=100'
        ]);

        // or...

        // Ensures that the width of the image is 1.5x the height
        $this-&gt;validate($request, [
             'avatar' =&gt; 'dimensions:ratio=3/2'
        ]);
    }</code></pre>
<p>That's it! One less thing you have to manage yourself in your own code.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/new-json-column-where-and-update-syntax-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/new-json-column-where-and-update-syntax-in-laravel-5-3"/>
        <title>New JSON-column where() and update() syntax in Laravel 5.3</title>
        <published>2016-07-08T00:00:00+00:00</published>
        <updated>2016-07-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">While Laravel has had the ability to cast your dat...</summary>
        <content type="html"><![CDATA[
        <p>While Laravel has had the ability to cast your data to and from JSON since version 5.0, it was previously just a convenience&mdash;your data was still just stored in a TEXT field. But MySQL 5.7 introduced an actual JSON column type.</p>
<p>Laravel 5.3 introduces a simple syntax for lookups and updates based on the value of specific keys in your JSON columns.</p>
<p>Let's assume we have a table with a JSON column:</p>
<pre><code class="language-php">...
class CreateContactsTable extends Migration
{
    public function up()
    {
        Schema::create('contacts', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;string('name');
            $table-&gt;json('meta');
            $table-&gt;timestamps();
        });
    }</code></pre>
<p>We'll imagine that each contact has some foundational information like their name, but some other properties are flexible. The best way to store them might be a JSON column&mdash;like our <code>meta</code> column above.</p>
<p>We could imagine one contact (output to JSON for blog-post-readability) might look like this:</p>
<pre><code class="language-javascript">{
    "id": 1,
    "name": "Alphonse",
    "meta": {
        "wants_newsletter": true,
        "favorite_color": "red"
    }
}</code></pre>
<p>So, let's get all of our users whose favorite color is red. As you can see below, we start with the column (<code>meta</code>), followed by an arrow (<code>-&gt;</code>), followed by the key name of the JSON property (<code>favorite_color</code>).</p>
<pre><code class="language-php">$redLovers = DB::table('users')
    -&gt;where('meta-&gt;favorite_color', 'red')
    -&gt;get();</code></pre>
<p>This means &quot;look for every entry in the <code>users</code> table which has a JSON object stored in <code>meta</code> that has a key of <code>favorite_color</code> that's set to <code>red</code>.&quot;</p>
<p>What if we want to update Alphonse to no longer want the newsletter?</p>
<pre><code class="language-php">DB::table('users')
    -&gt;where('id', 1)
    -&gt;update(['meta-&gt;wants_newsletter' =&gt; false]);</code></pre>
<p>What's great here is, even if the <code>wants_newsletter</code> key wasn't previously set on this record, it will be now, and it'll be correctly set to <code>false</code>.</p>
<p>See the power? We can query based on properties in the JSON column <em>and</em> we can update individual pieces of the JSON column without having to know, or care about, the others. Brilliant.</p>
<blockquote>
<p>Note: MariaDB does not have JSON columns, and PostgreSQL has JSON columns but this feature appears to not currently work on them. So consider this a MySQL 5.7+ feature for now.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/advanced-operations-with-collectionwhere-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/advanced-operations-with-collectionwhere-in-laravel-5-3"/>
        <title>Advanced operations with Collection::where in Laravel 5.3</title>
        <published>2016-07-08T00:00:00+00:00</published>
        <updated>2016-07-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you want to filter a Laravel collection to only...</summary>
        <content type="html"><![CDATA[
        <p>If you want to filter a Laravel collection to only those records which meet particular criteria, you're most likely going to reach for <code>filter()</code> or <code>reject()</code>. For a quick refresh, this is how you might use both:</p>
<pre><code class="language-php">$vips = $people-&gt;filter(function ($person) {
    return $person-&gt;status === 'vip';
});

$nonVips = $people-&gt;reject(function ($person) {
    return $person-&gt;status === 'vip';
});</code></pre>
<p>You might not know it, but there's also a <code>where()</code> method that's pretty simple that gives you the same functionality:</p>
<pre><code class="language-php">$vips = $people-&gt;where('status', 'vip');</code></pre>
<p>Prior to 5.3, this would check strictly (<code>===</code>), just like in our examples above.</p>
<p>In 5.3, that same line is now a <em>loose</em> check (<code>==</code>), <em>but</em> you can also customize the comparison operator. That makes all of this possible:</p>
<pre><code class="language-php">$nonVips = $people-&gt;where('status', '!==', 'vip');
$popularPosts = $posts-&gt;where('views', '&gt;', 500);
$firstTimeUsers = $people-&gt;where('logins', '===', 1);</code></pre>
<p>You can see the all of the possible operators at the time of writing this post here: <a href="https://github.com/laravel/framework/blob/ebf6cf77d85b7b9e97c504e1aafe93a17f1a1e9c/src/Illuminate/Support/Collection.php#L214-L260">Collection#l214-260</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/the-new-cache-global-helper-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/the-new-cache-global-helper-in-laravel-5-3"/>
        <title>The new cache() global helper in Laravel 5.3</title>
        <published>2016-07-06T00:00:00+00:00</published>
        <updated>2016-07-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Time for another new feature in Laravel 5.3!
            Short...
        </summary>
        <content type="html"><![CDATA[
        <p>Time for another new feature in Laravel 5.3!</p>
<h2>Shortcut global helpers in Laravel</h2>
<p>As I was writing <a href="https://laravelupandrunning.com/">my book</a> I noticed a pattern in the global helper functions like <code>session()</code> and, in some ways, <code>cookie()</code>. There are three primary functions that they can perform: <code>get</code> a value, <code>put</code> a value, or return an instance of their backing service.</p>
<p>For example:</p>
<ul>
<li><code>session('abc', null)</code> gets the value of <code>abc</code>, or an optional fallback of <code>null</code>.</li>
<li><code>session(['abc' =&gt; 'def'])</code> sets the value of <code>abc</code> to <code>def</code>.</li>
<li><code>session()</code> returns an instance of the <code>SessionManager</code>.</li>
</ul>
<p>The third option means you can use <code>session()-&gt;all()</code> (or any other methods) just like you would <code>Session::all()</code>.</p>
<p>I mentioned that it seems like there should be a <code>cache()</code> helper, and before I could even think much more about it, Jeffrey (Way) had already written one up. So! Behold! The global <code>cache()</code> helper, new in Laravel 5.3.</p>
<h2>The <code>cache()</code> global helper</h2>
<p>Like <code>session()</code>, the <code>cache()</code> global helper can perform three primary functions: <code>get</code>, <code>put</code>, or return an instance of the backing service.</p>
<p>For example:</p>
<ul>
<li><code>cache('abc', null)</code> gets the cached value of <code>abc</code>, or an optional fallback of <code>null</code>.</li>
<li><code>cache(['abc' =&gt; 'def'], 5)</code> sets the value of <code>abc</code> to <code>def</code>, for the duration of <code>5</code> minutes.</li>
<li><code>cache()</code> returns an instance of the <code>CacheManager</code>.</li>
</ul>
<p>The third option means you can use <code>cache()-&gt;forever()</code> (or any other methods) just like you would <code>Cache::forever()</code>.</p>
<p>That's it! Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/customizing-additional-parameters-in-first-or-create-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/customizing-additional-parameters-in-first-or-create-in-laravel-5-3"/>
        <title>Customizing additional parameters in FirstOrCreate in Laravel 5.3</title>
        <published>2016-06-29T00:00:00+00:00</published>
        <updated>2016-06-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">More Laravel 5.3 goodies! This time, it&#039;s an updat...</summary>
        <content type="html"><![CDATA[
        <p>More Laravel 5.3 goodies! This time, it's an update to the Eloquent <code>firstOrCreate</code> method.</p>
<p>If you've never used it before, you can pass an array of values to <code>firstOrCreate</code> and it will look up whether a record exists with those properties. If so, it'll return that instance; if not, it'll create it and then return the created instance.</p>
<p>Here's an example:</p>
<pre><code class="language-php">$tag = Tag::firstOrCreate(['slug' =&gt; 'matts-favorites']);</code></pre>
<p>This is good. It's very useful. <em>But</em>.</p>
<p>What if the tag with the slug <code>matts-favorites</code> represents a tag with the label <code>Matts favorites</code>?</p>
<pre><code class="language-php">$tag = Tag::firstOrCreate(['slug' =&gt; 'matts-favorites', 'label' =&gt; 'Matts Favorites']);</code></pre>
<p>OK, that worked well. But now, imagine this scenario: you want to create a tag with slug of <code>matts-favorites</code> and label of <code>Matt's favorites</code> <em>unless</em> there's already a tag with slug <code>matts-favorites</code>, in which case you just want that tag&mdash;even if it doesn't give you the label you want? Check it:</p>
<pre><code class="language-php">$tag = Tag::firstOrCreate(
    ['slug' =&gt; 'matts-favorites'],
    ['label' =&gt; "Matt's Favorites"]
);</code></pre>
<p>We've specified that the <code>Tag</code> model should look up a tag where <code>slug</code> is <code>matts-favorites</code> and return it if so. And if not, create a new tag with slug <code>matts-favorites</code> and label <code>Matt's Favorites</code>, and return that. Bam. Beautiful.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/the-new-loop-variable-in-laravel-5-3</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/the-new-loop-variable-in-laravel-5-3"/>
        <title>The new $loop variable in Laravel 5.3</title>
        <published>2016-06-27T00:00:00+00:00</published>
        <updated>2016-06-27T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Let&#039;s take a look at another new feature that&#039;s co...</summary>
        <content type="html"><![CDATA[
        <p>Let's take a look at another new feature that's coming in Laravel 5.3.</p>
<h2>What are Blade directives?</h2>
<p>Laravel's Blade templating language provides something called &quot;directives&quot;, which are custom tags&mdash;often control structures&mdash;that are prefaced with <code>@</code>. If you've ever written templates with Blade, you're likely familiar with <code>@if</code>, <code>@foreach</code>, and so on.</p>
<p>In general, these control structure directive simply emulate their PHP analogs; for example, <code>@if(condition)</code> is exactly the same as <code>&lt;?php if (condition):</code>.</p>
<h2>Introducing the <code>$loop</code> variable</h2>
<p>In 5.3, the <code>@foreach</code> directive is getting a bit of a superpower, in the form of a new <code>$loop</code> variable that will be available inside every <code>@foreach</code> loop.</p>
<p>The <code>$loop</code> variable is a <code>stdClass</code> object that provides meta information about the loop you're currently inside. Take a look at the properties it exposes:</p>
<ul>
<li><code>index</code>: the 0-based index of the current item in the loop; <code>0</code> would mean &quot;first item&quot;</li>
<li><code>iteration</code>: the 1-based index of the current item in the loop; <code>1</code> would mean &quot;first item&quot;</li>
<li><code>remaining</code>: how many items remain in the loop; if current item is first of three, would return <code>2</code></li>
<li><code>count</code>: the count of items in the loop</li>
<li><code>first</code>: boolean; whether this is the first item in the loop</li>
<li><code>last</code>: boolean; whether this is the last item in the loop</li>
<li><code>depth</code>: integer; how many &quot;levels&quot; deep this loop is; returns <code>1</code> for a loop, <code>2</code> for a loop within a loop, etc.</li>
<li><code>parent</code>: if this loop is within another <code>@foreach</code> loop, returns a reference to the <code>$loop</code> variable for the parent loop item; otherwise returns <code>null</code></li>
</ul>
<p>Most of this is pretty self-explanatory; it means you can do something like this:</p>
<pre><code class="language-php">&lt;ul&gt;
@foreach ($pages as $page)
   &lt;li&gt;{{ $page-&gt;title }} ({{ $loop-&gt;iteration }} / {{ $loop-&gt;count }})&lt;/li&gt;
@endforeach
&lt;/ul&gt;</code></pre>
<p>But you also get a reference to parent <code>$loop</code> variables when you have a loop-within-a-loop. You can use <code>depth</code> to determine whether this is a loop-within-a-loop, and <code>parent</code> to grab the <code>$loop</code> variable of its parent. That opens up templating options like this:</p>
<pre><code class="language-php">&lt;ul&gt;
@foreach ($pages as $page)
    &lt;li&gt;{{ $loop-&gt;iteration }}: {{ $page-&gt;title }}
        @if ($page-&gt;hasChildren())
        &lt;ul&gt;
        @foreach ($page-&gt;children() as $child)
            &lt;li&gt;{{ $loop-&gt;parent-&gt;iteration }}.{{ $loop-&gt;iteration }}:
                {{ $child-&gt;title }}&lt;/li&gt;
        @endforeach
        &lt;/ul&gt;
        @endif
    &lt;/li&gt;
@endforeach
&lt;/ul&gt;</code></pre>
<p>That's it!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-echo</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-laravel-echo"/>
        <title>Introducing Laravel Echo: An In-Depth Walk-Through</title>
        <published>2016-06-16T00:00:00+00:00</published>
        <updated>2016-06-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel Echo is a tool that makes it easy for you ...</summary>
        <content type="html"><![CDATA[
        <p>Laravel Echo is a tool that makes it easy for you to bring the power of WebSockets to your Laravel applications. It simplifies some of the more common&mdash;and more complex&mdash;aspects of building complex WebSockets interactions.</p>
<p>Echo comes in two parts: a series of improvements to Laravel's Event broadcasting system, and a new JavaScript package.</p>
<p>The backend components of Echo are baked into the Laravel core by default as of 5.3, and don't need to be imported (so it's different from something like <a href="https://laravel.com/docs/billing">Cashier</a>). You could use these backend improvements with any JavaScript frontend, not just those using the Echo JavaScript library, and still see some significant improvements in ease-of-use for working with WebSockets. But they work even better when you use the Echo JavaScript library.</p>
<p>The <a href="https://www.npmjs.com/package/laravel-echo">Echo JavaScript library</a> can be imported via NPM and then imported into your app's JavaScript. It's a layer of sugar on top of either <a href="https://github.com/pusher/pusher-js">Pusher JS</a> (the JavaScript SDK for <a href="https://pusher.com/">Pusher</a>) or <a href="http://socket.io/">Socket.io</a> (the JavaScript SDK many folks use on top of Redis WebSockets architectures).</p>
<h2>When would I use Echo?</h2>
<p>Before we go any further, let's take a look at how you might use Echo, to see if it's even something you might be interested in.</p>
<p>WebSockets will be useful to you if you want to send messages to your users&mdash;whether those messages are notifications or even updates to the structure of a page's data&mdash;while the users stay on the same page. True, you could accomplish this with long-polling, or some sort of regularly scheduled JavaScript ping, but this has the potential to overwhelm your server pretty quickly. WebSockets are powerful, don't overload your servers, can scale as much as you'd like, and they're nearly instantaneous.</p>
<p>If you want to use WebSockets within a Laravel app, Echo provides a nice, clean syntax for simple features like public channels and complex features like authentication, authorization, and private and presence channels.</p>
<blockquote>
<p>Important detail to know before hand: WebSockets implementations provide three types of channels: <em>public</em>, meaning anyone can subscribe; <em>private</em>, meaning the frontend has to authenticate the user against a backend and then assure that the user has permissions to subscribe to the given channel; and <em>presence</em>, which doesn't allow for sending messages and instead just notifies that a user is &quot;present&quot; in the channel or not.</p>
</blockquote>
<h2>Before we get to Echo: setting up a sample broadcast Event in Laravel</h2>
<p>Let's say you want to create a chat system, with multiple rooms. Ambitious, right? Well, we'll probably want to fire an Event every time a new chat message is received.</p>
<blockquote>
<p>Note: You'll need to be familiar with Laravel's Event Broadcasting in order to get the most out of this article. I wrote a brief <a href="https://mattstauffer.co/blog/broadcasting-events-with-pusher-socket-in-laravel-5.1">intro to Event broadcasting</a> a while back that would be worth reading over first.</p>
</blockquote>
<p>So, first, let's create the event:</p>
<pre><code class="language-bash">php artisan make:event ChatMessageWasReceived</code></pre>
<p>Open that class (<code>app/Events/ChatMessageWasReceived.php</code>) and mark it as implementing the <code>ShouldBroadcast</code> interface. For now, let's just have it broadcast to a public channel named <code>"chat-room.1"</code>.</p>
<blockquote>
<p>In 5.3, there's a new structure in the <code>broadcastOn()</code> method that frees you up from having to define private and presence channels by prefacing them with &quot;private-&quot; and &quot;presence-&quot;. Now, you can just wrap the channel name in a simple <code>PrivateChannel</code> or <code>PresenceChannel</code> object. So, to broadcast to a public channel, <code>return "chat-room.1";</code>. To broadcast to a private channel, <code>return new PrivateChannel("chat-room.1");</code>. And to broadcast to a presence channel, <code>return new PresenceChannel("chat-room.1");</code>.</p>
</blockquote>
<p>You'll want to probably create a model and a migration for <code>ChatMessage</code>, and give it a <code>user_id</code> and a <code>message</code> field. </p>
<pre><code class="language-bash">php artisan make:model ChatMessage --migration</code></pre>
<p>Here's a sample migration:</p>
<pre><code class="language-php">...
class CreateChatMessagesTable extends Migration
{
    public function up()
    {
        Schema::create('chat_messages', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;string('message');
            $table-&gt;integer('user_id')-&gt;unsigned();
            $table-&gt;timestamps();
        });
    }

    public function down()
    {
        Schema::drop('chat_messages');
    }
}</code></pre>
<p>And now let's update our event to inject a user and a chat message:</p>
<pre><code class="language-php">...
class ChatMessageWasReceived extends Event implements ShouldBroadcast
{
    use InteractsWithSockets, SerializesModels;

    public $chatMessage;
    public $user;

    public function __construct($chatMessage, $user)
    {
        $this-&gt;chatMessage = $chatMessage;
        $this-&gt;user = $user;
    }

    public function broadcastOn()
    {
        return [
            "chat-room.1"
        ];
    }
}</code></pre>
<p>And make our fields fillable in the model:</p>
<pre><code class="language-php">...
class ChatMessage extends Model
{
    public $fillable = ['user_id', 'message'];
}</code></pre>
<p>Now, create a way to trigger that event. For testing purposes, I often create an Artisan command to trigger my events. Let's try that.</p>
<pre><code class="language-bash">php artisan make:command SendChatMessage</code></pre>
<p>Open that file at <code>app/Console/Commands/SendChatMessage.php</code>. Give it a signature that allows you to pass it a message, and then set its <code>handle()</code> method to trigger our <code>ChatMessageWasReceived</code> event with that message:</p>
<pre><code class="language-php">...
class SendChatMessage extends Command
{
    protected $signature = 'chat:message {message}';

    protected $description = 'Send chat message.';

    public function handle()
    {
        // Fire off an event, just randomly grabbing the first user for now
        $user = \App\User::first();
        $message = \App\ChatMessage::create([
            'user_id' =&gt; $user-&gt;id,
            'message' =&gt; $this-&gt;argument('message')
        ]);

        event(new \App\Events\ChatMessageWasReceived($message, $user));
    }
}</code></pre>
<p>Now open <code>app/Console/Kernel.php</code> and add that command's class name to the <code>$commands</code> property so it's registered as a viable Artisan command.</p>
<pre><code class="language-php">...
class Kernel extends ConsoleKernel
{
    protected $commands = [
        Commands\SendChatMessage::class,
    ];
...</code></pre>
<p>Almost done! Finally, you need to go sign up for a <a href="https://pusher.com/">Pusher</a> account (Echo works with Redis and Socket.io too, but we're going to use Pusher for this example). Create a new app in your Pusher account and grab your key, secret, and App ID; then set those values in your <code>.env</code> file as <code>PUSHER_KEY</code>, <code>PUSHER_SECRET</code>, and <code>PUSHER_APP_ID</code>. Also, while you're in there, set the <code>BROADCAST_DRIVER</code> to <code>pusher</code>.</p>
<p>And, finally, require the Pusher library:</p>
<pre><code class="language-bash">composer require pusher/pusher-php-server:~2.0</code></pre>
<p>Now you can send events out to your Pusher account by running commands like this:</p>
<pre><code class="language-php">php artisan chat:message "Howdy everyone"</code></pre>
<p>If everything worked correctly, you should be able to log into your Pusher debug console, trigger that event, and see this appear:</p>
<p><img src="/assets/images/content/pusher-debug.png" alt="The message showing in the Pusher debug console" /></p>
<h2>Finally, Echo.</h2>
<p>So you now have a simple system for pushing events to Pusher. Let's get to what Echo provides for you.</p>
<h3>Installing the Echo JS library</h3>
<p>The simplest way to bring the Echo JavaScript library into your project is to import it with NPM and Elixir. So, let's import it and Pusher JS first:</p>
<pre><code class="language-bash"># Install the basic Elixir requirements
npm install
# Install Pusher JS and Echo, and add to package.json
npm install --save laravel-echo pusher-js</code></pre>
<p>Next, let's set up <code>resouces/assets/js/app.js</code> to import it:</p>
<pre><code class="language-javascript">import Echo from "laravel-echo"

window.Echo = new Echo({
    broadcaster: 'pusher',
    key: 'your-pusher-key-here'
});

// @todo: Set up Echo bindings here</code></pre>
<p>Finally, run <code>gulp</code> or <code>gulp watch</code> and be sure to link the resulting file into your HTML template, if you aren't already.</p>
<blockquote>
<p>Tip: If you're trying this on a fresh Laravel install, run <code>php artisan make:auth</code> before you try to write all the HTML yourself. Later features will require you to have Laravel's authentication running anyway, so just make it happen now.</p>
</blockquote>
<p>Echo needs access to your CSRF tokens; if you're using the Laravel auth bootstrap, it will make it available to echo as <code>Laravel.csrfToken</code>. But if you're not, you can just make this available yourself by creating a <code>csrf-token</code> meta tag:</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        ...
        &lt;meta name="csrf-token" content="{{ csrf_token() }}"&gt;
        ...
    &lt;/head&gt;
    &lt;body&gt;
        ...

        &lt;script src="js/app.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Fantastic! Let's get to learning the syntax.</p>
<h3>Subscribing to public channels with Echo</h3>
<p>Let's go back to <code>resources/assets/js/app.js</code> and listen to the public channel <code>chat-room.1</code> that we are broadcasting our Event to, and log any messages that come in to our user's console:</p>
<pre><code class="language-javascript">import EchoLibrary from "laravel-echo"

window.Echo = new EchoLibrary({
    broadcaster: 'pusher',
    key: 'your-pusher-key-here'
});

Echo.channel('chat-room.1')
    .listen('ChatMessageWasReceived', (e) =&gt; {
        console.log(e.user, e.chatMessage);
    });</code></pre>
<p>We're telling Echo: subscribe to the public channel named <code>chat-room.1</code>. Listen to an event named <code>ChatMessageWasReceived</code> (and notice how Echo keeps you from having to enter the full event namespace). And when you get an event, pass it to this anonymous function and act on it.</p>
<p>And take a look at our console now:</p>
<p><img src="/assets/images/content/echo-public-console-log.png" alt="Chrome Console log of message and user" /></p>
<p>Bam! With just a few lines of code, we have full access to the JSON-ified representation of our chat message and of our user. Brilliant! We can use this data not just to send users messages, but to update the in-memory data stores of your apps (VueJS, React, or whatever else)&mdash;allowing each WebSockets message to actually update the on-page display.</p>
<p>Let's move on to private and presence channels, which both require a new piece of complexity: authentication and authorization.</p>
<h2>Subscribing to private channels with Echo</h2>
<p>Let's make <code>chat-room.1</code> private. First, we'll need to add <code>private-</code> to the channel name. Edit the <code>broadcastsOn()</code> method of our Laravel Event, <code>ChatMessageWasReceived</code>, and set the channel name to be <code>private-chat-room.1</code>. Or, to make it cleaner, you can pass the channel name to a new instance of <code>PrivateChannel</code>, which does the same thing: <code>return new PrivateChannel('chat-room.1');</code>.</p>
<p>Next, we'll use <code>Echo.private()</code> in <code>app.js</code> instead of <code>Echo.channel()</code>.</p>
<p>Everything else can remain the same. However, if you try running the script, you'll notice that it doesn't work, and if you look at your console, you might see this error:</p>
<p><img src="/assets/images/content/echo-auth-not-found.png" alt="Auth not found error" /></p>
<p>This is hinting at the next big feature Echo handles for you: authentication and authorization.</p>
<h3>The basics of Echo's authentication and authorization</h3>
<p>There are two pieces to the auth system. First, when you first open up your app, Echo wants to POST to your <code>/broadcasting/auth</code> route. Once we set up the Laravel-side Echo tools, that route will associate your Pusher socket ID with your Laravel session ID. Now Laravel and Pusher know how to identify that any given Pusher socket connection is connected to a particular Laravel session.</p>
<p>The second piece of Echo's authentication and authorization features is that, when you want to access a protected resource (a private or presence channel), Echo will ping <code>/broadcasting/auth</code> to see whether you are allowed to visit that channel. Because your socket ID will be associated with your Laravel session, we can write simple and clear ACL rules for this route; so, let's get started.</p>
<p>First, edit <code>config/app.php</code> and find <code>App\Providers\BroadcastServiceProvider::class,</code>, and un-comment it. Now open that file (<code>app/Providers/BroadcastServiceProvider.php</code>). You should see something like this:</p>
<pre><code class="language-php">...
class BroadcastServiceProvider extends ServiceProvider
{
    public function boot()
    {
        Broadcast::routes();

        /*
         * Authenticate the user's personal channel...
         */
        Broadcast::channel('App.User.*', function ($user, $userId) {
            return (int) $user-&gt;id === (int) $userId;
        });
    }</code></pre>
<p>There are two important pieces here. First, <code>Broadcast::routes()</code> registers the broadcast routes that Echo uses for authentication and authorization.</p>
<p>Second, <code>Broadcast::channel()</code> calls make it possible for you to define access permissions for a channel or group of channels (using the <code>*</code> character to match multiple channels). Laravel ships with a default channel associated with a specific user to show what it looks like to authorize limiting access to a single, currently-authenticated, user.</p>
<h4>Writing the auth permissions for our private channel</h4>
<p>So we have a private channel named <code>chat-room.1</code>. That suggests we're going to have multiple chat rooms (<code>chat-room.2</code>, etc.) so let's define permissions here for all chat rooms:</p>
<pre><code class="language-php">Broadcast::channel('chat-room.*', function ($user, $chatroomId) {
    // return whether or not this current user is authorized to visit this chat room
});</code></pre>
<p>As you can see, the first value that's passed to the Closure is the current user and, if there any <code>*</code> characters that could be matched, they'll be passed as additional parameters.</p>
<p>For the sake of this blog post, we'll just hand-code the authorization, but you would at this point want to create a model and migration for chat rooms, add a many-to-many relationship with the user, and then in this Closure check whether the current user is connected to this chat room or not; something like <code>if ($user-&gt;chatrooms-&gt;contains($chatroomId))</code>. For now, let's just pretend:</p>
<pre><code class="language-php">Broadcast::channel('chat-room.*', function ($user, $chatroomId) {
    if (true) { // Replace with real ACL
        return true;
    }
});</code></pre>
<p>Go test it out and see what you get.</p>
<blockquote>
<p>Having trouble? Remember, you need to have set your <code>app.js</code> to use <code>echo.private()</code> instead of <code>echo.channel()</code>; you need to have updated your Event to broadcast on a private channel named <code>chat-room-1</code> instead of a public channel; you need to have updated your <code>BroadcastServiceProvider</code>. And you need to have logged in to your app. And you need to re-run <code>gulp</code>, if you're not using <code>gulp watch</code>.</p>
</blockquote>
<p>You should be able to see an empty console log, then you can trigger our Artisan command, and you should see your user and chatMessage there&mdash;just like before, but now it's restricted to authenticated and authorized users!</p>
<p>If you see the following message instead, that's fine! That means everything's working, and your system decided that you were <em>not</em> authorized for this channel. Go double-check all of your code, but this doesn't mean anything's broken&mdash; it just means you're not authorized.</p>
<p><img src="/assets/images/content/echo-403.png" alt="Console log showing 403" /></p>
<p>Make sure to log in and then try again.</p>
<h2>Subscribing to presence channels with Echo</h2>
<p>So, we now can decide in our backend which users have access to which chat rooms. When a user sends a message to a chat room (likely by sending an AJAX request to the server, but in our example, through an Artisan command) it will trigger a <code>ChatMessageWasReceived</code> event which will then be broadcast, privately, to all of our users over WebSockets. What's next?</p>
<p>Let's say we want to set up an indicator on the side of our chat room showing who's there; maybe we want to play a noise when someone enters or leaves. There's a tool for that, and it's called a presence channel.</p>
<p>We'll need two things for this: a new <code>Broadcast::channel()</code> permission definition and a new channel that's prefixed with <code>presence-</code> (which we'll create by returning a <code>PresenceChannel</code> instance from the event's <code>broadcastOn</code> method). Interestingly, because channel auth definitions don't require the <code>private-</code> and <code>presence-</code> prefix, both <code>private-chat-room.1</code> and <code>presence-chat-room.1</code> will be referenced the same way in <code>Broadcast::channel()</code> calls: <code>chat-room.*</code>. <em>That's actually fine</em>, as long as you're OK with them having the same authorization rules. But I know that might be confusing, so for now we're going to name the channel a bit differently. Let's use <code>presence-chat-room-presence.1</code>, which we'll auth as <code>chat-room-presence.1</code>.</p>
<p>So, since we're just talking about presence, we don't need to tie this channel to an Event. Instead, we're just going to give <code>app.js</code> directions to join us to the channel:</p>
<pre><code class="language-javascript">Echo.join('chat-room-presence.1')
    .here(function (members) {
        // runs when you join, and when anyone else leaves or joins
        console.table(members);
    });</code></pre>
<p>We're &quot;joining&quot; a presence channel, and then providing a callback that will be triggered once when the user loads this page, and then once every time another member joins or leaves this presence channel. In addition to <code>here</code>, which is called on all three events, you can add a listener for <code>then</code> (which is called when the user joins), <code>joining</code> (which is called when other users join the channel), and <code>leaving</code> (which is called when other users leave the channel).</p>
<pre><code class="language-javascript">Echo.join('chat-room-presence.1')
    .here(function (members) {
        // runs when you join
        console.table(members);
    })
    .joining(function (joiningMember, members) {
        // runs when another member joins
        console.table(joiningMember);
    })
    .leaving(function (leavingMember, members) {
        // runs when another member leaves
        console.table(leavingMember);
    });</code></pre>
<p>Next, let's set up the auth permissions for this channel in the <code>BroadcastServiceProvider</code>:</p>
<pre><code class="language-php">Broadcast::channel('chat-room-presence.*', function ($user, $roomId) {
    if (true) { // Replace with real authorization
        return [
            'id' =&gt; $user-&gt;id,
            'name' =&gt; $user-&gt;name
        ];
    }
});</code></pre>
<p>As you can see, a presence channel doesn't just return <code>true</code> if the user is authenticated; it needs to return an array of data that you want to make available about the user, for use in something like a &quot;users online&quot; sidebar.</p>
<blockquote>
<p>Note: You might be wondering how I said earlier you could use the same <code>Broadcast::channel()</code> definition for both a private and a presence channel with similar names (<code>private-chat-room.*</code> and <code>presence-chat-room.*</code>), since private channel Closures are expected to return a boolean and presence channel Closures are expected to return an array. However, returning an array still is &quot;truth-y&quot;, and will be treated as a &quot;yes,&quot; authorizing that user for access to that channel.</p>
</blockquote>
<p>If everything got connected correctly, you should now be able to open up this app in two different browsers and see the updated members list logging to the console every time another user joins or leaves:</p>
<p><img src="/assets/images/content/echo-members-in-and-out-table.png" alt="Console log of members joining and leaving" /></p>
<p>So you can now imagine how you might be able to ring a bell every time a user leaves or arrives, you could update your JavaScript in-memory list of members and bind that to an &quot;online members&quot; list on the page, and much more.</p>
<h2>Exclude current user</h2>
<p>There's one last thing that Echo provides: what if you don't want the current user to get notifications? Maybe every time a new message comes into a chat room you're in, you want it to pop up a little message at the top of the screen temporarily. You probably don't want that to happen for the user that <em>sent</em> the message, right?</p>
<p>To exclude the current user from receiving the message, use the <code>broadcast</code> helper to trigger your event instead of the <code>event()</code> helper, and follow the call with <code>toOthers()</code>:</p>
<pre><code class="language-php">broadcast(new \App\Events\ChatMessageWasReceived($message, $user))-&gt;toOthers();</code></pre>
<p>Of course, this won't do anything with our sample Artisan command, but it will work if the Event is being triggered by a user of your app with an active session.</p>
<h2>That's all, folks!</h2>
<p>What we've done here looks pretty simple, so let me talk about why this is great.</p>
<p>First, remember that the messages that you're sending to your users are not just text&mdash;we're talking about JSON representations of your models. To get a sense for why this is great, take a look at how Taylor creates a task manager that keeps tasks up to date, on the page, in real time in <a href="https://laracasts.com/lessons/introducing-laravel-echo">his Laracasts video</a>. This is powerful stuff!</p>
<p>Second, it's important to note that <strong>the most important benefits that Echo provides are completely invisible</strong>. While you may agree that this is powerful stuff and opens up a ton of opportunities, you might be tempted to say &quot;but Echo is hardly doing anything!&quot;</p>
<p>However, what you're not seeing is how much work you would to do to set up authentication, channel authorization, presence callbacks, and more <em>if you weren't using Echo</em>. Some of these features exist in Pusher JS and Socket.io, with varying levels of difficulty, but Echo makes them simpler and provides consistent conventions. Some of the features don't exist in the other libraries at all, or at least not as a single, simple feature. Echo takes what could be slow and painful with other socket libraries and makes it simple and easy.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/things-i-didnt-know-laravel-could-do</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/things-i-didnt-know-laravel-could-do"/>
        <title>Things I didn&#039;t know Laravel could do</title>
        <published>2016-06-02T00:00:00+00:00</published>
        <updated>2016-06-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            It turns out that there&#039;s a long road between &amp;qu...
        </summary>
        <content type="html"><![CDATA[
        <p><a href="http://laravelupandrunning.com/"><img src="/assets/images/content/book-cover.png" style="float: right; width: 11em; max-width: 100%; margin: 0 1em 1em 1em"></a></p>
<p>It turns out that there's a long road between &quot;I have a book contract&quot; and &quot;I know everything there is to know in order to write this book.&quot;</p>
<p>It doesn't matter how much of an expert you feel like. It doesn't matter how much time you've spent learning and teaching. Across the board, every tech author I've talked to has described just how much they learned&mdash;<em>had</em> to learn&mdash;when they wrote a book.</p>
<p>I learned a <em>lot</em> in writing <a href="http://laravelupandrunning.com/">Laravel: Up and Running</a>. And I want to share it with you.</p>
<h2>I wanted to write a book you will like</h2>
<p>I had two big fears when I first started writing <em>Laravel: Up and Running</em>.</p>
<p>First, I was afraid that I wouldn't have anything to offer other than what was already on my blog. That fear was <em>quickly</em> assuaged when I realized just how much there is to cover.</p>
<p>And second, I was afraid I was writing a book that would be helpful for beginners but useless for everyone else. Once again, this fear didn't last long.</p>
<p><strong>There is as much content in this book that I had to learn as I wrote as there is content that I already knew</strong>. The amount of source diving I had to do, and test apps I had to write, to get this book right is incredible. For several chapters I spent more time coding and testing and reading source code than I did writing the actual book.</p>
<h2>A few things I learned</h2>
<p>No blog post could contain all of the new things I learned from writing this book. I've been using&mdash;and teaching about&mdash;Laravel for years, and I was still shocked by how many tools and helpers and features I discovered.</p>
<p>Here are a few that stand out to me that I had never seen prior to writing the book.</p>
<h3>1. The Cookie Façade is one special cookie</h3>
<p>Cookies are a little different than other similar tools&mdash;cache, session, etc.&mdash;in that PHP can't actually write them in the middle of a user request. Rather, they have to be returned along with the response.</p>
<p>That means that the Cookie Facade (and the global <code>cookie()</code> helper) doesn't have anything like <code>Cookie::put()</code> to allow you to directly set a cookie. Traditionally, we've created cookies and then attached them to the response using code like this:  </p>
<pre><code class="language-php">Route::get('dashboard', function () {
    $cookie = cookie('saw-dashboard', true, 15);

    return view('dashboard')-&gt;withCookie($cookie);
});</code></pre>
<p>But in writing the book I learned that there's a <code>queue()</code> method on the Cookie Façade (and <em>only</em> on the Façade, not the helper or the injected class) that you can use prior to the response, and Laravel's <code>AddQueuedCookiesToResponse</code> middleware will un-queue that cookie and attach it to your response after your route returns. So that makes this code possible:</p>
<pre><code class="language-php">Route::get('dashboard', function () {
    Cookie::queue('saw-dashboard', true, 15);

    return view('dashboard');
});</code></pre>
<p>In this example it doesn't matter much, but in a longer controller method you might appreciate the ability to set your cookie earlier&mdash;or to even set it somewhere other than your controller, if you want.</p>
<h3>2. Attaching files to emails is easier than you think</h3>
<p>I always knew you could attach files to your emails, but figured it was something like &quot;get the underlying Swift object and then perform fifty lines of magic to make it happen.&quot;</p>
<p>Nope. It's stupidly simple.</p>
<pre><code class="language-php">Mail::send('emails.whitepaper', [], function ($m) {
    $m-&gt;to('barasa@wangusi.ke');
    $m-&gt;subject('Your whitepaper download');
    $m-&gt;attach(storage_path('pdfs/whitepaper.pdf'));
});</code></pre>
<p>It's also incredibly simple to embed an image directly into your email template:</p>
<pre><code class="language-php">// emails/has-image.blade.php
Here's that image we talked about sending:

&lt;img src="{{ $message-&gt;embed(storage_path('embed.jpg')) }}"&gt;

Thanks!</code></pre>
<p>Magic.</p>
<h3>3. You can chain more Scheduler methods than the docs show</h3>
<p>The docs show that you can chain a few types of Scheduler methods together to define the schedule your commands will run at. But it turns out you can chain any reasonable combination of times together.</p>
<p>This makes the Scheduler much more powerful that the docs let on. You can now do something like this:</p>
<pre><code class="language-php">// Run once an hour, weekdays, from 8-5
$schedule-&gt;command('do:thing')-&gt;weekdays()-&gt;hourly()-&gt;when(function () {
    return date('H') &gt;= 8 &amp;&amp; date('H') &lt;= 17;
});</code></pre>
<p>You can also write more complex schedulers in other classes, and pass them in with a Closure:</p>
<pre><code class="language-php">$schedule-&gt;command('do:thing')-&gt;everyThirtyMinutes()-&gt;skip(function () {
    return app('SkipDetector')-&gt;shouldSkip();
});</code></pre>
<h3>4. You can assert that a view gets passed certain data</h3>
<p>This seems like everyone should know it, but somehow I had never stumbled across it. In your tests, you can assert that, if you visit a particular route, the view in that route gets passed data. So you can write a route like this:</p>
<pre><code class="language-php">Route::get('test', function () {
    return view('test')-&gt;with('foo', 'bar');
});</code></pre>
<p>And then write this test:</p>
<pre><code class="language-php">public function test_view_gets_data()
{
    $this-&gt;get('test');
    $this-&gt;assertViewHas('foo');        // true
    $this-&gt;assertViewHas('foo', 'bar'); // true
    $this-&gt;assertViewHas('foo', 'baz'); // false
}</code></pre>
<h2>Get your free sample here, folks!</h2>
<p>There is a <em>lot</em> more that I learned that I haven't covered here. Much of it will come through in the little details, which made it not as good of a fit for a blog post like this&mdash;but trust me, there's a lot.</p>
<p>If you want to check out the book itself, I have a free sample available on the site I've set up for the book: <a href="https://laravelupandrunning.com/">laravelupandrunning.com</a></p>
<h2>Want to read more today?</h2>
<p>Finally, if you already know you want the book, it's available for <strong><a href="http://shop.oreilly.com/product/0636920044116.do">print and e-book pre-order on O'Reilly</a></strong>, and if you pre-order the e-book right now you'll get a free copy of the first 12 chapters, right out of my text editor, before they've seen the strike of an editor's pen.</p>
<p>Thanks for checking this out. I'm confident that, no matter who you are (except you, Taylor, and maybe you, Jeffrey), you'll learn something from this book. I've busted my butt to get this to be useful not just to people new to Laravel, but every member of the Laravel community, and I think y'all are going to love it.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/why-i-wrote-my-book-with-oreilly</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/why-i-wrote-my-book-with-oreilly"/>
        <title>Why I wrote my book with O&#039;Reilly</title>
        <published>2016-05-31T00:00:00+00:00</published>
        <updated>2016-05-31T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            In case you missed it, I finished the first draft...
        </summary>
        <content type="html"><![CDATA[
        <p><img src="/assets/images/content/laravel-up-running-in-grid.png" alt="Laravel Up and Running book cover in a grid" /></p>
<p>In case you missed it, I finished the first draft of my book <a href="http://laravelupandrunning.com/">Laravel: Up and Running</a> this weekend. I'm ecstatic to be done, and ready to finish the updates and edits to get this book published!</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">First draft. Is. Done<br><br>My “250-page” book is currently sitting at 371 pages <br><br>Next up!! Edits, &amp; making sure it’s up to date w/last 9 mos.</p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/737132431594004480">May 30, 2016</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I took a look at the git history, and my first commit to the repo for the book was on <strong>July 10, 2015</strong>. That means the book will likely publish somewhere close to a year after I first started writing, and I finished writing the first draft in <strong>325 days</strong>.</p>
<p>I've gotten a lot of questions about what the process was like working with <a href="http://www.oreilly.com/">O'Reilly</a>, why I chose O'Reilly over self-publishing, and what syntax and system I'm using to write the book. I didn't want to spend too much time blogging <em>about</em> the book while I was writing it, but now that the first draft is done I can finally take a pause and write this up.</p>
<h2>Why O'Reilly?</h2>
<p>If you're not familiar with O'Reilly, they're the premier tech publisher. I currently have three O'Reilly books on my nightstand, dozens on my bookshelf, and my brothers and I grew up reading their &quot;animal books&quot; (a series of tech books with animals on the cover). You've probably seen them, even if you don't recognize the name:</p>
<p><img src="/assets/images/content/animal-books.jpg" alt="A picture of three O'Reilly animal book covers" /></p>
<p>So, when O'Reilly approached me about writing a book about <a href="https://laravel.com">Laravel</a>, my first response was lifetime-geek excitement. O'Reilly? Wants me? It's like rappers who grew up learning how to rap by listening to artists like Jay-Z, only to do so well that they one day are asked to feature on one of his songs. It just <em>feels</em> good.</p>
<h3>Gimme... a little money</h3>
<p>However, when you work with a traditional publisher, you only make a fraction of what you make when you self-publish. Your publisher sets your price (I spent a year writing 371 pages and it's currently listed at $30 on Amazon&mdash;that feels a bit like a kick in the gut), and while I don't want to reveal all of O'Reilly's secrets, let's just say I will be paid less than a quarter of the revenue. That sucks, right?</p>
<p>My friend Adam just released a book called <a href="http://adamwathan.me/refactoring-to-collections/">Refactoring to Collections</a>. You can pay anywhere from $39-179 for it, and Adam is paid nearly every cent (Gumroad takes a very small cut). Most of my friends who self-publish do so through Leanpub, which takes a small percentage of your revenue.</p>
<p>So we can see, there's a very big difference on pay-out. Why, then, would I choose to work with a traditional publisher?</p>
<hr />
<p>There are four primary reasons why I chose to publish with O'Reilly.</p>
<h4>1. The Jay-Z Effect</h4>
<p>First, I love O'Reilly, have learned from them since I was a kid, and <em>love</em> the feeling of telling my friends and family that I'm writing a book for O'Reilly. Even my wife, who's as non-technical as they get, said, &quot;Wait, like those animal books you have on your nightstand??&quot; Yes. Those.</p>
<h4>2. O'Reilly Knows What They're Doing</h4>
<p>The second reason is that O'Reilly has tooling, editors, promotional machines, and the experience of publishing and promoting that I don't have. If I self-published, my book wouldn't have gone to print. It wouldn't be in Amazon or physical bookstores. Instead, it would go out to my Twitter audience as an ebook and that's it. I would've facilitated finding my own editors (although I did that with O'Reilly anyway because I know some great editors), and either published through Leanpub or had to create my own PDF generator like Adam did. With O'Reilly I have access to decades of publishing wisdom and experience that I wouldn't have on my own.</p>
<h4>3. Expanding My Audience</h4>
<p>The third reason is that O'Reilly has an audience that I don't have. They have respect and connections within academia, the enterprise, and a wide swath of the tech community that I don't have. And I don't just mean that <em>I</em> don't have those connections; Laravel, as a relatively young framework, doesn't have as many of those connections as I want it to.</p>
<p>Working with O'Reilly doesn't just legitimize my book, it also helps to legitimize Laravel, which is something I very much want to see happen. I would love for the old-school PHP heads who are considering trying out a framework to see an O'Reilly book about Laravel and consider that a validation&mdash;and a learning experience&mdash;that can get them there.</p>
<h4>4. Non-Monetary Benefits</h4>
<p>And finally, writing a book with O'Reilly may not get me as much <em>money</em> (and trust me, I'm not rich, I would love more money), but it provides other benefits to me as an author.</p>
<p>It helps my <strong>credibility</strong> as an author and a teacher: I've been published by a major publisher, not just Leanpub. It helps my <strong>connections</strong>: I am now in the O'Reilly fold, with a connection to other O'Reilly authors and O'Reilly conferences. And it helps my <strong>reputation</strong>. In ten years, will my consultancy still exist (I hope so)? Will the number of Twitter followers I have matter? Who knows. But in ten years, I predict that being an O'Reilly author will still be a signifier of accomplishment and ability. I don't have a computer science degree. I don't have many pieces of paper that show my abilities as a thinker and teacher and developer. But I will have this book, and you better believe I'll have a big picture of me smiling and holding it the second I get my first printed copy.</p>
<h2>My Recommendations For You</h2>
<p>So, would I recommend publishing with O'Reilly? <strong>Absolutely</strong>. If you're asking the question, you are likely in a position where you should consider it, strongly.</p>
<p>If you have a large audience already and want to write a book to make a lot of money and don't mind doing a lot of the work yourself, you may not want to go with a traditional publisher. There are people like that, and they're often better suited to publish with Leanpub or something similar. My friend Adam? He self-published, and it was absolutely the right decision for that book.</p>
<p>But if you're not that exact type of person, I'd highly recommend trying the traditional publisher route <em>if you can</em>. Even someone who has all of those characteristics can benefit from publishing with someone like O'Reilly.</p>
<h3>Caveats</h3>
<p>Not everyone can just walk up to O'Reilly and get a book published with them. There were two primary factors that led to my connection with them.</p>
<p>First, they had decided to write a book on a topic I love to teach. If you are deeply passionate about a subject O'Reilly (or your desired publisher) already has a book on, you may be out of luck.</p>
<p>And second, I had a ridiculous amount of <em>written</em> material available on the Internet on the topic they wanted a book about. They were able to see just how I might write a book about Laravel before they even contacted me.</p>
<p>The number one recommendation I would make if you want to write a book, traditional publisher or no: blog. Blog all the things. Blog all the time. Refine your voice. Get used to writing. And get your name out there and connected to the subject you would like to write about.</p>
<p>And here's my number one warning: just because you write a book, it doesn't mean it will sell. If you choose to self-publish, <em>you</em> are responsible for finding a book people are interested in, and marketing it. You could put six months of work into your book only to discover that only ten people want it. That would be awful. So do everything in your power to make sure that you're going to see the level of sales that you think validate your time spent.</p>
<h2>Coming up</h2>
<p>I'll write a short post later this week about the <em>process</em> of working with O'Reilly--how they use git and AsciiDoc and what the planning and writing and editing processes are like.</p>
<p>And when we get closer to the publishing of the book, I'll gladly write up any other relevant pieces of information. If I can help you, future author, with my experiences, I would love it.</p>
<hr />
<p>Love this article? You can <a href="http://shop.oreilly.com/product/0636920044116.do">pre-order the e-book now</a> and get early access to the first few chapters, un-edited, with more to come.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/using-sparkpost-for-transactional-emails-with-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/using-sparkpost-for-transactional-emails-with-laravel"/>
        <title>Using SparkPost for Transactional emails with Laravel</title>
        <published>2016-04-26T00:00:00+00:00</published>
        <updated>2016-04-26T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Recently, Mandrill announced that they&#039;d be sunset...</summary>
        <content type="html"><![CDATA[
        <p>Recently, <a href="http://mandrill.com/">Mandrill</a> announced that they'd be sunsetting their transactional email service and instead rolling it in to a secondary service for paid <a href="http://mailchimp.com/">MailChimp</a> users. That's fine for them, but many of us were using it for small one-off apps and weren't interested in all of a sudden paying money to send 100 emails a month.</p>
<p><a href="http://www.mailgun.com/">Mailgun</a> and <a href="http://sendgrid.com/">Sendgrid</a> have been standby transactional email providers for a while, and there's also <a href="https://aws.amazon.com/ses">Amazon's SES</a>, <a href="https://www.campaignmonitor.com/features/transactional-email/">CampaignMonitor</a>, and higher-cost-high-uptime premium <a href="https://postmarkapp.com/">Postmark</a>.</p>
<p>But right when Mandrill announced their pricing change, a new transactional email provider came out of nowhere: <a href="https://www.sparkpost.com/">SparkPost</a>. They claim they've been around for years and power most of the Internet, but that's not entirely true. Rather, they are a <em>new</em> transactional service built on top of an <em>old</em> and powerful infrastructure, called &quot;Momentum&quot; by <a href="https://www.messagesystems.com/">MessageSystems</a>. But Momentum itself is definitely proven:</p>
<p><img src="/assets/images/content/sparkpost-powers-the-web.png" alt="Momentum-powers-the-web" /></p>
<p>So let's walk through the process of signing up and moving <a href="https://giscus.co/">Giscus</a>, my app for notifying you of comments on your gists, from Mandrill to SparkPost.</p>
<blockquote>
<p>Note: Most of the stuff in this article is easy to do. I'm writing it to give you a sense of what SparkPost is like in case you want to compare it with another provider, <em>not</em> because I think you need instructions for how to sign up. :)</p>
</blockquote>
<h2>Signing up for SparkPost</h2>
<p>First, let's go <a href="https://app.sparkpost.com/sign-up">sign up</a>. </p>
<p><img src="/assets/images/content/sparkpost-sign-up.png" alt="SparkPost sign-up" /></p>
<p>100k free emails a month for the lifetime of the account? Yes please.</p>
<p><img src="/assets/images/content/sparkpost-welcome.png" alt="SparkPost welcome screen" /></p>
<p>Now, I enter my domain. Sadly I don't have access to either of these email addresses, so let's see what else we can do.</p>
<p><img src="/assets/images/content/sparkpost-smtp-rest.png" alt="SparkPost SMTP vs REST" /></p>
<p>I'll choose REST. We could technically use either, but I prefer using an API if possible. This gets me an API key, so I'll copy it down and then head over to the dashboard.</p>
<blockquote>
<p>Note: If you want it done fast, or if you're using Laravel prior to 5.2, just use SMTP. You can copy the credentials, paste them into your <code>.env</code> file, update your app config to use SMTP, and then you're done.</p>
</blockquote>
<p><img src="/assets/images/content/sparkpost-dashboard.png" alt="SparkPost dashboard" /></p>
<p>Well ain't this pretty! This daily limit was 500 until I verified my email address, but now it's 10,000. What's next? Verify my sending domain. Let's do it.</p>
<p><img src="/assets/images/content/sparkpost-verify-domain.png" alt="SparkPost Domain Verification" /></p>
<p>Just like any other email provider, I'll need to set up DKIM and SPF records to verify ownership of the domain. Your experience may vary based on your DNS provider, but with DNSimple this is easy as pie. Once I set up the SPF and DKIM records, I was marked &quot;ready to send.&quot;</p>
<h2>Setting up SparkPost with Laravel</h2>
<p>So our SparkPost account is up and running. Let's now connect it to Giscus.</p>
<p>Like I mentioned earlier, the fastest option is SMTP. But I want to try the full API integration, so I'm going to upgrade Giscus to 5.2 using <a href="https://laravelshift.com/">Laravel Shift</a> and then that'll get me access to the SparkPost driver.</p>
<p>Make sure you're on Laravel 5.2.29 or later. I wasn't, so I upgraded, and now I need to add a <code>sparkpost</code> array to my <code>config/services.php</code> file:</p>
<pre><code class="language-php">'sparkpost' =&gt; [
    'secret' =&gt; env('SPARKPOST_SECRET'),
],</code></pre>
<p>I'll grab my API key that I stored earlier, head to my <code>.env</code> file, and put it in there as <code>SPARKPOST_SECRET</code>:</p>
<pre><code>SPARKPOST_SECRET=1509812piu4nlkjadhfo98qwrw</code></pre>
<p>Finally, I'll update <code>.env</code> to show it that I'm using the <code>sparkpost</code> driver:</p>
<pre><code>MAIL_DRIVER=sparkpost</code></pre>
<p>And that's it! Mail's now coming through via my new SparkPost driver.</p>
<h2>The dashboard</h2>
<p>One of the main reasons I wrote this post was to show folks what SparkPost feels like, so here are a few screenshots of the dashboard:</p>
<h3>User accounts</h3>
<p><img src="/assets/images/content/sparkpost-user-accounts.png" alt="SparkPost User Accounts" /></p>
<h3>Webhooks</h3>
<p><img src="/assets/images/content/sparkpost-webhooks.png" alt="SparkPost Webhooks" /></p>
<h3>Reports</h3>
<p><img src="/assets/images/content/sparkpost-reports.png" alt="SparkPost Reports" /></p>
<p><img src="/assets/images/content/sparkpost-events.png" alt="SparkPost Events" /></p>
<h2>Miscellany</h2>
<p>SparkPost also offers lists and templates, if you want to use their API directly. Check out the <a href="https://packagist.org/packages/sparkpost/php-sparkpost">PHP-SparkPost</a> package on Packagist.</p>
<h3>Important caveat:</h3>
<p>One thing I've noticed is that something that I would often do on other providers (I can't remember who does and doesn't have it, sadly, but I know Mailgun does) is inspect the contents of an email that was sent. I'll often use it in debugging or helping folks with spam issues. </p>
<p>I haven't yet found out how to do it in SparkPost, and I'm worried it may not be possible. I've <a href="https://twitter.com/stauffermatt/status/725018453103403009">asked SparkPost on twitter</a>, so we'll see what the response is. If they don't have it, that would be reason enough for me to use Mailgun instead. I hope I'm wrong, though, and it's just hiding in there somewhere!</p>
<h2>Conclusion</h2>
<p>That's all. It's very simple to set up and verify a SparkPost account; it's a proven platform; they have a generous free plan; and the dashboard is very easy to use, save the possible lack of the ability to inspect individual messages.</p>
<p>Have you had good or bad experiences with SparkPost? Let me know <a href="http://twitter.com/stauffermatt">on twitter</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/getting-started-using-vues-vue-router-for-single-page-apps</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/getting-started-using-vues-vue-router-for-single-page-apps"/>
        <title>Getting started using Vue&#039;s Vue-router for single page apps</title>
        <published>2016-04-01T00:00:00+00:00</published>
        <updated>2016-04-01T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">One of the things I love most about Vue.js is that...</summary>
        <content type="html"><![CDATA[
        <p>One of the things I love most about <a href="http://vuejs.org">Vue.js</a> is that it works on the simplest of pages with the simplest of components. You don't need any complicated build tools or dependency trees.</p>
<p>However, Vue isn't just limited to simple components. <a href="https://github.com/vuejs/vue-resource">Vue-resource</a> makes AJAX easy, <a href="http://vuejs.github.io/vue-router/en/">vue-router</a> sets up single-page-app routing with almost no effort, and one day I'll learn <a href="https://github.com/vuejs/vuex">Vuex</a>, I promise.</p>
<p>I want to show you just how easy it is to use vue-router to create a single-page-app using Vue. And trust me: it is easy. If you've already created your first component using Vue, you're 90% of the way there.</p>
<h2>Getting set up</h2>
<p>As is often the case, I choose <a href="https://laravel.com/docs/elixir">Laravel Elixir</a> as my build tool.</p>
<p>You can use any build system that gives you access to your NPM packages, or you can even pull in the package manually (via <a href="https://cdnjs.cloudflare.com/ajax/libs/vue-router/0.7.10/vue-router.min.js">CDN</a>) or via Bower. In the end, get the <code>vue-router</code> package installed somehow. If you're not going to use Elixir, just skip the next section.</p>
<h3>Installing Vue and vue-router with Laravel Elixir (Optional)</h3>
<p>If you are going to start a new project using Laravel Elixir, read the docs for basic installation instructions. Then add <code>vue</code> and <code>vue-router</code>:</p>
<pre><code class="language-bash">npm install vue vue-router --save</code></pre>
<p>Next, you'll want to add a Browserify task for your JavaScript file:</p>
<pre><code class="language-javascript">// gulpfile.js
elixir(function (mix) {
    mix.browserify('app.js');
});</code></pre>
<p>This now expects that you have a file at <code>resources/assets/js/app.js</code> and will pass that file through Browserify and Babel and output it at <code>public/js/app.js</code>. Create the resources version of the file, and then run <code>gulp watch</code> to get it running.</p>
<h3>Pulling in the dependencies</h3>
<p>In your primary JavaScript file, you'll want to pull in Vue and vue-router using whatever import system you have available:</p>
<pre><code class="language-javascript">var Vue = require('vue');
var VueRouter = require('vue-router');

Vue.use(VueRouter);</code></pre>
<p>We pull in Vue and vue-router, and then we link them together. Now, let's write our app.</p>
<h2>Creating your application</h2>
<p>Like in any Vue app, we need to create a base application. But unlike in other Vue apps, the core templating work we'll be doing is mapping certain routes to certain components. There's no new Vue concept like a &quot;page&quot;--each page is just a component, which may contain other components.</p>
<p>So, let's create our App and our router:</p>
<pre><code class="language-javascript">var App = Vue.extend({});

var router = new VueRouter();

router.start(App, '#app');</code></pre>
<p>That's it! This won't actually do anything, since we haven't mapped any routes, but we just defined an App, defined a router, bound them together, and then initialized the router.</p>
<h2>Mapping routes to components</h2>
<p>Now that we have an app and a router, let's define a few routes:  </p>
<pre><code class="language-javascript">var App = Vue.extend({});

var router = new VueRouter();

var Home = Vue.extend({
  template: 'Welcome to the &lt;b&gt;home page&lt;/b&gt;!';
});

var People = Vue.extend({
  template: 'Look at all the people who work here!';
});

router.map({
  '/': {
    component: Home
  },
  '/people': {
    component: People
  }
});

router.start(App, '#app');</code></pre>
<p>We've now defined two possible routes in our application, and mapped each with a component.</p>
<h2>Building the HTML page</h2>
<p>Let's create an HTML page to hold our router. Despite what you might think, this page doesn't need to be entirely empty. With vue-router, your app can contain some code that isn't switched out by components--for example, a nav section.</p>
<pre><code class="language-html">...
&lt;div id="app"&gt;
  &lt;a v-link="{ path: '/' }"&gt;&lt;h1&gt;Our company&lt;/h1&gt;&lt;/a&gt;
  &lt;ul class="navigation"&gt;
    &lt;li&gt;&lt;a v-link="{ path: '/people' }"&gt;People&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;

  &lt;router-view&gt;&lt;/router-view&gt;
&lt;/div&gt;
...</code></pre>
<p>Let's assume this page has HTML header and wrapper tags, and also imports our scripts and dependencies in the header or footer somewhere.</p>
<p>We can see a few important pieces here. First, when we start our router in our script file, we bound it to <code>'#app'</code>, so we needed to create a page element with the ID of &quot;app&quot; to bind our Vue app to.</p>
<p>Second, you can see the Vue syntax for links: using the <code>v-link</code> property and passing it a JSON object. For now, we'll stick to <code>{ path: '/url-here' }</code>.</p>
<blockquote>
<p>If the link you're currently visiting is &quot;active&quot;--meaning the user has that link open--the router will apply the class <code>v-link-active</code> to that link, which you can then style uniquely. You can also change that class or have it applied to a separate related element like a parent <code>div</code> or <code>li</code>--check out the docs to learn more.</p>
</blockquote>
<p>Finally, we have a <code>&lt;router-view&gt;</code> component, which is where the output of each page's component will go.</p>
<p>If you open that page up and everything loads correctly, you now have your first single-page app using vue-router!</p>
<blockquote>
<p>You might notice that it's currently using &quot;hashbang&quot;-style navigation, where all of your routes are appended after <code>#!</code>. You can disable this, which we'll talk about later, but it will take a bit of server mumbo jumbo, just so you're prepared.</p>
</blockquote>
<h2>More advanced route definition</h2>
<p>We defined some pretty simple routes above. Let's dig a little further into the sorts of routes you can define with vue-router.</p>
<h3>Route parameters</h3>
<p>You're probably going to want to define routes at some point that are more than just a static URL. We call URLs that can match multiple URLS &quot;dynamic&quot; URLs. Let's learn how to define one.</p>
<pre><code class="language-javascript">router.map({
  '/people/:personId': {
    component: {
      template: 'Person ID is {{$route.params.personId}}'     
    }
  }
});</code></pre>
<p>We can learn a few things from this example. First, we can see that vue-router maps dynamic parameters using this syntax: <code>:paramName</code>.</p>
<p>Second, we can see that vue-router allows you to define component objects inline, if you'd like.</p>
<p>And third, we can see we have access to a <code>$route</code> object with a <code>params</code> property that's an object of all of the matched dynamic URL parameters.</p>
<h4>Greedy route segments</h4>
<p>If you want to define a dynamic route segment that can match multiple segments, use a segment definition name that starts with <code>*</code> instead of <code>:</code>:</p>
<pre><code class="language-javascript">router.map({
  '/people/*greedy' =&gt; {},
  '/people/*greedy/baz' =&gt; {},
});</code></pre>
<p>That first route definition will match <code>/people/a</code>, <code>/people/a/b</code>, <code>/people/a/b/c/d/e/f</code>.</p>
<p>The second route definition will match <code>/people/a/baz</code>, <code>/people/a/b/c/d/e/f/g/baz</code>, etc.</p>
<p>And both will return a <code>greedy</code> segment on the route: <code>$route.params.greedy</code>, which is equal to the full string for that segment. <code>/people/a/b/baz</code> would return <code>{ greedy: 'a/b' }</code>.</p>
<h3>Named routes</h3>
<p>If you've used Laravel routes before, you'll be familiar with the idea of giving any given route a &quot;name&quot; that you can use to refer to it later. You can do this with vue-router as well:</p>
<pre><code class="language-javascript">router.map({
  '/people/:personId': {
    name: 'people.show',
    component: People
  }
});</code></pre>
<p>You can then link to that route with <code>v-link</code>:</p>
<pre><code class="language-html">&lt;a v-link="{ name: 'people.show', params: { personId: 5 }}"&gt;Person 5&lt;/a&gt;</code></pre>
<h3>Navigating to a route in JavaScript</h3>
<p>We've seen how <code>v-link</code> can replace normal links, but what if you need to trigger a navigation event in your JavaScript? <code>router.go()</code> is your friend:</p>
<pre><code class="language-javascript">router.go({ name: 'people.show', params : { personId: 5 }});</code></pre>
<p>You can also use <code>router.replace()</code>, which functions the same except it doesn't generate a new history record in the browser.</p>
<h2>Router options</h2>
<p>When you instantiate the router object at the top of your JavaScript file, you can optionally pass it a few configuration properties.</p>
<ul>
<li><strong>hashbang</strong>: If you set this to <code>false</code>, the system will use actual URLs (<code>/people</code>) instead of hashbang URLs (<code>/#!/people</code>). If you do this, you'll want to enable <strong>history</strong> and configure your server correctly.</li>
<li><strong>history</strong>: Uses your browser's push state to update your browser history as you navigate through the site. Requires your server to be <a href="http://readystate4.com/2012/05/17/nginx-and-apache-rewrite-to-support-html5-pushstate/">configured correctly</a></li>
<li><strong>root</strong>: If your application is not at your web root, set this property for navigation to correctly append the subdirectory your app is in. For example, if your app is in <code>/app</code>, set this property to <code>/app</code> so that vue-router URLs are generated appropriately; <code>/app/people</code> instead of just <code>/people</code>.</li>
</ul>
<blockquote>
<p>If you're using this app within a Laravel app, instead of configuring nginx or Apache to handle hashbang-less push state, you could configure your Laravel app to handle it; just set up a capture route that grabs all valid URLs and passes them the view that's outputting your Vue code.  </p>
<pre><code class="language-php"> Route::get('/{vue_capture?}', function () {
   return view('home');
 })-&gt;where('vue_capture', '[\/\w\.-]*');</code></pre>
</blockquote>
<h2>Getting route information inside your components</h2>
<p>Every component in your app will have access to <code>this.$route</code>, which is a &quot;Route Context Object&quot; and exposes properties that can be useful for getting information about your route. Your templates will also have access to this object as <code>$route</code>.</p>
<ul>
<li><strong><code>$route.path</code></strong> is equal to the absolute path; e.g. <code>/people</code></li>
<li><strong><code>$route.params</code></strong> contains the key/value pairs of your dynamic sections; e.g. <code>{ personId: 5 }</code></li>
<li><strong><code>$route.query</code></strong> contains the key/value pairs of your query string; e.g. <code>/people?sortBy=names</code> would return <code>{ sortBy : lastName }</code></li>
<li><strong><code>$route.router</code></strong> returns the vue-router instance</li>
<li><strong><code>$route.matched</code></strong> returns route configuration objects for every matched segment in the current route</li>
<li><strong><code>$route.name</code></strong> returns the name, if it has one, of the current route</li>
</ul>
<p>You can also pass custom data into your components by passing it into the route definition. For example, I wanted a certain section of my app to be admin-only, so I passed that as a flag into the definition, and was about to check it inside my component as <code>$route.adminOnly</code>.</p>
<pre><code class="language-javascript">router.map({
  '/secret-admin-panels': {
    component: SecretDashboard,
    adminOnly: true
  }
});</code></pre>
<h2>Setting hooks</h2>
<p>It was possible for me to check the <code>$route.adminOnly</code> property in my components, but that's something that would be better handled before users are even granted access to the component, using something like middleware. With vue-router, that's going to be route hooks, like <code>beforeEach</code>:</p>
<pre><code class="language-javascript">// Sample means of checking user access
var MyUser = { admin: false };

router.beforeEach(function (transition) {
  if (transition.to.adminOnly &amp;&amp; ! MyUser.admin) {
    transition.redirect('/login');
  } else {  
    transition.next();
  }
});</code></pre>
<p>As you can see, we intercept the request <em>before</em> the component is rendered. We can allow it to move forward using <code>transition.next()</code>, but we can also intercept the user and redirect or abort <code>transition.abort()</code>.</p>
<p>There's also an <code>afterEach()</code> hook.</p>
<h2>Miscellaneous</h2>
<p>A few quick notes before we're done.</p>
<p>First, <code>&lt;router-view&gt;</code> can be passed props just like any other on-page component.</p>
<p>Second, Vue has an entire <a href="http://vuejs.github.io/vue-router/en/pipeline/index.html">Transition Pipeline</a> that you can use to define visual and functional transition behavior between pages.</p>
<p>Finally, this article isn't exhaustive; make sure to read the <a href="http://vuejs.github.io/vue-router/en/">docs</a> to learn more.</p>
<h2>Concluding</h2>
<p>That's it for now. You can see how simple it is to set up your first single-page app using Vue and vue-router, and how smoothly the transition to single component to single-page app can be.</p>
<p>If you want to see a (somewhat) working example, my work-in-progress learning app <a href="http://github.com/mattstauffer/suggestive">Suggestive</a> uses vue-router.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/how-to-use-vueify-es2015-and-browserify-on-your-vue-projects-with-laravel-elixir
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-use-vueify-es2015-and-browserify-on-your-vue-projects-with-laravel-elixir"/>
        <title>How to use Vueify, ES2015, and Browserify on your Vue projects with Laravel Elixir</title>
        <published>2016-03-17T00:00:00+00:00</published>
        <updated>2016-03-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I just wrote up a tutorial on the Tighten Blog abo...</summary>
        <content type="html"><![CDATA[
        <p>I just wrote up a tutorial on the <a href="http://blog.tighten.co/setting-up-your-first-vuejs-site-using-laravel-elixir-and-vueify?utm_source=mattstauffer.co">Tighten Blog</a> about using Laravel Elixir to make it easy to add Vueify and use ES2015 on your Vue projects.</p>
<blockquote>
<p>Laravel Elixir is a build tool for the Laravel PHP framework, but it works just fine outside of Laravel. It's a wrapper around Gulp that makes it simple and painless to perform all the development tasks that are most common across the vast majority of web applications. [..] we get Babel (for ES2015) for free, and Vueify for cheap, so we can write simple, distinct components with almost no pain when it comes to putting them together.</p>
</blockquote>
<p>I'm using Vueify on every project that uses Vue these days, and Elixir makes the whole process painless.</p>
<p><a href="http://blog.tighten.co/setting-up-your-first-vuejs-site-using-laravel-elixir-and-vueify?utm_source=mattstauffer.co">Setting up your first Vue.js site using Laravel Elixir and Vueify - Tighten.co Blog</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-i-created-a-password-less-email-only-authentication-system-in-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-i-created-a-password-less-email-only-authentication-system-in-laravel"/>
        <title>How I created a password-less, email-only authentication system in Laravel</title>
        <published>2016-03-11T00:00:00+00:00</published>
        <updated>2016-03-11T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I just wrote up a tutorial on the Tighten Blog abo...</summary>
        <content type="html"><![CDATA[
        <p>I just wrote up a tutorial on the <a href="http://blog.tighten.co/creating-a-password-less-medium-style-email-only-authentication-system-in-laravel?utm_source=mattstauffer.co">Tighten Blog</a> about how to create a password-less login system in Laravel.</p>
<blockquote>
<p>If you've never had the chance to work with one, the login system works like this: enter your email address on the login page, get emailed a login link, click the link, and now you're logged in. Access to your email address proves your identity without the need for a password.  </p>
<p>Let's build one together.</p>
</blockquote>
<p>This was a ton of fun to create and turned out pretty simple; check it out!</p>
<p><a href="http://blog.tighten.co/creating-a-password-less-medium-style-email-only-authentication-system-in-laravel?utm_source=mattstauffer.co">Creating a password-less, Medium-style, email-only authentication system in Laravel - Tighten.co Blog</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-merge-only-specific-commits-from-a-pull-request</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-merge-only-specific-commits-from-a-pull-request"/>
        <title>How to merge only specific commits from a pull request</title>
        <published>2016-03-07T00:00:00+00:00</published>
        <updated>2016-03-07T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Tonight I was looking at pull requests to all of m...</summary>
        <content type="html"><![CDATA[
        <p>Tonight I was looking at pull requests to all of my open source repositories, and there was a pull request that had started out great and then been ruined by someone offering bad advice to the original pull request-er. I later came back and asked, &quot;Could you re-PR this with just the initial commits?&quot; But by that point they had been driven off.</p>
<p>I thought it was hopeless, and just started pulling the code into a new branch. I could get it to work without any trouble but it wouldn't give attribution to the original author, which I was hoping for. And then I stopped and thought, why not Google around a bit?</p>
<p>A few Stack Overflow answers and a bit of digging later and I found my answer: <code>git cherry-pick</code>.</p>
<h2>How to use <code>git cherry-pick</code></h2>
<p>Turns out you can, indeed, &quot;cherry-pick&quot; just the commits you want from that pull request. Steps:</p>
<ol>
<li>Pull down the branch locally. Use your git GUI or pull it down on the command line, whatever you'd like.</li>
<li>Get back into the branch you're merging <em>into</em>. You'll likely do this by running <code>git checkout master</code>.</li>
<li>&quot;Cherry pick&quot; the commits you want into this branch. Go to either the git log or the GitHub UI and grab the unique commit hashes for each of the commits that you want, and then run this command: <code>git cherry-pick super-long-hash-here</code>. That will pull just this commit into your current branch.</li>
<li>Push up this branch like normal. <code>git push origin master</code></li>
</ol>
<h2>An example</h2>
<p>So, I had a pull request introducing the <code>log</code> component. I went to the pull request in GitHub and pulled the branch down (using the &quot;use the command line&quot; directions, but I could've also pulled down with the GitHub UI.)</p>
<p>On the command line, I then ran <code>git checkout master</code>. I went to the GitHub UI, found the commit I wanted, and grabbed its commit hash by clicking the little &quot;copy&quot; icon next to it in the commit list. Then I ran <code>git cherry-pick long-hash-here-pasted-from-github</code>.</p>
<p>Finally, I pushed it up to GitHub with <code>git push origin master</code>. Done! Finally, I closed the pull request manually with a link to the commit.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/strict-mode-and-other-mysql-customizations-in-laravel-5-2</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/strict-mode-and-other-mysql-customizations-in-laravel-5-2"/>
        <title>&quot;Strict&quot; mode and other MySQL customizations in Laravel 5.2</title>
        <published>2016-02-26T00:00:00+00:00</published>
        <updated>2016-02-26T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you remember my post How To Disable MySQL Stric...</summary>
        <content type="html"><![CDATA[
        <p>If you remember my post <a href="https://mattstauffer.co/blog/how-to-disable-mysql-strict-mode-on-laravel-forge-ubuntu">How To Disable MySQL Strict Mode on Laravel Forge (Ubuntu)</a>, you'll remember that MySQL 5.7 introduced something we've been casually calling &quot;strict mode,&quot; which is really a combination of new modes that, in sum, make MySQL process your queries a little more strictly than before.</p>
<p>In my previous post I showed how to disable it on Ubuntu, but since then, <a href="https://github.com/laravel/framework/pull/12030">Adam Wathan has added a feature to Laravel</a> that allows you to define whether you're using &quot;strict&quot; mode and also allows you to customize exactly which modes you'd like enabled--all in code.</p>
<p>If I can set a configuration option in code instead of on a server without suffering a performance hit, I'll always prefer it--it's one less thing I have to do every time I deploy to a new server. So, I'm totally glad for this new feature.</p>
<blockquote>
<p>It's worth noting that you can use this feature not just to disable strict mode on 5.7; you can also enable it on 5.6. It might be wise to enable it on any app running on 5.6 so that you can prepare for 5.7, seeing if anything breaks when you turn on some of the stricter modes. </p>
</blockquote>
<h2>MySQL 5.7 and &quot;strict&quot; mode</h2>
<p>Before we talk about the feature, let's quickly cover what &quot;strict mode&quot; means.</p>
<p>MySQL has &quot;modes&quot;, each of which enable or disable a certain behavior. For example, <code>ERROR_FOR_DIVISION_BY_ZERO</code> is a mode that, you guessed it, throws an error when you divide by zero in a SQL division operation. Without this mode enabled, you'll just get a <code>NULL</code> result silently.</p>
<p>&quot;Strict mode,&quot; which is really just the list of modes 5.7 enables by default, is comprised of the following modes:</p>
<pre><code>ONLY_FULL_GROUP_BY
STRICT_TRANS_TABLES
NO_ZERO_IN_DATE
NO_ZERO_DATE
ERROR_FOR_DIVISION_BY_ZERO
NO_AUTO_CREATE_USER
NO_ENGINE_SUBSTITUTION</code></pre>
<p>You can learn more about these modes at the <a href="http://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_allow_invalid_dates">MySQL documentation</a>.</p>
<p>Prior to 5.7, the only mode that was enabled was <code>NO_ENGINE_SUBSTITUTION</code>.</p>
<h2>Enabling and disabling strict mode in Laravel 5.2</h2>
<p>With this new feature, Laravel now has the ability to do three things: Disable &quot;strict&quot; mode, returning to the &lt;= 5.6 behavior; enable &quot;strict&quot; mode, setting it to the 5.7 behavior; or customizing exactly which modes are enabled.</p>
<p>These settings live in <code>config/database.php</code> in the <code>connections.mysql</code> section. For starters, let's look into enabling and disabling &quot;strict&quot; mode:</p>
<pre><code class="language-php">    'connections' =&gt; [
        'mysql' =&gt; [
            // Behave like MySQL 5.6
            'strict' =&gt; false,

            // Behave like MySQL 5.7
            'strict' =&gt; true,
        ]
    ]</code></pre>
<h2>Customizing which modes are enabled</h2>
<p>But what if you're not satisfied with either 5.6's or 5.7's mode defaults? Just customize them yourself.</p>
<pre><code class="language-php">    'connections' =&gt; [
        'mysql' =&gt; [
            // Ignore this key and rely on the strict key
            'modes' =&gt; null,

            // Explicitly disable all modes, overriding strict setting
            'modes' =&gt; [],

            // Explicitly enable specific modes, overriding strict setting
            'modes' =&gt; [
                'STRICT_TRANS_TABLES',
                'ONLY_FULL_GROUP_BY',
            ],
        ]
    ]</code></pre>
<h2>That's all, folks</h2>
<p>You now have the ability to take total control over which modes are enabled on your app's MySQL server, in code, without touching a line of server configuration. Just like that.</p>
<p>By default, I'd recommend leaving them all on. But there may be occasions with particular use cases or old projects where you need to customize this list, and it's now possible--and even simple.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/all-my-projects-asking-for-open-source-help</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/all-my-projects-asking-for-open-source-help"/>
        <title>All My Projects: Asking for Open-Source Help</title>
        <published>2016-02-11T00:00:00+00:00</published>
        <updated>2016-02-11T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you listen to my podcast or follow me on Twitte...</summary>
        <content type="html"><![CDATA[
        <p>If you listen to my podcast or follow me on Twitter, you probably already know that my life has gotten a little bit busier than usual as I work to finish my <a href="http://laravelupandrunning.com/">book</a>. As a part of that, I've switched to podcasting on the <a href="http://fiveminutegeekshow.com/">Five-Minute Geek Show</a> only once a week instead of twice.</p>
<p>I have, however, started a new, simpler podcast that only takes a few minutes to post: <a href="http://threeminutegeekshow.com/">The Three-Minute Geek Show</a>, powered by <a href="http://briefs.fm/">Briefs.fm</a>. Each episode is less than three minutes and takes me about three minutes to post, so it's been easier to get content up there.</p>
<p>But as a part of this busy-ness, I'm interested in telling people more about the side projects that occupy my time. Maybe, in a time where I have even less time than usual to devote to my side projects, I could reach out to the community around me for help.</p>
<p>So, here's a quick rundown a few active projects I maintain. If you have time, I'd love for you to consider contributing to them!</p>
<blockquote>
<p>Note: Many of these projects don't have good documentation of how to contribute or what even needs doing. I need as much help there as I do with actual feature contributions!</p>
</blockquote>
<h3>Symposium</h3>
<p><strong><a href="https://github.com/tightenco/symposium">GitHub</a></strong><br />
Tech: Laravel<br />
Abstract, Bio, and Photo Management Tool for Conference Speakers<br />
<a href="http://threeminutegeekshow.com/10">3-minute intro to Symposium</a></p>
<h3>PulledOver</h3>
<p><strong><a href="https://github.com/mattstauffer/pulledover">GitHub</a></strong><br />
Tech: Laravel, Twilio<br />
Phone Recording Service for People Pulled Over By Police<br />
<a href="http://threeminutegeekshow.com/22">3-minute intro to PulledOver</a></p>
<h3>Suggestive</h3>
<p><strong><a href="https://github.com/mattstauffer/suggestive">GitHub</a></strong><br />
Tech: Laravel, VueJS<br />
Listener Suggestion and Voting Service for Podcasts<br />
<a href="http://threeminutegeekshow.com/14">3-minute intro to Suggestive</a></p>
<h3>Gistlog</h3>
<p><strong><a href="https://github.com/tightenco/gistlog">GitHub</a></strong><br />
Tech: Laravel<br />
Easy Blogging With Gists<br />
<a href="http://threeminutegeekshow.com/24">3-minute intro to Gistlog</a></p>
<h3>Giscus</h3>
<p><strong><a href="https://github.com/tightenco/giscus">GitHub</a></strong><br />
Tech: Laravel<br />
Comment Notifications For Your Gists<br />
<a href="http://threeminutegeekshow.com/25">3-minute intro to Giscus</a></p>
<h3>Torch</h3>
<p><strong><a href="https://github.com/mattstauffer/torch">GitHub</a></strong><br />
Tech: Laravel<br />
Use Laravel Components Outside of Laravel<br />
<a href="http://threeminutegeekshow.com/23">3-minute intro to Torch</a></p>
<h3>Confomo</h3>
<p><strong><a href="https://github.com/mattstauffer/confomo">GitHub</a></strong><br />
Tech: Laravel, Knockout (old, needs a ground-up re-write with a real API and with VueJS)<br />
Track Who You Want To Meet and Who You Met at Conferences</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/an-introduction-to-statamic-v2-beta-a-laravel-based-flat-file-cms</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/an-introduction-to-statamic-v2-beta-a-laravel-based-flat-file-cms"/>
        <title>An introduction to Statamic v2 beta, a Laravel-based flat-file CMS</title>
        <published>2016-02-09T00:00:00+00:00</published>
        <updated>2016-02-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">After many weeks of preparation, we finally launch...</summary>
        <content type="html"><![CDATA[
        <p>After many weeks of preparation, we finally launched the long-awaited Tighten blog last week. It's been such a pleasure getting to have my hands on literally every line of code that we've written here, and to collaborate together with the fine developers at Tighten on an internal project.</p>
<p>We launched the blog on the v2 beta of <a href="http://statamic.com/">Statamic</a>, a flat-filed based CMS that's built on Laravel. My first post on the blog is a writeup of how our first few weeks of working with Statamic v2 beta has been.</p>
<blockquote>
<p>Many folks who love programming in Laravel have found themselves needing to build simpler web sites, powered by data edited by backend administrative components that are similar across projects. They see the similarities between this and CMSes and therefore want to build a Laravel-based CMS.<br />
... [Statamic's developers] know how to make content management systems. They understand the constraints and structures and flows and interactions. [...] With Statamic, we have that knowledge paired with Laravel.  This is A Good Thing™.</p>
</blockquote>
<p>Interested in a Laravel-based CMS? Check out the writeup: <a href="http://blog.tighten.co/statamic-v2-beta-first-impressions-of-a-new-laravel-based-flat-file-cms?utm_source=mattstaufferco&amp;utm_medium=linkblog&amp;utm_campaign=mattstauffercolinkblog">Statamic v2 Beta: First Impressions of a new Laravel-based Flat-file CMS</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/multiple-authentication-guard-drivers-including-api-in-laravel-5-2</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/multiple-authentication-guard-drivers-including-api-in-laravel-5-2"/>
        <title>Multiple authentication guard drivers (including API) in Laravel 5.2</title>
        <published>2016-01-22T00:00:00+00:00</published>
        <updated>2016-01-22T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Let&#039;s get back to Laravel 5.2 features, shall we? ...</summary>
        <content type="html"><![CDATA[
        <p>Let's get back to Laravel 5.2 features, shall we? 5.2 introduced a significant boost to the power of the entire authentication system, including making it much simpler to have multiple &quot;guards&quot; running at once.</p>
<h2>Why should you care?</h2>
<p>The default authentication guard in Laravel prior to 5.2 (now named the <code>web</code> guard) is your traditional web-based application authentication layer: username and password post to a controller, which checks the credentials and redirects if they are invalid; if valid, the user information gets saved to the session. Not all of those pieces are absolutely necessary but that's the general mindset.</p>
<p>But what if you want to have an API running in the same app, and it uses JSON web tokens (or some other stateless, non-session authentication mechanism)? In the past you'd have to jump through a lot of hoops to have multiple authentication drivers running at the same time.</p>
<h2>Laravel 5.2's default auth guards</h2>
<p>In 5.2, not only is it simple to have multiple auth drivers running, it actually already works that way out of the box.</p>
<p>If you check <code>config/auth.php</code>, you'll see two guards set out of the box: <code>web</code>, which is the classic Laravel authentication layer, and <code>api</code>, which is a stateless (no session memory) token-based driver.</p>
<p>Both, as you can see, connect to the same &quot;provider&quot;.</p>
<blockquote>
<p>Auth providers are also customizable. They're the definition of how the system should store and retrieve information about your users. Each is defined by an instance of <code>Illuminate\Contracts\Auth\UserProvider</code>.</p>
</blockquote>
<pre><code class="language-php">    'guards' =&gt; [
        'web' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'users',
        ],

        'api' =&gt; [
            'driver' =&gt; 'token',
            'provider' =&gt; 'users',
        ],
    ],</code></pre>
<p>If you look up higher in <code>config/auth.php</code>, you can see that the default Auth guard will be &quot;web&quot;. That means any time you use Auth functions, middleware, or façades inside your application, they will default to the <code>web</code> guard unless you explicitly specify otherwise.</p>
<h2>Introducing the token auth driver</h2>
<p>So, if <code>web</code> uses the classic <code>session</code> driver, what's this new <code>token</code> driver we're seeing powering the <code>api</code> guard?</p>
<p>Jacob Bennett has written a fantastic post on that already: <a href="https://gistlog.co/JacobBennett/090369fbab0b31130b51">API Token Authentication in Laravel 5.2</a>.</p>
<p>Check out his post to learn more about how it works, but here's the short of it:</p>
<ul>
<li>Add an <code>api_token</code> column to your <code>users</code> table. 60-character string, unique.</li>
<li>Instead of using the <code>auth</code> middleware in your route definition, use the <code>auth:api</code> middleware.</li>
<li>In your API routes, use <code>Auth::guard('api')-&gt;user()</code> to get your user instead of <code>Auth::user()</code>.</li>
</ul>
<p>As you can see, we need to store an <code>api_token</code> for each user, and every incoming request that's guarded by the <code>token</code>-driven <code>api</code> guard will require a query parameter named <code>api_token</code> with a valid API token set to authenticate that user. And since it's stateless, every request will need to have this API token set; one successful request won't affect the next request.</p>
<blockquote>
<p>If you're not familiar with token-based authentication, the consuming application (e.g. an iOS application) will have gotten, and saved, the token for the authenticating user prior to this request, so it will be creating its API calls using that known token as a part of the URL. For example, an iOS app might want to get a list of its user's friends; when the user first authenticated the application with your web site/API the app received a token and stored it. Now, it will generate requests using URLs like this: <code>http://yourapp.com/api/friends?api_token=STORED_TOKEN_HERE</code></p>
</blockquote>
<h2>Using non-default drivers</h2>
<p>As you can see in the token example above, there are two primary places we're going to be using drivers other than the default: in the auth guard middleware, and when we're using convenience features like <code>Auth::check()</code> and <code>Auth::user()</code> in our code.</p>
<p>You can choose which guard you're using to protect your routes by adding a colon and the guard name after <code>auth</code> in the middleware key (e.g. <code>Route::get('whatever', ['middleware' =&gt; 'auth:api'])</code>).</p>
<p>You can choose which guard you're calling manually in your code by making <code>guard('guardname')</code> the first call of a fluent chain every time you use the Auth façade (e.g. <code>Auth::guard('api')-&gt;check()</code>).</p>
<h2>Creating your own guards and drivers</h2>
<p>Creating your own guard is simple, beause each guard is just a key (<code>web</code>, <code>api</code>) that points to a specific configuration of a driver (<code>session</code>, <code>token</code>) and a provider (<code>users</code>). They're configured, as mentioned above, in <code>config/auth.php</code>:</p>
<pre><code class="language-php">    'guards' =&gt; [
        'web' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'users',
        ],

        'api' =&gt; [
            'driver' =&gt; 'token',
            'provider' =&gt; 'users',
        ],
        'matts-fancy-api-guard' =&gt; [
            'driver' =&gt; 'token',
            'provider' =&gt; 'users',
        ],
    ],</code></pre>
<p>But as you can tell, that doesn't really do much unless you're changing the driver or the provider.</p>
<p>Creating your own driver is not quite as simple as creating your own guard. The docs have a spot about <a href="https://laravel.com/docs/5.2/authentication#adding-custom-guards">Creating your own auth driver</a>, and you're essentially going to be creating your own implementation of <code>Illuminate\Contracts\Auth\Guard</code> and then registering it as a driver in a service provider somewhere.</p>
<p>The docs also cover <a href="https://laravel.com/docs/5.2/authentication#adding-custom-user-providers">how to create your own user provider</a>.</p>
<h2>Concludinal</h2>
<p>That's it. Enjoy.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/the-auth-scaffold-in-laravel-5-2</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/the-auth-scaffold-in-laravel-5-2"/>
        <title>The auth scaffold in Laravel 5.2</title>
        <published>2016-01-08T00:00:00+00:00</published>
        <updated>2016-01-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;re like me, many of the applications you bu...</summary>
        <content type="html"><![CDATA[
        <p>If you're like me, many of the applications you build in Laravel have a similar Saas-type framework: user signup, user login, password reset, public sales page, logged-in dashboard, logout route, and a base Bootstrap style for when you're just getting started.</p>
<p>Laravel used to have a scaffold for this out of the box. It disappeared recently, to my great chagrin, but it's now back as an Artisan command: <code>make:auth</code>.</p>
<p><img src="/assets/images/content/auth-scaffold-command-line.png" alt="Command line output of artisan make:auth" /></p>
<p>What does it provide? Let's dig in.</p>
<h2>What changed?</h2>
<p>We have a layout (<code>resources/views/layouts/app.blade.php</code>) that is the core of this scaffold, and then a series of views that extend it:</p>
<ul>
<li><strong>welcome.blade.php</strong> - the public welcome page</li>
<li><strong>home.blade.php</strong> - the dashboard for logged-in users</li>
<li><strong>auth/login.blade.php</strong> - the login page</li>
<li><strong>auth/register.blade.php</strong> - the register/signup page</li>
<li><strong>auth/passwords/email.blade.php</strong> - the password reset confirmation page</li>
<li><strong>auth/passwords/reset.blade.php</strong> - the password reset prompt page</li>
<li><strong>auth/emails/password.blade.php</strong> - the password reset email</li>
</ul>
<p>Our public page is still routed via <code>routes.php</code>:</p>
<pre><code class="language-php">Route::get('/', function () {
    return view('welcome');
});</code></pre>
<p>And we now have a <code>HomeController</code>, which routes our dashboard:</p>
<pre><code class="language-php">class HomeController extends Controller
{
    /**
     * Show the application dashboard.
     *
     * @return Response
     */
    public function index()
    {
        return view('home');
    }
}</code></pre>
<p>This is of course routed in <code>routes.php</code> in the <code>web</code> group. And notice that there's something else new there: The <code>Route::auth()</code> method:</p>
<pre><code class="language-php">Route::group(['middleware' =&gt; 'web'], function () {
    Route::auth();

    Route::get('/home', 'HomeController@index');
});</code></pre>
<h3>Route::auth()</h3>
<p>The <code>auth()</code> method is a shortcut to defining the following routes:</p>
<pre><code class="language-php">// Authentication Routes...
$this-&gt;get('login', 'Auth\AuthController@showLoginForm');
$this-&gt;post('login', 'Auth\AuthController@login');
$this-&gt;get('logout', 'Auth\AuthController@logout');

// Registration Routes...
$this-&gt;get('register', 'Auth\AuthController@showRegistrationForm');
$this-&gt;post('register', 'Auth\AuthController@register');

// Password Reset Routes...
$this-&gt;get('password/reset/{token?}', 'Auth\PasswordController@showResetForm');
$this-&gt;post('password/email', 'Auth\PasswordController@sendResetLinkEmail');
$this-&gt;post('password/reset', 'Auth\PasswordController@reset');</code></pre>
<h2>The frontend</h2>
<p>Now let's take a look at what we get in the browser:</p>
<p><img src="/assets/images/content/scaffold-preview.png" alt="Screenshot of the output from a default auth scaffold view" /></p>
<p>As you can see we have Bootstrap CSS, a basic Bootstrap app layout, and helpful to our basic auth actions.</p>
<h3>App.blade.php</h3>
<p>So what does this master layout look like?</p>
<p>We get <a href="https://fortawesome.github.io/Font-Awesome/">FontAwesome</a>, the <a href="https://www.google.com/fonts/specimen/Lato">Lato</a> font, <a href="http://getbootstrap.com/">Bootstrap CSS</a>, a basic hamburger-on-mobile responsive layout, jQuery, Bootstrap JS, and placeholders that are commented out for the default output CSS and JS files if you choose to use <a href="https://laravel.com/docs/elixir">Elixir</a>.</p>
<p>We also have a top nav that links us home, and links guests to either login or register, and links authenticated users to log out.</p>
<h2>Conclusion</h2>
<p>That's it! It's not anything complex, but it's 30-60 minutes of typing that you just saved on every app that needs it.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-disable-mysql-strict-mode-on-laravel-forge-ubuntu</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-disable-mysql-strict-mode-on-laravel-forge-ubuntu"/>
        <title>How to disable MySQL strict mode on Laravel Forge (Ubuntu)</title>
        <published>2016-01-05T00:00:00+00:00</published>
        <updated>2016-01-05T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">MySQL has had a strict mode since 5.1, but in 5.7 ...</summary>
        <content type="html"><![CDATA[
        <p>MySQL has had a <a href="http://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_strict_trans_tables">strict mode</a> since 5.1, but in 5.7 it became the default. If you've spun up a server recently and all of a sudden your apps have broken, this may be the source.</p>
<p>In Laravel, you can fix this in code: edit your <code>database.php</code> config file, and add a key of <code>strict</code> with a value of <code>false</code>. But if you're using a non-Laravel application (we've run into this with both CodeIgniter and CraftCMS applications), you won't have that option. Here's how to disable strict mode globally on any Laravel Forge server (and any other Ubuntu server).</p>
<blockquote>
<p>Note: I'm not advocating for disabling strict mode. These new modes provide speed and consistency benefits that are worth keeping them enabled. I want to give you the options in case you need them, but my recommendation is to keep them enabled and to learn how to work with them.</p>
</blockquote>
<h2>Your configuration file</h2>
<p>MySQL actually looks <a href="https://dev.mysql.com/doc/refman/5.1/en/option-files.html">five different places</a> for configuration files, so you can make the change I'm about to recommend several places. It'll look in <code>/etc/my.cnf</code>, <code>/etc/mysql/my.cnf</code>, <code>SYSCONFDIR/my.cnf</code>, <code>$MYSQL_HOME/my.cnf</code>, and <code>~/my.cnf</code>. <code>~/.my.cnf</code> is user-specific, and the third and fourth options rely on specifics from your environment. So let's stick with one of the first two.</p>
<p>On a default Laravel Forge box, the default MySQL configuration will live in <code>/etc/mysql/my.cnf</code>, so let's put our changes there. SSH into your server and use Vim or Pico to edit that file.</p>
<h2>Your lines</h2>
<p>If you scroll down the file a bit, you'll find the <code>[mysqld]</code> section. We're going to add a new key, <code>sql_mode</code>. On MySQL 5.7, the default values for this key out of the box are: </p>
<pre><code>STRICT_TRANS_TABLES,ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code></pre>
<p>The strict mode comes from <code>STRICT_TRANS_TABLES</code>. So, let's overwrite the <code>sql_mode</code> and set it to be the same as the default, but <em>without</em> strict mode.</p>
<pre><code>[mysqld]
sql_mode=ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code></pre>
<p>That's it! Save the file, and restart MySQL. From the command line that would be <code>sudo /etc/init.d/mysql restart</code>, or from the Laravel Forge interface, open the server, click the <em>Restart Services</em> icon at the bottom, and choose <em>Restart MySQL</em>.</p>
<blockquote>
<p>Note: If you're using CraftCMS or certain versions of Laravel, you'll likely also want to disable the &quot;ONLY_FULL_GROUP_BY&quot; option.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/middleware-groups-in-laravel-5-2</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/middleware-groups-in-laravel-5-2"/>
        <title>Middleware groups in Laravel 5.2</title>
        <published>2015-12-22T00:00:00+00:00</published>
        <updated>2015-12-22T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">When you are creating a site of any significant si...</summary>
        <content type="html"><![CDATA[
        <p>When you are creating a site of any significant size in Laravel, your routes file will often get pretty large. One of the first things I do in a new site is group my routes by logically distinct sections like &quot;admin&quot;, &quot;auth&quot;, &quot;public&quot;. Usually each of these groups get their own set of middleware&mdash;admin, for example, gets <code>auth</code>. Maybe the API group gets a different <code>auth</code> middleware, and it might get an API-specific rate limiter or something else.</p>
<p>Laravel 5.2 has introduced something called middleware groups, which are essentially a shortcut to applying a larger group of middleware, using a single key.</p>
<blockquote>
<p>Note: Even if you don't want to use the middleware &quot;shortcuts&quot; aspect of middleware groups, you should read on, because this is a big change to Laravel's global middleware stack.</p>
</blockquote>
<p>So remember my admin example above? We can now create an &quot;admin&quot; middleware group. Let's learn how.</p>
<h2>Defining middleware groups</h2>
<p>You can define middleware groups in <code>app\Http\Kernel.php</code>. There's a new property named <code>$middlewareGroups</code> that's an array; each key is a name and each value is the corresponding middleware.</p>
<p>Out of the box, it comes with <code>web</code> and <code>api</code>:</p>
<pre><code class="language-php">protected $middlewareGroups = [
    'web' =&gt; [
        \App\Http\Middleware\EncryptCookies::class,
        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \Illuminate\View\Middleware\ShareErrorsFromSession::class,
        \App\Http\Middleware\VerifyCsrfToken::class,
    ],

    'api' =&gt; [
        'throttle:60,1',
    ],
];</code></pre>
<p>As you can see, the keys can reference either a class or a route-specific middleware shortcut like <code>throttle</code> or <code>auth</code>. Let's make an <code>admin</code> group:</p>
<pre><code class="language-php">protected $middlewareGroups = [
    'web' =&gt; [...],
    'api' =&gt; [...],
    'admin' =&gt; [
        'web',
        'auth',
    ]
];</code></pre>
<p>We've defined that the <code>admin</code> is a group that uses <code>web</code> (another group) and <code>auth</code> (a named route middleware). That's it!</p>
<h3>Changes from 5.1</h3>
<p>You might notice that the middleware in <code>web</code> are those that used to be applied to every route in Laravel 5.1 and before. That's a pretty big shift in thinking, so please take note of that: <strong>anything that's not given a <code>web</code> middleware will not have cookies or session or CSRF functional</strong>.</p>
<p>That also means we have a lot more flexibility, though: it frees us up to have more stateless API layers that aren't giving us the convenience of cookies and sessions. We can get rid of most of the universal middleware&mdash;if you take a look, the only universal middleware in 5.2 is the &quot;check for maintenance mode&quot; middleware.</p>
<p>Note as well that any APIs that rely on cookies or sessions (or CSRF) will not work if they're stuck under this <code>api</code> group, so if you have stateful APIs, you'll need to make some tweaks to this default <code>api</code> group.</p>
<h2>Using middleware groups</h2>
<p>OK, so we know how to define a middleware group. How do we use it?</p>
<p>It'll be clear when you look at the default <code>routes.php</code> in 5.2:</p>
<pre><code class="language-php">Route::get('/', function () {
    return view('welcome');
});

Route::group(['middleware' =&gt; ['web']], function () {
    //
});</code></pre>
<p>As you can see, you use it just like any route middleware like <code>auth</code>: just put the key either as the direct value of <code>middleware</code>, or in an array that's the value of <code>middleware</code>. So, here's our <code>admin</code> middleware group in use:</p>
<pre><code class="language-php">Route::group(['middleware' =&gt; 'admin'], function () {
    Route::get('dashboard', function () {
        return view('dashboard');
    });
});</code></pre>
<p>That's it! Enjoy!</p>
<blockquote>
<p>Note: Later in Laravel 5.2, all routes in <code>routes.php</code> are now wrapped with the <code>web</code> middleware group by default. I'll try to write that up more later, but take a look at the <code>RouteServiceProvider</code> to see how it's all working.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/api-rate-limiting-in-laravel-5-2</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/api-rate-limiting-in-laravel-5-2"/>
        <title>API rate limiting in Laravel 5.2</title>
        <published>2015-12-19T00:00:00+00:00</published>
        <updated>2015-12-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">More and more of my work in Laravel lately has bee...</summary>
        <content type="html"><![CDATA[
        <p>More and more of my work in Laravel lately has been creating APIs. I have a manual rate limiter class I've been using, but I've had a sense that there's a cleaner way to do it. Unsurprisingly, when Taylor set out to write a rate limiter middleware for Laravel, he did it cleaner and better than I had.</p>
<h2>Brief introduction to rate limiting</h2>
<p>If you're not familiar with it, rate limiting is a tool&mdash;most often used in APIs&mdash;that <em>limits</em> the <em>rate</em> at which any individual requester can make requests.</p>
<p>That means, for example, if some bot is hitting a particularly expensive API route a thousand times a minute, your application won't crash, because after the <em>nth</em> try, they will instead get a <code>429: Too Many Attempts.</code> response back from the server.</p>
<p>Usually a well-written application that implements rate limiting will also pass back three headers that might not be on another application: <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>, and <code>Retry-After</code> (you'll only get <code>Retry-After</code> if you've hit the limit). <code>X-RateLimit-Limit</code> tells you the max number of requests you're allowed to make within this application's time period, <code>X-RateLimit-Remaining</code> tells you how many requests you have left within this current time period, and <code>Retry-After</code> tells you how many seconds to wait until you try again. (<code>Retry-After</code> could also be a date instead of a number of seconds).</p>
<blockquote>
<p>Note: Each API chooses the time span it's rate limiting for. GitHub is per hour, Twitter is per 15-minute segment. This Laravel middleware is per minute.</p>
</blockquote>
<h2>How to use Laravel's rate-limiting middleware</h2>
<p>So, on to the new feature in Laravel 5.2. There's a new <code>throttle</code> middleware that you can use. Let's take a look at our API group:</p>
<pre><code class="language-php">Route::group(['prefix' =&gt; 'api'], function () {
    Route::get('people', function () {
        return Person::all();
    });
});</code></pre>
<p>Let's apply a throttle to it. The default throttle limits it to 60 attempts per minute, and disables their access for a single minute if they hit the limit.</p>
<pre><code class="language-php">Route::group(['prefix' =&gt; 'api', 'middleware' =&gt; 'throttle'], function () {
    Route::get('people', function () {
        return Person::all();
    });
});</code></pre>
<p>If you make a request to this <code>api/people</code> route, you'll now see the following lines in the response headers:</p>
<pre><code>HTTP/1.1 200 OK
... other headers here ...
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 59</code></pre>
<p>Remember, this response means:</p>
<p>A) This request succeeded (the status is <code>200</code>)<br />
B) You can try this route 60 times per minute<br />
C) You have 59 requests left for this minute  </p>
<p>What response would we get if we went over the rate limit?</p>
<pre><code>HTTP/1.1 429 Too Many Requests
... other headers here ...
Retry-After: 60
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 0</code></pre>
<p>And the actual content of the response would be a string: &quot;Too Many Attempts.&quot;</p>
<p>What if we tried again after 30 seconds?</p>
<pre><code>HTTP/1.1 429 Too Many Requests
... other headers here ...
Retry-After: 30
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 0</code></pre>
<p>Same response, except the <code>Retry-After</code> timer that's telling us how long to wait has ticked down by 30 seconds.</p>
<h2>Customizing the <code>throttle</code> middleware</h2>
<p>Let's do a bit of customization. We want to limit it to 5 attempts per minute.</p>
<pre><code class="language-php">Route::group(['prefix' =&gt; 'api', 'middleware' =&gt; 'throttle:5'], function () {
    Route::get('people', function () {
        return Person::all();
    });
});</code></pre>
<p>And if we want to change it so that, if someone hits the limit, they can't try again for another 10 minutes?</p>
<pre><code class="language-php">Route::group(['prefix' =&gt; 'api', 'middleware' =&gt; 'throttle:5,10'], function () {
    Route::get('people', function () {
        return Person::all();
    });
});</code></pre>
<p>That's all there is to it!</p>
<p>You can see the code that's supporting this here: <a href="https://github.com/illuminate/routing/blob/master/Middleware/ThrottleRequests.php">ThrottlesRequests.php</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/implicit-model-binding-in-laravel-5-2</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/implicit-model-binding-in-laravel-5-2"/>
        <title>Implicit route model binding in Laravel 5.2</title>
        <published>2015-12-18T00:00:00+00:00</published>
        <updated>2015-12-18T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve never used it, Laravel&#039;s route model bin...</summary>
        <content type="html"><![CDATA[
        <p>If you've never used it, Laravel's <a href="http://laravel.com/docs/5.1/routing#route-model-binding">route model binding</a> has been around for a while, but Laravel 5.2 is about to make it even easier.</p>
<h2>The basics of route model binding</h2>
<p>Let's assume that a common pattern for binding a URL route is something like this:</p>
<pre><code class="language-php">Route::get('shoes/{id}', function ($id) {
    $shoe = Shoe::findOrFail($id);
    // Do stuff
});</code></pre>
<p>This is something I do a <em>lot</em>. Wouldn't it be nice if you could drop the <code>findOrFail</code> line and just teach Laravel's router that this route represents a Shoe? You can. In your route service provider, just teach the router: <code>$router-&gt;model('shoe', 'App\Shoe');</code> That means, &quot;any time I have a route parameter named <code>shoe</code>, it's an ID representing an instance of <code>App\Shoe</code>&quot;. This allows us to re-write the above code like this:</p>
<pre><code class="language-php">Route::get('shoes/{shoe}', function ($shoe) {
    // Do stuff
});</code></pre>
<h2>Implicit route model binding</h2>
<p>In Laravel 5.2, it's even easier to use route model binding. Just typehint a parameter in the route Closure (or your controller method) and name the parameter the same thing as the route parameter, and it'll automatically treat it as a route model binding:</p>
<pre><code class="language-php">Route::get('shoes/{shoe}', function (App\Shoe $shoe) {
    // Do stuff
});</code></pre>
<p>That means you can now get the benefits of route model binding without having to define anything in the Route Service Provider. Easy!</p>
<p>That's it for implicit route model binding! Everything past this point is already around in 5.1.</p>
<h2>Little known features of route model binding</h2>
<p>These features are not new with 5.2, and therefore not specific to implicit route model binding, but they seem to be not commonly known, so I thought I would throw them in here.</p>
<h3>Custom binding logic for route model binding</h3>
<p>If you want to customize the logic a route model binding uses to look up and return an instance of your model, you can pass a Closure as the second parameter of an explicit bind instead of passing a class name:</p>
<pre><code class="language-php">$router-&gt;bind('shoe', function ($value) {
    return App\Shoe::where('slug', $value)-&gt;where('status', 'public')-&gt;first();
});</code></pre>
<h3>Custom exceptions for route model binding</h3>
<p>You can also customize the exceptions that the route model bindings throw (if they can't find an instance of that model) by passing a Closure as the third parameter:</p>
<pre><code class="language-php">$router-&gt;model('user', 'App\User', function () {
    throw new NotFoundHttpException;
});</code></pre>
<h3>Changing an Eloquent model's &quot;route key&quot;</h3>
<p>By default, Laravel assumes an Eloquent model should map to URL segments using its <code>id</code> column. But what if you expect it to <em>always</em> map to a slug, like in my shoe custom binding logic example above?</p>
<p>Eloquent implements the <code>Illuminate\Contracts\Routing\UrlRoutable</code> contract, which means every Eloquent object has a <code>getRouteKeyName()</code> method on it that defines which column should be used to look it up from a URL. By default this is set to <code>id</code>, but you can override that on any Eloquent model:</p>
<pre><code class="language-php">class Shoe extends Model 
{
    public function getRouteKeyName()
    {
        return 'slug';
    }
}</code></pre>
<p>Now, I can use explicit or implicit route model binding, and it will look up shoes where the <code>slug</code> column is equal to my URL segment. Beautiful.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/form-array-validation-in-laravel-5-2</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/form-array-validation-in-laravel-5-2"/>
        <title>Form array validation in Laravel 5.2</title>
        <published>2015-12-17T00:00:00+00:00</published>
        <updated>2015-12-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">It&#039;s time to start writing about the new features ...</summary>
        <content type="html"><![CDATA[
        <p>It's time to start writing about the new features in Laravel 5.2! You'll notice that many of these features are quicker and easier to learn and write up, so it may seem that it's a smaller release. But many of the features in 5.2 will have a big impact on the simplicity and convenience of the code we write day-to-day.</p>
<h2>A quick introduction to HTML Form arrays</h2>
<p>Form array validation simplifies the process of validating the somewhat abnormal shape of data HTML forms pass in when the array syntax is used. If you're not familiar with it, a common use case is when you allow a user to add multiple instances of the same type on one form.</p>
<p>Let's imagine you have a form where a user is adding a <strong>company</strong>, and as a part of it they can add as many <strong>employees</strong> to the company as they want. Each employee has a name and a title.</p>
<p>Here's our HTML; imagine that we have some JavaScript that creates a new &quot;employee&quot; div every time you press the &quot;Add another employee&quot; button so they user can add as many employees they want.</p>
<pre><code>&lt;form&gt;
    &lt;label&gt;Company Name&lt;/label&gt;
    &lt;input type="text" name="name"&gt;

    &lt;h3&gt;Employees&lt;/h3&gt;
    &lt;div class="add-employee"&gt;
        &lt;label&gt;Employee Name&lt;/label&gt;
        &lt;input type="text" name="employee[1][name]"&gt;
        &lt;label&gt;Employee Title&lt;/label&gt;
        &lt;input type="text" name="employee[1][title]"&gt;
    &lt;/div&gt;
    &lt;div class="add-employee"&gt;
        &lt;label&gt;Employee Name&lt;/label&gt;
        &lt;input type="text" name="employee[2][name]"&gt;
        &lt;label&gt;Employee Title&lt;/label&gt;
        &lt;input type="text" name="employee[2][title]"&gt;
    &lt;/div&gt;
    &lt;a href="#" class="js-create-new-add-employee-box"&gt;Add another employee&lt;/a&gt;

    &lt;input type="submit"&gt;
&lt;/form&gt;</code></pre>
<p>If you fill out that form and submit it, this is the shape of the <code>$_POST</code>:</p>
<pre><code>array(2) {
  ["name"]=&gt;
  string(10) "Acme, Inc."
  ["employee"]=&gt;
  array(2) {
    [1]=&gt;
    array(2) {
      ["name"]=&gt;
      string(10) "Joe Schmoe"
      ["title"]=&gt;
      string(11) "Head Person"
    }
    [2]=&gt;
    array(2) {
      ["name"]=&gt;
      string(18) "Conchita Albatross"
      ["title"]=&gt;
      string(21) "Executive Head Person"
    }
  }
}</code></pre>
<p>As you can see, we get an <code>employee</code> &quot;object&quot;. And it contains an array of the IDs that we passed in, with the key/value pairs of &quot;fieldname&quot; =&gt; &quot;user provided field value&quot;.</p>
<blockquote>
<p>Note: It used to be common to just set every instance of the &quot;employee name&quot; field, for example, to be just <code>employee[][name]</code> without setting the ID manually. <em>Don't do this.</em> It'll make every aspect of working with the code more complex.</p>
</blockquote>
<p>But how do we validate this? Prior to 5.2, it's a bunch of manual work. Now, Laravel understands this nesting structure and can validate against it uniquely.</p>
<h2>Writing form array validation rules</h2>
<p>So, how do we do it? Let's take a look at a normal validator:</p>
<pre><code class="language-php">    // CompaniesController.php
    public function store(Request $request)
    {
        $this-&gt;validate($request, [
            'name' =&gt; 'required|string'
        ]);
        // Save, etc.
    }</code></pre>
<p>And now let's add validation for our company employee fields:</p>
<pre><code class="language-php">    // CompaniesController.php
    public function store(Request $request)
    {
        $this-&gt;validate($request, [
            'name' =&gt; 'required|string',
            'employee.*.name' =&gt; 'required|string',
            'employee.*.title' =&gt; 'string',
        ]);
        // Save, etc.
    }</code></pre>
<p>Now we're validating every <code>employee[*][name]</code> and <code>employee[*][title]</code> uniquely, with pretty much no effort on our part. Beautiful.</p>
<h2>Postscript</h2>
<p>You may have noticed that the shape of the validation is <code>employee.*.name</code>, with an asterisk in the middle, which almost indicates that you could put something else there.</p>
<p>What if, instead of an asterisk to indicate &quot;all&quot;, you put a specific number there? Turns out it'll only validate the entities with that ID. So if you put <code>employee.1.name</code> in the validation array instead of <code>employee.*.name</code>, only the employee with the ID of <code>1</code> will be validated according to those rules.</p>
<p>I don't know why or when you would do it, but you could actually set completely separate validation rules for each ID:</p>
<pre><code class="language-php">    $this-&gt;validate($request, [
        'employee.1.name' =&gt; 'required|string',
        'employee.2.name' =&gt; 'integer', // Not sure *why* you would do this, but, it's possible
    ]);</code></pre>
<p>That's it. Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/case-insensitive-orderby-filter-with-vuejs</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/case-insensitive-orderby-filter-with-vuejs"/>
        <title>Writing a case-insensitive orderBy filter with VueJS</title>
        <published>2015-12-16T00:00:00+00:00</published>
        <updated>2015-12-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">There&#039;s a cool new open source project called koel...</summary>
        <content type="html"><![CDATA[
        <p>There's a cool new open source project called <a href="https://github.com/phanan/koel">koel</a> that came out this week. It's a music player (a Spotify clone) that serves your own music and runs on Laravel and VueJS. I figured I'd try it out and see if I could send in any pull requests to help out.</p>
<p>One thing I noticed was that when I sorted by artist (or anything else), any items that start with a lowercase letter were sorted after all the items that started with an uppercase letter. I took a look to see what was happening, and it seems that VueJS' <a href="http://vuejs.org/api/#orderBy">orderBy</a> function is case sensitive by default, which mean uppercase letters get sorted first, and then lowercase. I Googled around and found a <a href="https://github.com/vuejs/Discussion/issues/197">closed GitHub issue</a> that indicated that this was the intended behavior for <code>orderBy</code>, so I set out to write a case-insensitive orderBy filter.</p>
<h2>Finding Vue's native <code>orderBy</code></h2>
<p>First, I knew that I wanted to mimic Vue's native <code>orderBy</code> function as closely as possible. So, I needed to hunt it down. There are various ways to do that&mdash;grep, your IDE, whatever else&mdash;but eventually we land on <a href="https://github.com/vuejs/vue/blob/9dc0d7d87f1dc2eac731eb8bd2f923bd3a53d353/src/filters/array-filters.js#L67-L90">vuejs/vue/src/filters/array-filters.js</a>.</p>
<pre><code class="language-javascript">/**
 * Filter filter for arrays
 *
 * @param {String} sortKey
 * @param {String} reverse
 */

export function orderBy (arr, sortKey, reverse) {
  arr = convertArray(arr)
  if (!sortKey) {
    return arr
  }
  var order = (reverse &amp;&amp; reverse &lt; 0) ? -1 : 1
  // sort on a copy to avoid mutating original array
  return arr.slice().sort(function (a, b) {
    if (sortKey !== '$key') {
      if (isObject(a) &amp;&amp; '$value' in a) a = a.$value
      if (isObject(b) &amp;&amp; '$value' in b) b = b.$value
    }
    a = isObject(a) ? getPath(a, sortKey) : a
    b = isObject(b) ? getPath(b, sortKey) : b
    return a === b ? 0 : a &gt; b ? order : -order
  })
}</code></pre>
<p>What's this doing? At its core, it's duplicating the array and sorting it by pulling out the values of the provided key and comparing it.</p>
<p>You may have noticed that we have a few non-native functions in use: <code>convertArray</code>, <code>isObject</code>, and <code>getPath</code>.</p>
<h2>How to add a custom filter</h2>
<p>So, we know the structure of our new filter. Where do we put it?</p>
<p>Vue makes it simple to add a <a href="http://vuejs.org/guide/custom-filter.html">custom filter</a>. Here's the structure, which you can place in whatever file you're using to do your core Vue bindings:</p>
<pre><code class="language-javascript">Vue.filter('reverse', function (value) {
    return value.split('').reverse().join('');
});</code></pre>
<p>Let's try an example where we do something to an array. Notice we want to duplicate the array with <code>.slice()</code> so we're not manipulating the original array.</p>
<pre><code class="language-javascript">Vue.filter('uppercaseArray', function (array) {
    return array.map(function (item) {
        return item.toUppercase();
    });
});</code></pre>
<p>We mapped over each item in the duplicated array, assumed it was a string, uppercased it, and then returned the mapped array. That means we can now, anywhere in our app, use this filter:</p>
<pre><code class="language-javascript">&lt;tr v-for="item in items | uppercaseArray"&gt; ... etc.</code></pre>
<blockquote>
<p>Note: In this example, we didn't use <code>slice()</code> before operating on the array. Why? Because, as wonderful folks pointed out to me on Twitter, <code>map()</code> in JavaScript already creates a duplicate, so you don't need <code>slice()</code> like you do with <code>sort()</code>.</p>
</blockquote>
<h2>Porting and updating orderBy</h2>
<p>Great. Now, let's write our own. Let's take orderBy and add a few lines to make it case insensitive.</p>
<pre><code class="language-javascript">Vue.filter('caseInsensitiveOrderBy', function (arr, sortKey, reverse) {
  arr = convertArray(arr)
  if (!sortKey) {
    return arr
  }
  var order = (reverse &amp;&amp; reverse &lt; 0) ? -1 : 1
  // sort on a copy to avoid mutating original array
  return arr.slice().sort(function (a, b) {
    if (sortKey !== '$key') {
      if (isObject(a) &amp;&amp; '$value' in a) a = a.$value
      if (isObject(b) &amp;&amp; '$value' in b) b = b.$value
    }
    a = isObject(a) ? getPath(a, sortKey) : a
    b = isObject(b) ? getPath(b, sortKey) : b

    // Our new lines
    a = a.toLowerCase()
    b = b.toLowerCase()

    return a === b ? 0 : a &gt; b ? order : -order
  })
});</code></pre>
<p>As you can see, I just added the lower-casing at the end, nothing else. What happens?</p>
<p>ERROR. <strong>Uncaught ReferenceError: convertArray is not defined.</strong> Well, crap.</p>
<p>Turns out all those custom functions aren't just sitting around for you&mdash;you have to find where they're available. I was able to find all of them except <code>convertArray</code> (I found it but I think it may be an entirely private method) so let's update it with the place Vue exposes each (<code>getPath</code> I found with Evan's help on GitHub, and <code>isObject</code> I found by trial and error).</p>
<pre><code class="language-javascript">Vue.filter('caseInsensitiveOrderBy', function (arr, sortKey, reverse) {
  // arr = convertArray(arr)
  if (!sortKey) {
    return arr
  }
  var order = (reverse &amp;&amp; reverse &lt; 0) ? -1 : 1
  // sort on a copy to avoid mutating original array
  return arr.slice().sort(function (a, b) {
    if (sortKey !== '$key') {
      if (Vue.util.isObject(a) &amp;&amp; '$value' in a) a = a.$value
      if (Vue.util.isObject(b) &amp;&amp; '$value' in b) b = b.$value
    }
    a = Vue.util.isObject(a) ? Vue.parsers.path.getPath(a, sortKey) : a
    b = Vue.util.isObject(b) ? Vue.parsers.path.getPath(b, sortKey) : b

    a = a.toLowerCase()
    b = b.toLowerCase()

    return a === b ? 0 : a &gt; b ? order : -order
  })
});</code></pre>
<p>As you can see, some of those core Vue methods are exposed via objects like <code>Vue.util</code> and <code>Vue.parsers</code>.</p>
<p>Now, let's just take a look at <code>convertArray</code> to see if we care. Turns out it's an alias for <code>_postProcess</code>:</p>
<pre><code class="language-javascript">_postProcess: function _postProcess(value) {
  if (isArray(value)) {
    return value;
  }
  ... etc
}</code></pre>
<p>Well, check it out! This isn't perfect, but if we're passing in an array, we just get the array back. So, while I'll still keep looking at how to bring in <code>convertArray</code> properly, we can drop it safely for any use of this new function that is, indeed, getting an array passed in.</p>
<p>And that's it. We now have a functional <code>caseInsensitiveOrderBy</code> filter.</p>
<pre><code class="language-javascript">&lt;tr v-for="item in items | caseInsensitiveOrderBy title"&gt; ... etc.</code></pre>
<p>Good. To. Go.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/live-coding-as-i-learn-vue-js</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/live-coding-as-i-learn-vue-js"/>
        <title>Live coding as I learn Vue.js</title>
        <published>2015-12-01T00:00:00+00:00</published>
        <updated>2015-12-01T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Most tutorials come from a place of perfection. Yo...</summary>
        <content type="html"><![CDATA[
        <p>Most tutorials come from a place of perfection. You already know what you're doing, you write a script, and you teach it as if you've always known exactly how to do it. I think these are really valuable, and without tools like <a href="http://laracasts.com/">Laracasts</a> (which are admittedly a little less polished and a little more <em>real</em> than many tutorials), the web development world would be a much sadder place.</p>
<p>But I also think there's a place for people to live code as they go, both as experts and also as learners. That's why I recorded and released <a href="https://www.youtube.com/watch?v=g4BbeHYCR1E">Rapid Application Development - From Idea to Prototype in 1:45 with Laravel</a> in February. </p>
<h2>Learning Vue out loud</h2>
<p>Now, I'm taking it a step further. I have no experience with <a href="http://vuejs.org/">Vue.js</a> but I want to learn it. So I'm taking every chance I get to live-code on <a href="http://twitch.tv/mattstauffer">Twitch (I'm mattstauffer)</a> as I'm learning Vue.</p>
<p>That means every time I'm writing code, I'm trying to accomplish a task that I don't know how to accomplish. It means doing things wrong, fumbling, and lots of confusion and typos and Googling. I'm hoping that me &quot;learning out loud&quot; will help others learn along with me.</p>
<p>If you can't join live on Twitch, I'm exporting all the videos to a YouTube playlist, which I've embedded below. <a href="https://www.youtube.com/channel/UChByJR-sX8CooIAc5nkV7Mg">Subscribe to my channel</a> or just bookmark this page to be kept up.</p>
<p>(Note that, to see all the videos in the playlist below, you need to click the little hamburger icon at the upper left hand corner of the embed).</p>
<div class="video-container">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/videoseries?list=PLgJIx0-UaB9Qe1O7NDCF8raGyPMPM7cj_&showinfo=1" frameborder="0" allowfullscreen></iframe>
</div>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/taking-control-of-your-javascript-objects-with-the-revealing-module-pattern
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/taking-control-of-your-javascript-objects-with-the-revealing-module-pattern"/>
        <title>Taking Control of Your JavaScript Objects With the Revealing Module Pattern</title>
        <published>2015-11-06T00:00:00+00:00</published>
        <updated>2015-11-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">On the latest episode of the Laravel Podcast, I Lo...</summary>
        <content type="html"><![CDATA[
        <p>On the latest episode of the Laravel Podcast, <a href="http://www.laravelpodcast.com/episodes/19454-episode-37-i-love-the-things-you-are-saying">I Love the Things You Are Saying</a>, we were talking about VueJS, and Taylor mentioned that sometimes it's annoying to have long objects that you pass around in JavaScript frameworks. You know the ones: you're defining a series of parameters and methods and you have to cram them all into a comma separated list so they are set as properties on an object:</p>
<pre><code class="language-javascript">Vue.doSomethingOrOther({
    onething: function () {

    },
    otherThing: function () {

    },
    etcetera: 'etcetera'
});</code></pre>
<p>On the podcast I mentioned my undying love for the <strong>Revealing Module Pattern</strong> and promised an example, so here goes.</p>
<h2>Why do we Need The Revealing Module Pattern?</h2>
<p>I first learned about the Revealing Module Pattern through Addy Osmani's book <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#revealingmodulepatternjavascript">Learning JavaScript Design Patterns</a>.</p>
<p>Let's take a quick example to show why Revealing Module is great. Let's presume we want an <code>Analytics</code> object. We want to be able to use it throughout our JavaScript to make calls to Google Analytics, but we want a simpler syntax.</p>
<pre><code class="language-javascript">var Analytics = {};</code></pre>
<p>Let's give it two methods, <code>pageView</code> and <code>action</code>.</p>
<pre><code class="language-javascript">var Analytics = {
    pageView: function () {
        GoogleAnalytics.prepSomethingOrOther();
        GoogleAnalytics.pushOrSomething('pageView');
    },
    action: function (key) {
        GoogleAnalytics.prepSomethingOrOther();
        GoogleAnalytics.pushOrSomething('action', key);
    }
};</code></pre>
<p>Well, take a look at that&mdash;it's a bit of repeated code! If only we could have private methods, we could extract some sort of `pushOrSomething' method:</p>
<pre><code class="language-javascript">var Analytics = {
    pushOrSomething: function () {
        GoogleAnalytics.prepSomethingOrOther();
        // Use function.apply to pass the called parameters along
        GoogleAnalytics.pushOrSomething.apply(this, arguments);
    },
    pageView: function () {
        this.pushOrSomething('pageView');
    },
    action: function (key) {
        this.pushOrSomething('action', key);
    }
};</code></pre>
<p>This looks good, but our big problem here is that we've now exposed <code>Analytics.pushOrSomething()</code> to the public. Additionally, we haven't hit it quite yet, but when we start building this object out, we'll run into Taylor's pain point of the constantly-growing comma-separated list.</p>
<h2>The Self-Executing Anonymous Function</h2>
<p>The Revealing Module Pattern relies on a concept call the Self-Executing Anonymous Function. Let's take a look, first, at an anonymous function:</p>
<pre><code class="language-javascript">var AnalyticsGenerator = function() {
    return {};
};

var Analytics = AnalyticsGenerator();</code></pre>
<p>Great, so we have an un-named function that returns something IF we run it. But that's an awkward syntax, especially if we only expect to run this once. If only we could call the function as soon as we define it...</p>
<pre><code class="language-javascript">var Analytics = (function() {
    return {};
})();</code></pre>
<p>By George, we've done it! We just wrapped the function in parentheses, and then added a second set of parentheses afterwards to indicate it should be executed. Now <code>Analytics</code> is defined as the <em>result</em> of this function's execution, which in this case is just an empty object.</p>
<h2>The Revealing Module Pattern</h2>
<p>Finally. The pattern. Check out our previous example, but now Revealing-Moduled:</p>
<pre><code class="language-javascript">var Analytics = (function () {

    var _pushOrSomething = function () {
        GoogleAnalytics.prepSomethingOrOther();
        // Use function.apply to pass the called parameters along
        GoogleAnalytics.pushOrSomething.apply(this, arguments);
    };

    var pageView = function () {
        _pushOrSomething('pageView');
    };

    var action = function (key) {
        _pushOrSomething('action', key);
    };

    return {
        pageView: pageView,
        action: action
    };
})();</code></pre>
<p>Notice that we've updated the calls within <code>pageView</code> and <code>action</code> to reference the function name without <em>this</em>, and we've prefaced the &quot;private&quot; function <code>pushOrSomething</code> with an underscore, just as a reminder to keep it private.</p>
<p>At the end, we've defined what we want to return, and anything that's not in that return object is &quot;private&quot; and can't be called by the public. This also works for properties, and you can even do all sorts of procedural work, if you want:</p>
<pre><code class="language-javascript">var Analytics = (function () {
    var variableOrWhatever = 42;
    variableOrWhatever *= 1.0;

    var _pushOrSomething = function () {
        GoogleAnalytics.initialize(variableOrWhatever);
        GoogleAnalytics.somethingOrOther();
        // Use function.apply to pass the called parameters along
        GoogleAnalytics.pushOrSomething.apply(this, arguments);
    };

    var pageView = function () {
        _pushOrSomething('pageView');
    };

    var action = function (key) {
        _pushOrSomething('action', key);
    };

    return {
        variableOrWhatever: variableOrWhatever,
        pageView: pageView,
        action: action
    };
})();</code></pre>
<p>If you want to see this running, and see what happens when you try to call a &quot;private&quot; method, check out <a href="https://jsbin.com/zekadutaqi/1/edit?js,console">this JSBin</a>. Or, just try the code above and see what happens when you run <code>Analytics._pushOrSomething</code> (hint: your browser won't like it).</p>
<p>The sky's the limit, kids. Now <em>anywhere</em> you need to generate a JavaScript object you have much more freedom to quickly create private methods and run procedural nasty prep code in the midst of creating it.</p>
<h2>ES6 Addendum</h2>
<p>A lot of the reason we need this sort of stuff is because JavaScript is based on Prototypes, not Classes &amp; Objects. That's slowly been changing over time, and ES6 has made a huge difference in this aspect. So if you're writing ES6, you'll find <em>less</em> use for this pattern&mdash;but I'd still suggest keeping it in your toolbelt.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/environment-specific-variables-in-laravels-testing-environment</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/environment-specific-variables-in-laravels-testing-environment"/>
        <title>Environment specific variables in Laravel&#039;s testing environment</title>
        <published>2015-11-04T00:00:00+00:00</published>
        <updated>2015-11-04T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In Laravel, it&#039;s easy to set environment variables...</summary>
        <content type="html"><![CDATA[
        <p>In Laravel, it's easy to set environment variables that are specific to your testing environment. Just edit your <code>phpunit.xml</code> file and set them as entries in the <code>&lt;php&gt;</code> block:</p>
<pre><code class="language-xml">    &lt;php&gt;
        &lt;env name="APP_ENV" value="testing"/&gt;
        &lt;env name="CACHE_DRIVER" value="array"/&gt;
        &lt;env name="SESSION_DRIVER" value="array"/&gt;
        &lt;env name="QUEUE_DRIVER" value="sync"/&gt;
        &lt;env name="DB_DATABASE" value=":memory:"/&gt;
        &lt;env name="DB_CONNECTION" value="sqlite"/&gt;
        &lt;env name="TWILIO_FROM_NUMBER" value="+15005550006"/&gt;
    &lt;/php&gt;</code></pre>
<p>But what if you find yourself needing to exclude these values from version control?</p>
<h2>My example</h2>
<p>I'm getting back to work on <a href="http://pulledover.us/">PulledOver</a>, which uses Twilio as its foundation. I wanted to write some tests for my TwilioClient class, which directly connects to Twilio's API, so I was using <a href="https://www.twilio.com/docs/api/rest/test-credentials">Twilio's Test Credentials</a> to send fake calls to the API and examine their responses.</p>
<p>But that means I have a Twilio SID and Token that I'm not supposed to expose to the public, right? I even asked around on Twitter:</p>
<blockquote class="twitter-tweet" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/geek?src=hash">#geek</a>&#10;When you’re working with <a href="https://twitter.com/twilio">@twilio</a> Test credentials, does it matter if you commit them to version control? Would be easier if I could…</p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/661584915054522368">November 3, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I got quite a few responses, and one from the CEO of Twilio (!):</p>
<blockquote class="twitter-tweet" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> <a href="https://twitter.com/twilio">@twilio</a> Best not to check them in. We may rate-limit API requests w/ test credentials, and if the whole world is using yours..</p>&mdash; Jeff Lawson (@jeffiel) <a href="https://twitter.com/jeffiel/status/661609706515881984">November 3, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>OK, so I need to exclude them. But <em>how</em>? I scratched my head a few times, dropped a question in the company Slack, and went to sleep. I woke up this morning and the ever-resourceful <a href="https://twitter.com/keithdamiani">Keith Damiani</a> had an answer for me: use Dotenv (which Laravel uses to load <code>.env</code>) to load a <code>.env.test</code> file in Laravel's TestCase base class. DUH. Here's how you do it:</p>
<h2>Implementing <code>.env.test</code> in Laravel</h2>
<p>First, create a <code>.env.test.example</code> file and fill it with placeholders for whichever keys you want:</p>
<pre><code>TWILIO_ACCOUNT_SID=fillmein
TWILIO_ACCOUNT_TOKEN=fillmein</code></pre>
<p>Next, copy <code>.env.test.example</code> to <code>.env.test</code> and fill in the actual values.</p>
<p>Add <code>.env.test</code> to your <code>.gitignore</code> file.</p>
<p>Finally, add these line to <code>tests/TestCase.php</code>'s <code>createApplication</code> method, just below <code>$app = require __DIR__.'/../bootstrap/app.php';</code>:</p>
<blockquote>
<p>Note: Dotenv has changed their syntax recently, so I'll show two different versions here:</p>
</blockquote>
<pre><code class="language-php">// Old Dotenv
if (file_exists(dirname(__DIR__) . '/.env.test')) {
    Dotenv::load(dirname(__DIR__), '.env.test');
}

// New Dotenv
if (file_exists(dirname(__DIR__) . '/.env.test')) {
    (new \Dotenv\Dotenv(dirname(__DIR__), '.env.test'))-&gt;load();
}</code></pre>
<p>That's it! Your <code>.env.test</code> environment variables are now pulled into any test you run that extends <code>TestCase</code>, but those values are safely kept out of version control.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/creating-custom-requires-annotations-for-phpunit</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/creating-custom-requires-annotations-for-phpunit"/>
        <title>Creating custom @requires annotations for PHPUnit</title>
        <published>2015-10-27T00:00:00+00:00</published>
        <updated>2015-10-27T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I was working on a project this weekend that requi...</summary>
        <content type="html"><![CDATA[
        <p>I was working on a project this weekend that required skipping certain tests in a particular environment (Travis CI). I wrote something like this in my base test class:</p>
<pre><code class="language-php">private function skipIfTravis()
{
    if (getenv('TRAVIS') === true) {
        $this-&gt;markTestSkipped('This test should not run if on Travis.');
    }
}</code></pre>
<p>Then in a test, I would use it like this:</p>
<pre><code class="language-php">public function test_it_can_do_something_that_wont_work_on_travis()
{
    $this-&gt;skipIfTravis();

    // Do stuff...
}</code></pre>
<p>This worked, but it didn't feel right. I remembered that there was a <code>@requires</code> annotation in PHPUnit that works natively to allow you to skip a test under a certain version of PHP or with certain extensions disabled, so I set out to write my own custom <code>@requires</code> block.</p>
<blockquote>
<p>Note: Of course, I could've just made up a custom annotation named <code>@skipIfTravis</code> or something. The syntax may have been cleaner. But I was primarily interested in learning&mdash;how do PHPUnit annotations work? What does it look like to extend a pre-existing annotation? How do you not just check for the annotation, but also check its value? I'll show you what I found and then you can run willy-nilly with your own naming schemes.</p>
</blockquote>
<h2>The reference</h2>
<p>The only article I could find that referenced this concept was <a href="http://codesymphony.co/creating-your-own-phpunit-requires-annotations/">Creating Your Own PHPUnit @requires Annotations</a>, which got me 90% of the way there, but with a syntax I didn't particularly love.</p>
<p>As you can see in the example below that I copied from their site, we're extending PHPUnit's <code>checkRequirements()</code> method, inspecting the current annotation's <code>requires</code> block, and then testing our conditions;</p>
<pre><code class="language-php">protected function checkRequirements() {

    parent::checkRequirements();

    $annotations = $this-&gt;getAnnotations();

    foreach ( array( 'class', 'method' ) as $depth ) {

        if ( empty( $annotations[ $depth ]['requires'] ) ) {
            continue;
        }

        $requires = array_flip( $annotations[ $depth ]['requires'] );

        if ( isset( $requires['WordPress multisite'] ) &amp;&amp; ! is_multisite() ) {
            $this-&gt;markTestSkipped( 'Multisite must be enabled.' );
        } else if ( isset( $requires['WordPress !multisite'] ) &amp;&amp; is_multisite() ) {
            $this-&gt;markTestSkipped( 'Multisite must not be enabled.' );
        }
    }
}</code></pre>
<p>So, I adapted this for my needs. I figured, if I wanted to <em>require</em> that the code was <em>not</em> running on Travis, then I'd have to add a possible value of <code>!Travis</code> to the <code>@requires</code> annotation. It already feels a bit smelly, that we're requiring a negative, but let's just roll with it for now.</p>
<p>As you can see in the code below, we're running the parent method, grabbing all the annotations (which are grouped by class annotations and method annotations), checking for an annotation named <code>@requires</code>, and looking for a value of <code>!Travis</code>. If so, we're checking if the <code>TRAVIS</code> environment variable is true, and if so, we're skipping the test.</p>
<pre><code class="language-php">protected function checkRequirements()
{
    parent::checkRequirements();

    $annotations = $this-&gt;getAnnotations();

    foreach (['class', 'method'] as $depth) {
        if (empty($annotations[$depth]['requires'])) {
            continue;
        }

        $requires = array_flip($annotations[$depth]['requires']);

        if (isset($requires['!Travis']) &amp;&amp; getenv('TRAVIS') === true) {
            $this-&gt;markTestSkipped('This test does not run on Travis.');
        }
    }
}</code></pre>
<p>It didn't feel quite right. I'm in love with Laravel's Collection class, and there's a simple helper that allows you to convert an array to a Collection: <code>collect()</code>. So I converted this array into a Collection and then used <code>each()</code> to replace the <code>foreach(['class', 'method'])</code>. I also dropped the <code>array_flip</code> and simplified the checking and accessing of our requires blocks:</p>
<pre><code class="language-php">collect($this-&gt;getAnnotations())-&gt;each(function ($location) {
    if (! isset($location['requires'])) {
        return;
    }

    if (in_array('!Travis', $location['requires']) &amp;&amp; getenv('TRAVIS') === true) {
        $this-&gt;markTestSkipped('This test does not run on Travis.');
    }
});</code></pre>
<p>So, I grabbed my base <code>TestClass</code> and placed this code into it, and now I can annotate any test to be skipped on Travis.</p>
<h2>Full code, annotated</h2>
<pre><code class="language-php">// TestCase.php
// Extending parent checkRequirements method
protected function checkRequirements()
{
    parent::checkRequirements();

    // Convert the list of annotations, which can be grouped by class and/or 
    // method, to an Illuminate collection, and then act on each
    collect($this-&gt;getAnnotations())-&gt;each(function ($location) {
        // Exit early if this annotation isn't @requires
        if (! isset($location['requires'])) {
            return;
        }

        // Look for a key with our value !Travis under the @requires annotation
        if (in_array('!Travis', $location['requires']) &amp;&amp; getenv('TRAVIS') == true) {
            $this-&gt;markTestSkipped('This test does not run on Travis.');
        }
    });
}</code></pre>
<pre><code class="language-php">// SomeTest
/**
 * @requires !Travis
 */
public function test_it_does_something_i_would_like_to_skip_on_travis()
{
    // Test stuff
}</code></pre>
<h2>Postscript</h2>
<p>Looking at it afterwards, I think it'd probably be better <em>in this instance</em> to use a custom-named annotation like <code>@skipIfTravis</code> instead of overloading the <code>@requires</code> annotation.</p>
<p>Let's imagine, just for a second, we had a <code>@skipIfTravis</code> AND a <code>@skipIfLocal</code>&mdash;not because that's a great idea, but just because it's an interesting opportunity to look at a broader architecture.</p>
<pre><code class="language-php">    // TestCase.php
    protected function checkRequirements()
    {
        parent::checkRequirements();

        collect($this-&gt;getAnnotations())-&gt;each(function ($location) {
            $this-&gt;handleTravisSkips($location);
            $this-&gt;handleLocalSkips($location);
        });
    }

    private function handleTravisSkips($location)
    {
        if (! array_key_exists(['skipIfTravis', $location)) {
            return;
        }

        if (getenv('TRAVIS') === true) {
            $this-&gt;markTestSkipped('This test does not run on Travis.');
        }
    }

    private function handleLocalSkips($location)
    {
        if (! array_key_exists('skipIfLocal', $location)) {
            return;
        }

        if (getenv('LOCAL') === true) {
            $this-&gt;markTestSkipped('This test does not run on local environments.');
        }
    }</code></pre>
<p>You can probably sense a bit of a smell here, where we're duplicating the structure with the handlers.</p>
<p>If you're like me, you're dreaming of allowing this requirements-checker to have &quot;annotation handlers&quot; registered. Something like <code>$this-&gt;registerHandler($locationKey, $classToHandleThisLocation)</code>.</p>
<p>And I'm sure there are all sorts of more complicated and interesting frameworks or tools already out there (if so, <a href="http://twitter.com/stauffermatt">let me know on Twitter</a>!) I just had a little fun with this and wanted to document it as I went along. I hope it helped someone!</p>
<h2>Post-Postscript</h2>
<p>I forgot to mention this, but: if you did indeed only have a single annotation, you could clean up the collection operations a bit. We're really just filtering out the options that don't meet three criteria (has a <code>@requires</code> annotation, <code>!Travis</code> in the requires annotation array, and travis environment variable true), and then marking test as skipped for those which remain. I did a bit of optimization, and then worked with Illuminate filter-guru Adam Wathan to clean it up even a bit more. Note that we're relying on Illuminate's <code>array_get</code> to combine the <code>requires</code> checking and <code>!Travis</code> checking, and then using <code>and</code> to only skip the test if the <code>getenv</code> returns true.</p>
<pre><code class="language-php">collect($this-&gt;getAnnotations())-&gt;filter(function ($location) {
    return in_array('!Travis', array_get($location, 'requires', []));
})-&gt;each(function ($location) {
    getenv('TRAVIS') and $this-&gt;markTestSkipped('This test hates Travis.');
});</code></pre>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/custom-conditionals-with-laravels-blade-directives</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/custom-conditionals-with-laravels-blade-directives"/>
        <title>Custom conditionals with Laravel&#039;s Blade Directives</title>
        <published>2015-10-10T00:00:00+00:00</published>
        <updated>2015-10-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">One of the greatest aspects of Laravel Blade is th...</summary>
        <content type="html"><![CDATA[
        <p>One of the greatest aspects of Laravel Blade is that it's incredibly easy to handle view partials and control logic. I find myself frequently extracting the contents of a loop out to a Blade partial and then passing just a bit of data into the partial.</p>
<p>But sometimes the repetitive code isn't the view itself, but the conditional logic I'm running.</p>
<h2>A recent example</h2>
<p>I'm writing a quick Laravel app for my physical trainer, and it needs to be multitenant, which means it needs to handle and route visits from <code>myapp.com</code> but also <code>username.myapp.com</code>. The way I'm handling this is that I want to have an <code>App\Context</code> object available globally, which contains knowledge about the application's state.</p>
<p>I have a service provider that binds a new <code>App\Context</code> object to the IOC, and it has knowledge of which URL was used to access it, which helps it know if the user is visiting from a &quot;public&quot; (<code>myapp.com</code>) or &quot;client&quot; (<code>username.myapp.com</code>) context.</p>
<p>So, I find myself writing conditionals all over the place to test whether I'm in a public context or a client context.</p>
<p>I originally was writing it like this, using <a href="https://mattstauffer.co/blog/injecting-an-object-from-the-ioc-using-laravel-blade-service-injection">Blade service injection</a>:</p>
<pre><code class="language-php">// random-file.blade.php
@inject('context', 'App\Context')
@if ($context-&gt;isPublic())
    // One thing
@else
    // Another thing
@endif</code></pre>
<p>It worked fine, but it did feel kind of nasty. I considered binding an <code>$isPublic</code> or a <code>$context</code> variable to every view using a global view composer, but it just didn't feel right. I happened to mention the situation to Taylor and he reminded me of the ability to create custom Blade directives. </p>
<h2>What is a Blade directive?</h2>
<p>Blade directives allow you to create a custom Blade tag. You might think of just outputting some HTML:</p>
<pre><code class="language-php">@myGreatTag
// produces:
&lt;a href="#"&gt;Great things here&lt;/a&gt;</code></pre>
<p>Which you'd bind like this:</p>
<pre><code class="language-php">// AppServiceProvider
    public function boot()
    {
        Blade::directive('myGreatTag', function () {
            return '&lt;a href="#"&gt;Great things here&lt;/a&gt;';
        });
    }</code></pre>
<p>... but there's not really much reason to do that. You could just accomplish that with a view partial: <code>@include('partials.my-great-partial')</code> </p>
<p>Where directives shine is when you realize that the output of your Blade tags don't get treated as just HTML&mdash;they are treated as PHP. For example:</p>
<pre><code class="language-php">@if (true === true)</code></pre>
<p>actually converts to:</p>
<pre><code class="language-php">&lt;?php if(true === true): ?&gt;</code></pre>
<p>And the binding for the <code>@if</code> directive actually looks like this:</p>
<pre><code class="language-php">    protected function compileIf($expression)
    {
        return "&lt;?php if{$expression}: ?&gt;";
    }</code></pre>
<h2>Making it happen</h2>
<p>So, now that we realize that, we realize that a Blade directive is allowing us to <em>write shortcuts for PHP.</em></p>
<p>That means I can re-write my conditional like this:</p>
<pre><code class="language-php">@public
    // public thing
@else
    // non-public thing
@endif</code></pre>
<p>And this is all it takes:</p>
<pre><code class="language-php">// AppServiceProvider
    public function boot()
    {
        Blade::directive('public', function () {
            return "&lt;?php if (app('context')-&gt;isPublic()): ?&gt;";
        });
    }</code></pre>
<p>It might look strange, but remember, we're just <em>returning a string that will be executed as PHP.</em> </p>
<p>I could've chosen to figure out whether or not our current context <code>isPublic</code> in the binding, and just outputted <code>if(true)</code> or <code>if(false)</code>, but that just seemed weird:</p>
<pre><code class="language-php">Blade::directive('public', function () {
    $isPublic = app('context')-&gt;isPublic() ? 'true' : 'false';
    return "&lt;?php if ({$isPublic}): ?&gt;";
});</code></pre>
<p>And, it turns out, that actually wouldn't work! Since views are cached, it wouldn't re run this check on every page view. </p>
<p>But honestly, the sky is the limit here.</p>
<h2>Other options</h2>
<p>Of course, I could've named it <code>@ifPublic</code>. Or I could actually create a whole set of conditionals. It could be <code>@ifPublic</code>, <code>@otherwiseBecauseYouKnowWhatTheHeck</code>, and <code>@endIfPublicAndStuff</code>. Whatever I want.</p>
<p>Further, I can actually pass parameters into Blade directives, opening up all sorts of options for customization (and abuse):</p>
<pre><code class="language-php">// Bind:
Blade::directive('newlinesToBr', function($expression) {
    return "&lt;?php echo nl2br{$expression}; ?&gt;";
});

// Use:
&lt;p&gt;@newlinesToBr($body)&lt;/p&gt;</code></pre>
<p>Now we're actually creating custom inline functions for formatting, or whatever insane ideas you decide to throw at it. Go wild. Well, don't really go wild; you could end up confusing yourself and any current/future developers on the project. But allow yourself to extend the capabilities of Blade so you're not repeating the same logic over and over, or resorting to inline <code>&lt;?php</code> blocks.</p>
<p>Go forth and simplify!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-apply-for-a-web-developer-job-at-tighten-and-how-not-to</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/how-to-apply-for-a-web-developer-job-at-tighten-and-how-not-to"/>
        <title>How to Apply for a Web Developer Job at Tighten (and How Not To)</title>
        <published>2015-09-30T00:00:00+00:00</published>
        <updated>2015-09-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            I just finished reading over 200 applications for...
        </summary>
        <content type="html"><![CDATA[
        <p><img src="/assets/images/content/employment-graphic.jpg" alt="" /></p>
<p>I just finished reading over 200 applications for our latest job posting, a <strong>Web Developer</strong> job at <a href="http://www.tighten.co/">Tighten Co.</a>. We still hire infrequently enough and are small enough that the two founders (Dan and me) and our operations manager (Dave) read every single application, which is hours upon hours of work before we even get to our initial phone screen.</p>
<p>Some applicants, and some tendencies among applicants, have stood out as best practices, but many more things have stood out as consistent turnoffs. So, I figured I'd share some with you here.</p>
<blockquote>
<p><strong>Caveat:</strong> Applying for a job at a large company is often very different than applying for a job at a small consultancy like Tighten. This is not about &quot;how to apply for any job ever,&quot; but instead, it's a reflection on what helps me, as a hiring supervisor at Tighten, choose to put your application in our phone screen stack.</p>
</blockquote>
<h2>DO: Read the job description</h2>
<p>Many applicants applied purely because they liked Tighten. I'm overjoyed that we have such a good reputation that folks will apply to our job postings without even bothering to read the description. A little bit of attention to addressing the requirements of <em>this particular</em> job would've been nice in these circumstances, because each job posting is unique depending on the mixture of frontend, backend, or other particular skills. But that's not too bad.</p>
<p>What is disappointing, however, is the <strong>number of applicants who missed key elements of the job description</strong>. For example, we only can handle to hire people from the U.S. and Canada right now. We wrote that explicitly on the job posting. And yet a solid 1/5th of our applicants were not from the U.S. or Canada.</p>
<h3>Just reference the cat already</h3>
<p>This has happened before. So on the job posting this time, I wrote as a &quot;Must Have&quot; this item: &quot;Reference a cat or a breed of cat in your application&quot;. I just snuck it in there. And only about a third of our applicants did reference a cat. ONE THIRD.</p>
<p>Now, again, I understand that quite a few applicants were just excited to apply to Tighten, and we didn't hold that against them. But it helped make it even more clear the distinction between people who really cared about this job posting (or our company) and those who just were bulk sending off applications to every remotely viable job post.</p>
<h2>DON'T: Go overboard with your resumé</h2>
<p>Aesthetic appeal is important on your resumé! But colors and fonts and styles and layouts and other complicated stuff can be distracting on any resumé, and this is doubly true when you're not a professional designer. Keep it simple.</p>
<p>Keeping your resumé simple also applies to the content. There's such a thing as Too Much Information on a resumé. Give me the information that will help me decide to hire you and leave the rest off.</p>
<h2>DO: Write a custom cover letter for each job application</h2>
<p><strong>First</strong>, we can smell a generic cover letter from 20 feet away. It says to us, &quot;your company isn't important enough for me to spend 15 minutes writing you a custom cover letter.&quot; This is something that could be a huge part of your life for the next few years or more, and you can't spend 15 minutes on a custom cover letter?</p>
<p><strong>Second</strong>, a generic cover letter probably doesn't do a good job of communicating how you meet <em>our needs</em>. Each job posting is carefully crafted to find someone who meets our particular needs at the moment, so that you have the opportunity in your application to show why <em>you are that person.</em> Your generic cover letter that is designed to get you any job in the entire field of IT is not the best tool you have to do that.</p>
<p><strong>Third</strong>, the number of times someone has pasted a generic cover letter when applying to our job and <em>left another company's name on it</em> would blow your mind. Someone who does that is instantly rejected, regardless of the quality of their application. Don't be that person.</p>
<p><strong>The best cover letter shows that you understand who we are and what we want, and communicates to use why you can meet all of our requirements.</strong></p>
<h2>DON'T: Stop yourself from applying if you don't have the nice-to-haves</h2>
<p>It seems that the less qualified someone is, the more likely they are to apply to <em>absolutely everything.</em> Many developers that we'd love to work with are extremely empathic, which in turn means they're much less likely to apply a job posting that they don't think fits them perfectly.</p>
<p>This means we wade through many applications from people who don't meet <em>any</em> of our must-haves, but there are plenty of amazing developers who would be a great fit but don't fit 100% of our nice-to-haves and therefore never apply.</p>
<p>At least at Tighten, we intentionally separate our job requirements between &quot;Must Have&quot; and &quot;Nice to Have&quot;. If you meet all the must haves, apply! The benefit of the Nice to Have is just so that you can distinguish yourself if you meet all those <em>too</em>, but don't let those keep you from applying.</p>
<h2>DO: Update your web site and resumé</h2>
<p>We're going to check out your Twitter, and your web site, and we're going to read your resumé. We'll be curious about holes in your resumé, and the first things we check are your education, where your job history <em>started</em>, and what your <em>most recent</em> job looks like.</p>
<p>Quite a few applicants had web sites that were clearly from the late 1990's or early 2000's. Dan and I were both web developers then, so we can recognize a site from that time period well; additionally, your IE6 conditionals might be showing. :)</p>
<p>If you send something along to us, it should be how you want to present yourself to us. If something isn't up to snuff, and if you have to caveat it heavily, consider either re-making it, or just not sending it at all. Only a few people actually make it from the screening round to an actual phone conversation, so your materials you send along--cover letter, resumé, web site, etc.--need to speak for you. Are they saying the things you want said?</p>
<h2>DON'T: &quot;To whom it may concern&quot; us</h2>
<p>Know the company you're applying to. Is it a big company? Keep it formal, and stuff all your keywords in. You need to pass their HR screen, so I get it.</p>
<p>But if it's a small company like Tighten, especially if you know the founders read the applications, <em>be a human.</em> Yes, we want you to be professional. But we want to know what you're like as a person. We're entirely remote, so we need to know that you know how to communicate effectively; if you're overly formal, that will affect our perception of what you'll be like to have on a team.</p>
<p>For us, you might try: &quot;Dear Dan &amp; Matt&quot;, &quot;Dear Hiring Manager,&quot; &quot;Hey Tighten folks,&quot;, or the internal favorite at Tighten, &quot;Yo Stauff-meister&quot;. (The last one is a joke. You probably shouldn't actually do that.)</p>
<h2>DO: Use LinkedIn well or not at all</h2>
<p>Sorry, because I know developers love to hate LinkedIn. I hate it too. Its emails are painfully annoying. Its UI is horrible. But it's one of the things we're going to look at when we evaluate your application.</p>
<p>If you don't have a LinkedIn, that looks like an intentional choice. But if you have a LinkedIn with two connections and no profile picture and not any useful information, that shows that you're not concerned with managing your business relationships and reputation. It's not as if that's a not-hireable offense, but it looks a little bit like a broken-down-house on your property.</p>
<h2>DON'T: Tell us your entire life story</h2>
<p>We love when applications are personal and fun. We want to get to know you, and we love hearing a little bit about your family and your hobbies. But for the cover lever, keep it to just a little bit. If two thirds of your cover letter is a story of every place you've lived for the last three years and we know more about your life than the people closest to you do, there's a name for that: overdisclosure. Keep it short.</p>
<h2>DO: Give us up-to-date code samples</h2>
<p>I understand that many developers' work situations keep them from being able to share code samples from their work, and not every developer has time to do lots of open source work.</p>
<p>However, I'm not going to hire a developer without seeing their code. And if you send over examples of your work, I will read it. So if the only samples you have are from 10 years ago, you're better off not sending it in.</p>
<p>Rather, spend some time on a night or weekend and create a side project <em>solely for the purpose of applying to jobs.</em> It's worth the time. Even if it's not a fully functional project, just write a single page of PHP or Javascript or HTML or CSS. Give me something to work with.</p>
<h2>DO: Check your spelling and grammar</h2>
<p>In programming we talk about &quot;code smells.&quot; A code smell doesn't mean code is bad, but just that you should be on guard.</p>
<p>Typos, grammar issues, and spelling issues are job application smells. Of course, we all make typos. But typos and spelling issues, especially when we see several of them, show that you don't have attention to detail as a personality trait, and that's a big turnoff.</p>
<p>Additionally, almost all such issues can be caught if you read over your application once or twice, if you run it through a spell checker, or if you have a friend read it over. Again, this job could be a huge part of your life over the next few years. Doesn't it merit a bit of attention?</p>
<h2>DON'T: Make excuses</h2>
<p>It's completely fine if there's a particular reason for a gap in your work history, so if you know we're going to be asking a question (&quot;Why no code samples?&quot;, &quot;Why are you applying for this job if all your work experience is in Python?&quot;, etc.), please feel free to preemptively answer those questions for us.</p>
<p>But there's a difference between a preemptive answer and an excuse. Is it something you can fix up in a few hours, or even a weekend? Then just fix it. Is it a code sample that isn't a good fit? Don't send it. Make something else. Don't make excuses for things that you're capable of changing.</p>
<h2>DO: Set yourself apart</h2>
<p>There were a few applicants whose applications stood heads and shoulders above the rest. These folks wrote compelling cover letters, custom application web sites, and were involved with impressive projects and open source tools.</p>
<p>Standing out in the application phase doesn't guarantee you a job. But it almost completely guarantees you get to the phone call round. If someone took the time to learn about our company, build a custom web site to apply for it, and to generally show us that this job is something special to them, not just one of the fifty jobs they applied to today, that's a special thing for us.</p>
<h2>More</h2>
<p>Do you have other tips for job applicants I didn't include here? Let me know on <a href="http://twitter.com/stauffermatt">Twitter</a>!</p>
<p>I also asked around on Twitter:</p>
<blockquote class="twitter-tweet" lang="en"><p lang="en" dir="ltr">I’m writing a blog post giving devs tips on sending in an initial job application. Hiring managers, anything you *really* want devs to hear?</p>&mdash; Matt Stauffer (@stauffermatt) <a href="https://twitter.com/stauffermatt/status/648850566131654656">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>And got these responses:</p>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Keep it short. Make it easy to extract the information. Most important things first.</p>&mdash; Rik Heywood (@RikHeywood) <a href="https://twitter.com/RikHeywood/status/648936113474809856">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> and explain why you want to work for me - sending your CV to 1000 companies in the hope one will bite? I’m not interested.</p>&mdash; Rik Heywood (@RikHeywood) <a href="https://twitter.com/RikHeywood/status/648936445529489408">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> I don&#39;t much care that you can&#39;t spell perfectly, you know how to use tools to correct must of your mistakes don&#39;t you?</p>&mdash; Guillaume Rossolini (@g_rossolini) <a href="https://twitter.com/g_rossolini/status/648929169250865152">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> however if you complain &quot;if nobody gives me a chance I&#39;ll never have experience&quot;, then you are definitely not who I need.</p>&mdash; Guillaume Rossolini (@g_rossolini) <a href="https://twitter.com/g_rossolini/status/648929687658471424">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> don&#39;t sell yourself as a lifeless robot. IT geeks do have a bad reputation when it comes to social skills - prove them wrong</p>&mdash; Salvatore Mulas (@salvomulas) <a href="https://twitter.com/salvomulas/status/648882483329634304">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Why they&#39;re in this industry in the first place. Are they driven by passion or are they just &quot;putting their time in&quot;?</p>&mdash; Kory Gorsky (@KoryGorsky) <a href="https://twitter.com/KoryGorsky/status/648875219940196353">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> probably a no brainer but I hated when devs lied about what they claimed to know. Be honest and upfront with skills/experience</p>&mdash; Jarrod Rizor (@JarrodRizor) <a href="https://twitter.com/JarrodRizor/status/648870907381968896">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> keep it to 1 page, 2 max. include links to your best code samples. provide detail on the technologies you claim to know</p>&mdash; Daniel Abernathy (@dabernathy89) <a href="https://twitter.com/dabernathy89/status/648866758988722177">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> It&#39;s awesome that you&#39;re cool/quirky, but the standard cover letter/resume formats exist for a reason. Disregard at your peril</p>&mdash; J.T. Grimes (@JT_Grimes) <a href="https://twitter.com/JT_Grimes/status/648855651842572288">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Your Github account is not your resume - we&#39;re hiring for much more than coding ability.</p>&mdash; J.T. Grimes (@JT_Grimes) <a href="https://twitter.com/JT_Grimes/status/648856305566789633">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> an answer to the question &quot;Why do you want to work specifically HERE in our company (i.e. what do you know about us)&quot;</p>&mdash; Laravel Daily (@DailyLaravel) <a href="https://twitter.com/DailyLaravel/status/648855714170077184">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> Submit your application like this - <a href="https://t.co/T56OM4Kybj">https://t.co/T56OM4Kybj</a> <a href="https://twitter.com/hashtag/instanthire?src=hash">#instanthire</a></p>&mdash; Eric L. Barnes (@ericlbarnes) <a href="https://twitter.com/ericlbarnes/status/648854823132090369">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> If your resume creates any obvious questions (where was this guy for three years?) your cover letter should answer them.</p>&mdash; J.T. Grimes (@JT_Grimes) <a href="https://twitter.com/JT_Grimes/status/648853023159009280">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> tell me how you added *value* to the last places you worked at, and why you think this is relevant to this one.</p>&mdash; Deprecated BIF (@dch__) <a href="https://twitter.com/dch__/status/648852504357244928">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> show me you can communicate, have empathy, and resolve conflict &amp; awkward situations. Tell me what sort of team env you prefer</p>&mdash; Deprecated BIF (@dch__) <a href="https://twitter.com/dch__/status/648852735945777152">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-conversation="none" lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/stauffermatt">@stauffermatt</a> <a href="https://twitter.com/funkatron">@funkatron</a> Decent grammar and spelling are important. Not paying attention to them shows me a lack of attention to details.</p>&mdash; Dylan Ribb (@dylanribb) <a href="https://twitter.com/dylanribb/status/648851942379122688">September 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><em>(<a href="https://www.flickr.com/photos/waponigirl/5621810815/">CC-licensed image from waponigirl on Flickr</a>)</em></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/environment-specific-configuration-for-craftcms-using-phpdotenv</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/environment-specific-configuration-for-craftcms-using-phpdotenv"/>
        <title>Environment-Specific Configuration for CraftCMS Using PHPDotEnv</title>
        <published>2015-09-24T00:00:00+00:00</published>
        <updated>2015-09-24T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">TL;DR: save your environment-specific configuratio...</summary>
        <content type="html"><![CDATA[
        <p>TL;DR: save your environment-specific configuration details in a git-ignored <code>.env</code> file. Instructions <a href="#how-do-i-add-phpdotenv-to-my-craft-site">below</a>.</p>
<h2>What's wrong with the current system?</h2>
<p>Craft is a fantastic CMS, but every CMS shows some pain points when you have a large team working on the same site at the same time. One of these points for me is Craft's native <a href="http://buildwithcraft.com/docs/multi-environment-configs">multi-environment configuration options</a>, which allow you to define configuration options based on the domain name:</p>
<pre><code class="language-php">return [
    '*' =&gt; [
        'omitScriptNameInUrls' =&gt; true,
    ],
    'example.dev' =&gt; [
        'devMode' =&gt; true,
    ],
    'example.com' =&gt; [
        'cooldownDuration' =&gt; 0,
    ]
];</code></pre>
<p>This is great, but it's limited: You're hard-coding the configuration details into your code, which sometimes means putting sensitive information into your version control. Every developer's local installs either all have to have different domains, or if they use the same domain they need to all have the same configuration settings. And something just feels <em>dirty</em> about the codebase having such knowledge of every place it's going to be deployed.</p>
<h2>A better way</h2>
<p>I've fallen in love with how easy <a href="https://github.com/bkeepers/dotenv">dotenv</a> and <a href="https://github.com/vlucas/phpdotenv">phpdotenv</a> make it to keep particular variables (e.g. database connection information) unique for each environment (local, staging, production, etc.) <em>without</em> committing them all to version control (e.g. GitHub).</p>
<p>This is especially helpful when you're developing as a part of a team, who may have different connections across each of their unique &quot;local&quot; environments. It also is more secure, because your production database credentials aren't accessible to every person with access to your git repo.</p>
<h2>How does phpdotenv work?</h2>
<p><code>phpdotenv</code> allows you to load in a file named <code>.env</code> that sits in your project root (you can customize where it lives or what it's named, but that's the default) and add its keys/values to your <code>$_ENV</code> global. Here's quick look at a sample <code>.env</code> file:</p>
<pre><code>DB_HOST=localhost
DB_NAME=my_web_site
DB_USER=root
DB_PASS=root</code></pre>
<p>With <code>phpdotenv</code>, all the values you set in <code>.env</code> become accessible across your entire codebase via <code>$_ENV</code> and the <code>getenv()</code> function, so you can have a single file for your environment-specific variables that gets loaded at runtime and makes them accessible anywhere. That means, anywhere in your code, you can just write <code>getenv('DB_HOST')</code> and it will return, in the example above, <code>localhost</code>.</p>
<p>Additionally, you can require that each environment's <code>.env</code> must contain certain fields, so that if a particular environment is missing certain keys, <code>phpdotenv</code> will make a fuss until you fix it.</p>
<p>If you're confused as to how each environment has a unique <code>.env</code> file, it's because you use <code>.gitignore</code> to tell git to ignore that file, and in each environment you'll make a new copy from a template, named <code>.env.example</code>.</p>
<h2>How do I add phpdotenv to my Craft site?</h2>
<blockquote>
<p>Note: This requires using <a href="https://getcomposer.org/">Composer</a>. That might sound scary, but trust me, it's going to be simple.</p>
</blockquote>
<h3>1. Initialize a Composer project and require <code>vlucas/phpdotenv</code></h3>
<p>First, create a file in your project root named <code>composer.json</code>. Fill it with the following:</p>
<pre><code class="language-json">{
    "require": {
        "vlucas/phpdotenv": "^2.0"
    }
}</code></pre>
<p>If you haven't yet, <a href="https://getcomposer.org/download/">install Composer</a>.</p>
<p>Run <code>composer install</code>.</p>
<h3>2. Add the Composer autoloader and Dotenv loader to <code>index.php</code></h3>
<p>Edit your <code>public/index.php</code> file and add these lines to the top:</p>
<pre><code class="language-php">require_once('../vendor/autoload.php');

try {
    $dotenv = new Dotenv\Dotenv(dirname(__DIR__));
    $dotenv-&gt;load();
    $dotenv-&gt;required(['DB_HOST', 'DB_NAME', 'DB_USER', 'DB_PASS']);
} catch (Exception $e) {
    exit('Could not find a .env file.');
}</code></pre>
<h3>3. Create <code>.env</code> and <code>.env.example</code></h3>
<p>Now create a file in the root named <code>.env</code>. For now, fill it with this:</p>
<pre><code>DB_HOST=localhost
DB_NAME=craft
DB_USER=root
DB_PASS=root</code></pre>
<p>Duplicate that file and name the duplicate <code>.env.example</code>.</p>
<h3>4. Git ignore environment-specific files</h3>
<p>Add these lines to your <code>.gitignore</code> file:</p>
<pre><code>/vendor/
.env</code></pre>
<h3>5. Update <code>.env</code> with appropriate connection details</h3>
<p>Now go into <code>craft/config/db.php</code> (if this is an existing site) and move those values into your <code>.env</code> file so that it looks something like this:</p>
<pre><code>DB_HOST=my.db.server.com
DB_NAME=mysite_craft
DB_USER=mysite_sql_user
DB_PASS=1395h901h91jr91</code></pre>
<h3>6. Update Craft config files to get values from the <code>$_ENV</code></h3>
<p>Update <code>craft/config/db.php</code> to look like this:</p>
<pre><code class="language-php">return [
    'server' =&gt; getenv('DB_HOST'),
    'user' =&gt; getenv('DB_USER'),
    'password' =&gt; getenv('DB_PASS'),
    'database' =&gt; getenv('DB_NAME'),
    'tablePrefix' =&gt; 'craft',
];</code></pre>
<p>That's it! Your site is now getting its configuration details from your <code>.env</code> file. Every time you spin up a new instance of this site, just create a new <code>.env</code> file from the <code>.env.example</code> template in the new environment and set its details appropriately.</p>
<p>As you've probably realized, you can set other properties in here; I use it to set <code>BASE_URL</code> and then pull that in <code>craft/config/general.php</code> as an <code>environmentVariable</code>.</p>
<h2>What did we just do?</h2>
<p>Composer allows us to pull in external code. So we initialized a new Composer configuration file (if you're a Composer guru, you might be mad that I didn't teach <code>composer init</code>... I know, me too), and then told Composer to require this <code>phpdotenv</code> package. Then we asked Composer to install it.</p>
<p>Then we needed to pull the Composer autoloader into our code so that we had access to any packages it installs. Once we had that, we could use <code>Dotenv</code>'s loader to pull in our <code>.env</code> file and import its keys and values to our <code>$_ENV</code>.</p>
<p>We updated our <code>.env</code> to have the correct connection details, and then updated Craft's database configuration array to pull its details from our <code>.env</code> using the <code>getenv()</code> function.</p>
<h2>What does this do to my deployment requirements?</h2>
<p>This has two effects on your deployment.</p>
<p>First, every time you spin up a new environment, you need to copy <code>.env.example</code> to <code>.env</code> and fill out those details correctly for the new environment.</p>
<p>Second, your deployment servers all need Composer. Thankfully, every modern host has Composer on it. If you don't have a good host, I highly recommend <a href="https://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge">Laravel Forge and DigitalOcean</a> for quick and easy Craft hosting.</p>
<h2>Conclusion</h2>
<p>That's it! Look at you and your environment-specific configs go!</p>
<blockquote>
<p>Note: I just added Laravel's <code>env()</code> helper function to my <a href="https://github.com/mattstauffer/craftplugindevhelpers">craftPluginDevHelpers</a> plugin. This allows you to set fallback default values, and it also converts boolean values like <code>true</code> to actual PHP booleans. However, relying on an installed plugin for this is a bit sketchy, since if it's not installed your <code>env</code> won't work right. So, I would recommend either manually checking for boolean strings (e.g. <code>if (getenv('THINGISENABLED') == 'true')</code>), OR including Laravel's <a href="https://packagist.org/packages/illuminate/support">Illuminate/Support</a> package via Composer.</p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-spark-a-deep-dive</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/introducing-laravel-spark-a-deep-dive"/>
        <title>Introducing Laravel Spark: A Deep Dive</title>
        <published>2015-09-17T00:00:00+00:00</published>
        <updated>2015-09-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve been around on the general Laravel-inter...</summary>
        <content type="html"><![CDATA[
        <p>If you've been around on the general Laravel-interested Internet over the last month or two, or if you attended Laracon US or Laracon EU, you've probably already heard of Laravel Spark. If you haven't, check out <a href="https://youtu.be/PRFO4YlHHQU">Taylor's introductory video from Laracon EU</a>.</p>
<p>I've held off on writing about it until now, because it has changed a <em>lot</em> over the span of its development. It's released as an Alpha now, so the API has solidified <em>some</em>... but it'll still change quite a bit between now and the release.</p>
<blockquote>
<p><strong>WARNING</strong>: This article is about an <strong>alpha release</strong>. <strong>This release is not intended to show the final API or feature set</strong>. Spark <em>will change</em> often before its release, and I won't always catch every change immediately. If you find any ways this guide has become out-of-date as Spark changes between Alpha and final release, <a href="https://gist.github.com/mattstauffer/5276b74ee69cc70d121e">please let me know here</a>. If you hate something and think it's the worst idea you've ever seen, chill. This is just an alpha and there's no promise <em>anything</em> will stay the way it is right now.</p>
</blockquote>
<p>If you want a quick, TL;DR version of how to install Spark, check out <a href="https://laravel-news.com/2015/09/laravel-spark/">Laravel News' quick writeup</a>. This is, instead, a deep-dive into how it works and what it does. I'll be writing a more general introduction to Spark once it's actually released, so beware: this is a bit of a deeper dive, for people geeky enough to want to look at an alpha release.</p>
<h2>High-level overview</h2>
<p>In case you're still having a bit of trouble understanding what Spark is really about, <em>Spark is a tool designed to make it quicker for you to spin up SaaS applications, and it handles user authentications, plans and payments and coupons, and team logic.</em></p>
<p>Most SaaSes have these same components: user accounts, Stripe-based payments, and different payment plans. And many have payment coupons and team payment options.</p>
<p>Rather than re-creating this functionality with every new Laravel app you create, just use Spark, and you'll get all that and a free SaaS landing page to boot.</p>
<p><img src="/assets/images/content/spark-landing.png" alt="Spark Landing" /></p>
<h2>Installing Spark</h2>
<p>Like Laravel and Lumen, Spark has a global Composer installer to make installation simpler. To install the Spark installer, run this command:</p>
<pre><code class="language-bash">composer global require "laravel/spark-installer=~1.0"</code></pre>
<blockquote>
<p>Note: Like with the other installers, you need to make sure that the global Composer <code>bin</code> is in your system's <code>$PATH</code> so that when you run <code>spark</code> from the command line, it'll find <code>spark</code> from within that folder.</p>
</blockquote>
<h2>Adding Spark to your new Laravel install</h2>
<p>So, let's create a new Laravel application:</p>
<pre><code class="language-bash">cd ~/Sites
laravel new spark-blog-post
cd spark-blog-post</code></pre>
<p>The next step is to install Spark.</p>
<p>And then we install Spark:</p>
<pre><code class="language-bash">spark install</code></pre>
<p>That's it for installation. It'll give you several prompts; you'll probably just want to choose <code>yes</code> for everything.</p>
<p><img src="/assets/images/content/spark-installation.png" alt="Spark Installation" /></p>
<p>Finally, like it told you to, go into your <code>.env</code> and add your Stripe Key &amp; Secret, and, optionally, your Authy key.</p>
<h3>Migrations</h3>
<p>If you, like me, develop on Homestead, the &quot;migrations&quot; step likely just did nothing. And if you hadn't edited your <code>.env</code> before you ran <code>spark install</code>, which I didn't tell you to, then it REALLY didn't do anything. But that's fine.</p>
<p>The best way to do it, if you're setting up this site on Homestead, is: now that you've installed Spark, go edit your <code>.env</code> file to customize the database name that you'd like to use for this site. Then ssh into your Homestead box and migrate the database from there. Done.</p>
<h3>Changes Spark makes to your files</h3>
<p>Spark has done quite a bit here. Check it out:</p>
<p><img src="/assets/images/content/spark-diff.png" alt="Spark diff" /></p>
<p>This is changing some default views (e.g. changing the root from showing <code>welcome</code> to showing <code>spark::welcome</code>) and adding others (<code>/home</code>, wrapped in the <code>auth</code> middleware). It's also updating the <code>User</code> model to make it <code>Billable</code> and <code>TwoFactorAuthenticatable</code>. It's adding quite a few Stripe-related fields to the <code>User</code> that you'll be familiar with if you've ever used Laravel Cashier (and if you hadn't guessed, Cashier is a dependency of Spark).</p>
<p>It's adding <code>CashierServiceProvider</code> and two <code>SparkServiceProvider</code>s. It's updating the password reset email to be the Spark password reset email. It's updating the <code>create tables</code> migration to add Cashier, Team, and Two-Factor Auth columns.</p>
<p>Finally, it's pulling in <code>app.js</code> into Elixir and adding some Spark-specific Sass variables to <code>app.scss</code>.</p>
<h3>New files from Spark</h3>
<p>Spark also added quite a few files for you. Let's look through them.</p>
<h4>app/Providers/SparkServiceProvider.php</h4>
<p>The <code>SparkServiceProvider</code> is where you do most of the customization, so it's accordingly <em>huge</em>.</p>
<pre><code class="language-php">&lt;?php

namespace App\Providers;

use App\Team;
use Validator;
use Laravel\Spark\Spark;
use Illuminate\Http\Request;
use Laravel\Spark\Providers\AppServiceProvider as ServiceProvider;

class SparkServiceProvider extends ServiceProvider
{
    /**
     * Meta-data included in invoices generated by Spark.
     *
     * @var array
     */
    protected $invoiceWith = [
        'vendor' =&gt; 'Your Company',
        'product' =&gt; 'Your Product',
        'street' =&gt; 'PO Box 111',
        'location' =&gt; 'Your Town, 12345',
        'phone' =&gt; '555-555-5555',
    ];

    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot()
    {
        parent::boot();

        //
    }

    /**
     * Customize general Spark options.
     *
     * @return void
     */
    protected function customizeSpark()
    {
        Spark::configure([
            'models' =&gt; [
                'teams' =&gt; Team::class,
            ]
        ]);
    }

    /**
     * Customize Spark's new user registration logic.
     *
     * @return void
     */
    protected function customizeRegistration()
    {
        // Spark::validateRegistrationsWith(function (Request $request) {
        //     return [
        //         'name' =&gt; 'required|max:255',
        //         'email' =&gt; 'required|email|unique:users',
        //         'password' =&gt; 'required|confirmed|min:6',
        //         'terms' =&gt; 'required|accepted',
        //     ];
        // });

        // Spark::createUsersWith(function (Request $request) {
        //     // Return New User Instance...
        // });
    }

    /**
     * Customize the roles that may be assigned to team members.
     *
     * @return void
     */
    protected function customizeRoles()
    {
        Spark::defaultRole('member');

        Spark::roles([
            'admin' =&gt; 'Administrator',
            'member' =&gt; 'Member',
        ]);
    }

    /**
     * Customize the tabs on the settings screen.
     *
     * @return void
     */
    protected function customizeSettingsTabs()
    {
        Spark::settingsTabs()-&gt;configure(function ($tabs) {
            return [
                $tabs-&gt;profile(),
                $tabs-&gt;teams(),
                $tabs-&gt;security(),
                $tabs-&gt;subscription(),
                // $tabs-&gt;make('Name', 'view', 'fa-icon'),
            ];
        });

        Spark::teamSettingsTabs()-&gt;configure(function ($tabs) {
            return [
                $tabs-&gt;owner(),
                $tabs-&gt;membership(),
                // $tabs-&gt;make('Name', 'view', 'fa-icon'),
            ];
        });
    }

    /**
     * Customize Spark's profile update logic.
     *
     * @return void
     */
    protected function customizeProfileUpdates()
    {
        // Spark::validateProfileUpdatesWith(function (Request $request) {
        //     return [
        //         'name' =&gt; 'required|max:255',
        //         'email' =&gt; 'required|email|unique:users,email,'.$request-&gt;user()-&gt;id,
        //     ];
        // });

        // Spark::updateProfilesWith(function (Request $request) {
        //     // Update $request-&gt;user()...
        // });
    }

    /**
     * Customize the subscription plans for the application.
     *
     * @return void
     */
    protected function customizeSubscriptionPlans()
    {
        // Spark::free()
        //         -&gt;features([
        //             'Feature 1',
        //             'Feature 2',
        //             'Feature 3',
        //         ]);

        // Spark::plan('Basic', 'stripe-id')-&gt;price(10)
        //         -&gt;trialDays(7)
        //         -&gt;features([
        //             'Feature 1',
        //             'Feature 2',
        //             'Feature 3',
        //         ]);
    }
}</code></pre>
<p>Let's walk through it one piece at a time.</p>
<h5>$invoiceWith</h5>
<p>This will customize the invoices that Spark generates. Put your information here, it ends up on the PDF. Done.</p>
<pre><code class="language-php">    protected $invoiceWith = [
        'vendor' =&gt; 'Your Company',
        'product' =&gt; 'Your Product',
        'street' =&gt; 'PO Box 111',
        'location' =&gt; 'Your Town, 12345',
        'phone' =&gt; '555-555-5555',
    ];</code></pre>
<h5>customizeRegistration()</h5>
<p>This allows you to add your own validation requirements and customize the user creation process.</p>
<pre><code class="language-php">    protected function customizeRegistration()
    {
        // Spark::validateRegistrationsWith(function (Request $request) {
        //     return [
        //         'name' =&gt; 'required|max:255',
        //         'email' =&gt; 'required|email|unique:users',
        //         'password' =&gt; 'required|confirmed|min:6',
        //         'terms' =&gt; 'required|accepted',
        //     ];
        // });

        // Spark::createUsersWith(function (Request $request) {
        //     // Return New User Instance...
        // });
    }</code></pre>
<p>The <code>createUsersWith</code> function is run in the registration controller like this:</p>
<pre><code class="language-php">    // Laravel\Spark\Repositories\UserRepository
    protected function createNewUser(Request $request, $withSubscription)
    {
        if (Spark::$createUsersWith) {
            return $this-&gt;callCustomUpdater(Spark::$createUsersWith, $request, [$withSubscription]);
        } else {
            return $this-&gt;createDefaultUser($request);
        }
    }</code></pre>
<p>And, just for your customization purposes, this is what that method will do if you don't override it:</p>
<pre><code class="language-php">    // Laravel\Spark\Repositories\UserRepository
    protected function createDefaultUser(Request $request)
    {
        $model = config('auth.model');

        return (new $model)-&gt;create([
            'name' =&gt; $request-&gt;name,
            'email' =&gt; $request-&gt;email,
            'password' =&gt; bcrypt($request-&gt;password),
        ]);
    }</code></pre>
<h5>customizeRoles()</h5>
<p>By default, Spark has a role system for the Teams setting. You can set up your list of roles and your default here.</p>
<pre><code class="language-php">    protected function customizeRoles()
    {
        Spark::defaultRole('member');

        Spark::roles([
            'admin' =&gt; 'Administrator',
            'member' =&gt; 'Member',
        ]);
    }</code></pre>
<h5>customizeSettingsTabs()</h5>
<p>By default, Spark creates an account/admin panel with a few default tabs. You can remove tabs, re-order them, or add your own.</p>
<p>If you're using Teams, you can also customize the Team tabs.</p>
<pre><code class="language-php">    protected function customizeSettingsTabs()
    {
        Spark::settingsTabs()-&gt;configure(function ($tabs) {
            return [
                $tabs-&gt;profile(),
                $tabs-&gt;teams(),
                $tabs-&gt;security(),
                $tabs-&gt;subscription(),
                // $tabs-&gt;make('Name', 'view', 'fa-icon'),
            ];
        });

        Spark::teamSettingsTabs()-&gt;configure(function ($tabs) {
            return [
                $tabs-&gt;owner(),
                $tabs-&gt;membership(),
                // $tabs-&gt;make('Name', 'view', 'fa-icon'),
            ];
        });
    }</code></pre>
<h5>customizeProfileUpdates()</h5>
<p>Just like you could customize the validation logic and user creation process for user registration, you can do the same thing for the user profile update process.</p>
<pre><code class="language-php">    protected function customizeProfileUpdates()
    {
        // Spark::validateProfileUpdatesWith(function (Request $request) {
        //     return [
        //         'name' =&gt; 'required|max:255',
        //         'email' =&gt; 'required|email|unique:users,email,'.$request-&gt;user()-&gt;id,
        //     ];
        // });

        // Spark::updateProfilesWith(function (Request $request) {
        //     // Update $request-&gt;user()...
        // });
    }</code></pre>
<p>The default behavior in the <code>ProfileController</code> that you'd be overwriting in <code>updateProfilesWith</code> is:</p>
<pre><code class="language-php">    Auth::user()-&gt;fill($request-&gt;all())-&gt;save();</code></pre>
<h5>customizeSubscriptionPlans()</h5>
<p>Like the name suggests, this is where you determine what your plans are. You can add free plans, monthly plans, yearly plans, and define the price, number of trial days, and feature list.</p>
<p>This code snippet shows everything except a yearly plan, which you'd define by adding a <code>-&gt;yearly()</code> fluent call to your plan definition.</p>
<pre><code class="language-php">    protected function customizeSubscriptionPlans()
    {
        // Spark::free()
        //         -&gt;features([
        //             'Feature 1',
        //             'Feature 2',
        //             'Feature 3',
        //         ]);

        // Spark::plan('Basic', 'stripe-id')-&gt;price(10)
        //         -&gt;trialDays(7)
        //         -&gt;features([
        //             'Feature 1',
        //             'Feature 2',
        //             'Feature 3',
        //         ]);
    }</code></pre>
<h4>app/Team.php</h4>
<p>There's a new model for Teams, if you're going to use them.</p>
<pre><code class="language-php">&lt;?php

namespace App;

use Laravel\Spark\Teams\Team as SparkTeam;

class Team extends SparkTeam
{
    //
}</code></pre>
<p>It's extending this model for customization (trimmed for brevity):</p>
<pre><code class="language-php">&lt;?php

namespace Laravel\Spark\Teams;

...

class Team extends Model
{
    protected $table = 'teams';

    protected $fillable = ['name'];

    /**
     * Get all of the users that belong to the team.
     */
    public function users() {}

    /**
     * Get the owner of the team.
     */
    public function owner() {}

    /**
     * Get all of the pending invitations for the team.
     */
    public function invitations() {}

    /**
     * Invite a user to the team by e-mail address.
     *
     * @param  string  $email
     * @return \Laravel\Spark\Teams\Invitation
     */
    public function inviteUserByEmail($email) {}

    /**
     * Remove a user from the team by their ID.
     *
     * @param  int  $userId
     * @return void
     */
    public function removeUserById($userId) {}
}</code></pre>
<h4>database/migrations/DATE_create_teams_table.php</h4>
<p>Here's the <code>up</code> migration:</p>
<pre><code class="language-php">        // Create Teams Table...
        Schema::create('teams', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;integer('owner_id')-&gt;index();
            $table-&gt;string('name');
            $table-&gt;timestamps();
        });

        // Create User Teams Intermediate Table...
        Schema::create('user_teams', function (Blueprint $table) {
            $table-&gt;integer('team_id');
            $table-&gt;integer('user_id');
            $table-&gt;string('role', 25);

            $table-&gt;unique(['team_id', 'user_id']);
        });

        // Create Invitations Table...
        Schema::create('invitations', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;integer('team_id')-&gt;index();
            $table-&gt;integer('user_id')-&gt;nullable()-&gt;index();
            $table-&gt;string('email');
            $table-&gt;string('token', 40)-&gt;unique();
            $table-&gt;timestamps();
        });</code></pre>
<h4>resources/assets/js/app.js</h4>
<p>This is where your general application JavaScript should go, and it's pre-filled with some Spark JavaScript.</p>
<pre><code class="language-javascript">/*
 |--------------------------------------------------------------------------
 | Laravel Spark - Creating Amazing Experiences.
 |--------------------------------------------------------------------------
 |
 | First, we will load all of the "core" dependencies for Spark which are
 | libraries such as Vue and jQuery. Then, we will load the components
 | which manage the Spark screens such as the user settings screens.
 |
 | Next, we will create the root Vue application for Spark. We'll only do
 | this if a "spark-app" ID exists on the page. Otherwise, we will not
 | attempt to create this Vue application so we can avoid conflicts.
 |
 */

require('laravel-spark/core/dependencies');

if ($('#spark-app').length &gt; 0) {
    require('./spark/components')

    new Vue(require('laravel-spark'));
}</code></pre>
<h4>resources/assets/js/spark/components.js</h4>
<p>This pulls in the VueJS components for the individual pages.</p>
<pre><code class="language-javascript">/*
 |--------------------------------------------------------------------------
 | Spark Page Components
 |--------------------------------------------------------------------------
 |
 | These components control the user settings screens for Spark. You will
 | change these paths to your own custom components if you need to use
 | your own component to provide custom logic for your applications.
 |
 | In addition, the components which control the team settings and member
 | management are also included. Again, you may change these paths and
 | require your own custom-built components to manage these screens.
 */

require('laravel-spark/settings/dashboard/profile')
require('laravel-spark/settings/dashboard/security/password')
require('laravel-spark/settings/dashboard/security/two-factor')

require('laravel-spark/settings/team/owner')
require('laravel-spark/settings/team/membership/edit-team-member')</code></pre>
<h4>resources/views/home.blade.php</h4>
<p>This is the default home page that we looked at before.</p>
<pre><code class="language-php">@extends('spark::layouts.app')

@section('content')
&lt;!-- Main Content --&gt;
&lt;div class="container spark-screen"&gt;
    @if (Spark::usingTeams() &amp;&amp; ! Auth::user()-&gt;hasTeams())

        &lt;!-- Teams Are Enabled, But The User Doesn't Have One --&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-10 col-md-offset-1"&gt;
                &lt;div class="panel panel-default"&gt;
                    &lt;div class="panel-heading"&gt;You Need A Team!&lt;/div&gt;

                    &lt;div class="panel-body bg-warning"&gt;
                        It looks like you haven't created a team!
                        You can create one in your &lt;a href="/settings?tab=teams"&gt;account settings&lt;/a&gt;.
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

    @else

        &lt;!-- Teams Are Disabled Or User Is On Team --&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-10 col-md-offset-1"&gt;
                &lt;div class="panel panel-default"&gt;
                    &lt;div class="panel-heading"&gt;Dashboard&lt;/div&gt;

                    &lt;div class="panel-body"&gt;
                        Your Application's Dashboard.
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

    @endif
&lt;/div&gt;
@endsection</code></pre>
<h4>terms.md</h4>
<p>This file will generate your &quot;Terms of Service&quot; page.</p>
<pre><code class="language-markdown">This page is generated from the `terms.md` file in your project root.</code></pre>
<h3>Looking at your installation</h3>
<p>Phew. That was a lot. Let's actually see what we get here. First, we get the beautiful landing page we saw in the screenshot above. But what else?</p>
<p>First, let's check out our login page. Notice we have a nice Bootstrap-based layout with a fixed footer, Copyright information, and some basic social links.</p>
<p><img src="/assets/images/content/spark-login.png" alt="Spark Login page" /></p>
<p>We also got a Password Reset page:</p>
<p><img src="/assets/images/content/spark-password-reset.png" alt="Spark Password Reset page" /></p>
<p>And a Register page:</p>
<p><img src="/assets/images/content/spark-register.png" alt="Spark Register page" /></p>
<p>And terms of service:</p>
<p><img src="/assets/images/content/spark-terms-of-service.png" alt="Spark Terms of Service" /></p>
<p>Notice we also have error handling baked in:</p>
<p><img src="/assets/images/content/spark-error-handling.png" alt="Spark Error Handling" /></p>
<p>OK, time to register. Once we do, we hit the dashboard (<code>/home</code>), which has a dropdown menu allowing us to logout and edit our settings:</p>
<p><img src="/assets/images/content/spark-dashboard.png" alt="Spark Dashboard" /></p>
<p>Let's check out that User Settings Page. Notice that these are the tabs that we could've edited in the <code>SparkServiceProvider</code> above.</p>
<p><img src="/assets/images/content/spark-user-settings.png" alt="Spark User Settings" /></p>
<p>Edit your password and two-factor auth:</p>
<p><img src="/assets/images/content/spark-security.png" alt="Spark Security" /></p>
<p>That's it out-of-the-box. Let's explore some more concepts.</p>
<h2>Teams</h2>
<p>In order to enable your users to join teams, you need to use the <code>CanJoinTeams</code> trait in your User model. Thankfully, Spark already imported that class in your User model's import block, so it's as simple as adding <code>CanJoinTeams</code> to the <code>use</code> Trait list in your model:</p>
<pre><code class="language-php">// app/User.php
class User ...
{
    use Authorizable, Billable, CanJoinTeams, CanResetPassword, TwoFactorAuthenticatable;</code></pre>
<p>Now when we visit our user settings panel, we see something a little different:</p>
<p><img src="/assets/images/content/spark-add-team.png" alt="Spark Adding a Team" /></p>
<p>Let's add a team.</p>
<p><img src="/assets/images/content/spark-teams-page.png" alt="Spark Teams page" /></p>
<p>In this context, I choose to think of a Team as like an Account. We have a web app where you login, pay, and see your data not by a single user account, but by a Team/Group which has a single Owner. The Owner is responsible for paying and appointing admins; the admins and owner can invite and delete other users. Every user on the team uses it and accesses the same data, possibly with unique roles.</p>
<p>So, let's try editing a team and see what we get.</p>
<p><img src="/assets/images/content/spark-owner-settings.png" alt="Spark Team Owner Settings" /></p>
<p>Of course, we want to invite someone else to our team.</p>
<blockquote>
<p>Note: if you get a validation error the first time you try to invite someone to your team, check your logs; it's likely because the default Mail configuration (in <code>.env</code>) sends to Mailtrap.io. You can either change this, or set up Mailtrap so that your email works.</p>
</blockquote>
<p>Here's what we see until they accept:</p>
<p><img src="/assets/images/content/spark-invited-users.png" alt="Spark Invited Users" /></p>
<p>And what they see once they click the link in their email:</p>
<p><img src="/assets/images/content/spark-invited-registration.png" alt="Spark Invited Registration" /></p>
<p>Once that user signs up, they'll have the opportunity to leave your team:</p>
<p><img src="/assets/images/content/spark-leave-team.png" alt="Spark Leave Team" /></p>
<blockquote>
<p>Note: There are no default restrictions around creation of teams. Users can create as many teams as they like. It's up to you to constrain them using <code>validateNewTeamsWith()</code>.</p>
</blockquote>
<p>If you want to customize the validation of new team creation, check out the <code>validateNewTeamsWith()</code> method. As of the writing of this post, it's not shown by default in <code>SparkServiceProvider</code>, but you can go into the <code>customizeSpark()</code> method and add a call to it:</p>
<pre><code class="language-php">protected function customizeSpark()
{
    Spark::configure(...);

    Spark::validateNewTeamsWith(function() {
        // Validate here...
    });
}</code></pre>
<p>Also, note that, if you have teams enabled, you'll be prompted to name your team when you sign up:</p>
<p><img src="/assets/images/content/spark-team-on-registration.png" alt="Spark Name Team On Registration" /></p>
<p>Once you add the <code>CanJoinTeams</code> trait to your user model, they'll gain a few useful methods, including:</p>
<p><code>$user-&gt;hasTeams()</code> shows whether they have <em>any</em> teams that they're associated with.
<code>$user-&gt;current_team</code> or <code>$user-&gt;currentTeam()</code> accesses the currently-selected team.
<code>$user-&gt;ownsTeam($team)</code> determines whether the user owns the team passed in.
<code>$user-&gt;teamRole($team)</code> gets the role for the member's relationship to the team passed in.</p>
<h2>Payments &amp; Plans</h2>
<p>Until now, every sample I've show has been how the app works without Stripe and plans set up. Let's now go add a Stripe key and secret and add some plans to the <code>SparkServiceProvider</code>.</p>
<p>Like with Cashier, you need to add the plan to Stripe first. Let's add a free plan, and a yearly and monthly version of the same plan. Now, let's add them to the <code>SparkServiceProvider</code>:</p>
<pre><code class="language-php">    // SparkServiceProvider
    protected function customizeSubscriptionPlans()
    {
        Spark::free()
                -&gt;features([
                    'Feature 1',
                    'Feature 2',
                    'Feature 3',
                ]);

        Spark::plan('Basic Monthly', 'basic-monthly')-&gt;price(10)
                -&gt;trialDays(7)
                -&gt;features([
                    'Feature 1',
                    'Feature 2',
                    'Feature 3',
                ]);

        Spark::plan('Basic Yearly', 'basic-yearly')-&gt;price(120)
                -&gt;trialDays(7)
                -&gt;yearly()
                -&gt;features([
                    'Feature 1',
                    'Feature 2',
                    'Feature 3',
                ]);
    }</code></pre>
<p>All of a sudden, we get a Subscription tab:</p>
<p><img src="/assets/images/content/spark-subscription-tab.png" alt="Spark Subscription Tab" /></p>
<p>And check the registration flow now:</p>
<p><img src="/assets/images/content/spark-plan-switcher.gif" alt="Spark Plan Switcher" /></p>
<p>Then the registration page, taking your payment information:</p>
<p><img src="/assets/images/content/spark-billing-registration.png" alt="Spark Billing Information" /></p>
<p>You can check their plan in your code:</p>
<pre><code class="language-php">Auth::user()-&gt;getStripePlan();</code></pre>
<h2>Coupons</h2>
<p>Spark passes coupon requests along to Stripe, so you don't need to do anything to add them except to add the coupon to Stripe. Just have the users pass the coupon as a parameter when they visit the registration page:</p>
<pre><code>http://yourapp.com/register?coupon=yourCouponCodeHere</code></pre>
<p>Without having to write any code, you just got your coupon hooked right in:</p>
<p><img src="/assets/images/content/spark-coupon-registration.png" alt="Spark Coupon In Effect" /></p>
<p>You can also temporarily add a site-wide coupon by adding this in the <code>SparkServiceProvider</code> (likely in the <code>customizeSpark()</code> method):</p>
<pre><code class="language-php">Spark::promotion('coupon-code-here');</code></pre>
<h2>Roles</h2>
<p>You can define the roles for your team in <code>SparkServiceProvider</code> like we showed above.</p>
<pre><code class="language-php">    // SparkServiceProvider
    protected function customizeRoles()
    {
        Spark::defaultRole('member');

        Spark::roles([
            'admin' =&gt; 'Administrator',
            'member' =&gt; 'Member',
        ]);
    }</code></pre>
<p>You can customize the default role, choose the options (each with a key and a label), and once you create these roles you can check for them elsewhere:</p>
<p><code>echo Auth::user()-&gt;teamRole(Auth::user()-&gt;current_team);</code></p>
<p>I'm guessing there will be (or there are already and I haven't found it yet) simpler ways to get and check this sort of information, but it's in there already if you use code like the above.</p>
<h2>Views</h2>
<p>By default Spark publishes a few views. If you want more, there are two options: one for the basic views, and another for <em>all</em> views.</p>
<pre><code class="language-bash">php artisan vendor:publish --tag=spark-basics</code></pre>
<p>Which outputs these views:</p>
<pre><code>resources/views/vendor/spark/emails/auth/password/email.blade.php
resources/views/vendor/spark/emails/billing/invoice.blade.php
resources/views/vendor/spark/emails/team/invitations/new.blade.php
resources/views/vendor/spark/emails/team/invitations/existing.blade.php
resources/views/vendor/spark/welcome.blade.php
resources/views/vendor/spark/nav/guest.blade.php
resources/views/vendor/spark/layouts/app.blade.php
resources/views/vendor/spark/common/footer.blade.php
resources/views/vendor/spark/nav/authenticated.blade.php
resources/views/vendor/spark/layouts/common/head.blade.php
resources/views/vendor/spark/settings/tabs/profile.blade.php
resources/views/vendor/spark/settings/tabs/security.blade.php
resources/views/vendor/spark/settings/team/tabs/owner.blade.php
resources/views/vendor/spark/auth/registration/simple/basics.blade.php
resources/views/vendor/spark/auth/registration/subscription/basics.blade.php
resources/views/vendor/spark/settings/team/tabs/membership/modals/edit-team-member.blade.php</code></pre>
<p>Or, there's the full export:</p>
<pre><code class="language-bash">php artisan vendor:publish --tag=spark-full</code></pre>
<p>This outputs <em>every file</em> in the entire spark directory, which is far too many to list here. They'll all end up in <code>resources/views/vendor/spark</code>.</p>
<h2>Miscellaneous</h2>
<h3>Disabling Authy</h3>
<p>If you want to disable Two-Factor Authentication, add a <code>protected $twoFactorAuth = false;</code> property on your <code>SparkServiceProvider</code>. </p>
<h3>Other</h3>
<p>The Spark class has a few other methods available on it; here are a few of note:</p>
<p><code>Spark::forcingPromotion()</code> returns whether or not we're forcing a promotion site-wide at the moment.
<code>Spark::retrieveusersWith()</code> allows you to customize the method Spark uses to retrieve the current user.</p>
<h2>Conclusion</h2>
<p>You made it! This is a LOT, I know. Once Spark is settled, I'll write another bog post that's less of a deep dive and more of a general introduction to how Spark works, but since you're brave and looking at the alpha, I gave you a deeper dive.</p>
<p>In general, I couldn't be more excited about Spark. We write this sort of code <em>so often</em> and having a pre-built set of tools to do it for you--especially with as much nuance and customization as Spark provides--is amazing.</p>
<p>There's a lot more going on under the hood. I just revealed the pieces here that I think will be most interesting. Like I wrote before, this will all change; I'll do my best to keep it up to date, but I'd love your help in pointing out if I've missed anything.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/acl-access-control-list-authorization-in-laravel-5-1</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/acl-access-control-list-authorization-in-laravel-5-1"/>
        <title>ACL (Access Control List) Authorization in Laravel 5.1</title>
        <published>2015-09-09T00:00:00+00:00</published>
        <updated>2015-09-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">The authentication that Laravel provides out-of-th...</summary>
        <content type="html"><![CDATA[
        <p>The authentication that Laravel provides out-of-the-box makes it simple to get user signup, login, logout, and password resets up and running quickly and easily.</p>
<p>But if you needed to control access to certain sections of the site, or turn on or off particular pieces of a page for non-admins, or ensure someone can only edit their own contacts, you needed to bring in a tool like <a href="https://github.com/BeatSwitch/lock">BeatSwitch Lock</a> or hand-roll the functionality, which would be something called ACL: Access Control Lists, or basically the ability to define someone's ability to do and see certain things based on attributes of their user record.</p>
<p>Thankfully, Taylor and Adam Wathan wrote an ACL layer in Laravel 5.1.11 that provides this functionality without any added work.</p>
<h2>What can it do?</h2>
<p>The out-of-the-box Laravel ACL is called <code>Gate</code> (that's not a product name like &quot;Spark&quot;, but rather the name of the classes and the façades).</p>
<p>Using the <code>Gate</code> classes (either injecting them or using the Gate façade) allows you to easily check if a user (either the currently-logged-in user or a specific user) is &quot;allowed&quot; to do a certain thing. Check out this syntax for a taste:</p>
<pre><code class="language-php">if (Gate::denies('update-contact', $contact)) {
    abort(403);
}</code></pre>
<p>Drop that into your controller and it checks the currently authenticated user against a ruleset that you defined (and which you named <code>update-contact</code>); it takes the data of that particular contact, checks it agains the ruleset, and returns whether or not the user is authorized.</p>
<p>You can also check for <code>Gate::allows</code>, you can use it in conditionals in Blade with <code>@can</code>, and there's much, much more. So, let's take a look.</p>
<h2>How does it work?</h2>
<p>Everything with Laravel's ACL is founded on a concept called an &quot;Ability.&quot; An Ability is a key (e.g. &quot;update-contact&quot;) and a Closure (with optional parameters) that returns either true or false.</p>
<h3>Defining Abilities</h3>
<p>Let's define an Ability in the default location, the <code>AuthServiceProvider</code>:</p>
<pre><code class="language-php">...
class AuthServiceProvider extends ServiceProvider
{
    public function boot(GateContract $gate)
    {
        parent::registerPolicies($gate);

        $gate-&gt;define('update-contact', function ($user, $contact) {
            return $user-&gt;id === $contact-&gt;user_id;
        });
    }
}</code></pre>
<p>As you can see, the first parameter for our Closure is the user. If there's no currently-authenticated user (and if you haven't specified one--we'll see that later), Gate will automatically return false for every Ability.</p>
<h4>Class methods instead of Closures</h4>
<p>Just like most other places in Laravel that accept Closures (e.g. route definition), you can pass a class name and method into the second parameter of <code>define</code> instead of a Closure, and it'll be resolved out of the Container:</p>
<pre><code class="language-php">$gate-&gt;define('update-post', 'PostACLCheckerThingie@update');</code></pre>
<h3>Checking with Façades</h3>
<p><code>Gate</code> allows you to check using the following methods: <code>check</code>, <code>allows</code>, or <code>denies</code>. Note that <code>check</code> is just the same as <code>allows</code>, and <code>denies</code> is exactly the opposite of <code>allows</code>; so it's really just <code>allows</code> with a clone named <code>check</code> and an opposite check named <code>denies</code>.</p>
<p>If you're using the façade, you won't need to pass in the user; the façade automatically passes in the currently authenticated user for you.</p>
<pre><code class="language-php">if (Gate::denies('update-contact', $contact)) {
    abort(403);
}</code></pre>
<pre><code class="language-php">if (Gate::allows('create-contact')) {
    redirect('hooray');
}</code></pre>
<p>Or, if you've defined an Ability with multiple parameters:</p>
<pre><code class="language-php">$gate-&gt;define('delete-interaction', function ($user, $contact, $interaction) {
    // Do stuff...
});</code></pre>
<p>Just pass an array to the second parameter:</p>
<pre><code class="language-php">if (Gate::allows('delete-interaction', [$contact, $interaction]) {
    // Do stuff...
});</code></pre>
<p>What if you want to check this ability for a specific user, instead of the currently authenticated user?</p>
<pre><code class="language-php">if (Gate::forUser($user)-&gt;denies('update-contact', $contact)) {
    abort(403);
}</code></pre>
<h3>Checking with Injected Gate</h3>
<p>As always, you can inject the class itself instead of using the façade. The class you'll inject is the same <code>GateContract</code> that's injected into the <code>AuthServiceProvider</code>: <code>Illuminate\Contracts\Auth\Access\Gate</code>.</p>
<pre><code class="language-php">    public function somethingResolvedFromContainer(Gate $gate)
    {
        if ($gate-&gt;denies('create-team')) {
            // etc.
        }
    }</code></pre>
<h3>Checking on the user model</h3>
<p>Laravel's <code>App\User</code> model now provides <code>can</code> and <code>cannot</code>, which mirror <code>allows</code> and <code>denies</code> on the <code>Gate</code>. This comes from the <code>Authorizable</code> trait.</p>
<p>So, if we have a user somewhere, we can check <code>can()</code> on them:</p>
<pre><code class="language-php">if ($user-&gt;can('update-contact', $contact)) {
    // Do stuff
}</code></pre>
<h3>Blade</h3>
<p>You can also use <code>can</code> (optionally with <code>else</code>) in Blade:</p>
<pre><code class="language-php">&lt;nav&gt;
    &lt;a href="/"&gt;Home&lt;/a&gt;
    @can('edit-contact', $contact)
        &lt;a href="{{ route('contacts.edit', [$contact-&gt;id]) }}"&gt;Edit This Contact&lt;/a&gt;
    @endcan
&lt;/nav&gt;</code></pre>
<h3>Intercepting checks</h3>
<p>What if you have the idea of a superuser, or admin? Or what if you want to be able to set a temporary toggle to change the ACL logic for your users?</p>
<p>The <code>before</code> function allows you to return early, before all of your other checks, in certain exceptional circumstances.</p>
<pre><code class="language-php">$gate-&gt;before(function ($user, $ability) {
    if ($user-&gt;last_name === 'Stauffer') {
        return true;
    }
});</code></pre>
<p>Or, more realistically:</p>
<pre><code class="language-php">$gate-&gt;before(function ($user, $ability) {
    if ($user-&gt;isOwner()) {
        return true;
    }
});</code></pre>
<h3>Policies</h3>
<p>There's another concept that you can (optionally) use to define access logic in your applications. It's an organizational structure that'll help keep you from crudding up the <code>AuthServiceProvider</code>; it's almost like a controller, in that it helps you group your ACL logic based on the resource that it's controlling access to.</p>
<h4>Generating Policies</h4>
<p>You can generate a policy with Artisan:</p>
<pre><code class="language-bash">php artisan make:policy ContactPolicy</code></pre>
<p>Then you register it with the <code>AuthServiceProvider</code> in the <code>policies</code> property:</p>
<pre><code class="language-php">class AuthServiceProvider extends ServiceProvider
{
    protected $policies = [
        Contact::class =&gt; ContactPolicy::class,
    ];</code></pre>
<p>Here's what our auto-generated Policy looks like:</p>
<pre><code class="language-php">&lt;?php

namespace App\Policies;

class ContactPolicy
{
    /**
     * Create a new policy instance.
     *
     * @return void
     */
    public function __construct()
    {
        //
    }
}</code></pre>
<p>So, let's define the <code>update</code> method:</p>
<pre><code class="language-php">&lt;?php

namespace App\Policies;

class ContactPolicy
{
    public function update($user, $contact)
    {
        return $user-&gt;id === $contact-&gt;user_id;
    }
}</code></pre>
<blockquote>
<p>Note: I've primarily been using the <code>update</code> method as an example here. There are a few situations (see below) where the method name matters, because it needs to sync with the calling method. But you'll like have a variety of method names: <code>show</code>, <code>create</code>, or even <code>addInteraction</code>.</p>
</blockquote>
<h4>Checking Policies</h4>
<p>If there's a policy defined for a resource type, the <code>Gate</code> will use the first parameter key to figure out which method to check on your policy.</p>
<p>So, to check if you can update a Contact, just pass the contact in and check for the <code>update</code> Ability. This code will pass to the <code>update</code> method on the <code>ContactPolicy</code>:</p>
<pre><code class="language-php">if (Gate::denies('update', $contact)) {
    abort(403);
}</code></pre>
<p>This also works for the User model checking and Blade checking.</p>
<p>Additionally, there's a <code>policy</code> helper that allows you to retrieve a policy class and run its methods:</p>
<pre><code class="language-php">if (policy($contact)-&gt;update($user, $contact)) {
    // Do stuff
}</code></pre>
<h3>Controller authorization</h3>
<p>Since much of the authorization will be quitting out of a controller method if the Ability is denied, there's a shortcut for that <em>when in a Controller</em> (which is added via the new <code>AuthorizesRequests</code> trait):</p>
<pre><code class="language-php">    public function update($id)
    {
        $contact = Contact::findOrFail($id);

        $this-&gt;authorize('update', $contact);

        // Do stuff...
    }</code></pre>
<p>Just like in our examples above, this will throw a <code>403</code> error if the authorization fails.</p>
<p>And finally, if your controller method name lines up with the same method name on the Policy (e.g. the <code>update</code> controller method and the <code>update</code> method on the Policy), you can skip the first parameter of <code>authorize</code> entirely:</p>
<pre><code class="language-php">    public function update($id)
    {
        $contact = Contact::findOrFail($id);

        $this-&gt;authorize($contact);

        // Do stuff...
    }</code></pre>
<p>This is one of my favorites; you might not love the magic, but since this is something I do <em>so often</em>, I'm really excited to trim down the amount of my controller methods that are dedicated to <em>the same ACL logic, over and over.</em></p>
<h2>Concliption</h2>
<p>That's it. As someone who has written ACLs dozens of times, I can say: This is better than anything I've built, simpler than anything I've imported from others, and does everything I need.</p>
<p>If you need anything like Roles, user groups, or database-defined permissions levels, you'll still need to do some of the work yourself--and you may still find yourself reaching for an external package. But for most circumstances, this is more than enough, and just as simple as it can be.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/restoring-lost-innodb-mysql-databases-after-all-data-and-hope-was-lost-with-drop-tables
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/restoring-lost-innodb-mysql-databases-after-all-data-and-hope-was-lost-with-drop-tables"/>
        <title>Restoring lost InnoDB MySQL databases after all data and hope was lost with DROP TABLES</title>
        <published>2015-08-29T00:00:00+00:00</published>
        <updated>2015-08-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Tonight we had a DROP TABLES command run on a live...</summary>
        <content type="html"><![CDATA[
        <p>Tonight we had a <code>DROP TABLES</code> command run on a live production database. It happened about four hours before I was scheduled to turn on database backups, and about three days before I was scheduled to move the site to a server that Linode backs up daily. If you're not familiar with this, it basically means we lost every tiny little piece of data on a live server. Everything.</p>
<p><a href="http://xkcd.com/327/"><img src="http://imgs.xkcd.com/comics/exploits_of_a_mom.png" alt="Little Bobby Tables" /></a></p>
<p>Needless to say, we all freaked. It's a product in alpha, with just a few very early testers, which is why it was on a crappy server. But this was still terrible for us; we want our customers to be able to rely on us to keep their data safe, even in an early alpha. We had one or two users who weren't just kicking the tires but were actually using this for their day-to-day work. I hadn't gotten the backups turned on because I had been traveling and I had a reminder set at 9:30pm to turn them on.</p>
<p><img src="/assets/images/content/sql-backups-reminder.png" alt="reminder" /></p>
<h2>The short story</h2>
<p>I may expand this blog post later, but in short: I've worked with my team since 6pm eastern (it's 2:35am eastern right now), I'm exhausted and need to sleep, but we went from <em>every database table is not just truncated but entirely deleted</em> to <em>we have all of our data back in one piece.</em></p>
<p>It's all due to the magician that is Aleks, the man beind <a href="https://twindb.com/">Twindb</a>. Through his articles, and a bit of Twitter and email help, I was able to extract our old data from the deepest depths of InnoDB's operating archives.</p>
<h2>Synopsis of the solution</h2>
<p>In short, we used the tool <code>sys_parser</code> to recover our SQL schema ([<a href="https://twindb.com/recover-table-structure-from-innodb-dictionary/](Recover">https://twindb.com/recover-table-structure-from-innodb-dictionary/](Recover</a> table structure from InnoDB dictionary)). Then we installed Twindb's InnoDB recovery kit using the instructions on the first half of this post: <a href="https://twindb.com/how-to-recover-innodb-dictionary/">How to Recover InnoDB Dictionary</a>. Finally, we used the instructions at <a href="https://twindb.com/recover-innodb-table-after-drop-table-innodb/">Recover InnoDB Table After DROP</a> to extract the pages of the InnoDB storage file into individual files using <code>stream_parser</code>, and with a combination of <code>grep</code> and <code>c_parser</code>, we identified which page each table was stored in, and then used <code>c_parser</code> and the schema SQL files we generated with <code>sys_parser</code> to create files we could import into SQL.</p>
<h2>@todo: A longer walkthrough</h2>
<p>If I have enough energy to talk about this later, I'll write it up further. But it needs to be said: We wouldn't've gotten anywhere without the help of the man behind Twindb, Aleksandr Kuzminsky. Just look at this <a href="https://twitter.com/twindba/status/637497047529078785">Twitter thread</a>. He also emailed with me in the midst of traveling to a camp site. I can't thank him enough for his help on this.</p>
<p>Also, many, many friends responded to my request for help on Twitter. Thank you so much.</p>
<p>So, know: it is possible to recover data even after a full drop/truncate. It's a lot of work, and you're much better off just backing up your data regularly. But if you're already in that spot... it can be done.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/login-throttling-in-laravel-5.1</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/login-throttling-in-laravel-5.1"/>
        <title>Login Throttling in Laravel 5.1</title>
        <published>2015-07-31T00:00:00+00:00</published>
        <updated>2015-07-31T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve ever run a SaaS (or put any web site wit...</summary>
        <content type="html"><![CDATA[
        <p>If you've ever run a SaaS (or put any web site with comments or signups on the Internet for any length of time), you've experienced the annoyance of spam signups and comments.</p>
<p>But, whether or not you know it, any login forms are likely to get a lot of automated login attempts. Most login forms don't stop an automated attack trying email after email, password after password, and since those aren't being logged, you might not even know it's happening.</p>
<p>The best solution to something like this is to halt a user from attempting logins after a certain number of failed attempts. This is called login throttling, or rate limiting.</p>
<p>Graham Campbell wrote a great package called <a href="https://github.com/GrahamCampbell/Laravel-Throttle">Laravel Throttle</a> to address this in previous versions of Laravel, but in Laravel 5.1 Login throttling comes right out of the box.</p>
<h2>How to Enable Login Throttling in Laravel 5.1</h2>
<p>By default, Laravel 5.1's <code>AuthController</code> already imports the <code>ThrottlesLogins</code> trait, so every new Laravel 5.1 app already has this enabled out of the box.</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Controllers\Auth;

use App\User;
use Validator;
use App\Http\Controllers\Controller;
use Illuminate\Foundation\Auth\ThrottlesLogins;
use Illuminate\Foundation\Auth\AuthenticatesAndRegistersUsers;

class AuthController extends Controller
{
    use AuthenticatesAndRegistersUsers, ThrottlesLogins;</code></pre>
<p>In order for it to work, you just need to display errors on your login page, which you'll likely already have because you need to display &quot;bad username/password&quot; type errors; something like this:</p>
<pre><code class="language-php">@if (count($errors) &gt; 0)
    &lt;div class="alert alert-danger"&gt;
        &lt;strong&gt;Whoops!&lt;/strong&gt; There were some problems with your input.&lt;br&gt;&lt;br&gt;
        &lt;ul&gt;
            @foreach ($errors-&gt;all() as $error)
                &lt;li&gt;{{ $error }}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
    &lt;/div&gt;
@endif</code></pre>
<p>Once you do, anyone who has 5 failed logins in a row will be stopped from logging in for 60 seconds. Both of these values are customizable; read below to see how.</p>
<p><img src="/assets/images/content/laravel-throttling.gif" alt="Laravel Throttling in action" /></p>
<h2>How Laravel 5.1's Login Throttling works</h2>
<p>If you check out the <code>ThrottlesLogins</code> trait, you can see it's incrementing a cache counter on every failed login. The cache key for whether you're treated as the same user is based on username and IP address:</p>
<pre><code class="language-php">return 'login:attempts:'.md5($username.$request-&gt;ip());</code></pre>
<p>That leaves us with code looking like this:</p>
<pre><code class="language-php">$attempts = $this-&gt;getLoginAttempts($request);

$lockedOut = Cache::has($this-&gt;getLoginLockExpirationKey($request));

if ($attempts &gt; $this-&gt;maxLoginAttempts() || $lockedOut) {
    if (! $lockedOut) {
        Cache::put(
            $this-&gt;getLoginLockExpirationKey($request), time() + $this-&gt;lockoutTime(), 1
        );
    }

    return true;
}

return false;</code></pre>
<p>We can also learn that we can customize how long it locks them out by simply setting a <code>lockoutTime</code> property on our <code>AuthController</code>:</p>
<pre><code class="language-php">private function lockoutTime() 
{
    return property_exists($this, 'lockoutTime') ? $this-&gt;lockoutTime : 60;
}</code></pre>
<p>The same is true for the number of login attempts; customize that with a <code>maxLoginAttempts</code> property. We learn that here:</p>
<pre><code class="language-php">protected function maxLoginAttempts()
{
    return property_exists($this, 'maxLoginAttempts') ? $this-&gt;maxLoginAttempts : 5;
}</code></pre>
<h2>Conclusion</h2>
<p>So: upgrade to Laravel 5.1 and you get free login throttling with a simple trait. Start new apps in Laravel 5.1 and they get login throttling for free out of the box. Security FTW.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/using-github-authentication-for-login-with-laravel-socialite</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/using-github-authentication-for-login-with-laravel-socialite"/>
        <title>Using Github authentication for login with Laravel Socialite</title>
        <published>2015-07-16T00:00:00+00:00</published>
        <updated>2015-07-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel&#039;s Socialite package makes it simple to aut...</summary>
        <content type="html"><![CDATA[
        <p>Laravel's <a href="https://github.com/laravel/socialite">Socialite</a> package makes it simple to authenticate your users to  Facebook, Twitter, Google, LinkedIn, GitHub and Bitbucket. You can authenticate them for the purpose of connecting their pre-existing user account to a third-party service, but you can also use it as your primary login mechanism, which we'll be talking about here.</p>
<p>I'm working on a new little micro-SaaS that is purely dependent on GitHub in order to operate, so there's no reason to set up any user flow other than just GitHub. Let's do it.</p>
<h2>Pre-cursor</h2>
<p>There's a little bit of knowledge about how OAuth works that'll help to get started. The general flow for an OAuth application that's authenticating the way we will be here is:</p>
<ol>
<li>User visits page that requires authentication. Authentication page directs them to login page.</li>
<li>Login page either immediately directs them to the service (e.g. GitHub) or has a &quot;Login with GitHub&quot; button that directs them to the service.</li>
<li>User visits a page on the service's web site and carries with them information about the consuming web site (MySocialiteApplication.com, which might have a GitHub Application ID of <code>12345</code>) and a call back URL (<code>http://mysocialiteapplication.com/auth/github/callback</code>, maybe).</li>
<li>User signs into the service provider (e.g. Github) and GitHub redirects them back to the callback URL, along with a one-time use &quot;token&quot; that identifies them</li>
<li>The consuming application (<code>MySocialiteApplication.com</code>) uses the token to request a dump of information about the authenticating user from GitHub.</li>
<li>The consuming application takes that information and does something with it&mdash;in this case, marks the user as authenticated and lets them use the site.</li>
</ol>
<p>OK, so now you understand the basic flow, let's get started with Socialite.</p>
<h2>Install Socialite</h2>
<pre><code class="language-bash">$ composer require laravel/socialite</code></pre>
<p>To hook Socialite into your Laravel application, edit <code>config/app.php</code> and add the following line to the Service Providers array:</p>
<pre><code class="language-php">Laravel\Socialite\SocialiteServiceProvider::class,</code></pre>
<p>and add the following line to the Aliases array:</p>
<pre><code class="language-php">'Socialite' =&gt; Laravel\Socialite\Facades\Socialite::class,</code></pre>
<p>Socialite is now hooked into your application and booting. Let's get your credentials set up.</p>
<h2>Create GitHub app</h2>
<p>For this particular example, we'll be using GitHub as our authentication provider. If you wanted, though, you could use one of the other options, or you could set up multiple authentication options.</p>
<p>First, let's go to GitHub and set up a new Application. If you're new to OAuth, you'll need to create an account and then an Application with each service provider. The application will ask you questions like &quot;What's the name of your application&quot;, &quot;What's the callback URL&quot;, etc.</p>
<p>Once you complete it, you'll usually get a client ID and a client Secret, which we need to capture in order to configure Socialite correctly.</p>
<p>So, visit <a href="https://github.com/settings/applications/new">GitHub's New Application page</a>, fill out the form, and grab your client ID and secret.</p>
<p>For now, I'm setting the callback URL to be:
<code>http://mysocialiteapplication.app:8000/auth/github/callback</code>, but you should set it to whatever the GitHub callback URL will be on your development environment.</p>
<blockquote>
<p>Note: You can create a separate Application later for the production version of the site that has the production callback URL, or you can just adjust this once you go live--but that'll mean this authentication feature won't work locally anymore.</p>
</blockquote>
<h2>Services config</h2>
<p>Now, let's paste the authentication information in where Socialite can access it. This lives in <code>config/services.php</code>, and as you can see, I've chosen to reference environment variables instead of pasting the values directly in:</p>
<pre><code class="language-php">'github' =&gt; [
    'client_id' =&gt; env('GITHUB_ID'),
    'client_secret' =&gt; env('GITHUB_SECRET'),
    'redirect' =&gt; env('GITHUB_URL'),
],</code></pre>
<p>So, let's add those values to our <code>.env.example</code> and to our <code>.env</code> files:</p>
<pre><code>GITHUB_ID=client id from github
GITHUB_SECRET=client secret from github
GITHUB_URL=http://mysocialiteapplication.app:8000/auth/github/callback</code></pre>
<p>Boom. Socialite can now hit GitHub for you. Let's set up our routes and controller methods.</p>
<h2>Routes</h2>
<p>Add these routes to <code>routes.php</code> (you can make them anything you want, but this is the convention):</p>
<pre><code class="language-php">    Route::get('auth/github', 'Auth\AuthController@redirectToProvider');
    Route::get('auth/github/callback', 'Auth\AuthController@handleProviderCallback');</code></pre>
<p>Now let's fill out those controller methods:</p>
<h2>Controller methods</h2>
<p>In <code>Auth\AuthController</code>:</p>
<pre><code class="language-php">    /**
     * Redirect the user to the GitHub authentication page.
     *
     * @return Response
     */
    public function redirectToProvider()
    {
        return Socialite::driver('github')-&gt;redirect();
    }

    /**
     * Obtain the user information from GitHub.
     *
     * @return Response
     */
    public function handleProviderCallback()
    {
        try {
            $user = Socialite::driver('github')-&gt;user();
        } catch (Exception $e) {
            return Redirect::to('auth/github');
        }

        $authUser = $this-&gt;findOrCreateUser($user);

        Auth::login($authUser, true);

        return Redirect::to('home');
    }

    /**
     * Return user if exists; create and return if doesn't
     *
     * @param $githubUser
     * @return User
     */
    private function findOrCreateUser($githubUser)
    {
        if ($authUser = User::where('github_id', $githubUser-&gt;id)-&gt;first()) {
            return $authUser;
        }

        return User::create([
            'name' =&gt; $githubUser-&gt;name,
            'email' =&gt; $githubUser-&gt;email,
            'github_id' =&gt; $githubUser-&gt;id,
            'avatar' =&gt; $githubUser-&gt;avatar
        ]);
    }</code></pre>
<p>You can structure this code any way you want; many folks will create an authentication service and inject it in. Handle it however you want, but the above is what it should be doing in general.</p>
<p>First we redirect to GitHub; when the redirect comes back, we grab the relevant information, and then we either look up the user and authenticate as that user, or we create a new user and authenticate.</p>
<h2>Database</h2>
<p>We need to update our <code>users</code> migration so that it will allow us to store some GitHub-specific information. There's more information that comes back from GitHub, but here's what I chose to store. Since this is a new app, I could just modify the <code>users</code> migration, but if you have an existing app, you'll need to make a new migration.</p>
<pre><code class="language-php">            $table-&gt;increments('id');

            // Cached from GitHub
            $table-&gt;string('github_id')-&gt;unique();
            $table-&gt;string('name');
            $table-&gt;string('email');
            $table-&gt;string('avatar');

            $table-&gt;rememberToken();
            $table-&gt;timestamps();</code></pre>
<h2>User Eloquent</h2>
<p>Finally, let's update the Eloquent User model so we can fill the new GitHub fields:</p>
<pre><code class="language-php">    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = ['name', 'email', 'github_id', 'avatar'];</code></pre>
<p>That's it. Let's see how this works now.</p>
<h2>Using it</h2>
<p>Set up a button on some page on your site that directs to <code>auth/github</code>.</p>
<p><img src="/assets/images/content/Screen-Shot-2015-07-16-at-1.45.52-PM.png" alt="Github login button" /></p>
<p>The user will be sent to GitHub, asked to give permissions to your app, and upon approval, sent back to <code>auth/github/callback</code>.</p>
<p><img src="/assets/images/content/authorize-github-socialite.png" alt="Github auth screen" /></p>
<p>Then your callback code will run and will either log in the pre-existing user or create a new user and log in as that.</p>
<p>Then the user should be forwarded to <code>home</code>, and you now have a Laravel-authenticated user, with a Laravel user session and all of the functionality of the <code>Auth</code> façade and driver available to you.</p>
<p>You can go build a <code>logout</code> route that runs <code>Auth::logout</code> or whatever else you like; at this point, you're up and running using Socialite for GitHub authentication! Enjoy!</p>
<h2>PostScript: Adam Wathan's Eloquent OAuth L5</h2>
<p>Quick note: if you plan to use the social services for <em>login only</em>, and you want to hook it into Laravel's user and authentication systems as your primary use (like we did here), there's a package for that: Adam Wathan's <a href="https://github.com/adamwathan/eloquent-oauth-l5">Eloquent OAuth L5</a>. It takes what we did here and makes it a lot simpler. Watch <a href="https://vimeo.com/120085196">this video</a> to learn how it works.</p>
<p>This is the sample code for using his code:</p>
<pre><code class="language-php">// Redirect to Facebook for authorization
Route::get('facebook/authorize', function() {
    return OAuth::authorize('facebook');
});

// Facebook redirects here after authorization
Route::get('facebook/login', function() {

    // Automatically log in existing users
    // or create a new user if necessary.
    OAuth::login('facebook');

    // Current user is now available via Auth facade
    $user = Auth::user();

    return Redirect::intended();
});</code></pre>
<p>As you can see, some of the work we had to do in our controller code has been abstracted away.</p>
<p>If you're using social services <em>on top of</em> other authentication systems, though, or if you're using it for functional components like pulling information from Github, or if it's not hooking into Eloquent users, you'll want to stick with Socialite.</p>
<p>Whichever tool you use, just know that it's very, very simple to set up social logins and authentication with your Laravel applications.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/excluding-routes-from-the-csrf-middleware-in-laravel-5.1</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/excluding-routes-from-the-csrf-middleware-in-laravel-5.1"/>
        <title>Excluding Routes from the CSRF Middleware in Laravel 5.1</title>
        <published>2015-07-07T00:00:00+00:00</published>
        <updated>2015-07-07T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Whoops! I missed a feature from my Laravel 5.1 rev...</summary>
        <content type="html"><![CDATA[
        <p>Whoops! I missed a feature from my Laravel 5.1 review!</p>
<p>It's now super easy to exclude specific routes from your CSRF middleware:</p>
<pre><code class="language-php">// app/Http/Middleware/VerifyCsrfToken
protected $except = [
 'webhook/*'
];</code></pre>
<p>Learn more about how, and why, it works at <a href="https://laravel-news.com/2015/06/excluding-routes-from-the-csrf-middleware/?utm_medium=referral&amp;utm_source=mattstauffer.co&amp;utm_campaign=matt-loves-laravel-news">Laravel News': Excluding Routes from the CSRF Middleware</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/sublime-text-3-for-php-developers</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/sublime-text-3-for-php-developers"/>
        <title>Sublime Text (3) for PHP Developers</title>
        <published>2015-06-26T00:00:00+00:00</published>
        <updated>2015-06-26T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">A lot of folks in the PHP community have been chec...</summary>
        <content type="html"><![CDATA[
        <p>A lot of folks in the PHP community have been checking out PHPStorm lately, including myself and most of the developers I work with. We love the code intelligence we get from PHPStorm, but still miss the speed, quick boot-up, and convenience of Sublime Text.</p>
<p>Before I blindly assume PHPStorm is the only way to go, I wanted to see: Can I bring the things a PHP-focused IDE provides PHP developers back to Sublime Text and get the best of both worlds?</p>
<p>Let's start with a quick list of ways that PHPStorm really sets itself apart for me. Please note: There are a million other features that PHPStorm uniquely offers, but to be honest, it's the tiny little conveniences that I've seen provide the biggest boost in efficiency.</p>
<p>Also note: This is Sublime Text 3 we're talking about.</p>
<h2>My Must-Haves From PHPStorm</h2>
<p>Without most of these wonderful PHP-focused features, it'll be hard to recommend using something other than PHPStorm, even if it's slower and costlier and uses more memory. So. Can we reproduce them in Sublime Text?</p>
<ul>
<li>Auto-<code>use</code> (import) of classes</li>
<li>Class FQCN inline completion</li>
<li>Easily navigate to a symbol's definition</li>
<li>Easy constructor injection</li>
<li>Highlight unused imports</li>
<li>Git gutters</li>
<li>Code sniffing/PSR-2 validation</li>
<li>Code Completion: PHP</li>
<li>Code Completion: project code</li>
</ul>
<h2>Package Control</h2>
<p>Before we talk about anything else, you at least need to know how to install packages in Sublime Text. </p>
<p>If you haven't yet, <a href="https://packagecontrol.io/installation">Go install Package Control now</a>.</p>
<p>Unless otherwise specified, every package after this should be installed using Package Control.</p>
<h2>Sublime PHP Companion</h2>
<p>The most significantly PHP-focused package for Sublime Text is called <a href="https://github.com/erichard/SublimePHPCompanion">Sublime PHP Companion</a>.</p>
<p>Like most packages, it contains a series of actions you can perform. <del>They're mapped to certain keys by default, but you can always re-map them.</del> Update: there is no keymapping by default anymore. <a href="https://github.com/erichard/SublimePHPCompanion/blob/master/messages/1.0.0.txt">Learn more about how to set up PHPCompanion keymapping here</a>.</p>
<ul>
<li><strong>find_use</strong> (<code>F10</code>) - When your cursor is over a class name, this command makes it simple to <code>use</code> (import) that class.
<img src="/assets/images/content/php-companion-use.gif" alt="find_use" /></li>
<li><strong>expand_fqcn</strong> (<code>F9</code>) - Same as <code>find_use</code> but instead of expanding the class in the import block, it expands its FQCN inline. <img src="/assets/images/content/php-companion-use-inline.gif" alt="expand_fqcn" /></li>
<li><strong>import_namespace</strong> (<code>F8</code>) - Adds the namespace for the current file based on the file's path.</li>
<li><strong>goto_definition_scope</strong> (<code>shift+F12</code>) - Same as Sublime Text's native <strong>goto_definition</strong> (described below), but scoped in a PHP-aware manner.</li>
</ul>
<p>The package isn't perfect, and it is clearly not as bright as PHPStorm is when it comes to detecting namespaces and parsing some weird edge cases. But for day-to-day work, this is a huge boost in the PHP-code-knowledge area.</p>
<h2>AllAutocomplete</h2>
<p>Sublime PHP Companion doesn't sniff your classes and give you autocompletion, sadly, but <a href="https://github.com/alienhard/SublimeAllAutocomplete">SublimeAllAutocomplete</a> does register the names of all symbols (functions, classes, etc.) in any files you have open in other tabs and add those to the autocomplete register.</p>
<p>This isn't quite the same as full userland-code-sensitive autocompletion, but it helps a lot.</p>
<p><img src="/assets/images/content/allautocomplete.gif" alt="AllAutocomplete demonstration" /></p>
<h2>Cmd-click for function definition</h2>
<p>Sublime PHP Companion makes it easy to right click on functions and go to their definitions, but this shortcut brings back PHPStorm's CMD-click-to-definition. FYI, in Sublime Text CMD (or windows' ctrl key or whatever it is on other systems) is called &quot;Super&quot;.</p>
<p>First, create a user mousemap file. If you don't have one, go here:</p>
<p><strong>Linux</strong><br />
Create <code>Default (Linux).sublime-mousemap</code> in <code>~/.config/sublime-text-3/Packages/User</code></p>
<p><strong>Mac</strong><br />
Create <code>Default (OSX).sublime-mousemap</code> in <code>~/Library/Application Support/Sublime Text 3/Packages/User</code></p>
<p><strong>Windows</strong><br />
Create <code>Default (Windows).sublime-mousemap</code> in <code>%appdata%\Sublime Text 3\Packages\User</code></p>
<p>Next, place this in the file:</p>
<pre><code class="language-json">[
    {
        "button": "button1", 
        "count": 1, 
        "modifiers": ["ctrl"],
        "press_command": "drag_select",
        "command": "goto_definition"
    }
]</code></pre>
<p>You just taught Sublime Text this: &quot;when I hold ctrl and click button one, fire the <code>goto_definition</code> command.&quot; Done! (<a href="https://gist.github.com/kendellfab/6135193">original source</a>)</p>
<p><img src="/assets/images/content/st-click-to-definition.gif" alt="ST Click to definition" /></p>
<blockquote>
<p>Note: I originally wanted to suggest using the <code>super</code> modifier, so it would be just like PHPStorm; however, that would override Sublime Text's &quot;hold <code>super</code> and click to get multiple cursors&quot; behavior, so I didn't.</p>
</blockquote>
<h2>Code sniffing and PHP_CodeSniffer</h2>
<h3>Sublime PHPCS</h3>
<p>There's a package named <a href="http://benmatselby.github.io/sublime-phpcs/">Sublime PHPCS</a> that brings PHP_CodeSniffer, PHP's linter, PHP Mess Detector, and Scheck (?) to bear on your code.</p>
<p>You can tweak all sorts of settings, but you're primarily either going to run it every time you save your file (good, but can get annoying), or every time you trigger it from the command palette (press <code>super-shift-p</code> and then type until you get &quot;PHP Code Sniffer: Sniff this file&quot;) or keyboard shortcut (<code>ctrl-super-shift-s</code> by default).</p>
<p>You'll get gutter highlights and a list up top of all of the places your code doesn't satisfy the linter.</p>
<p>Note that this and any other packages that rely on code sniffing and linting will be requiring command line applications installed, so be sure to visit their sites and read their directions.</p>
<h3>PHP_CodeSniffer Sublime Text 2/3 Plugin</h3>
<p>Interestingly, there's a relatively un-noticed plugin doing the same thing (but for PHPCS only) that's written by the same group that wrote PHP CodeSniffer, so it might be worth checking out as well; it's called <a href="https://github.com/squizlabs/sublime-PHP_CodeSniffer">PHP_CodeSniffer Sublime Text 2/3 Plugin</a> (creative, I know.)</p>
<p>I've never used this one, though, so proceed with caution.</p>
<h3>Mike Francis PHP CS Fixer Build Script</h3>
<p><a href="http://twitter.com/_mikefrancis">Mike Francis</a> also shared a <a href="https://gist.github.com/mikefrancis/63436f1cb94ec31ce31f">custom build script</a> he wrote that runs PHP-CS-Fixer on your code whenever you trigger it. That means it'll actually enforce PSR-2 (or whatever other PHP-CS-Fixer standard you pass it) on your code for you.</p>
<p>Taylor Otwell actually shared this same script with me, but he didn't write it up as nicely as Mike did. :) He did, however, mention that you might want to set this preference: <code>"show_panel_on_build": false,</code> This'll keep it from popping out the command panel with your results every time, which can get very irritating very quickly.</p>
<h3>SublimeLinter</h3>
<p><a href="https://packagecontrol.io/packages/SublimeLinter-php">SublimeLinter PHP</a> (and its required dependency, <a href="http://sublimelinter.readthedocs.org/en/latest/installation.html">SublimeLinter</a>) rely on PHP's built-in linter (just like the Sublime PHPCS plugin above). This is a simpler version that <em>only</em> runs the linter, nothing else.</p>
<h2>DocBlockr</h2>
<p>If you're the type to use PHPStorm, there's a greater chance that you're the type to write Doc blocks. (Just sayin').</p>
<p><a href="https://github.com/spadgos/sublime-jsdocs">DocBlockr</a> makes it simple to create new doc blocks, but more importantly, if you create a doc block just above a defined function, it will extract that function's parameter information and pre-fill it in your doc block. Boom.</p>
<p><img src="/assets/images/content/docblock.gif" alt="DocBlockr in action" /></p>
<h2>Git helpers</h2>
<h3>Sublime Text Git</h3>
<p>Are you the type that hates switching from your IDE to your terminal/Git client? <a href="https://github.com/kemayo/sublime-text-git">Sublime Text Git</a> provides access to many Git commands directly from the Sublime Text command palette.</p>
<h3>GitGutter</h3>
<p><a href="https://github.com/jisaacks/GitGutter">GitGutter</a> shows you diff information regarding each line's status--has it been modified, inserted, or deleted?</p>
<p>This is not nearly as powerful as PHPStorm's Git gutters, but it's a step in the right direction.</p>
<p><img src="/assets/images/content/gitgutter.gif" alt="GitGutter" /></p>
<h2>Syntax Highlighting</h2>
<ul>
<li><a href="https://github.com/Anomareh/PHP-Twig.tmbundle">PHP-Twig</a> for Twig</li>
<li><a href="https://github.com/Medalink/laravel-blade">Laravel Blade Highlighter</a> for Laravel Blade</li>
<li><a href="https://github.com/facelessuser/BracketHighlighter">Bracket Highlighting</a> - shows the start and end bracket in the gutter for the block your cursor is currently in</li>
</ul>
<h2>PHPUnit Build</h2>
<p>There's a great plugin that makes it super easy to run PHPUnit from the command palette or a keyboard shortcut: <a href="https://packagecontrol.io/packages/SimplePHPUnit">SimplePHPUnit</a></p>
<p>Just like the name implies, you install the package and you're up and running.</p>
<h2>CodeIntel</h2>
<p><a href="https://github.com/SublimeCodeIntel/SublimeCodeIntel">CodeIntel</a> is supposed to provide Sublime Text intelligence about the language you're working in. It should provide autocompletion, easy jump-to-definition, and information about the function you're currently working in.</p>
<p>Why do I keep saying &quot;should&quot; and &quot;supposed to&quot;? Because I have yet to meet a PHP developer who can get CodeIntel up and running consistently and predictably. Have you? <a href="http://twitter.com/stauffermatt">Hit me up</a>.</p>
<h2>Other Plugins</h2>
<p>When I asked around on Twitter, plenty of folks shared plugins. Since I don't use these, I can only share them vaguely, but I'm sure they're all worth a quick check.</p>
<ul>
<li><a href="https://github.com/facelessuser/ApplySyntax">ApplySyntax</a> extends Sublime Text's ability to determine which syntax to apply to your current file</li>
<li><a href="https://github.com/farcaller/DashDoc">DashDoc</a> makes it easy for Mac users with the <a href="https://kapeli.com/dash">Dash</a> application to look up any word in Dash</li>
<li><a href="https://github.com/akrabat/SublimeFunctionNameDisplay">Function Name Display</a> adds information to the status bar about the current file, class, and function/method name</li>
<li><a href="https://packagecontrol.io/packages/phpfmt">phpfmt</a> looks like an alternative to PHP CS Fixer</li>
<li><a href="https://github.com/spectacles/CodeComplice">CodeComplice</a> is code intel, but newer&mdash;maybe this is the solution?!</li>
<li><a href="https://packagecontrol.io/packages/Xdebug%20Client">Xdebug Client</a></li>
<li><a href="https://github.com/sindresorhus/editorconfig-sublime">EditorConfig</a> is a standard to share particular editor configuration patterns for each project. This plugin lets you import and use them in Sublime Text. (learn more about the <a href="http://editorconfig.org">EditorConfig format</a>)</li>
<li><a href="https://github.com/dzhibas/SublimePrettyJson">SublimePrettyJSON</a> is great for quickly formatting JSON </li>
<li><a href="https://github.com/jdc0589/CaseConversion">CaseConversion</a> makes it simple to convert between snake_case and camelCase and PascalCase and split and join words and everything else. </li>
</ul>
<h2>CodeBug for Xdebug</h2>
<p>Do you miss the Xdebug integration in PHPStorm? Check out <a href="http://codebugapp.com/">Codebug</a>, a standalone xdebug client.</p>
<p><img src="/assets/images/content/codebug-screenshot.png" alt="Codebug Screenshot" /></p>
<h2>A Few General Sublime Text Tips</h2>
<p>This post is <em>not</em> an introduction to all things Sublime Text, but I do want to cover a few important pieces here.</p>
<h3>Finding files with &quot;Goto Anything&quot; (cmd-p)</h3>
<p>If you press <code>super-P</code> you'll get the wildly powerful <code>Goto Anything</code> palette, which allows you to easily find files, but you can go a bit further: if you find your file (e.g. by typing <code>Handler.php</code>), you can also trigger opening it at a certain line (<code>Handler.php:35</code>) or at a certain symbol (<code>Handler.php@report</code>).</p>
<p><img src="/assets/images/content/st-goto-anything.gif" alt="Goto Anything" /></p>
<h3>Finding commands with the Command Palette (cmd-shift-p)</h3>
<p>While the <code>Goto Anything</code> palette lets you search for files in your project, the Command Palette allows you to search for commands.</p>
<p>This means that any command that Sublime Text lets you perform (run builds, rename files, etc.), but also those from third-party packages (Sniff this file, etc.) can be run purely from the keyboard, even if you don't know (or have) the keyboard shortcut.</p>
<p><img src="/assets/images/content/st-command-palette.gif" alt="Command Palette" /></p>
<h3>Finding symbols with &quot;Goto Symbols&quot; (cmd-r)</h3>
<p>If you press <code>super-R</code> you'll get the <code>Goto Symbol</code> palette, which will navigate to any symbol in your current file.</p>
<p>Symbols are things like classes, methods, or functions.</p>
<p><img src="/assets/images/content/st-goto-symbols.gif" alt="Goto Symbols" /></p>
<h3>Multiple cursors</h3>
<p>Many editors have added multiple cursors, but Sublime Text still does it the best. </p>
<p>If you've never tried it, go learn about it somewhere, but here's a quick intro: </p>
<p>Open up a file. Hold &quot;super&quot; (cmd on Mac) and click several places around the file. Now start typing. BOOM.</p>
<p>Another great trick: Place your cursor on a common word (for example, a variable name). Now press <code>Super-D</code> a few times. You now have several instances of that variable selected and you can manipulate them all at once.</p>
<p><img src="/assets/images/content/st-multiple-cursors.gif" alt="Multiple selection" /></p>
<p>Or, select five lines and press <code>Super-shift-l</code>. Check it.</p>
<p>There's a <em>lot</em> more you can do with this if you get creative.</p>
<h3>Fuzzy matching</h3>
<p>Did you know that when you're using any of the command palettes in Sublime Text, you don't have to finish one word?</p>
<p>In most editors (like PHPStorm), if you wanted to find a file named <code>resources/views/conferences/edit.blade.php</code>, you could type <code>resources/views/conferences/edit.blade.php</code> or <code>conferences/edit.blade.php</code>, but in Sublime Text all you would need is something like <code>resvieconedblp</code>. Just type enough that the order of letters you're typing could only exist in the string you're looking for, and you'll be good to go. Skip a letter here, skip a slash there--no problem.</p>
<p><img src="/assets/images/content/st-fuzzy-matching.gif" alt="Sublime Text Fuzzy Matching" /></p>
<h2>Miscellany</h2>
<p>There's a lot more to learn about how Sublime Text works, and a lot of tools and courses available to you. This is not a comprehensive resource for everything that's great about Sublime; those guides have already been written.</p>
<p>If you want to learn more about Sublime Text, there are two excellent resources I'd consider checking out.</p>
<ul>
<li><a href="https://sublimetextbook.com/friend/GEEKSHOW">Sublime Text Power User</a> is a book and video series by my friend Wes Bos that teaches you everything you need to use Sublime Text like a boss. It's the easiest way for someone new to Sublime Text to get up and running quickly. Also, I reached out to Wes and he gave me a <code>GEEK</code> coupon to get you $10 off (disclaimer: it helps me out, too.)</li>
<li><a href="https://www.shortcutfoo.com/">ShortcutFoo</a> is a great resource for learning keyboard shortcuts for any environment. They've got programs for everything from Vim to Sublime Text to Photoshop to Excel.</li>
</ul>
<h2>The Verdict</h2>
<p>Let's take a look at our list and see what we've handled:</p>
<ul>
<li><del>Class FQCN inline completion</del> (Sublime PHP Companion)</li>
<li><del>Easily navigate to a symbol's definition</del> (Sublime PHP Companion)</li>
<li><del>Navigate to a symbol's definition</del> (Sublime PHP Companion)</li>
<li>Easy constructor injection (Macro?)</li>
<li><del>Highlight unused imports</del> (SublimeLinter)</li>
<li><del>Git gutters</del> (GitGutter)</li>
<li><del>Code sniffing/PSR-2 validation</del> (SublimePHPCS etc.)</li>
<li>Code Completion: PHP</li>
<li>Code Completion: project code</li>
</ul>
<p>Not bad, actually. Let's talk about what's missing:</p>
<ul>
<li><strong>Construction injection</strong> (e.g. simplifying injecting a property into the constructer as a property, setting it in the constructor, and defining the class property) is something I think can be solved with a clever macro&mdash;but I haven't seen that clever macro yet.</li>
<li>CodeIntel purports to offer <strong>PHP code completion</strong>, so it's just a matter of getting that working. But I don't think (correct me if I'm wrong) anything in the Sublime Text world claims to sniff the definitions of <em>your</em> code and then provide autocompletion and parameter suggestion. So that's a big shortcoming for sure. Note, however: AllAutocomplete definitely relieves this pain a little.</li>
</ul>
<p>What's my verdict? As always, it depends. I think it'll depend some on the project, some on the developer, and some on whether or not I can find solutions to some of the issues above. But I'm definitely leaning on Sublime Text a lot more than I was six months ago&mdash;it's just so darn fast.</p>
<h2>Postscript</h2>
<p>Are there any Sublime Text tips for PHP developers that I missed? Let me know on <a href="http://twitter.com/stauffermatt">Twitter</a>.</p>
<p>Are there any PHPStorm features that I didn't cover here that you think are <em>vital</em> to every developer's toolkit? Let me know that too.</p>
<p>Also: I couldn't've written this without Adam Wathan, Taylor Otwell, Jeffrey Way, and many, many other friends on Twitter.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-databasemigrations-databasetransactions-and-withoutmiddleware
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-databasemigrations-databasetransactions-and-withoutmiddleware"/>
        <title>Better Integration Testing in Laravel 5.1: DatabaseMigrations, DatabaseTransactions, and
            WithoutMiddleware
        </title>
        <published>2015-06-19T00:00:00+00:00</published>
        <updated>2015-06-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Continuing in our series about testing and integra...</summary>
        <content type="html"><![CDATA[
        <p>Continuing in our series about testing and integration testing in Laravel 5.1, let's take a look at some new traits that are available for your tests.</p>
<h2>Database migrations and data</h2>
<p>Two of these traits have to do with the behavior of database migrations and database state during your testing. If you have never tested anything that relies on the database, it'll help you to know that it can be hard at times to ensure that your database gets into the right state before your tests run.</p>
<h3>DatabaseMigrations Trait</h3>
<p>Here's how it normally goes: Before every test, you migrate your database tables. And after each test, you either wipe out the data that was added in the test, or if you're asking for pain, you <em>don't</em> and you hope that data doesn't break any tests that happen later in the testing process.</p>
<p>The <code>DatabaseMigrations</code> trait simplifies this process for you. Here's the source for the trait:</p>
<pre><code class="language-php">&lt;?php

namespace Illuminate\Foundation\Testing;

trait DatabaseMigrations
{
    /**
     * @before
     */
    public function runDatabaseMigrations()
    {
        $this-&gt;artisan('migrate');

        $this-&gt;beforeApplicationDestroyed(function () {
            $this-&gt;artisan('migrate:rollback');
        });
    }
}</code></pre>
<p>As you can see, it just migrates your data on setup, and then registers a direction to roll back the migrations when the application is torn down at the end of the test.</p>
<p>How do you use it? </p>
<pre><code class="language-php">&lt;?php

use Illuminate\Foundation\Testing\DatabaseMigrations;

class ExampleTest extends TestCase
{
    use DatabaseMigrations;

    //
}</code></pre>
<p>That's it!</p>
<h3>DatabaseTransactions Trait</h3>
<p>Migrating up and down every test is a simple way to handle it, but it's hard to do that quickly unless you're working with SQLite. We do a lot of SQLite-based testing at <a href="https://tighten.co/">Tighten</a>, but it can be irritating at times to worry about some of SQLite's restrictions every time you write a migration.</p>
<p>If you want to test in MySQL, you might find more success wrapping each test in a transaction. It functions like this:</p>
<p>Every time a test is set up, it starts a database transaction. The test runs. And when the test is being torn down, the transaction is rolled back, which means the database is nice and pristine again.</p>
<p>Let's check out the source of the trait:</p>
<pre><code class="language-php">&lt;?php

namespace Illuminate\Foundation\Testing;

trait DatabaseTransactions
{
    /**
     * @before
     */
    public function beginDatabaseTransaction()
    {
        $this-&gt;app-&gt;make('db')-&gt;beginTransaction();

        $this-&gt;beforeApplicationDestroyed(function () {
            $this-&gt;app-&gt;make('db')-&gt;rollBack();
        });
    }
}</code></pre>
<p>Just like above, it's running the &quot;begin&quot; operation, and then registering a callback to run the &quot;stop&quot; operation when the test is spinning down.</p>
<pre><code class="language-php">&lt;?php

use Illuminate\Foundation\Testing\DatabaseTransactions;

class ExampleTest extends TestCase
{
    use DatabaseTransactions;

    //
}</code></pre>
<h2>Testing routes with middleware</h2>
<p>In Laravel 5, CSRF middleware changed to be enabled by default on all routes. But you don't always want to worry about CSRF in the middle of a test. Or maybe you have some other custom middleware that you don't want to run.</p>
<p>There's now a trait you can add to your tests to turn off that Middleware so you don't have to worry about it in your tests:</p>
<h3>WithoutMiddleware Trait</h3>
<p>You guessed it, we're going to start by looking at the source:</p>
<pre><code class="language-php">&lt;?php

namespace Illuminate\Foundation\Testing;

use Exception;

trait WithoutMiddleware
{
    /**
     * @before
     */
    public function disableMiddlewareForAllTests()
    {
        if (method_exists($this, 'withoutMiddleware')) {
            $this-&gt;withoutMiddleware();
        } else {
            throw new Exception('Unable to disable middleware. CrawlerTrait not used.');
        }
    }
}</code></pre>
<p>We're calling the <code>withoutMiddleware</code> method if it exists. It's checking to make sure we're in a test that has <code>CrawlerTrait</code>, which practically is just checking if we are working with integration tests by extending Laravel's <code>TestCase</code>. And if so, it's disabling all middleware for these tests.</p>
<pre><code class="language-php">&lt;?php

use Illuminate\Foundation\Testing\WithoutMiddleware;

class ExampleTest extends TestCase
{
    use WithoutMiddleware;

    //
}</code></pre>
<p>Note that you can also just call <code>$this-&gt;withoutMiddleware();</code> in a single test method if you only want to disable it within that method.</p>
<h2>Concladadore</h2>
<p>That's it. Three simple helper traits to make it even simpler to do integration testing in Laravel 5.1.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-model-factories</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-model-factories"/>
        <title>Better Integration Testing in Laravel 5.1: Model Factories</title>
        <published>2015-06-16T00:00:00+00:00</published>
        <updated>2015-06-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">When you&#039;re testing your code, you often want to c...</summary>
        <content type="html"><![CDATA[
        <p>When you're testing your code, you often want to create a fake entry for one or more of your models. You may have tried this in your tests:</p>
<pre><code class="language-php">$post = new Post;
$post-&gt;title = 'Fake Blog Post Title';
$post-&gt;body = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam lorem erat, luctus at diam sed, dapibus facilisis purus. In laoreet enim nunc, ut pretium arcu scelerisque in. Nunc eu cursus nibh. Etiam pulvinar vulputate libero sed molestie. In condimentum varius faucibus. Vestibulum non blandit sapien, quis tincidunt augue. Aliquam congue sapien eget mattis sagittis.';
$post-&gt;save();</code></pre>
<p>That's already a pain to write out in the middle of your test. But what about when you need to create multiples? To differentiate them? Create related items? It gets out of control.</p>
<h2>The factory</h2>
<p>If you've ever used <a href="https://github.com/laracasts/TestDummy">TestDummy</a> or <a href="https://github.com/adamwathan/faktory">Faktory</a> (or <a href="https://github.com/thoughtbot/factory_girl">factory_girl</a> in Ruby), you're already familiar with using a &quot;factory&quot; to build fake entities for your testing.</p>
<p>If you haven't used them before, these are libraries that make it simple to create a pattern for how to generate fake entities for testing. You're defining to the system: &quot;Every time I request an entity of class <em>type</em>, give me one with these properties filled out to these values.&quot;</p>
<blockquote>
<p>Note: It's worth pointing out that the fields you provide by default shouldn't always be &quot;every field available to this model&quot;, but rather those which are useful in your context. Especially in testing, there are often circumstances where you only want to set a minimum set of fields.</p>
</blockquote>
<p>Want to learn more about how factories work, especially in testing? Check out <a href="http://adamwathan.me/2014/09/26/testing-eloquent-models-with-faktory">Adam Wathan's article introducing model factories</a> for a better overview about how to use them. </p>
<h2>Our first example</h2>
<p>Let's take a look at an example. We'll use the Laravel 5.1 syntax:</p>
<pre><code class="language-php">// app/database/ModelFactory.php
$factory-&gt;define('App\Post', function () {
    return [
        'title' =&gt; 'My Awesome Post',
        'body' =&gt; 'The Body'
    ];
});</code></pre>
<p>You've just defined that, every time someone requests an entity of class <code>App\Post</code> (and from now on, why don't we just write <code>App\Post::class</code> instead of <code>'App\Post'</code>?) from the factory, they will receive a Post with <code>title</code> of <code>My Awesome Post</code> and a <code>body</code> of <code>The Body</code>. Pretty straightforward.</p>
<h2>Using the make syntax</h2>
<p>So, how <em>do</em> we request such an entity? Let's start with <code>make()</code>:</p>
<pre><code class="language-php">$post = factory(App\Post::class)-&gt;make();</code></pre>
<p>What do you think you're getting? An entity of class <code>Post</code>, with the same title and body every time.</p>
<pre><code class="language-php">dd($post-&gt;toArray());

/* Returns:
array:2 [
  "title" =&gt; "My Awesome Post"
  "body" =&gt; "The Body"
]
*/</code></pre>
<h2>Creating multiples</h2>
<p>So, what if we want to create three objects for testing?</p>
<pre><code class="language-php">$posts = factory(App\Post::class, 3)-&gt;make();</code></pre>
<p>Done. You now get a Collection of Posts.</p>
<pre><code class="language-php">dd($posts-&gt;toArray());

/* Returns:
array:3 [
  0 =&gt; array:2 [
    "title" =&gt; "My Awesome Post"
    "body" =&gt; "The Body"
  ]
  1 =&gt; array:2 [
    "title" =&gt; "My Awesome Post"
    "body" =&gt; "The Body"
  ]
  2 =&gt; array:2 [
    "title" =&gt; "My Awesome Post"
    "body" =&gt; "The Body"
  ]
]
*/</code></pre>
<h2>Using Faker</h2>
<p>You've probably noticed that having three Posts with the same data is less useful than we might want. </p>
<p>Enter the <a href="https://github.com/fzaninotto/Faker">Faker</a> library. It's always been a great tool for seeding and it's at times useful in testing; it makes it simple to generate structured, fake data for your fake entities.</p>
<p>It's even easier now: Faker is baked into Laravel 5.1. Check it out:</p>
<pre><code class="language-php">$factory-&gt;define(App\Post::class, function ($faker) {
    return [
        'title' =&gt; $faker-&gt;sentence,
        'body' =&gt; $faker-&gt;paragraph
    ];
});</code></pre>
<p>Faking, built right in. Now every entity you create with the factory will have a unique title and body:</p>
<pre><code class="language-php">$posts = factory(App\Post::class, 3)-&gt;make();

dd($posts-&gt;toArray());

/* Returns:
array:3 [
  0 =&gt; array:2 [
    "title" =&gt; "Ea quis animi ex eius in aut."
    "body" =&gt; "Animi velit rerum corrupti quod nam consequuntur. Eius mollitia ut voluptatum laborum quod ex est. Id et aut aut molestias distinctio illo."
  ]
  1 =&gt; array:2 [
    "title" =&gt; "Illo quod doloribus placeat."
    "body" =&gt; "Ea dolorem eligendi modi sit. Facilis incidunt et sequi velit quia. Ab ipsa dicta dolor doloribus."
  ]
  2 =&gt; array:2 [
    "title" =&gt; "Quod qui ea et quo."
    "body" =&gt; "Iure atque vel rerum perspiciatis voluptatem eligendi provident molestiae. Porro aut est accusamus aut. Tempora quisquam ea delectus nihil hic quidem alias velit. Necessitatibus et illum quo culpa ad sint."
  ]
]
*/</code></pre>
<p>Note: Faker is easily injectable by default, but if you want to use it, you still need to include it in your <code>composer.json</code> as <code>fzaninotto/faker</code>. Thanks to Eric Barnes for the tip!</p>
<h2>Persisting to the database</h2>
<p>Since we'll be using these model factories  often in integration testing (or in testing database-backed chunks of the application), we're going to need to talk about how to persist these fake entities to the database. Thankfully, it's simple:</p>
<pre><code class="language-php">factory(App\Post::class, 20)-&gt;create();</code></pre>
<p>That's it! Now you have 20 fake Posts in your database.</p>
<h2>A few practical examples</h2>
<p>First, these work great in your database seeders. Just truncate the database and run <code>factory(ClassName::class, 20)-&gt;create();</code> and you're seeded and ready to go.</p>
<p>But let's take a look at a testing example.</p>
<pre><code class="language-php">&lt;?php
...
class PostRepositoryTest extends TestCase
{
    public function test_it_paginates()
    {
        factory(App\Post::class, 50)-&gt;create();

        $thisPage = (new App\PostRepository)-&gt;paginate();

        $this-&gt;assertEquals(20, $thisPage-&gt;count());
    }
}</code></pre>
<p>I wrote earlier that these factories are good for integration testing, and they are; but as you can see above, they're also good for testing any smaller pieces (unit or functional) that access the database.</p>
<p>We inserted more than our pagination count, ran the <code>all()</code> method, and tested our return. This test could only function properly with real data in a database, unless you are interested in mocking your entire Eloquent database access layer, which I wouldn't recommend.</p>
<p>Here's a simple integration testing example:</p>
<pre><code class="language-php">&lt;?php
...
class PostListPageTest extends TestCase
{
    public function test_list_page_paginates()
    {
        factory(App\Post::class, 50)-&gt;create();

        $this-&gt;visit('/posts')
            -&gt;see('Next Page');
    }
}</code></pre>
<p>We are only expecting the &quot;Next Page&quot; button to show up if there are more than our pagination count (20), so we added 50 and checked to see that the posts page shows the &quot;Next Page&quot; button.</p>
<p>Another option is to actually look at our individual items:</p>
<pre><code class="language-php">&lt;?php
...
class PostListPageTest extends TestCase
{
    public function test_list_page_shows_titles()
    {
        $post = factory(App\Post::class)-&gt;create();

        $this-&gt;visit('/posts')
            -&gt;see($post-&gt;title);
    }
}
</code></pre>
<h2>Customizing the output of your models</h2>
<p>What if you're working with a particular model, and you want to set a particular value on it for testing purposes?</p>
<p>Just pass the override parameters as an array to the <code>make</code>/<code>create</code> method:</p>
<pre><code class="language-php">$user = factory(App\Post::class)-&gt;make([
    'title' =&gt; 'THE GREATEST POST',
]);</code></pre>
<h2>Defining multiple types for a single model</h2>
<p>What if you need to generate two different sorts of Post to test a particular condition against others?</p>
<p>Try <code>defineAs</code> to allow yourself to specific a 'type' when you're generating fake entities. You can either create the two entirely separately:</p>
<pre><code class="language-php">$factory-&gt;defineAs(App\Post::class, 'short-post', function ($faker) {
    return [
        'title' =&gt; $faker-&gt;sentence,
        'body' =&gt; $faker-&gt;paragraph
    ];
});

$factory-&gt;defineAs(App\Post::class, 'long-post', function ($faker) {
    return [
        'title' =&gt; $faker-&gt;sentence,
        'body' =&gt; implode("\n\n", $faker-&gt;paragraphs(10))
    ];
});</code></pre>
<p>Or, you can extend the base type with a customized type:</p>
<pre><code class="language-php">$factory-&gt;define(App\Post::class, function ($faker) {
    return [
        'title' =&gt; $faker-&gt;sentence,
        'body' =&gt; $faker-&gt;paragraph
    ];
});

$factory-&gt;defineAs(App\Post::class, 'long-post', function ($faker) use ($factory) {
    $post = $factory-&gt;raw('App\Post');

    return array_merge($post, ['body' =&gt; implode("\n\n", $faker-&gt;paragraphs(5))]);
});</code></pre>
<h2>Adding relationships to your models</h2>
<p>Leverage the magic of Illuminate Collections to quickly set up your fake entities and their relationships:</p>
<pre><code class="language-php">$posts = factory('App\Post', 3)
    -&gt;create()
    -&gt;each(function($post) {
        $post-&gt;relatedItems()-&gt;save(factory('App\Item')-&gt;make());
    });</code></pre>
<h2>Conclusion</h2>
<p>Model factories have long been a powerful tool to aid testing and seeding. Having them built-in to the framework is now one less step in the way of us testing well and consistently.</p>
<p>Check back later this week for even more 5.1 testing goodies.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-powerful-integration-tests-in-a-few-lines
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/better-integration-testing-in-laravel-5.1-powerful-integration-tests-in-a-few-lines"/>
        <title>Better Integration Testing in Laravel 5.1: Powerful Integration Tests in A Few Lines</title>
        <published>2015-06-15T00:00:00+00:00</published>
        <updated>2015-06-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Whether or not you&#039;ve written integration tests in...</summary>
        <content type="html"><![CDATA[
        <p>Whether or not you've written integration tests in Laravel before, you'll be pleased to hear that integration testing is more powerful, easier to use, and easier to learn in Laravel 5.1.</p>
<blockquote>
<p>Note: If you do a lot of testing, it's likely you already have <a href="https://github.com/fzaninotto/Faker">Faker</a> and <a href="https://github.com/padraic/mockery">Mockery</a> installed on every site you run, but you just got saved a step: they're now installed by default.</p>
</blockquote>
<h2>Integration Tests?</h2>
<p>For a quick refresher, integration tests are those which test your <em>entire system as an integrated application</em>, as compared against unit tests, which test <em>each system of your application separately.</em></p>
<p>Usually integration tests pass in input to your application (often just an instruction like &quot;visit this page&quot;) and check the output (often &quot;I should see this text somewhere on the page&quot;), with no concern of <em>how</em> that input was converted to that output. Integration tests see the actual processes running your application as a black box. Don't know, don't care.</p>
<h2>Integrated package integrated</h2>
<p>Jeffrey Way's fantastic <a href="https://github.com/laracasts/integrated">Integrated</a> package has given integration tests in Laravel superpowers for a while now, and it's now a part of the Laravel core.</p>
<p>This means that any tests extending <code>TestCase</code> provide a simple, fluent interface for you to operate what amounts to almost a fake web browser that can check your output. If you've ever written Selenium-based tests, think that but simpler and easier to set up.</p>
<p>I'll show a few examples here, but note that the full documentation is available at the <a href="http://laravel.com/docs/5.1/testing">docs</a>.</p>
<h3>Simple tests with <code>visit()</code> and <code>see()</code></h3>
<p>Check this out:</p>
<pre><code class="language-php">&lt;?php
...
class HomePageTest extends TestCase
{
    public function test_home_page_says_wowee()
    {
        $this-&gt;visit('/')
            -&gt;see('Wowee');
    }
}</code></pre>
<p>In two lines of code, we just tested that a user who visits the home page of the application sees the phrase &quot;Wowee&quot; somewhere on the site. <em>Two lines of code.</em> If you have any imagination, you can see how far we can take this, with almost <em>no work</em>, to ensure that the front end of our application functions properly, not just its guts.</p>
<h3>Check the page with <code>seePageIs()</code></h3>
<pre><code class="language-php">    public function test_forwarder_forwards_the_page()
    {
        $this-&gt;visit('/forwarder')
            -&gt;seePageIs('forwarded-to');
    }</code></pre>
<h3>Check links with <code>click()</code></h3>
<pre><code class="language-php">    public function test_cta_link_functions()
    {
        $this-&gt;visit('/sales-page')
            -&gt;click('Try it now!')
            -&gt;see('Sign up for trial')
            -&gt;onPage('trial-signup');
    }</code></pre>
<h3>Fill out forms with <code>type()</code>, <code>select()</code>, <code>check()</code>, <code>attach()</code>, and <code>press()</code></h3>
<p>There are many more interactions you can script with the new functionality.</p>
<p>For example, you can fill out a form and submit it:</p>
<pre><code class="language-php">    public function test_it_can_subscribe_to_newsletter()
    {
        $this-&gt;visit('/newsletter')
            -&gt;type('me@me.com', '#newsletter-email')
            -&gt;press('Sign Up')
            -&gt;see('Thanks for signing up!')
            -&gt;onPage('newsletter/thanks');
    }</code></pre>
<p>Note that <code>press()</code> can either be passed the value of the button (<code>press("Sign Up")</code>) or the name (<code>press("sign-up-button")</code>)</p>
<p>You can also fill out other fields:</p>
<pre><code class="language-php">    public function test_signups_can_complete()
    {
        $this-&gt;visit('/signup')
            -&gt;type('Matt Stauffer', 'name')
            -&gt;check('overTwentyOne')
            -&gt;select('Florida', 'state')
            -&gt;attach('../uploads/test.jpg', 'profilePicture')
            -&gt;press('Sign Up')
            -&gt;seePageIs('/signup/thanks');
    }</code></pre>
<h3>Submit a form all at once with <code>submitForm()</code></h3>
<pre><code class="language-php">    public function test_login_form()
    {
        $this-&gt;visit('/login')
            -&gt;submitForm('Log In', ['email' =&gt; 'me@me.com', 'password' =&gt; 'secret'])
            -&gt;see('Welcome!')
            -&gt;onPage('dashboard');
    }</code></pre>
<h3>Verify a record exists in the database with <code>seeInDatabase()</code></h3>
<pre><code class="language-php">    public function test_saves_newsletter_signups()
    {
        $this-&gt;visit('/newsletter-signup')
            -&gt;type('me@me.com')
            -&gt;press('Sign up')
            -&gt;seeInDatabase('signups', ['email' =&gt; 'me@me.com']);
    }</code></pre>
<h2>Super power auto-testing</h2>
<p>Cool trick: you can tell Elixir to run your tests every time you modify a file by adding the following code to your gulp file: <code>mix.phpUnit()</code>. Now, just run <code>gulp tdd</code> from the command line and it will re-run PHPUnit every time you change any of your files and notify you of the results.</p>
<p>Thanks to Jeffrey Way for pointing this out&mdash;I had no idea it existed and now I'm in love with it.</p>
<h2>Conclude</h2>
<p>As you can see, bringing in Integrated has laid the foundation for simple and powerful integration tests with almost no work. I have to make this clear: I've written integration tests before and it's <em>never</em> been this easy to get started.</p>
<p>We're not done yet&mdash;check back later this week to learn more about all the amazing things you can do with integration testing in Laravel 5.1.</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/advanced-input-output-with-artisan-commands-tables-and-progress-bars-in-laravel-5.1
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/advanced-input-output-with-artisan-commands-tables-and-progress-bars-in-laravel-5.1"/>
        <title>Advanced input &amp; output with Artisan commands, tables, &amp; progress bars in Laravel 5.1</title>
        <published>2015-06-11T00:00:00+00:00</published>
        <updated>2015-06-11T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Yesterday we talked about the new signature syntax...</summary>
        <content type="html"><![CDATA[
        <p>Yesterday <a href="/blog/creating-artisan-commands-with-the-new-simpler-syntax-in-laravel-5.1">we talked about the new signature syntax for Artisan commands</a>.</p>
<p>Today, let's take a look at the options Artisan commands present for input and output. Most of this is review; to get to what's new in 5.1, go to <a href="#advanced-output">advanced output</a>.</p>
<blockquote>
<p>Note: Artisan commands build on top of the <a href="http://symfony.com/doc/current/components/console/introduction.html">Symfony Console Component</a>, so if you really want to geek out, you can go learn more there.</p>
</blockquote>
<p>As a quick reminder, here's what a signature definition looks like in a 5.1 command object:</p>
<pre><code class="language-php">protected $signature = 'command:name
    {argument}
    {optionalArgument?}
    {argumentWithDefault=default}
    {--booleanOption}
    {--optionWithValue=}
    {--optionWithValueAndDefault=default}
';</code></pre>
<p>Here are the methods that you can use within your command's <code>handle()</code> method to get and display data:</p>
<h2>Basic input</h2>
<h3><code>$this-&gt;argument('argumentName')</code></h3>
<p>The argument method allows you to get the value of an argument you defined in your parameter list.</p>
<p>So, if your signature definition is <code>do:thing {awesome}</code> and the user runs <code>php artisan do:thing fantastic</code>, <code>$this-&gt;argument('awesome')</code> will return <code>fantastic</code>.</p>
<p>Note that, if you're accessing an argument that's not required, and you haven't set a default, <em>and</em> the user doesn't fill anything out, this will come back as <code>null</code>.</p>
<h3><code>$this-&gt;option('optionName')</code></h3>
<p>Just like the argument method, the option method gets the value of an option.</p>
<p>If the option is defined as a boolean option (<code>--queued</code>, <code>--doItAwesomely</code>), this will return as <code>true</code> if passed or <code>false</code> if not.</p>
<p>So, if your signature definition is <code>go {--boldly}</code> and the user runs <code>php artisan go --boldy</code>, <code>$this-&gt;option('boldly')</code> will return true.</p>
<h3><code>$this-&gt;argument()</code> and <code>$this-&gt;option()</code></h3>
<p>If you don't pass parameters to the argument and option methods, they'll each return an array of all of their defined parameters and their values.</p>
<p>So, if your route definition is <code>jump:on {thing1} {thing2}</code> and your user runs <code>php artisan jump:on rock boulder</code>, <code>$this-&gt;argument()</code> will return this array:</p>
<pre><code class="language-php">[
    'command': 'jump:on',
    'thing1': 'rock',
    'thing2': 'boulder'
]</code></pre>
<p>Same thing for options.</p>
<h2>Basic output</h2>
<p>When you're writing your <code>handle()</code> method, it's common to want to send output to the end user. There are quite a few options for this.</p>
<p>All four of the simple output methods (<code>$this-&gt;info()</code>, <code>$this-&gt;comment()</code>, <code>$this-&gt;question()</code>, and <code>$this-&gt;error()</code>) allow you to pass any string to the user, as a notification:</p>
<pre><code class="language-php">$this-&gt;info('Finished syncing data');</code></pre>
<p>Check out all the colors:</p>
<p><img src="/assets/images/content/artisan-output-colors.png" alt="All the output colors" /></p>
<h2>Advanced input</h2>
<p>What if you want to write a script that allows you to have various stages of information retrieval from the user? Or conditional information retrieval depending on previous responses, or depending on part of the operations of the command?</p>
<h3><code>$this-&gt;ask()</code></h3>
<p>Throw a question out to the user and get their response:</p>
<pre><code class="language-php">public function handle()
{
    $name = $this-&gt;ask('What is your name?');

    $this-&gt;info("Hello, $name");
}</code></pre>
<p><img src="/assets/images/content/artisan-ask.gif" alt="Demonstration of this->ask" /></p>
<h3><code>$this-&gt;secret()</code></h3>
<p>Secret is the same as ask, but with hidden typing:</p>
<pre><code class="language-php">public function handle()
{
    $password = $this-&gt;secret('What is your password?');

    $this-&gt;info("This is really secure. Your password is $password");
}</code></pre>
<p><img src="/assets/images/content/artisan-secret.gif" alt="Demonstration of this->secret" /></p>
<h3><code>$this-&gt;confirm()</code></h3>
<p>What if you just need a yes/no?</p>
<pre><code class="language-php">public function handle()
{
    if ($this-&gt;confirm('Do you want a present?')) {
        $this-&gt;info("I'll never give you up.");
    }
}</code></pre>
<p><img src="/assets/images/content/artisan-confirm.gif" alt="Demonstration of this->confirm" /></p>
<h3><code>$this-&gt;anticipate()</code> and <code>$this-&gt;choice()</code></h3>
<p>What if you need custom choices? The Anticipate method allows you to provide autocompletion (but leaves the response free to be whatever the user wants), and the Choice method forces a choice between provided options.</p>
<pre><code class="language-php">public function handle()
{
    $name = $this-&gt;anticipate(
        'What is your name?', 
        ['Jim', 'Conchita']
    );

    $this-&gt;info("Your name is $name");

    $source = $this-&gt;choice(
        'Which source would you like to use?', 
        ['master', 'develop']
    );

    $this-&gt;info("Source chosen is $source");
}</code></pre>
<p>And the result:</p>
<p><img src="/assets/images/content/artisan-choice-anticipate.gif" alt="Demonstration of anticipate and choice" /></p>
<h2>Advanced output</h2>
<p>Laravel 5.1 introduces two new advanced output forms:
table and progress bar.</p>
<h3><code>$this-&gt;table()</code></h3>
<p>The table method accepts two parameters: headers and data.</p>
<p>So, let's start with some hand-crafted goodness:</p>
<pre><code class="language-php">public function handle()
{
    $headers = ['Name', 'Awesomeness Level'];

    $data = [
        [
            'name' =&gt; 'Jim',
            'awesomeness_level' =&gt; 'Meh',
        ],
        [
            'name' =&gt; 'Conchita',
            'awesomeness_level' =&gt; 'Fabulous',
        ],
    ];

    /* Note: the following would work as well:
    $data = [
        ['Jim', 'Meh'],
        ['Conchita', 'Fabulous']
    ];
    */

    $this-&gt;table($headers, $data);
}</code></pre>
<p>Here's the output:</p>
<p><img src="/assets/images/content/artisan-table.png" alt="Demonstration of the table" /></p>
<p>And as you can see in the docs, this is a great tool for easily exporting data with Eloquent:</p>
<pre><code class="language-php">public function handle()
{
    $headers = ['Name', 'Email'];

    $users = App\User::all(['name', 'email'])-&gt;toArray();

    $this-&gt;table($headers, $users);
}</code></pre>
<p>This is built on the <a href="http://symfony.com/doc/current/components/console/helpers/tablehelper.html">Symfony Table Helper</a>.</p>
<h3>Progress bar</h3>
<p>It might seem like magic, but outputting progress bars are actually really simple using the Symfony Progress Bar Component:</p>
<pre><code class="language-php">public function handle()
{
    $this-&gt;output-&gt;progressStart(10);

    for ($i = 0; $i &lt; 10; $i++) {
        sleep(1);

        $this-&gt;output-&gt;progressAdvance();
    }

    $this-&gt;output-&gt;progressFinish();
}</code></pre>
<p>This yields this beauty:</p>
<p><img src="/assets/images/content/artisan-progress.gif" alt="Demonstration of the progress bar" /></p>
<p>Let's break it down. First, we notify the progress bar how many &quot;units&quot; we'll be working through:</p>
<pre><code class="language-php">$this-&gt;output-&gt;progressStart($numUnits);</code></pre>
<p>Then, every time we process a unit, we advance the progress bar by one:</p>
<pre><code class="language-php">$this-&gt;output-&gt;progressAdvance();</code></pre>
<p>Finally, we mark it as complete:</p>
<pre><code class="language-php">$this-&gt;output-&gt;progressFinish();</code></pre>
<p>Note that this syntax is a wrapper around the <a href="http://symfony.com/doc/2.7/components/console/helpers/progressbar.html">Symfony Progress Bar component</a>. You can take a look there for more information about how it functions.</p>
<h2>Conclado</h2>
<p>That's it. You're now a professional Artisan input/output coordinator. Put that on your resumé/CV.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/creating-artisan-commands-with-the-new-simpler-syntax-in-laravel-5.1</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/creating-artisan-commands-with-the-new-simpler-syntax-in-laravel-5.1"/>
        <title>Creating Artisan commands with the new, simpler syntax in Laravel 5.1</title>
        <published>2015-06-10T00:00:00+00:00</published>
        <updated>2015-06-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;re not familiar with Artisan commands, they...</summary>
        <content type="html"><![CDATA[
        <p>If you're not familiar with Artisan commands, they're command-line functions that you can run to interact with your Laravel application.</p>
<p>If you run <code>php artisan</code> from the command line in any Laravel application directory, you'll see a list of all of the Artisan commands available for each app. As you can see, Laravel comes with quite a few enabled out of the box.</p>
<p><img src="/assets/images/content/laravel-default-commands.png" alt="A few of the default Artisan commands in Laravel" /></p>
<h2>The Old Way</h2>
<p>While Artisan commands are powerful and refreshingly encapsulated, prior to Laravel 5.1 they were a bit of a hassle to define. Let's look at the old way, and then check out the <a href="#the-new-way">new</a>.</p>
<p>For these examples, we'll be using a <a href="http://symposiumapp.com/">Symposium</a> command that syncs down all of the conferences available on the <a href="http://joind.in/">Joind.in</a> API.</p>
<p>You generate a new Artisan command using the following (Artisan!) command:</p>
<pre><code class="language-bash">$ php artisan make:console SyncJoindInEvents</code></pre>
<p>In Laravel 5 and earlier, that would pump out this boilerplate:</p>
<pre><code class="language-php">&lt;?php namespace Symposium\Console\Commands;

use Illuminate\Console\Command;
use Symfony\Component\Console\Input\InputOption;
use Symfony\Component\Console\Input\InputArgument;

class SyncJoindInEvents extends Command {

    /**
     * The console command name.
     *
     * @var string
     */
    protected $name = 'command:name';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description.';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function fire()
    {
        //
    }

    /**
     * Get the console command arguments.
     *
     * @return array
     */
    protected function getArguments()
    {
        return [
            ['example', InputArgument::REQUIRED, 'An example argument.'],
        ];
    }

    /**
     * Get the console command options.
     *
     * @return array
     */
    protected function getOptions()
    {
        return [
            ['example', null, InputOption::VALUE_OPTIONAL, 'An example option.', null],
        ];
    }

}</code></pre>
<p>As you can see, defining arguments and options uses a complicated syntax that leaves you needing to reference the docs every step of the way. We'll end up with this for now:</p>
<pre><code class="language-php">&lt;?php namespace Symposium\Console\Commands;

use Illuminate\Console\Command;
use Symposium\JoindIn\Client;

class SyncJoindInEvents extends Command
{
    protected $name = 'joindin:sync';

    protected $description = 'Sync down Joind.in events.';

    protected $client;

    public function __construct()
    {
        parent::__construct();

        $this-&gt;client = Client::factory();
    }

    public function fire()
    {
        if ($eventId = $this-&gt;argument('eventId')) {
            $this-&gt;info("Syncing event $eventId");

            return $this-&gt;client-&gt;syncEvent($eventId);
        }

        $this-&gt;info("Syncing all events");

        return $this-&gt;client-&gt;syncAllEvents();
    }

    protected function getArguments()
    {
        return [
            ['eventId', InputArgument::OPTIONAL, '(optional) Joind.In event ID'],
        ];
    }
}</code></pre>
<h2>The New Way</h2>
<p>Let's create this same command in Laravel 5.1. Here's our boilerplate:</p>
<pre><code class="language-php">&lt;?php

namespace Symposium\Console\Commands;

use Illuminate\Console\Command;

class SyncJoindInEvents extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'command:name';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description.';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {
        //
    }
}</code></pre>
<p>First of all, take a look at that gorgeous PSR-2 formatting. Breathe it in.</p>
<p>Second, look how much simpler the boilerplate is. But, Matt, how do we customize the arguments and options?</p>
<h3>Signature</h3>
<p>You'll notice that <code>$name</code> has been replaced with <code>$signature</code>, which says &quot;the name <em>and signature</em> of the console command.&quot; This particular property of the command is where we define our arguments and options. So, here's our same command in Laravel 5.1:</p>
<pre><code class="language-php">&lt;?php

namespace App\Console\Commands;

use Illuminate\Console\Command;

class SyncJoindInEvents extends Command
{
    protected $signature = 'joindin:sync {eventId?}';

    protected $description = 'Sync down Joind.in events.';

    public function handle()
    {
        if ($eventId = $this-&gt;argument('eventId')) {
            $this-&gt;info("Syncing event $eventId");

            return $this-&gt;client-&gt;syncEvent($eventId);
        }

        $this-&gt;info("Syncing all events");

        return $this-&gt;client-&gt;syncAllEvents();
    }
}</code></pre>
<p>So, what else can you do? Check the <a href="http://laravel.com/docs/5.1/artisan">docs</a> for everything you want to know, but here are some goodies:</p>
<ul>
<li>Argument: <code>joindin:sync {eventId}</code></li>
<li>Optional Argument: <code>joindin:sync {eventId?}</code></li>
<li>Argument with default: <code>joindin:sync {eventId=all}</code></li>
<li>Boolean Option: <code>joindin:sync --wipeOldEvents</code></li>
<li>Option with Value: <code>joindin:sync --afterDate=</code></li>
<li>Option with Value and Default: <code>joindin:sync --afterDate=1999-01-01</code></li>
</ul>
<p>Note that you can also add descriptions inline:</p>
<pre><code class="language-php">protected $signature = 'joindin:sync
                        {eventId? : (optional) The ID of the event to sync}
                        {--wipeOldEvents : Whether to replace all locally-stored events with API results}';</code></pre>
<p>There's plenty more you can do, most of which you are likely familiar with: <code>$this-&gt;argument()</code> or <code>$this-&gt;option()</code> to get the data out; <code>$this-&gt;ask()</code>, <code>$this-&gt;secret()</code>, <code>$this-&gt;confirm()</code>, <code>$this-&gt;anticipate()</code>, and <code>$this-&gt;choice()</code> to prompt users; and <code>$this-&gt;info()</code> and <code>$this-&gt;error()</code> to output data.</p>
<p>There are also two new output functions: <code>$this-&gt;table()</code>, and the <code>$this-&gt;output-&gt;progress*</code>, which I'll cover tomorrow.</p>
<h2>Conshmusion</h2>
<p>That's it! We can now create Artisan commands with ease, without needing the Artisan docs open every time we write out the argument and option syntax. Go forth and create!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/passing-parameters-to-middleware-in-laravel-5.1</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/passing-parameters-to-middleware-in-laravel-5.1"/>
        <title>Passing parameters to Middleware in Laravel 5.1</title>
        <published>2015-06-09T00:00:00+00:00</published>
        <updated>2015-06-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you remember my blog post about Filter-style mi...</summary>
        <content type="html"><![CDATA[
        <p>If you remember my blog post about <a href="/blog/laravel-5.0-middleware-filter-style">Filter-style middleware in Laravel 5.0</a>, middleware got a big bump in its importance and priority in Laravel 5.0. In early development of 5.0, route filters were actually removed entirely, but later they were brought back&mdash;primarily (I assume) because you couldn't pass parameters to middleware, so they couldn't perfectly replace filters.</p>
<p>This is no longer the case. Middleware can now take parameters.</p>
<p><em>(and there was much rejoicing)</em> </p>
<h2>When would I use middleware paremeters?</h2>
<p>Remember, middleware is like a decorator that goes around your entire application request. It takes in a request, does some work, and spits out a response. And usually, it does that work consistently across every section of your application.</p>
<p>But what if you want to be able to customize exactly <em>how</em> the middleware is being processed for a given route, without creating a new middleware for every place it's customized?</p>
<p>Let's consider the most common example: Scoping authentication middleware based on roles. You want to, in the route definition, choose <em>how</em> the authentication middleware runs, by passing it a &quot;role&quot; parameter that defines which user role is required in order to access this route.</p>
<h2>Using parameterized middleware in the route defintion</h2>
<p>When you're adding middleware to a route definition, you'd normally set it like this:</p>
<pre><code class="language-php">Route::get('company', ['middleware' =&gt; 'auth', function () {
    return view('company.admin');
}]);</code></pre>
<p>So, let's add in our parameter to show that the user must have the <code>owner</code> role:</p>
<pre><code class="language-php">Route::get('company', ['middleware' =&gt; 'auth:owner', function () {
    return view('company.admin');
}]);</code></pre>
<p>Note that you can also pass multiple parameters as a comma-separated list:</p>
<pre><code class="language-php">Route::get('company', ['middleware' =&gt; 'auth:owner,view', function () {
    return view('company.admin');
}]);</code></pre>
<h2>Creating parameterized middleware</h2>
<p>So, how do we update our middleware to teach it to take parameters?</p>
<pre><code class="language-php">&lt;?php

namespace App\Http\Middleware;

use Closure;

class Authentication
{
    public function handle($request, Closure $next, $role)
    {
        if (auth()-&gt;check() &amp;&amp; auth()-&gt;user()-&gt;hasRole($role)) {
            return $next($request);
        }

        return redirect('login');
    }
}</code></pre>
<p>Note that the <code>handle()</code> method, which usually only takes a <code>$request</code> and a <code>$next</code> closure, has a third parameter, which is our middleware parameter. If you passed in multiple parameters to your middleware call in the route definition, just add more parameters to your <code>handle()</code> method:</p>
<pre><code class="language-php">    public function handle($request, Closure $next, $role, $action)</code></pre>
<blockquote>
<p>NOTE: If you've never used middleware before, you need to ensure that this middleware is registered in the HTTP Kernel as a <code>routeMiddleware</code>&mdash;there's no way you could pass parameters to a universal middleware.</p>
</blockquote>
<h2>Conclusissimo</h2>
<p>That's it! There's now no reason to use filters at all. I for one welcome our middleware overlords.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/injecting-an-object-from-the-ioc-using-laravel-blade-service-injection</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/injecting-an-object-from-the-ioc-using-laravel-blade-service-injection"/>
        <title>Injecting an object (from the IOC) using Laravel Blade Service Injection</title>
        <published>2015-06-08T00:00:00+00:00</published>
        <updated>2015-06-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel 5.1 introduces &quot;Service Injection&amp;quo...</summary>
        <content type="html"><![CDATA[
        <p>Laravel 5.1 introduces &quot;<a href="http://laravel.com/docs/master/blade#service-injection">Service Injection</a>&quot;, the ability to &quot;inject&quot; an object into Blade templates. This means you can now resolve an object out of the IOC within your templates:</p>
<pre><code class="language-php">// Blade template
@inject('service', 'App\Services\Service')
{{ $service-&gt;getSomething() }}</code></pre>
<p>As you can see, the first parameter is the variable name, and the second parameter is the class or interface name or alias.</p>
<blockquote>
<p>NOTE: You don't want to abuse this. There is such a thing as too much logic in your views, and it's a beast. But there are some circumstances in which instantiating a class in every controller just to pass them to the same view is a little bit too much work. Think about a context in which you might want a View Composer, but you only need a <em>single</em> class and binding a full View Composer might seem like too much work.</p>
</blockquote>
<p>So, before you might've done this:</p>
<pre><code class="language-php">// DashboardController
public function index()
{
    return view('dashboard')
        -&gt;with('analytics', App::make('App\Services\Analytics'));
}</code></pre>
<pre><code class="language-php">// dashboard.blade.php
// Template content...

@include('user.partials.finances-graph', ['analytics' =&gt; $analytics])

// Template content...</code></pre>
<pre><code class="language-php">// UserController
public function showFinances()
{
    return view('user.finances')
        -&gt;with('analytics', App::make('App\Services\Analytics'));
}</code></pre>
<pre><code class="language-php">// user/finances.blade.php
// Template content...

@include('user.partials.finances-graph', ['analytics' =&gt; $analytics])

// Template content...</code></pre>
<pre><code class="language-php">// user/partials/finances-graph.blade.php
&lt;h3&gt;Finances&lt;/h3&gt;

&lt;div class="finances-display"&gt;
     {{ $analytics-&gt;getBalance() }} / {{ $analytics-&gt;getBudget() }}
&lt;/div&gt;</code></pre>
<p>As you can see, we have two different controllers, pulling in two different templates, but those templates are both including the same partial template that needs the statistics service.</p>
<p>Let's rework this. Since it's just a single service, we'll inject the service into our template instead of creating a View Composer:</p>
<pre><code class="language-php">// DashboardController
public function index()
{
    return view('dashboard');
}</code></pre>
<pre><code class="language-php">// dashboard.blade.php
// Template Content...

@include('user.partials.finances-graph')

// Template Content...</code></pre>
<pre><code class="language-php">// UserController
public function showFinances()
{
    return view('user.finances');
}</code></pre>
<pre><code class="language-php">// user/finances.blade.php
// Template Content...

@include('user.partials.finances-graph')

// Template Content...</code></pre>
<pre><code class="language-php">// user/partials/finances-graph.blade.php
@inject('analytics', 'App\Services\Analytics')

&lt;h3&gt;Finances&lt;/h3&gt;

&lt;div class="finances-display"&gt;
     {{ $analytics-&gt;getBalance() }} / {{ $analytics-&gt;getBudget() }}
&lt;/div&gt;</code></pre>
<p>That's it! You're now a Service Injection professional.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/creating-a-welcome-series-drip-campaign-for-your-sendy-newsletter</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/creating-a-welcome-series-drip-campaign-for-your-sendy-newsletter"/>
        <title>Creating a welcome series (drip campaign) for your Sendy newsletter</title>
        <published>2015-06-06T00:00:00+00:00</published>
        <updated>2015-06-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In my last post I showed you how to download Sendy...</summary>
        <content type="html"><![CDATA[
        <p>In my <a href="/blog/installing-sendy-for-emails-on-laravel-forge">last post</a> I showed you how to download <a href="http://sendy.co/?ref=1DZsV">Sendy</a> and install it on a Laravel Forge server.</p>
<p>In this post, we'll be creating a series of welcome emails for every new subscriber. Before we get to a full drip campaign, let's look at the simple &quot;thank you message&quot; each list can have by default.</p>
<h2>Creating a single, simple welcome email</h2>
<p>Log into your Sendy account, and visit your brand page by clicking the brand title.</p>
<p>Click on &quot;View all lists&quot; in the left rail, and choose the &quot;Edit&quot; icon for the list you want. </p>
<p><img src="/assets/images/content/sendy-navigating-to-welcome-message.gif" alt="Animation of navigating to the "Edit List" screen" /></p>
<p>The first big chunk you'll see is, on the left, the settings for Single vs. Double Opt-in (keep it at single for now) and the subscribe success page, and on the right, the &quot;thank you&quot; email.</p>
<p>As you can see, this is just like any other email you create in the app. Set a subject, build a body (or paste in HTML), check the &quot;Send user a thank you email after they subscribe through the subscribe form or API?&quot; checkbox at the top, and it'll automatically be sent upon signup.</p>
<p><img src="/assets/images/content/sendy-welcome-email.png" alt="Custom welcome email" /></p>
<h3>Customizing the Double Opt-In email</h3>
<p>If you're using the Double Opt-in option, you'll <em>have</em> to have an email to provide a confirmation link for them to click.</p>
<p>Thankfully, Sendy has a default message that it'll send for you; however, if you want to customize the confirmation message, you can edit it below the &quot;thank you&quot; message section. Be sure to use the <code>[confirmation_link]</code> placeholder somewhere in your custom email.</p>
<p><img src="/assets/images/content/sendy-confirmation-email.png" alt="Custom confirmation email" /></p>
<h2>Creating a drip campaign</h2>
<p>A &quot;drip campaign&quot; is any sort of schedule of emails that are sent, not at the same time to every user, but triggered based on an event. So where a normal newsletter email is sent on June 5, 2015 for every subscriber, a drip campaign might send an email on &quot;the first day after signup&quot; for each unique user.</p>
<p>Usually a drip campaign will happen in response to one of two events: Either upon first signup (which we're talking about here), or after buying a paid training course. Either way, the trigger moment kicks off a series of emails spaced out a certain amount of time after the triggering event.</p>
<h3>Set up autoresponders</h3>
<p>Drip campaigns (or even a single welcome email that's not an immediate &quot;thank you&quot;) are achieved in Sendy via autoresponders.</p>
<p>Go back to the &quot;View all lists&quot; page, and click the name of your list. In the upper right hand corner, you'll see the text &quot;Autoresponders&quot;. Click that and you'll be able to set up timed emails.</p>
<p>As you can see, you can send off autoresponders based on custom fields, but right now we'll just choose &quot;Drip campaign,&quot; which triggers a drip campaign based on the user's signup date. Give your first autoresponder message a name, and then you'll find yourself on the screen for the email editor.</p>
<p><img src="/assets/images/content/navigate-to-autoresponders.gif" alt="Getting to the autoresponders page" /></p>
<h3>Spacing out your emails</h3>
<p>Once you've gotten this far, you see we're back at our normal email editor, with one unique piece: The ability to set <em>when</em> the email is sent out:</p>
<p><img src="/assets/images/content/sendy-set-drip-timeline.png" alt="Customizing drip campaign email delivery date" /></p>
<p>From here, you can just create as many emails as you want in your drip campaign, and space them out from the initial signup date.</p>
<p>Sendy considers a single &quot;drip campaign&quot; autoresponder as capable of having multiple emails, so you won't be creating a new autoresponder each time, but rather adding multiple emails to the existing autoresponder:</p>
<p><img src="/assets/images/content/sendy-add-more-emails.gif" alt="Adding an email to an existing autoresponder" /></p>
<h2>And, scene.</h2>
<p>That's it! You now have the power to create unique, custom drip campaigns for your newsletter to help onboard your new newsletter subscribers.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/installing-sendy-for-emails-on-laravel-forge</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/installing-sendy-for-emails-on-laravel-forge"/>
        <title>Installing Sendy (for emails) on Laravel Forge</title>
        <published>2015-06-02T00:00:00+00:00</published>
        <updated>2015-06-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Last week I decided to finally bite the bullet and...</summary>
        <content type="html"><![CDATA[
        <p>Last week I decided to finally bite the bullet and take the advice I've been giving so many others: I committed to creating an email newsletter to recap some of my favorite posts and also to give me a space to share some thoughts I don't have space for anywhere else.</p>
<p>So, time to get my newsletter-sending-setup up and running.</p>
<p><img src="/assets/images/content/sendy-header.png" alt="Sendy header" /></p>
<h2>Why Sendy?</h2>
<p>If I reach the number of subscribers I hope to reach, Campaign Monitor and Mailchimp will get far too expensive, far too fast, for something I'm just doing on the side.</p>
<p>So, I asked around on Twitter, and quite a few people recommended <a href="https://sendy.co/?ref=1DZsV">Sendy</a>, which is a <em>self-hosted</em> PHP application that costs $59 (one-time) and then sends using Amazon SES, which is extremely affordable.</p>
<blockquote>
<p>Please note: The link to Sendy above is an affiliate link, which means I'll make a commission if you sign up. This is not a paid review, and I planned this blog post before I knew they had an affiliate program; but if you're already going to consider signing up, I won't complain if Sendy sends me a commission. :)</p>
</blockquote>
<p>So, of course, being the dork I am, I figured I'd install Sendy on Laravel Forge and then write a blog post about how to do it. Many thanks to <a href="https://laravel-news.com/">Eric Barnes</a>, who had walked this road before me, and <a href="http://fideloper.com/">Chris Fidao</a>, who's just been helpful in general.</p>
<p>Note: Are you unfamiliar with Laravel Forge? Check out my <a href="https://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge">Laravel Forge series</a>.</p>
<h2>1. Buy Sendy and prep your code</h2>
<p>Your first step is to <a href="https://sendy.co/?ref=1DZsV">buy Sendy</a>.  You'll receive a Zip file download, and a license key. Save the license key somewhere safe, and unzip the file locally.</p>
<p>We'll be using Git to deploy the site (I originally wrote directions using SCP and, trust me, it's not worth it), so initialize a new git repository in the unzipped <code>sendy</code> folder and add everything to it.</p>
<p>Also, add a new, blank file to the <code>uploads</code> directory named <code>.gitkeep</code> and add that to Git too. That'll ensure the (currently empty) uploads directory gets uploaded to Forge.</p>
<pre><code class="language-bash">$ cd Downloads/sendy
$ touch uploads/.gitkeep
$ git init
$ git add .
$ git commit -m "Initial commit."
$ git remote add origin {remote-repository-URL}
$ git push origin master
</code></pre>
<blockquote>
<p>Note: If you don't have a paid Github account, I'd recommend checking out <a href="https://bitbucket.org/">Bitbucket</a>, as they provide free private repos.</p>
</blockquote>
<h2>2. Install Sendy on Forge</h2>
<p>You'll need to set up a Forge site for your Sendy server.</p>
<p>Let's assume you're using <code>sendy.mattstauffer.co</code> (be sure to pick a domain/subdomain that will work for all of your projects--this one domain is going to be used for every Sendy &quot;brand&quot; you set up):</p>
<h3>2.a Add the site</h3>
<p>Go add a site to one of your Forge servers (if you don't have one yet, <a href="https://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge">create your first server with Forge</a>), with the Root Domain set to your domain (e.g. <code>sendy.mattstauffer.co</code>) and the Web Directory empty (<em>not</em> the default <code>/public</code>).</p>
<p><img src="/assets/images/content/sendy-add-forge-site.png" alt="Add Forge Site" /></p>
<p>Now, you can just hook the site up to your Git repository.</p>
<p><img src="/assets/images/content/sendy-add-git.png" alt="Hook Forge up to Github" /></p>
<h3>2.b Tweak the deploy settings</h3>
<p>Hit the &quot;Edit Deploy Script&quot; button to tweak your deploy script. Set it to the following:</p>
<pre><code class="language-bash">$ cd /home/forge/sendy.mattstauffer.co
$ git pull origin master</code></pre>
<p>(Of course, replace my site domain with yours).</p>
<p>Since this project doesn't use Laravel or Composer, we're just dropping the lines from the default deploy script that run the Composer install and Laravel migrations.</p>
<p>Now, turn on auto-deploy (if you're using Bitbucket, set up the Deployment Trigger URL; if you're using Github, just hit &quot;Enable Quick Deploy&quot;) and hit the manual <strong>Deploy Now</strong> button to get the code up on the server.</p>
<h3>2.c Update <code>nginx.conf</code></h3>
<p>Because Sendy was designed for Apache, we have to do a bit of custom tweaking for Nginx. This script comes from Eric Barnes, who scraped it from the Internet somewhere.</p>
<p><a href="https://gist.github.com/ericbarnes/cf2e1484b7e9af603642">Nginx Config Script for Sendy</a></p>
<p>When you're managing your site in Forge, there's an icon in the lower right hand corner of the screen that looks like a pen and paper; tap it, and choose &quot;Edit Nginx Configuration.&quot;</p>
<p>Paste in Eric's script, and replace <code>site.com</code> with your URL--for example, <code>sendy.mattstauffer.co</code>.</p>
<h3>2.d Chmod the uploads directory</h3>
<p>SSH into your Forge server, <code>cd</code> to your Sendy directory, and <code>chmod 777</code> your <code>uploads</code> folder:</p>
<pre><code class="language-bash">$ ssh forge@my-forge-server-public-id
$ cd sendy.mattstauffer.co
$ chmod 777 uploads/</code></pre>
<h2>3. Set up your domain</h2>
<p>Copy your Forge server's Public IP address. Now, visit your DNS provider and add a A-Name record for the domain or subdomain. Point it to the Forge server Public IP address.</p>
<p><img src="/assets/images/content/sendy-dns.png" alt="Domain Server" /></p>
<h2>4. Sendy's Getting Started Guide</h2>
<p>Visit Sendy's <a href="https://sendy.co/get-started">Get Started Guide</a> and follow the directions.</p>
<p>Make sure to remember to add a database to your Forge server for the Sendy install to use.</p>
<p>Also note that the AWS/SES setup for Sendy is a bit complicated; if you have a lot of trouble with it, <a href="http://twitter.com/stauffermatt">hit me up on Twitter</a> and I might write a separate blog post on that.</p>
<h2>5. Set up cron jobs</h2>
<p>Manage the <em>server</em> (not the <em>site</em>) for your Forge install and go to the <em>Scheduler</em> tab.</p>
<p>Add two cron jobs, one for the scheduler and one for autoresponders.</p>
<pre><code>*/5 * * * *  php /home/forge/sendy.mattstauffer.co/scheduled.php
*   * * * *  php /home/forge/sendy.mattstauffer.co/autoresponders.php</code></pre>
<p>The autoresponder should run every minute, so there's already a default for that.</p>
<p>Note that the scheduler should run every 5 minutes, so you'll want to choose the &quot;custom&quot; frequency and set it to <code>*/5 * * * *</code>.</p>
<p><img src="/assets/images/content/send-add-cron.png" alt="Add cron" /></p>
<p>Once you add them both, it should look like this:</p>
<p><img src="/assets/images/content/sendy-all-crons.png" alt="All crons" /></p>
<h2>6. Templates</h2>
<p>Sendy doesn't come with any HTML templates out of the box, so it's going to be a little more work than you're used to to create your content.</p>
<p>Sendy <em>does</em> have a WYSIWYG editor inline, so you can create very simple newsletters easily, but if you want to go a little more complicated, you'll have to do some work on your own.</p>
<p>I'll be writing an article soon about how I create mine, but for a quick introduction, check out <a href="https://laravel-news.com/2014/06/laravel-news-digest-behind-the-scenes/">Eric Barnes' writeup on how he creates the Laravel-News newsletter</a>.</p>
<h2>Wait a sec.</h2>
<p><em>&quot;You're telling us all about how to create an email newsletter and you haven't pitched it yet?&quot;</em></p>
<p>Well, boy howdy, you're right!</p>
<blockquote>
<p>Friend, you should sign up for my new newsletter! I'll share my best thoughts and advice about how you can uniquely <strong>do good</strong>--wherever you are, whether you're a designer, a developer, a project manager, entrepreneur, or whatever else. I want to help you <strong>do what you do, whatever it is, the best you can</strong>.</p>
</blockquote>
<div style="background: #f3f3ee; padding: 1.5em;border-radius:0.5em;">

<form action="https://send.mattstauffer.co/subscribe" method="POST" accept-charset="utf-8"><!--
    <input type="text" name="name" id="name" placeholder="Your Name..." style="padding:0.5em 1em;border-radius:0.5em;border: 1px solid #ddd;margin-right:1em;"/>-->
    <input type="text" name="email" id="email" placeholder="Your Email..." style="padding:0.5em 1em;border-radius:0.5em;border: 1px solid #ddd;margin-right:1em;"/>
    <input type="hidden" name="list" value="jlLXuDMHCokwXR68VvCPnw"/>
    <input type="submit" name="signup" id="submit" value="Sign me up" style="background:#EB6864;border-radius:0.5em;padding:0.5em 2em;border:0;color:#fff"/>
</form>

</div>
<h2>Go forth and email</h2>
<p>That's it! You now have a fully-functional install of Sendy running on your Laravel Forge server.</p>
<p>From this point forward, it's just Sendy-as-usual: create a list and get people signed up, create a campaign, test send, send, profit.</p>
<p>That's it for this post--enjoy! Check back soon (or, sign up for my newsletter!) and I'll be posting more soon about how to tweak Sendy and how to create your own templating system with Laravel.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/installing-an-under-development-version-of-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/installing-an-under-development-version-of-laravel"/>
        <title>Installing an in-development version of Laravel</title>
        <published>2015-05-20T00:00:00+00:00</published>
        <updated>2015-05-20T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I&#039;m often writing here about features in the lates...</summary>
        <content type="html"><![CDATA[
        <p>I'm often writing here about features in the latest version of Laravel. You might be wondering, how do I install the latest version if I want to try it out?</p>
<blockquote>
<p>Disclaimer: If you do this, you're going to be installing an under-development, almost-    guaranteed-to-have-bugs version of Laravel. Things will break, and you can't expect any customer support until it's released.</p>
</blockquote>
<h2>Fresh Install</h2>
<p>The simplest option is to just to use Composer to install a fresh app from the <code>develop</code> branch:</p>
<pre><code class="language-bash">$ composer create-project laravel/laravel your-project-name-here dev-develop</code></pre>
<h2>Upgrade install</h2>
<p>If you need to upgrade, it's a little more complex, because you might find dependency issues, and you won't have the upgrade guide to show you what changes you need to make to your files. But if you're willing to risk it:</p>
<ol>
<li>Update the <code>minimum-stability</code> property in your <code>composer.json</code> to be <code>dev</code>. If it doesn't exist, just add it to the bottom of <code>composer.json</code> (<code>"minimum-stability": "dev"</code>)</li>
<li>Update the <code>laravel/framework</code> version to be the version you want to use. So, if you're running <code>5.0</code> and want to try out <code>5.1</code>, update it to be: <code>"laravel/framework": "5.1.*"</code></li>
<li>Composer update</li>
<li>Fix things that break because you don't have an upgrade guide available for you yet</li>
</ol>
<p>That's it! Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/applying-an-ssl-cert-to-a-laravel-forge-sites-www.-domain</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/applying-an-ssl-cert-to-a-laravel-forge-sites-www.-domain"/>
        <title>Applying an SSL cert to a Laravel Forge site&#039;s www. domain</title>
        <published>2015-05-15T00:00:00+00:00</published>
        <updated>2015-05-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Important Note: Many SSL certificate providers no...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>Important Note: Many SSL certificate providers now generate certs which work on both the www. and the non-www. version of your domain. If you have a provider that does this (RapidSSL does, and I've heard that Comodo does as well), follow these instructions, but instead of buying two certs, just use the same Forge cert ID in both locations.</p>
</blockquote>
<p>I ran into an issue this week that ended up with some visitors to <a href="https://karaniapp.com/">Karani</a> seeing security errors in their browsers when they visited via a particular URL. Not good!</p>
<p><img src="/assets/images/content/chrome-ssl-error.png" alt="Chrome SSL Cert Error" /></p>
<p>In Forge, if you set up <code>karaniapp.com</code> as a site, <code>www.karaniapp.com</code> will forward there. But if you buy a non-wildcard SSL cert for <code>karaniapp.com</code>, it won't work for <code>www.karaniapp.com</code>, so if someone types <code>https://www.karaniapp.com/</code>, it'll give a security error.</p>
<p>The fix? Add an SSL cert for <code>www.karaniapp.com</code> too.</p>
<h2>Your site's second cert</h2>
<p>Just like normal, generate a CSR in Forge, order a cert for <code>www.karaniapp.com</code>, and install it, but <em>don't</em> activate it (because if you activated this new SSL cert, that would deactive your primary SSL cert for <code>karaniapp.com</code>).</p>
<p>Instead, ssh into your server. <code>sudo vim /etc/nginx/sites-available/www.karaniapp.com</code> (or whichever domain you're adding the non-primary SSL cert to). What we're doing here is using <code>vim</code> (a command line editor; you can use pico or emacs or whatever else) to edit the Nginx configuration file for this site.</p>
<p>By default you'll just see the non-HTTPS config for a site redirect:</p>
<pre><code>server {
 listen 80;
 server_name www.karaniapp.com;
 return 301 $scheme://karaniapp.com$request_uri;
}</code></pre>
<p>You'll want to add the HTTPS redirect config in here, just below the closing brace, manually.</p>
<pre><code>server {
 listen 80;
 server_name www.karaniapp.com;
 return 301 $scheme://karaniapp.com$request_uri;
}

server {
 listen 443 ssl;
 server_name www.karaniapp.com;

 # FORGE SSL (DO NOT REMOVE!)
 ssl on;
 ssl_certificate /etc/nginx/ssl/karaniapp.com/12345/server.crt;
 ssl_certificate_key /etc/nginx/ssl/karaniapp.com/12345/server.key;

 return 301 $scheme://karaniapp.com$request_uri;
}</code></pre>
<p>Notice that there's a number (<code>12345</code> in this example) in the middle of the <code>ssl_certificate</code> and <code>ssl_certificate_key</code> paths. Where do you get the number from?</p>
<p>Log into Forge, edit your site, click the SSL Certificates tab, and scroll down to the bottom. Find the <strong>Cert Path</strong> for your non-primary SSL cert and grab the number from there.</p>
<p><img src="/assets/images/content/find-forge-ssl-cert-number.png" alt="Find Forge SSL Cert Number" /></p>
<p>Save that file and restart Nginx. You can either <code>sudo service nginx restart</code> from the command line, or visit the server in Forge, and click the refresh icon, and choose &quot;restart Nginx&quot;.</p>
<p><img src="/assets/images/content/forge-restart-nginx.png" alt="Forge Restart Nginx" /></p>
<p>That's it!</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/laravel-symfony-angular-cors-blocked-put-patch-delete-x-http-method-override-and-neterr-empty-response
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-symfony-angular-cors-blocked-put-patch-delete-x-http-method-override-and-neterr-empty-response"/>
        <title>Laravel/Symfony, Angular, CORS, Blocked PUT/PATCH/DELETE, X-HTTP-Method-Override, and
            net::ERR_EMPTY_RESPONSE
        </title>
        <published>2015-05-01T00:00:00+00:00</published>
        <updated>2015-05-01T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you couldn&#039;t tell from the title, this is going...</summary>
        <content type="html"><![CDATA[
        <p>If you couldn't tell from the title, this is going to be a very technical post that I hope saves someone from some of the pain my team just went through.</p>
<p>TL;DR Make your API SSL/HTTPS and you're good to go.</p>
<h2>The backstory</h2>
<p><a href="http://tighten.co/">Tighten</a> built an app for a client recently using an Angular frontend and a Laravel API backend. They were running on separate domains, and worked fine for us. But when the client tried to use them, they could <em>list</em> and <em>show</em> their content but not <em>create</em>, <em>edit</em>, or <em>delete</em> it.</p>
<p>We originally thought the issue was CORS, so we wasted <em>far</em> too much time on that. See the Postscript about CORS to learn more about that.</p>
<h2>Finding the real problem</h2>
<p>I was finally able to get on a screenshare with the client, so I had them open the Chrome Web Inspector. We saw that the XHR (AJAX) requests that had the header of <code>GET</code> and <code>OPTIONS</code> were working fine, but <code>PUT</code> (create), <code>PATCH</code> (edit), and <code>DELETE</code> (delete) were failing. They were showing up in Chrome as red with an error saying <code>net::ERR_EMPTY_RESPONSE</code>, which means there was <em>nothing</em> coming back. No error message, no status code, <em>nothing</em>.</p>
<p>I downloaded the HAR of each to make sure there was nothing different in our <code>OPTIONS</code>, diffed them in <a href="http://www.kaleidoscopeapp.com/">Kaleidoscope</a>, and found there was nothing of significance. The browser sent an <code>OPTIONS</code> request, the server sent back a reply saying it was OK to do all of those things, the browser sent a <code>PATCH</code>/<code>PUT</code>/<code>DELETE</code> request, and then the response on my machine (not behind firewall) was fine and the response on the client's (behind firewall) was <em>completely</em> empty:</p>
<pre><code class="language-json">        "response": {
          "status": 0,
          "statusText": "",
          "httpVersion": "unknown",
          "headers": [],
          "cookies": [],
          "content": {
            "size": 0,
            "mimeType": "x-unknown"
          },
          "redirectURL": "",
          "headersSize": -1,
          "bodySize": -1,
          "_transferSize": 0,
          "_error": "net::ERR_EMPTY_RESPONSE"
        },</code></pre>
<p>You don't get any more <em>nothing</em> than that. So we began to suspect that this client's server was disallowing <code>PUT</code>/<code>PATCH</code>/<code>DELETE</code> requests, since they're a <em>tiny</em> bit more advanced and less common.</p>
<h3>X-HTTP-METHOD-OVERRIDE</h3>
<p>Since Laravel's request and response objects are extensions of Symfony's, I could take advantage of Symfony's <code>X-HTTP-Method-Override</code> header. If you use Laravel or Symfony, you might be familiar with how this works on a web form: You add a hidden field named <code>_method</code> with a value of <code>PUT</code> or <code>PATCH</code> or <code>DELETE</code>, submit the form via POST, and then Symfony/Laravel treat it as a <code>PUT</code>/<code>PATCH</code>/<code>DELETE</code> request.</p>
<p>If you're making a request that's not a form--for example, an AJAX request to an API--you want to do things a little differently. You want to add a header named <code>X-HTTP-method-Override</code> with the value of your desired method.</p>
<p>So, we went into Angular and changed our requests from this:</p>
<pre><code class="language-javascript">        factory.patch = function(form) {
            return $http({
                url: AppSettings.base + AppSettings.dataType.all + '/' + form.id,
                data: form,
                method: "PATCH"
            });
        }</code></pre>
<p>to this:</p>
<pre><code class="language-javascript">        factory.patch = function(form) {
            return $http({
                url: AppSettings.base + AppSettings.dataType.all + '/' + form.id,
                data: form,
                method: "POST",
                headers: {
                    "X-HTTP-Method-Override": "PATCH"
                }
            });
        }</code></pre>
<p>At that point, we were now sending <code>POST</code> requests, which means they were able to make it past the client's <code>PUT</code>/<code>PATCH</code>-stripping proxy.</p>
<h2>Learning why</h2>
<p>I asked on Twitter the next morning, &quot;Has anyone ever heard of a corporate web proxy that disallows PUT and PATCH requests? Think we might be running into one but not sure.&quot; I received quite a bit of affirmative support--this is, indeed, a thing that happens often.</p>
<p><a href="https://twitter.com/stauffermatt/status/586510133296934913">https://twitter.com/stauffermatt/status/586510133296934913</a></p>
<h2>The HTTPS trick</h2>
<p>Several folks pointed out that, if you use HTTPS, the proxy can't even see the method, so it can't reject certain methods. (<a href="http://stackoverflow.com/a/26591326/1052406">StackOverflow</a>)</p>
<p>All APIs should be HTTPS anyway, so this is why this is something I've never run into before. The only reason the site we were working on <em>wasn't</em> HTTPS was because it was a staging server. I've now learned my lesson. Even our staging servers are getting HTTPS.</p>
<h2>Postscript: CORS</h2>
<h3>Our Laravel configuration</h3>
<p>At first we thought this was a CORS error, so we fussed with CORS for ages. This is a Laravel 4 app, so this is what our configuration looked like. First, the Middleware:</p>
<pre><code class="language-php">&lt;?php namespace App\Http;

use Symfony\Component\HttpKernel\HttpKernelInterface;
use Symfony\Component\HttpFoundation\Request as SymfonyRequest;

class Cors implements HttpKernelInterface
{
    protected $app;

    public function __construct(HttpKernelInterface $app)
    {
        $this-&gt;app = $app;
    }

    public function handle(SymfonyRequest $request, $type = HttpKernelInterface::MASTER_REQUEST, $catch = true)
    {
        // Handle on passed down request
        $response = $this-&gt;app-&gt;handle($request, $type, $catch);

        $response-&gt;headers-&gt;set('Access-Control-Allow-Origin' , '*', true);
        $response-&gt;headers-&gt;set('Access-Control-Allow-Methods', 'GET, POST, PATCH, PUT, DELETE, OPTIONS, HEAD', true);
        $response-&gt;headers-&gt;set('Access-Control-Allow-Headers', 'Content-Type, Accept, Authorization, X-Requested-With', true);

        if ($request-&gt;getMethod() == 'OPTIONS') {
            $response-&gt;setStatusCode(200);
            $response-&gt;setContent(null);
        }

        return $response;
    }
}
</code></pre>
<p>I'm still unsure of whether the &quot;if request is OPTIONS&quot; block is entirely necessary, but I was trying everything I could here.</p>
<p>Then, the binding:</p>
<pre><code class="language-php">&lt;?php namespace App\Http;

use Illuminate\Support\ServiceProvider;

class CorsProvider extends ServiceProvider
{
    public function register()
    {
        $this-&gt;app-&gt;middleware(Cors::class);
    }
}</code></pre>
<p>Finally, registering the Service Provider in <code>app/config/app.php</code>--I added <code>SocialPack\Http\CorsProvider::class,</code> to the bottom of the <code>providers</code> array.</p>
<p>Now we could sniff our response headers and see that we were getting them back just like we would want for correct CORS-ification.</p>
<h3>Same-domain</h3>
<p>When verifying our CORS settings didn't fix it, we tried putting the admin panel on the same domain. We moved the Angular app to <code>api.ourServer.com/admin</code> so that it was making calls from the same server.</p>
<p>Even that didn't fix it, which was when I realized it wasn't CORS at all.\</p>
<h2>Benso-matic</h2>
<p>Quick note: The primary developer on this project was <a href="https://twitter.com/besologic">Benson Lee</a>, and he was with me every step of the way of discovering this solution. Gotta give credit where credit's due. :)</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/broadcasting-events-with-pusher-socket-in-laravel-5.1</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/broadcasting-events-with-pusher-socket-in-laravel-5.1"/>
        <title>Broadcasting events with Pusher.com &amp; Socket.io in Laravel 5.1</title>
        <published>2015-04-28T00:00:00+00:00</published>
        <updated>2015-04-28T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Taylor&#039;s put up a new Laracast video about using t...</summary>
        <content type="html"><![CDATA[
        <p>Taylor's put up a <a href="https://laracasts.com/lessons/broadcasting-events-in-laravel-5-1">new Laracast video</a> about using the new Broadcasting tool in Laravel 5.1, which is a simple contract that allows you to <em>&quot;broadcast&quot;</em> any Event out to <a href="https://pusher.com">Pusher.com</a> or a Redis-backed <a href="http://socket.io">Socket.io</a> instance.</p>
<h2>What are Pusher.com and Socket.io?</h2>
<p>These are tools that use websockets to open a direct connection to your user's web browser so that you can push events directly to the user without reloading their page view.</p>
<p>If you've ever been on a web page and gotten &quot;push&quot; notifications of events (for example, when Laravel Forge updates the status of your server without you reloading the page), it's likely it was using websockets to open the connection between your browser and a server somewhere. Pusher.com is a hosted SaaS that makes it super easy to set it up, but you can also set up your own server using Socket.io.</p>
<h2>How do websockets work?</h2>
<p>I'll save you from most of the technical details, but just know: There's a direct connection being opened between a web browser and a backend server. The server can push &quot;events&quot; (which each have a name and optionally a payload of data) along &quot;channels&quot;. So, for example, Forge might have a &quot;server-status&quot; channel which can push out an event every time a server's status changes.</p>
<p>So if you set up Pusher.com to handle your websockets, you'll install a <a href="https://pusher.com/docs/javascript_quick_start">Javascript-based client on the frontend</a>, and then use the <a href="https://packagist.org/packages/pusher/pusher-php-server">Pusher PHP SDK</a> to &quot;push&quot; events from your server to Pusher.com, which will then push them to the client.</p>
<h2>So, what are Laravel broadcast events?</h2>
<p>If you're not familiar, check out <a href="https://mattstauffer.co/blog/laravel-5.0-events-and-handlers">how Laravel 5 events work</a>. So, we now know that we can fire events--in the Forge event, maybe it would be a <code>ServerUpdated</code> event.</p>
<pre><code class="language-php">// ServerControllerOrSomething.php
    public function update()
    {
        // Do updating stuff...

        // Now send event
        event(new ServerUpdated($server));
    }</code></pre>
<p>In the past, if you wanted to push a websocket notification to your users here, you would pull in the Pusher SDK, and manually send a notification over to Pusher.com in the event handler.</p>
<p>Now, you just add two things to your event: a <code>ShouldBroadcast</code> interface and a <code>broadcastOn</code> method.</p>
<h2>Updating your Event to be broadcast-friendly</h2>
<p>Check it out:</p>
<pre><code class="language-php">&lt;?php

use Illuminate\Contracts\Broadcasting\ShouldBroadcast;

class ServerUpdated implements ShouldBroadcast
{
    public $server;

    public function __construct($server)
    {
        $this-&gt;server = $server;
    }

    public function broadcastOn()
    {
        return ['server-updates'];
    }
}</code></pre>
<p>As you can see, the <code>broadcastOn</code> method just sends back an array, and as you can guess from what we talked about earlier, this array is a list of all of the Pusher channels we want to broadcast this event on.</p>
<h2>Payload</h2>
<p>Every public property on your event will be sent along as a part of the Pusher payload. Protected or private properties won't be sent along.</p>
<p>Note that we passed in an Eloquent object <code>$server</code> on ours; since Eloquent objects are <code>JSONable</code>, the <code>$server</code> object will be converted to JSON and delivered with the payload.</p>
<h2>Using these events in our client-side code</h2>
<p>You'll want to follow the Pusher directions to get your client code up and running, but you'll end up with something like this:</p>
<pre><code class="language-javascript">var serverChannel = pusher.subscribe('server-status');
serverChannel.bind('ServerUpdated', function(message) {
    console.log(message); // Full payload
});</code></pre>
<h2>Config</h2>
<p>There's a new <code>config/broadcasting.php</code> configuration file that allows you to set up your connections and pass in which each instance should be using.</p>
<p>The three possible drivers right now are Pusher.com, Socket.io, and <code>log</code>, which just writes it out to a local log file for testing:</p>
<pre><code class="language-json">[2015-04-28 20:00:00] local.INFO: Broadcasting [ServerUpdated] on channels [server-status] with payload:
{
    "server": {
        "id": 1
    }
}</code></pre>
<h2>Conclusion</h2>
<p>Now there are even less barriers getting in the way of you adding websockets to your app. Set your Event to broadcast, plug it into a Pusher.com account, and then pull in the Pusher client on your frontend and you're up and running!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/generating-synonymous-heroku-style-server-names-with-lumen</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/generating-synonymous-heroku-style-server-names-with-lumen"/>
        <title>Generating synonymous, Heroku-style, server names with Lumen</title>
        <published>2015-04-15T00:00:00+00:00</published>
        <updated>2015-04-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I gave an example yesterday about how to use Lumen...</summary>
        <content type="html"><![CDATA[
        <p>I gave an example yesterday about how to use Lumen, but I figured a few more examples would be fun.</p>
<p>If you spin up a new app on Heroku or Forge, they come up with a random name like &quot;airy-craig&quot; or &quot;soaring-peaks&quot;. I figured, why don't we create a microservice that just provides these sort of names for any consuming application?</p>
<p>We're going to be creating our names as variations on the phrase &quot;Happy Brad&quot; (in honor of my dear friend <a href="https://twitter.com/angrybrad">Brad</a>), and we'll use a thesaurus API to give us synonyms to the adjective we pass in. So, for example, <code>http://www.happy-brad-naming-service.com/happy/brad</code> would return something like:</p>
<pre><code class="language-json">{
    "result": "Elated Brad"
}</code></pre>
<p>while <code>http://www.happy-brad-naming-service.com/sad/brad</code> might return something like:</p>
<pre><code class="language-json">{
    "result": "Depressed Brad"
}</code></pre>
<h2>Installing Lumen</h2>
<p>If you haven't installed the Lumen installer yet, do that:</p>
<pre><code class="language-bash">composer global require "laravel/lumen-installer:~1.0"</code></pre>
<p>Now, just create a new Lumen project:</p>
<pre><code class="language-bash">cd Sites
lumen new happyBrad
cd happyBrad
cp .env.example .env</code></pre>
<h2>Basic setup</h2>
<p>The first thing I'll do is edit <code>bootstrap/app.php</code>. I'll definitely want to enabled the <code>Dotenv::load</code> line, and I'll be using Façades here, so I'll uncomment <code>$app-&gt;withFacades();</code> as well.</p>
<h2>Previewing your site</h2>
<p>Now run <code>php artisan serve</code> and you'll be serving a site at <code>localhost:8000</code>. Open that up in your browser, and then jump back to your code editor.</p>
<h2>First route</h2>
<p>Let's edit <code>app/Http/routes.php</code> to set up our first route.</p>
<pre><code class="language-php">&lt;?php

$app-&gt;get('/{adjective}/brad', function ($adjective) {
    return response([
        'result' =&gt; ucwords($adjective) . ' Brad'
    ]);
});</code></pre>
<p>Great. We're now taking in <code>site.com/adjective/brad</code> and we get a JSON response of <code>{"result": "Adjective Brad"}</code>.</p>
<h2>Synonyms</h2>
<p>All we have to do now is plug in the synonym generator. I just googled &quot;thesaurus API&quot;, and picked the <a href="https://words.bighugelabs.com/api.php">Big Huge Thesaurus</a> API. I applied for a free API key, and now I'm ready to go.</p>
<h3>Getting the synonym</h3>
<p>I could pull in Guzzle or write an SDK, but since this is so quick-and-dirty, let's just use <code>file_get_contents()</code> for now.</p>
<p>The URL I'm trying to create is <code>http://words.bighugelabs.com/api/{version}/{apiKey}/{term}/json</code>.</p>
<p>First, I need to save my thesaurus API key as an environment variable, so I add a line to <code>.env</code> and to <code>.env.example</code> that's <code>THESAURUS_KEY</code>, and in <code>.env</code> I'll set it equal to my actual thesaurus API key.</p>
<p>Second, I need to get that key in my route.</p>
<pre><code class="language-php">$apiKey = getenv('THESAURUS_KEY');</code></pre>
<p>Now, let's construct our URL:</p>
<pre><code class="language-php">$url = sprintf(
    "http://words.bighugelabs.com/api/2/%s/%s/json",
    $apiKey,
    urlencode($adjective)
);</code></pre>
<p>Then we can get it:</p>
<pre><code class="language-php">$result = json_decode(file_get_contents($url));</code></pre>
<p>I know this will return something like this:</p>
<pre><code class="language-php">{
    "adjective": {
        "syn": [
            "felicitous",
            "glad",
            "well-chosen"
        ],
        "ant": [
            "unhappy"
        ],
        "rel": [
            "euphoric",
            "joyous"
        ],
        "sim": [
            "riant",
            "prosperous"
        ]
    }
}</code></pre>
<p>So for now, I just want the array of synonyms. So, we'll pull in <code>$result-&gt;adjective-&gt;syn</code>.</p>
<p>Then, I want to randomly pull out a single adjective.</p>
<pre><code class="language-php">$synonyms = $result-&gt;adjective-&gt;syn;
$synonym = $synonyms[array_rand($synonyms)];</code></pre>
<p>Finally, let's return our response:</p>
<pre><code class="language-php">return response([
    'result' =&gt; ucwords($synonym) . ' Brad'
]);</code></pre>
<p>Let's put that all together:</p>
<pre><code class="language-php">$app-&gt;get('/{adjective}/brad', function ($adjective) {
    $apiKey = getenv('THESAURUS_KEY');

    $url = sprintf(
        "http://words.bighugelabs.com/api/2/%s/%s/json",
        $apiKey,
        urlencode($adjective)
    );

    $result = json_decode(file_get_contents($url));
    $synonyms = $result-&gt;adjective-&gt;syn;

    $synonym = $synonyms[array_rand($synonyms)];

    return response([
        'result' =&gt; ucwords($synonym) . ' Brad'
    ]);
});</code></pre>
<h3>Caching the response</h3>
<p>I'm going to be hitting the API a lot here, though, so let's cache our response using <code>Cache::remember</code>.</p>
<pre><code class="language-php">$app-&gt;get('/{adjective}/brad', function ($adjective) {
    $apiKey = getenv('THESAURUS_KEY');
    // Forever cache, because synonym lists are
    // likely never going to change
    $cacheTtl = 0;

    $synonyms = Cache::remember(
        $adjective,
        $cacheTtl,
        function() use ($adjective, $apiKey)
        {
            $url = sprintf(
                "http://words.bighugelabs.com/api/2/%s/%s/json",
                $apiKey,
                urlencode($adjective)
            );

            $result = json_decode(file_get_contents($url));
            $synonyms = $result-&gt;adjective-&gt;syn;

            return $synonyms;
        }
    );

    $synonym = $synonyms[array_rand($synonyms)];

    return response([
        'result' =&gt; ucwords($synonym) . ' Brad'
    ]);
});</code></pre>
<h2>Check it out</h2>
<p>You can use this tool yourself here:</p>
<p><a href="http://happy-brad.fiveminutegeekshow.com/adorable/brad">http://happy-brad.fiveminutegeekshow.com/adorable/brad</a></p>
<p>And check out the code here:</p>
<p><a href="https://github.com/mattstauffer/synonym-namer">https://github.com/mattstauffer/synonym-namer</a></p>
<p>And finally: If you were really using this service, A) you'd need a much bigger sample source to draw from, and B) you'd need to do much more error handling. This is just for fun.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-lumen-from-laravel</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-lumen-from-laravel"/>
        <title>Introducing Lumen from Laravel</title>
        <published>2015-04-14T00:00:00+00:00</published>
        <updated>2015-04-14T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Lumen is a new project from Laravel creator Taylor...</summary>
        <content type="html"><![CDATA[
        <p><a href="http://lumen.laravel.com/">Lumen</a> is a new project from Laravel creator Taylor Otwell. It's a &quot;micro-framework&quot;, meaning it's a smaller, faster, leaner version of a full web application framework. PHP has two other popular micro-frameworks, Slim and Silex.</p>
<p><img src="/assets/images/content/Screen-Shot-2015-04-14-at-9.49.31-AM.png" alt="Lumen" /></p>
<p>Lumen has the same foundation as Laravel, and many of the same components. But Lumen is built for microservices, not so much for user-facing applications (although it can be used for anything.) As such, frontend niceties like Bootstrap and Elixir and the authentication bootstrap and sessions don't come enabled out of the box, and there's less flexibility for extending and changing the bootstrap files.</p>
<h2>What's it for?</h2>
<p>Lumen is for projects and components that can benefit from the convenience and power of Laravel but can afford to sacrifice some configurability and flexibility in exchange for a speed boost. </p>
<p>Lumen is targeted at <a href="http://martinfowler.com/articles/microservices.html">microservices</a>--small, loosely-coupled components that usually support and enhance a core project. Microservices are separated components with bounded contexts (meaning they have well-defined interfaces between each other), so in a microservice architecture you might have several small Lumen apps that support another, possibly Laravel-powered, app.</p>
<h2>Show me.</h2>
<p>So as not to talk too much about microservices <em>and</em> Lumen at the same time, let's just start by providing a simple caching layer in front of a slow or unreliable external service. I often work with external data sources--APIs, for example--that need transformation and/or caching. As a result, I often build small single-purpose applications that sit between one source of data and my consuming code.</p>
<p>I'll often use Laravel for these applications, which is fine, but there is a lot of extra code that comes with stock Laravel that I don't need for a microservice, let alone one of these little single-purpose caches. So, let's build one of these using Lumen.</p>
<h3>Caching</h3>
<p>One simple way I've provided a cache layer in the past is just to route all of my calls through this layer, cache the results, and serve from the cache. Let's try that out.</p>
<h3>Installing Lumen</h3>
<p>Lumen has a simple installer just like Laravel's. You can pull it in globally:</p>
<pre><code class="language-bash">composer global require "laravel/lumen-installer=~1.0"</code></pre>
<p>Now, you can run <code>lumen new MyProject</code> and it'll create that folder and create a lumen project in there for you.</p>
<pre><code class="language-bash">cd Sites
lumen new my-cache
cd my-cache</code></pre>
<p>OK, so now we're in our Lumen install. You can check out <code>php artisan</code> to see what commands we have available, or <code>php artisan serve</code> to spin up a web server at <code>localhost:8000</code> that's serving your site.</p>
<p>Now, I just want to pass through all of my calls directly. Let's get this app running.</p>
<h3>Turning on DotENV and façades</h3>
<p>In Laravel, everything just works out of the box. That's pretty true in Lumen, too, but you're going to want to take a first glance at <code>bootstrap/app.php</code>. There are a few options you can enable in here--they'll look like a commented-out line of code that you can turn on by un-commenting it.</p>
<p>Because I'll be wanting to use Laravel's Façades and <code>.env</code> environment variables, I'll un-comment those lines, which look like this:</p>
<pre><code class="language-php">// Dotenv::load(__DIR__.'/../');</code></pre>
<p>and this:</p>
<pre><code class="language-php">// $app-&gt;withFacades();</code></pre>
<p>You can scroll through this file and see places you can enable Eloquent, route and global middleware, and service providers.</p>
<h3>Capturing all routes</h3>
<p>Next, let's go to <code>app/Http/routes.php</code>. Note that routes in Lumen use <a href="https://github.com/nikic/FastRoute">nikic/FastRoute</a> instead of the Illuminate Router, so things will look a little different.</p>
<p>Let's create a route to capture <em>every</em> route that's passed through. </p>
<pre><code class="language-php">$app-&gt;get('{path:.*}', function($path)
{
    echo 'You just visited my site dot com slash ' . $path;
});</code></pre>
<p>If you're familiar with Laravel, you may notice that that above route in Laravel would be:</p>
<pre><code class="language-php">$router-&gt;get('{path?}', function($path)
{
    echo 'You just visited my site dot com slash ' . $path;
})-&gt;where('path', '.*');</code></pre>
<p>But essentially, we're capturing every path and passing it in as the <code>$path</code> variable.</p>
<h3>Passing through</h3>
<p>Now, we can set up our API caller.  Skip the next two paragraphs if you don't care about the API caller--it's not entirely necessary to understand this example.</p>
<p>Note that I'm using a generic <code>PassThrough</code> class I wrote that is constructed with a base URL (e.g. <code>http://api.mysite.com/v1/</code>), and has a <code>getResultsForPath</code> method which takes a path (e.g. <code>people/145</code>), and returns a result that's an array with <code>headers</code>, <code>body</code>, and <code>status</code>. It operates the same as the <code>fakeApiCaller</code> class I described in <a href="https://mattstauffer.co/blog/the-little-oft-unrecognized-laravel-goodies">this blog post</a>.</p>
<p>So, we're defining which headers we do and don't want to return; the root URL for our API calling; and then we're passing the path to the caller, getting a response, and creating an Illuminate response using Laravel's <code>response()</code> helper, which takes the parameters of <code>body</code>, <code>status</code>, <code>headers</code>.</p>
<pre><code class="language-php">$app-&gt;get('{path:.*}', function ($path) use ($app)
{
    // Configure
    $headersToPass = ['Content-Type', 'X-Pagination'];
    $rootUrl = 'http://www.google.com/';

    // Run
    $passThrough = $app-&gt;make('App\PassThrough', [$rootUrl]);
    $result = $passThrough-&gt;getResultsForPath($path);

    // Return
    return response(
        $result['body'],
        $result['status'],
        array_only(
            $result['headers'],
            $headersToPass
        )
    );
});</code></pre>
<p>Notice that we're passing the <code>$app</code> instance around, which we can use to resolve objects out of the IOC container or whatever else.</p>
<h3>Caching</h3>
<p>Finally, let's, cache the results, and we're good to go.</p>
<pre><code class="language-php">$app-&gt;get('{path:.*}', function ($path) use ($app)
{
    // Configure
    $cacheTtl = 60;
    $headersToPass = ['Content-Type', 'X-Pagination'];
    $rootUrl = 'http://www.google.com/';

    // Run
    $result = Cache::remember(
        $path,
        $cacheTtl,
        function() use ($path, $app, $rootUrl) 
        {
            $passThrough = $app-&gt;make('App\PassThrough', [$rootUrl]);
            return $passThrough-&gt;getResultsForPath($path);
        }
    );

    // Return
    return response(
        $result['body'],
        $result['status'],
        array_only(
            $result['headers'], $headersToPass
        )
    );
});</code></pre>
<p>That's it! We now have a blazing fast caching mechanism in front of any site. Create your <code>PassThrough</code> class, use Guzzle to construct and call the path, and then split out the Guzzle response to the expected shape, and you're good to go.</p>
<h2>Other ideas</h2>
<p>Clearly this is a very simple use-case. Lumen is targeted at microservices, so it's more likely to be used when you're separating out a single high-use piece of your application. It might become your API server, or push (or pull) from your queues. It might collect data from multiple places and then serve it out in a normalized manner. If it's a single component, especially if it's high traffic, it may be worth trying it out with Lumen.</p>
<h2>Conclusion</h2>
<p>Lumen is Laravel, stripped down for speed. It doesn't bother with views and sessions and other consumer-facing conveniences--it's optimized for speedy, trim, microservices. Try it out. And check out the <a href="http://lumen.laravel.com/docs/installation">docs</a>, too, for a ton of more information about how to use Lumen. </p>
<p>ArtisanGoose has also written a <a href="http://blog.enge.me/post/building-an-api-for-your-laravel-application-with-lumen">blog post</a> about how he's using Lumen as a submodule <em>within</em> his Laravel application.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/the-little-oft-unrecognized-laravel-goodies</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/the-little-oft-unrecognized-laravel-goodies"/>
        <title>The little, oft-unrecognized, Laravel goodies</title>
        <published>2015-04-08T00:00:00+00:00</published>
        <updated>2015-04-08T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I was talking over a particular architecture issue...</summary>
        <content type="html"><![CDATA[
        <p>I was talking over a particular architecture issue with Taylor Otwell and happened to show him some unrelated code as an example. He paused our conversation so that he could show me a quick refactor, and straight up embarrassed me, so I had to share it with you, dear readers.</p>
<p>Here's my code. I write these little microservices all the time--they just sit in front of another service and cache it. That's it. Sometimes I modify the output or the headers, sometimes I crunch some things or mangle others. But the simplest form is just caching a slow or unreliable service.</p>
<pre><code class="language-php">&lt;?php // routes.php

class fakeApiCaller
{
    public function getResultsForPath($path)
    {
        return [
            'status' =&gt; 200,
            'body' =&gt; json_encode([
                'title' =&gt; "Results for path [$path]"
            ]),
            'headers' =&gt; [
                "Content-Type" =&gt; "application/json"
            ]
        ];
    }
}

Route::get('{path?}', function($path)
{
    $cacheLengthInMinutes = 60;
    $headersToPassThrough = [
        'Content-Type',
        'X-Pagination'
    ];

    if (Cache::has($path)) {
        $result = Cache::get($path);

    } else {
        $myCaller = new fakeApiCaller;

        $result = $myCaller-&gt;getResultsForPath($path);

        Cache::put($path, $result, $cacheLengthInMinutes);
    }

    // Pass through specified headers
    $headers = [];

    foreach ($headersToPassThrough as $header_name) {
        if (array_key_exists($header_name, $result['headers'])) {
            $headers[$header_name] = $result['headers'][$header_name];
        }
    }

    return response($result['body'], $result['status'], $headers);
})-&gt;where('path', '.*');</code></pre>
<p>It's clear, and I felt pretty good about it not wasting too much time or code. A bit long, yes, but whatever.</p>
<p>And then Taylor passed this back:</p>
<pre><code class="language-php">&lt;?php // routes.php

class fakeApiCaller
{
    public function getResultsForPath($path)
    {
        return [
            'status' =&gt; 200,
            'body' =&gt; json_encode([
                'title' =&gt; "Results for path [$path]"
            ]),
            'headers' =&gt; [
                "Content-Type" =&gt; "application/json"
            ]
        ];
    }
}

$app-&gt;get('{path?}', function($path)
{
    $result = Cache::remember($path, 60, function() use ($path) {
        return (new fakeApiCaller)-&gt;getResultsForPath($path);
    });

    return response($result['body'], $result['status'], array_only(
        $result['headers'], ['Content-Type', 'X-Pagination']
    ));
})-&gt;where('path', '.*');</code></pre>
<p>This takes advantage of several things mine didn't.</p>
<p>First, he used <a href="http://laravel.com/docs/5.0/cache#cache-usage"><code>$cache-&gt;remember()</code></a>, which was a Laravel feature I didn't even know existed. Remember is for <em>exactly</em> what I'm doing, so it simplifies the process of saying &quot;Give me the value of X, and if that wasn't set yet, get it from Y and then cache it at X and return it.&quot;</p>
<p>Second, he new'ed up the <code>fakeApiCaller</code> inline, which means he didn't need a spare line for that when we were only using it once.</p>
<p>Third, he passed the <code>$cacheLengthInMinutes</code> directly to <code>Cache::remember</code>. Using this or not depends on the familiarity of your team (and potential future devs) with Laravel. Just having a number there could be confusing, so if you anticipate trouble there, just extrat the 60 out as a variable like <code>$cacheLengthInMinutes</code>.</p>
<p>Fourth, he used Laravel's <code>array_only</code> syntax to easily only extract array items from <code>$result['headers']</code> that matched my &quot;desired pass-through&quot; array. Again, if you have folks who aren't used to <code>array_only</code>, you could extract the second parameter out to a <code>$headersToPassThrough</code> variable.</p>
<h2>Concludadore</h2>
<p>So, you might be looking at this saying, &quot;Matt, really? That's not that much different!&quot; And you're right. But to me, taking advantage of little tools and helpers--for example, I've been absolutely in love with <code>array_walk</code> lately--in your tiniest lines of code is a huge aspect of being a clear and concise programmer. If you're faithful in the little things...</p>
<p>I spend so much of my time at the top level that I miss out on a lot of opportunities for getting better as a line-by-line in-the-trenches programmer. I miss it, and I need it, which is (part of) why I have so many side projects. And little chances like this to up the quality and concision (but not cleverness!) of my code gives me great joy.</p>
<p>As an aside, my friend Zack Kitzmiller re-shared the <a href="http://c2.com/cgi/wiki?PythonPhilosophy">Zen of Python</a>, which I've read many times but feel like I should tattoo on my forearms.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/enabling-gzip-on-nginx-servers-including-laravel-forge</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/enabling-gzip-on-nginx-servers-including-laravel-forge"/>
        <title>Enabling Gzip on Nginx servers (including Laravel Forge)</title>
        <published>2015-03-23T00:00:00+00:00</published>
        <updated>2015-03-23T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I recently got an email from Google saying Karani ...</summary>
        <content type="html"><![CDATA[
        <p>I recently got an email from Google saying <a href="https://karaniapp.com/">Karani</a> has a few pages that are loading too slowly on mobile, and therefore will be penalized in its search results. I was shocked, because heavy mobile optimization has been a priority on Karani since day one.</p>
<p>I went to Google PageSpeed results they linked to, and found that Gzip wasn't enabled (<a href="https://developers.google.com/speed/docs/insights/EnableCompression">learn more about Gzip</a>). So, here are the steps I took to turn it back on:</p>
<h2>1. Figure out your settings</h2>
<p>I chose to copy the settings recommended by <a href="http://html5boilerplate.com/">HTML5Boilerplate</a>--that's what I had been using on my former Apache server and they worked great. H5bp is a wonderfully-curated collection of wisdom that I'm happy to benefit from.</p>
<p>You can find them here: <a href="https://github.com/h5bp/server-configs-nginx/blob/master/nginx.conf#L67-L109">h5bp nginx config</a></p>
<h2>2. SSH into your server, and edit your nginx configuration</h2>
<p>SSH into your server. Have your sudo password ready.</p>
<p>I'll use <code>vim</code>, but you can use whatever editor you prefer.</p>
<pre><code class="language-bash">sudo vim /etc/nginx/nginx.conf</code></pre>
<p>You can see that there's already a block of settings regarding Gzip; you could always just modify those and un-comment out the right lines. But since we're already prepared with our HTML5Boilerplate version, why don't we just wipe these lines:</p>
<pre><code>        ##
        # Gzip Settings
        ##

        Gzip on;
        Gzip_disable "msie6";

        # Gzip_vary on;
        # Gzip_proxied any;
        # Gzip_comp_level 6;
        # Gzip_buffers 16 8k;
        # Gzip_http_version 1.1;
        # Gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</code></pre>
<h2>3. Add your configuration settings</h2>
<p>Where the old Gzip settings were, paste your new settings. These are what they are at the time of writing this article:</p>
<pre><code>  # Compression

  # Enable Gzip compressed.
  gzip on;

  # Enable compression both for HTTP/1.0 and HTTP/1.1.
  gzip_http_version  1.1;

  # Compression level (1-9).
  # 5 is a perfect compromise between size and cpu usage, offering about
  # 75% reduction for most ascii files (almost identical to level 9).
  gzip_comp_level    5;

  # Don't compress anything that's already small and unlikely to shrink much
  # if at all (the default is 20 bytes, which is bad as that usually leads to
  # larger files after gzipping).
  gzip_min_length    256;

  # Compress data even for clients that are connecting to us via proxies,
  # identified by the "Via" header (required for CloudFront).
  gzip_proxied       any;

  # Tell proxies to cache both the gzipped and regular version of a resource
  # whenever the client's Accept-Encoding capabilities header varies;
  # Avoids the issue where a non-gzip capable client (which is extremely rare
  # today) would display gibberish if their proxy gave them the gzipped version.
  gzip_vary          on;

  # Compress all output labeled with one of the following MIME-types.
  gzip_types
    application/atom+xml
    application/javascript
    application/json
    application/rss+xml
    application/vnd.ms-fontobject
    application/x-font-ttf
    application/x-web-app-manifest+json
    application/xhtml+xml
    application/xml
    font/opentype
    image/svg+xml
    image/x-icon
    text/css
    text/plain
    text/x-component;
  # text/html is always compressed by HttpGzipModule</code></pre>
<h2>4. Restart Nginx</h2>
<p>You can use the Forge <code>nginx restart</code> dropdown, but since you're SSH'ed in you can also just run <code>sudo service nginx restart</code>.</p>
<h2>5. Test</h2>
<p><strike>Type any URL into <a href="http://checkgzipcompression.com">CheckGzipCompression.com</a>. You can test both html pages (e.g. <code>https://karaniapp.com/</code>) or individual assets like your JavaScript and CSS.</strike></p>
<p>CheckGzipCompression.com seems to be inconsistent. Directions coming soon on how to do it yourself, and Chris Fidao suggests <a href="https://redbot.org"><a href="https://redbot.org">https://redbot.org</a></a>.</p>
<h2>5. Profit</h2>
<p>That's it--you're now Gzip-compressing all of your basic text-based assets and few other freebies image types as well. Go forth and wow Google.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-envoyer.io</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-envoyer.io"/>
        <title>Introducing Envoyer.io</title>
        <published>2015-03-16T00:00:00+00:00</published>
        <updated>2015-03-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Envoyer is a new product from Taylor Otwell of Lar...</summary>
        <content type="html"><![CDATA[
        <p>Envoyer is a new product from Taylor Otwell of Laravel. Check out his <a href="http://laracasts.com/series/envoyer">intro videos</a> at Laracasts, and <a href="https://laravel-news.com/2015/03/envoyer-the-php-deployer-is-now-launched/">interview</a> at Laravel News.</p>
<h2>A little bit of history</h2>
<p>When Taylor Otwell first released <a href="http://forge.laravel.com/">Laravel Forge</a>, the work it took to spin up and manage multiple cloud VPSes and deploy sites to them was a big reason shared hosting had such a huge foothold. Forge took the process of creating a cloud VPS server, managing its environment, and deploying (and auto-Git-hook-deploying) sites to it and made it accessible and affordable.</p>
<p>But more complicated deploy needs--for example, managing complicated deploy scripts, or zero-downtime deploys--weren’t met by Forge. Whether or not you were a Forge user, you’d need to rely on a deploy system like Capistrano or Chef or Ansible to benefit from this level of power and flexibility, and the learning curve for these systems can be prohibitively high.</p>
<h2>Introducing Envoyer</h2>
<p>Today, <a href="http://envoyer.io/">Envoyer</a> is launching to address those needs. Envoyer is a <strong>zero-down-time deployer for PHP &amp; Laravel projects</strong>, which means it is a tool that you connect to your server to run your deploys, and which uses a series of tools to ensure that all of the preparation work each deploy needs in order to run--for example, <code>composer install</code>--happens in the background while the previous version of the site is still online.</p>
<h3>How does Zero-Down-Time Deploy work?</h3>
<p>If you’ve ever worked with Capistrano, you’re already familiar with this. Note that this is a technical answer; if you don’t care how it works, just skip to <a href="#your-first-project-with-envoyer">Your First Project With Envoyer</a>.</p>
<p>A deploy on a traditional system (e.g. Forge) means that there’s a single folder where your content lives. Let’s say you have two files, <code>index.php</code> and the <code>app</code> folder. You’d normally place them in the web root:</p>
<pre><code>/webroot/index.php
/webroot/app</code></pre>
<p>So, your deploy system would <code>cd</code> into that directory, pull down your latest code (<code>git pull</code>), and then run your deploy script, which likely includes <code>composer install</code>. That means that your site is likely non-functional for a few seconds at least.</p>
<p>A zero-down-time deploy system maintains a system of <code>releases</code> folders, each of which represents a single commit in your <code>git</code> history. Every time the deploy system gets triggered for a build, it creates a new folder in <code>releases</code> and clones the repo just at that commit into that folder. Then it runs your full deploy script in there. Only then, once it has a fully functional version of the site ready to go, <em>it changes the </em>current<em> folder to be a symlink to the latest folder under releases</em>. That’s it! The <em>public</em> folder at any time is just a symlink to one of several available folders in <code>releases</code>.</p>
<p>And Envoyer manages all of that for you. You end up with this:</p>
<pre><code>/webroot/current
/webroot/releases
/webroot/releases/20150316074832
/webroot/releases/20150315041251</code></pre>
<p>Note that any folders that need to persist across releases--for example, the <code>storage</code> folder in Laravel apps--need to exist at the webroot level, and need to be symlinked into each release. If you use Laravel, this is already managed for you.</p>
<h2>Your First Project With Envoyer</h2>
<p>OK, so let's get started with your first Envoyer project. Go over to <a href="http://envoyer.io/">Envoyer.io</a>. Sign up. Choose “I want to manage my own projects.”</p>
<p><img src="/assets/images/content/envoyer-screenshot-30.png" alt="" /></p>
<p>Here’s your dashboard:</p>
<p><img src="/assets/images/content/envoyer-screenshot-01.png" alt="" /></p>
<h3>Add your first project</h3>
<p>Your first step is to add your project. Click the big <strong>Add Project</strong> button at the top right.</p>
<p><img src="/assets/images/content/envoyer-screenshot-02.png" alt="" /></p>
<p>You’ll be prompted to choose which type of project it is, who your Git provider is, and which particular project it is.</p>
<h3>View your project dashboard</h3>
<p>Once you start your first project, you can click into the project’s dashboard.</p>
<p><img src="/assets/images/content/envoyer-screenshot-03.png" alt="" /></p>
<h3>Add your first server</h3>
<p>Click the <strong>Servers</strong> tab on this dashboard and add a new server. </p>
<p><img src="/assets/images/content/envoyer-screenshot-04.png" alt="" /></p>
<p>In order to add a new server, you’ll need to know its IP address, which Unix/SSH user you’re going to be connecting as, and what your project path is (likely something like <code>/home/username/website.com</code> or <code>/var/www/website.com</code>).</p>
<p>Once you add the server, Envoyer will give you an SSH key to add to that server so that Forge can authenticate.</p>
<p><img src="/assets/images/content/envoyer-screenshot-05.png" alt="" /></p>
<p>Copy that key and add it to <code>~/.ssh/authorized_keys</code> on your server, or if you’re using Forge, add it to the <strong>SSH Keys</strong> tab for that server.</p>
<p>Now, go back to Envoyer and check your connection status by clicking the refresh icon next to your server in the <strong>Connection Status</strong> column.</p>
<p><img src="/assets/images/content/envoyer-screenshot-06.png" alt="" /></p>
<p>If everything works, the icon will turn green and show the word “Successful.”</p>
<h3>Prepend <code>current/</code> to your server’s served/public directory for this site</h3>
<p>Now, whatever your web root was previously for your web site (in your Nginx/Apache config), you need to prepend <code>current/</code> to it. If you’re a Forge &amp; Laravel user, you’re used to setting the Web Directory in Forge to <code>public</code>. Now, that’ll be <code>current/public</code>.</p>
<p><img src="/assets/images/content/envoyer-screenshot-07.png" alt="" /></p>
<h3>Trigger a deploy</h3>
<p>Go back to your project dashboard and click the red <strong>Deploy</strong> button to trigger a new deploy. Go to the <code>deployments</code> tab and watch the deploy pop up.</p>
<p><img src="/assets/images/content/envoyer-screenshot-08.png" alt="" /></p>
<p>Click on the arrow button on the deployment and you’ll be able to see each of the steps of your deploy script (at this point, it’s the default deploy script for whichever project type you selected):</p>
<p><img src="/assets/images/content/envoyer-screenshot-09.png" alt="" /></p>
<p>Note that you can also drill down and view the specific terminal output once any of the steps of the deploy script is done:</p>
<p><img src="/assets/images/content/envoyer-screenshot-10.png" alt="" /></p>
<h3>And Done!</h3>
<p>That’s it for your first project! You now have a project up and running on Envoyer. One note: if you want it to automatically deploy your code every time you add a new commit to your Git branch, go to <strong>Project Settings / Source Control</strong> and check the box labeled <em>“Deploy When Code Is Pushed”</em>:</p>
<p><img src="/assets/images/content/envoyer-screenshot-11.png" alt="" /></p>
<h2>Customizing your deployment hooks</h2>
<p>Envoyer has 4 steps in its deploy process, and you can run custom scripts <em>before</em> or <em>after</em> each of these steps. The steps are <strong>Clone New Release</strong>, <strong>Install Composer Dependencies</strong>, <strong>Activate New Release</strong>, and <strong>Purge Old Releases</strong>.</p>
<p><img src="/assets/images/content/envoyer-screenshot-16.png" alt="" /></p>
<p>You can click the gear button next to any of the steps, and you’ll see this screen:</p>
<p><img src="/assets/images/content/envoyer-screenshot-17.png" alt="" /></p>
<p>This will allow you to add hooks <em>before</em> or <em>after</em> this step. Click the <strong>Add Hook</strong> button on either side.</p>
<p><img src="/assets/images/content/envoyer-screenshot-18.png" alt="" /></p>
<p>As you can see, each hook can customize its name, which user it runs as, and the body of the hook, which has access to the <code>{{release}}</code> variable which represents the folder path for the latest release folder--e.g. <code>/home/my-user/website.com/releases/20150316083301</code>.</p>
<p>Note that you can also click and drag any of hooks in each section to re-order them:</p>
<p><img src="/assets/images/content/envoyer-screenshot-19.png" alt="" /></p>
<h2>Rollbacks</h2>
<p>So, what if you push out a new deploy and you realize it broke everything? Normally you’d ssh into your server, <code>git log</code>, find a commit point, copy the hash, <code>git checkout THAT_HASH</code>, <code>composer install</code>, and then maybe stop to see if your heart was still beating.</p>
<p>With Envoyer, your previous release is still a fully functional folder in the <code>releases</code> directory. Just go to your project dashboard, find the latest functional deploy, and click the cloud “Redeploy” button. It’ll take the <code>releases</code> folder for that deploy and symlink the <code>current</code> directory to it. That’s it.</p>
<p><img src="/assets/images/content/envoyer-screenshot-12.png" alt="" /></p>
<h2>Health</h2>
<p>You may have noticed the <strong>Post-Deployment Health</strong> section of the Envoyer project dashboard. There’s an icon for New York, London, and Singapore, the three regions that Envoyer checks your site’s health from. Until you set up a Health Check URL, though, these icons will just be question marks.</p>
<p><img src="/assets/images/content/envoyer-screenshot-13.png" alt="" /></p>
<p>Each project can have a <strong>Health Check URL</strong>, which Envoyer will call after every deploy. You can edit that in the Project Settings.</p>
<p><img src="/assets/images/content/envoyer-screenshot-99.png" alt="" /></p>
<p>After every deploy, Envoyer looks at the HTTP response from that URL and makes sure that it’s <code>200</code> (the HTTP Status code for “OK”), and if so, it assumes your site is healthy. You could make this the home page of your site, <em>or</em> a special test URL that you handle in a way that best indicates the health of your site--whatever works best for you.</p>
<p>If everything’s healthy, you get all green checks:</p>
<p><img src="/assets/images/content/envoyer-screenshot-14.png" alt="" /></p>
<p>And if anything breaks, you’ll get red x’es (and you’ll probably want to read the <strong>Rollbacks</strong> section above):</p>
<p><img src="/assets/images/content/envoyer-screenshot-15.png" alt="" /></p>
<h2>Deploying to multiple servers</h2>
<p>If you want to deploy to multiple servers, just add a second server to your project and it’ll automatically be pulled into the deploy process.</p>
<h3>Stages of deploy</h3>
<p>Note, however, when the deploy process runs, it waits for each step to finish <em>on each server</em> before the rest proceed, ensuring all of your servers stay in perfect sync.</p>
<p><img src="/assets/images/content/envoyer-screenshot-21.png" alt="" /></p>
<h3>Environment configuration syncing</h3>
<p>If you have local configuration files that you want to sync across your deploys and servers (<code>.env</code> if you’re using <code>phpdotenv</code> or Laravel 5, <code>.env.php</code> if you’re using Laravel 4), click the <strong>Manage Environment</strong> button in your project dashboard.</p>
<p>Note that this configuration file is hashed with a password that is never stored by Envoyer, so make sure not to lose your “Environment Key” (i.e. this password). </p>
<p><img src="/assets/images/content/envoyer-screenshot-28.png" alt="" /></p>
<p>Once you enter your password, you’re presented with a text box that’s basically a code editor. Paste whatever you want in this file and it’ll be saved--if you chose <strong>Laravel 5</strong> or <strong>Other</strong> as your project type, this file will be <code>.env</code>, and if you chose <code>Laravel 4</code> the file will be <code>.env.php</code>.</p>
<p><img src="/assets/images/content/envoyer-screenshot-29.png" alt="" /></p>
<p>Now choose the servers you want to save it to and save.</p>
<p>Envoyer will manage saving this file to your web root and symlinking it into each release directory.</p>
<h2>Notifications</h2>
<p>If you visit the notifications tab for your project, you can set Envoyer up to notify you upon any major events. Right now Envoyer can notify you in either a Hipchat or a Slack chatroom.</p>
<p><img src="/assets/images/content/envoyer-screenshot-22.png" alt="" /></p>
<p><img src="/assets/images/content/envoyer-screenshot-23.png" alt="" /></p>
<h2>Heartbeats</h2>
<p>One of the biggest difficulties I’ve had in managing servers’ health is ensuring that their cron jobs are always running. Envoyer’s Heartbeats allow you to set the <em>expectation</em> that a certain URL will be pinged at a certain frequency, which means you can have your cron job ping that URL at the end of each run. If Envoyer misses a ping, it’ll notify you.</p>
<p>To add a Heartbeat, go to the Heartbeats tab for your project. Click the *<em>Add Heartbeat</em> button.</p>
<p><img src="/assets/images/content/envoyer-screenshot-24.png" alt="" /></p>
<p>You can give it a label and then define the frequency with which you expect it to run.</p>
<p><img src="/assets/images/content/envoyer-screenshot-25.png" alt="" /></p>
<p>Once you add it, it’ll start as Healthy. Until the period of time you chose has elapsed, it’ll stay Healthy. So if you chose “10 minutes”, it’ll stay Healthy for 10 minutes after you create it.</p>
<h3>Pinging a heartbeat</h3>
<p>Each Heartbeat has a unique URL, which you can get from its listing on the Heartbeats tab. It’ll be something like this: <code>https://beats.envoyer.io/heartbeat/203849102395790125</code></p>
<p>A regular cron file can just do this to ping the Heartbeat:</p>
<pre><code class="language-bash">php yourfile.php &amp;&amp; curl https://beats.envoyer.io/heartbeat/203849102395790125</code></pre>
<p>If you use Laravel, the latest versions of Laravel have added a <code>thenPing()</code> method to the scheduler that allows you to ping any URL after the cron job has run. This is perfect for Heartbeats:</p>
<p><img src="/assets/images/content/envoyer-screenshot-26.png" alt="" /></p>
<p>And here’s the notification you’ll get if your Heartbeat is missed:</p>
<p><img src="/assets/images/content/envoyer-screenshot-27.png" alt="" /></p>
<h2>Collaborators</h2>
<p>Envoyer allows for an unlimited number of people to access your servers. If someone on your team wants to collaborate but not set up their own Envoyer account, just have them sign up and choose “I’m just collaborating with others.”</p>
<p><img src="/assets/images/content/envoyer-screenshot-31.png" alt="" /></p>
<p>Envoyer has a Collaborators tab on each project that allows you to give other people access to your project by inviting them via email.</p>
<p><img src="/assets/images/content/envoyer-screenshot-32.png" alt="" /></p>
<p>Note that collaborators have access to everything in the project <em>except</em> “Delete project.”</p>
<h2>FAQ</h2>
<ul>
<li><strong>Does Envoyer replace Forge?</strong>
Nope. Envoyer doesn’t manage your servers. It can be used with any VPS, regardless of what service is managing it. However, it makes a great companion to Forge.</li>
<li><strong>How does Envoyer authenticate with my server?</strong> Once you add a new server, Envoyer will give you an SSH key to add to that server so that Forge can authenticate.</li>
<li><strong>Can I use Envoyer with a non-Laravel project?</strong> Absolutely, although some of the automatic conveniences of Envoyer won’t work for you--for example, the automatic linkage of the <code>storage</code> directory. But all of that is customizable.</li>
<li><strong>If I’m using Forge, should I connect the site to my Git repo in Forge?</strong> Nope. Just spin up the site, and leave it disconnected from any repository. Envoyer will handle all of that.</li>
<li><strong>What happens if there’s an error during one of the steps of my deploy process?</strong> Envoyer will notice it, and notify you. It’ll also cancel the deploy. <img src="/assets/images/content/envoyer-screenshot-20.png" alt="" /></li>
</ul>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/conditionally-loading-service-providers-in-laravel-5</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/conditionally-loading-service-providers-in-laravel-5"/>
        <title>Conditionally Loading Service Providers in Laravel 5</title>
        <published>2015-03-09T00:00:00+00:00</published>
        <updated>2015-03-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Since Laravel 5 flattened a lot of the environment...</summary>
        <content type="html"><![CDATA[
        <p>Since Laravel 5 flattened a lot of the environment-specific structures, much of the configuration that was once stored in different config directories for each environment has now moved into <code>.env</code> files.</p>
<p>But one that can't just live in <code>.env</code> is the environment-dependent loading of service providers.</p>
<p>On a project we're working on, we want to register our error handlers in service providers, and we want to register a different error handler depending on the environment. We have two: <code>ProductionErrorHandler</code> and <code>VerboseErrorHandler</code>, the second of which is for development environments.</p>
<h2>Loading service providers normally</h2>
<p>In case you're not familiar, defining normal (non-environment-specific) Service Providers happens in <code>/config/app.php</code>. There's a <code>providers</code> array there that looks a bit like this:</p>
<pre><code>    'providers' =&gt; [

        /*
         * Laravel Framework Service Providers...
         */
        'Illuminate\Foundation\Providers\ArtisanServiceProvider',
        'Illuminate\Auth\AuthServiceProvider',
        'Illuminate\Bus\BusServiceProvider',
        ...
    ]</code></pre>
<p>So, if your service provider should be loaded <em>in every environment</em>, just toss it into that array and you're good to go.</p>
<h2>Loading service providers conditionally</h2>
<p>However, if you want to make it conditional, you'll need to head over to <code>/app/Providers/AppServiceProvider.php</code>. This file is the general place you're going to want to be booting and registering anything that's not handled in another service provider, so this is a place you can go to conditionally register your service providers.</p>
<p>Here's what it looks like right now:</p>
<pre><code class="language-php">&lt;?php namespace app\Providers;

use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot()
    {
        //
    }

    /**
     * Register any application services.
     *
     * This service provider is a great spot to register your various container
     * bindings with the application. As you can see, we are registering our
     * "Registrar" implementation here. You can add your own bindings too!
     *
     * @return void
     */
    public function register()
    {
        $this-&gt;app-&gt;bind(
            'Illuminate\Contracts\Auth\Registrar',
            'App\Services\Registrar'
        );
    }
}</code></pre>
<p>So, let's do our switch. </p>
<pre><code class="language-php">    // AppServiceProvider.php

    public function register()
    {
        $this-&gt;app-&gt;bind(
            'Illuminate\Contracts\Auth\Registrar',
            'App\Services\Registrar'
        );

        if ($this-&gt;app-&gt;environment('production')) {
            $this-&gt;app-&gt;register('App\Providers\ProductionErrorHandlerServiceProvider');
        } else {
            $this-&gt;app-&gt;register('App\Providers\VerboseErrorHandlerServiceProvider');
        }
    }</code></pre>
<p><code>$this-&gt;app-&gt;register()</code> will set up the service provider just like adding it to <code>config/app.php</code> will, so its <code>register()</code> and <code>boot()</code> methods will get called at the appropriate times.</p>
<p>You could also use <code>switch</code> instead of <code>if</code>, or you could do your work based on other environment variables, or whatever else--but this is your current best bet to conditionally load service providers. Hope this helps!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/convert-laravel-5-frontend-scaffold-to-bower</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/convert-laravel-5-frontend-scaffold-to-bower"/>
        <title>Convert Laravel 5&#039;s Frontend Scaffold to Bower</title>
        <published>2015-03-04T00:00:00+00:00</published>
        <updated>2015-03-04T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel 5 comes with some base templates, which im...</summary>
        <content type="html"><![CDATA[
        <p>Laravel 5 comes with some base templates, which import Bootstrap.js and jQuery, and a base stylesheet which imports LESS Bootstrap. If you don't like it you can instantly remove it with <code>php artisan fresh</code>, but for a lot of quick-start, rapid development use cases, I've absolutely loved it.</p>
<p>However, what if you prefer managing your frontend dependencies with Bower? It's actually very simple to keep Laravel 5's default setup and just tweak it a bit to rely on Bower. Check it out:</p>
<h2>1. Add <code>bower.json</code></h2>
<p>You need a <code>bower.json</code> file to get started. Create a file in the root of your directory with the following content:</p>
<pre><code class="language-json">{
  "name": "your-project"
}</code></pre>
<h2>2. Add <code>.bowerrc</code></h2>
<p>By default Bower installs into <code>/bower_components</code>, but we want our bower dependencies in our <code>resources/assets</code> folder. Create a <code>.bowerrc</code> file in your project root that contains the following:</p>
<pre><code class="language-json">{
  "directory": "resources/assets/bower"
}</code></pre>
<h2>3. Install dependencies</h2>
<p>Now, assuming you have bower installed (if not, <code>$ npm install -g bower</code>), you can run the following commands to add jQuery and Bootstrap to your <code>bower.json</code>, and install them:</p>
<pre><code class="language-bash">$ bower install jquery —save
$ bower install bootstrap —save</code></pre>
<h2>4. Update LESS import</h2>
<p>Now, we need to update our scripts to pull in the new dependencies. In <code>resources/less/app.less</code>, change this:</p>
<pre><code class="language-less">@import "bootstrap/bootstrap";</code></pre>
<p>to this:</p>
<pre><code class="language-less">@import "../bower/bootstrap/less/bootstrap";</code></pre>
<h2>5. Bring in scripts</h2>
<p>In <code>gulpfile.js</code> add these lines (within the main <code>elixir()</code> block):</p>
<pre><code class="language-javascript">mix.scripts([
    '../assets/bower/jquery/dist/jquery.js',
    '../assets/bower/bootstrap/dist/js/bootstrap.js'
], 'public/js/vendor.js');</code></pre>
<h2>6. Change the template references</h2>
<p>In <code>resources/views/app.blade.php</code>, replace these lines:</p>
<pre><code class="language-html">&lt;script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.1/js/bootstrap.min.js"&gt;&lt;/script&gt;</code></pre>
<p>With this:</p>
<pre><code class="language-html">&lt;script src="{{ asset('/js/vendor.js') }}"&gt;&lt;/script&gt;</code></pre>
<h2>7. Clean up</h2>
<p>Delete the <code>resources/assets/less/bootstrap</code> folder.</p>
<h2>8. Run <code>gulp</code></h2>
<p>Now, just run <code>gulp</code> from the command line. It'll combine the vendor dependencies into <code>public/js/vendor.js</code>, it'll bring in the new versions of the bootstrap LESS into your stylesheet, and you're now ready to go.</p>
<h2>That's it!</h2>
<p>You're ready! Your site should <em>look</em> exactly the same, but it's now backed by the power of Bower. (ba dum ching)</p>
<p>If you ever want to add new dependencies, you can just user bower and add javascript files to your <code>gulpfile.js</code> <code>mix.scripts</code> array, and add LESS or CSS to your <code>app.less</code> imports. Done!</p>
<h2>Postscript</h2>
<p>What if you want to import a theme from Bootstrap? Turns out that's wildly easy. Bring in your <code>variables.less</code> from the theme, and just load it in <code>app.less</code> <em>after</em> you import the Bower Bootstrap. It turns out <a href="http://www.milesrausch.com/2012/11/06/mixin-and-variable-cascading-in-less/">LESS variables are overwritten if new versions of them are imported later</a> (HT <a href="https://twitter.com/marcorivm/status/573262845929902080">@marcorivm</a>), so you just do this in <code>app.less</code>:</p>
<pre><code class="language-less">@import "../bower/bootstrap/less/bootstrap";
@import "../bootswatch/variables";
@import "../bootswatch/bootswatch";</code></pre>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/export-an-eloquent-collection-to-a-csv-with-league-csv</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/export-an-eloquent-collection-to-a-csv-with-league-csv"/>
        <title>Export an Eloquent Collection to a CSV with League CSV</title>
        <published>2015-03-02T00:00:00+00:00</published>
        <updated>2015-03-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">League/CSV is a wonderfully simple wrapper around ...</summary>
        <content type="html"><![CDATA[
        <p><a href="http://csv.thephpleague.com/">League/CSV</a> is a wonderfully simple wrapper around PHP's native CSV support, and it's simple to dump your Laravel Eloquent collection results out to CSV.</p>
<p>There's a ton more you can do with CSV, so go check out the docs, but here's a simple recipe to get started:</p>
<h2>1. Install CSV</h2>
<pre><code class="language-bash">$ composer require league/csv</code></pre>
<h2>2. Prep the data</h2>
<p>Let's say you're in an <code>export</code> method in your controller.</p>
<pre><code class="language-php">    public function export()
    {
        $people = Person::all();
    }</code></pre>
<h2>3. Create the CSV file in memory</h2>
<pre><code class="language-php">$csv = \League\Csv\Writer::createFromFileObject(new \SplTempFileObject());</code></pre>
<h2>4. Create your headers</h2>
<p>You can manually pass an array of your headers, but this is the quick (and <em>very</em> dirty way) you can get it up and running in a prototype:</p>
<pre><code class="language-php">$csv-&gt;insertOne(\Schema::getColumnListing('people'));</code></pre>
<p>You just inserted a row (<code>insertOne()</code>) filled with an array of the column names from your <code>people</code> table.</p>
<h2>5. Insert your rows</h2>
<pre><code class="language-php">foreach ($people as $person) {
    $csv-&gt;insertOne($person-&gt;toArray());
}</code></pre>
<h2>6. Output it to the user</h2>
<pre><code class="language-php">$csv-&gt;output('people.csv');</code></pre>
<h2>Conclusion</h2>
<p>That's it! You're now dumping an entire Eloquent collection result straight to CSV. Let's check it out:</p>
<pre><code class="language-php">    public function export()
    {
        $people = Person::all();

        $csv = \League\Csv\Writer::createFromFileObject(new \SplTempFileObject());

        $csv-&gt;insertOne(\Schema::getColumnListing('people'));

        foreach ($people as $person) {
            $csv-&gt;insertOne($person-&gt;toArray());
        }

        $csv-&gt;output('people.csv');
    }</code></pre>
<p>If someone visits that route, they'll get <code>people.csv</code> downloaded straight into their browser. Done.</p>
<p>Again, check the <a href="http://csv.thephpleague.com/">docs</a> to learn more about it. I hope this helps!</p>
<h2>Postscript</h2>
<p>I intentionally used <code>foreach</code> in the example to show that you could also do this with any other source of data. But if you are really only using it for Laravel Collections, you could also use <code>Collection-&gt;each()</code>:</p>
<pre><code class="language-php">    public function export()
    {
        $csv = \League\Csv\Writer::createFromFileObject(new \SplTempFileObject());

        $csv-&gt;insertOne(\Schema::getColumnListing('people'));

        Person::all()-&gt;each(function($person) use($csv) {
            $csv-&gt;insertOne($person-&gt;toArray());
        });

        $csv-&gt;output('people.csv');
    }</code></pre>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/rapid-application-development-from-idea-to-prototype-in-145-with-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/rapid-application-development-from-idea-to-prototype-in-145-with-laravel"/>
        <title>Rapid Application Development - From Idea to Prototype in 1:45 with Laravel</title>
        <published>2015-02-19T00:00:00+00:00</published>
        <updated>2015-02-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I didn&#039;t even think to put this up on the blog, bu...</summary>
        <content type="html"><![CDATA[
        <p>I didn't even think to put this up on the blog, but I recorded a video of me developing <a href="http://gistlog.co/">Gistlog.co</a> from nothing to live prototype and put it up, almost entirely unedited, up on YouTube. Check it out:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/g4BbeHYCR1E?rel=0" frameborder="0" allowfullscreen></iframe>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-eloquent-attribute-casting</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-5.0-eloquent-attribute-casting"/>
        <title>Laravel 5.0 - Eloquent Attribute Casting</title>
        <published>2015-02-14T00:00:00+00:00</published>
        <updated>2015-02-14T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I had completely forgotten to finish my Laravel 5....</summary>
        <content type="html"><![CDATA[
        <p>I had completely forgotten to finish my Laravel 5.0 blog posts, but I saw a great quick introduction to attribute casting at <a href="http://jenssegers.be/blog/62/laravel-5-eloquent-attribute-casting-is-awesome">Laravel 5 Eloquent Attribute Casting is Awesome</a>, so I figured I would add it to my feature list. Check out the <a href="http://laravel.com/docs/master/eloquent#attribute-casting">official Eloquent docs here</a>.</p>
<h2>What is attribute casting?</h2>
<p>Casting a value means changing it to (or ensuring it is already) a particular <em>type.</em> Some types you might be familiar with are <code>integer</code> or <code>boolean</code>.</p>
<p>Attribute casting is a feature of Eloquent models that allows you to set your model to automatically <em>cast</em> a particular attribute on your Eloquent model to a certain <em>type</em>.</p>
<blockquote>
<p>Note: You could do this in the past, but you would have to automatically define a mutator for each attribute; now you can do it automatically with a single configuration array.</p>
</blockquote>
<p>That means if you store your data in a particular format in the database, and you want it to return in a different format, you can now cast it to the new format.</p>
<h2>But why?</h2>
<p>The most common uses for this will be when you store numbers—they’re returned as strings by default, but Eloquent attribute casting allows you to cast them as <code>integer</code>, <code>real</code>, <code>float</code>, or <code>double</code>—or booleans—you can convert <code>0</code> and <code>1</code> in your database to <code>true</code> and <code>false</code>.</p>
<p>But that’s not all.</p>
<h2>How does it work?</h2>
<p>You cast attributes in Eloquent by adding a <code>protected $casts</code> array to your model.</p>
<pre><code class="language-php">/**
 * The attributes that should be casted to native types.
 *
 * @var array
 */
protected $casts = [
    'is_admin' =&gt; 'boolean',
];</code></pre>
<p>As you can see, each entry in the array has the property slug as the key, and the cast type as the value. This <code>$casts</code> array is telling Eloquent: “Every time I access a property on this model named <code>is_admin</code>, please return it cast to type <code>boolean</code>.</p>
<h2>The cast types</h2>
<h3><code>integer</code> (or <code>int</code>)</h3>
<p>This casts your field to an integer using <code>return (int) $value</code>.</p>
<h3><code>float</code> (or <code>real</code> or <code>double</code>)</h3>
<p>Real, Float, and Double are the same thing in PHP. PHP’s <code>(double)</code> and <code>(real)</code> type casting are just aliases to <code>(float)</code>; and if you check out the source, Eloquent is literally running <code>return (float) $value</code> for all three of these keys.</p>
<h3><code>string</code></h3>
<p>This casts your field to a string using <code>return (string) $value</code>.</p>
<h3><code>boolean</code> (or <code>bool</code>)</h3>
<p>This casts your field to a boolean using <code>return (bool) $value</code>, which means you’ll likely be storing your values as <code>0</code> and <code>1</code>.</p>
<h3><code>object</code></h3>
<p>Object and Array are the most interesting option. Both convert (deserialize) JSON-serialized arrays into PHP. Object uses <code>return json_decode($value)</code>, returning a stdClass object.</p>
<h3><code>array</code></h3>
<p>Array deserializes JSON-serialized arrays into PHP arrays, using <code>return json_decode($value, true)</code>, returning an array.</p>
<p>You can view the actual code for these <a href="https://github.com/illuminate/database/blob/32fee7419ddbaa0bcfcfb829872c1a0bb4b8ead8/Eloquent/Model.php#L2721">in the source</a>.</p>
<h2>Conclude</h2>
<p>As you can see, Eloquent attribute casting has a ton of potential to free us up from unnecessary repetitive logic, and also sneakily makes it a lot easier to store data in JSON in our  database. Good Stuff!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/how-to-organize-class-namespaces</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/how-to-organize-class-namespaces"/>
        <title>How to Organize Class Namespaces</title>
        <published>2015-02-11T00:00:00+00:00</published>
        <updated>2015-02-11T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In A Brief Introduction to PHP Namespacing, I gave...</summary>
        <content type="html"><![CDATA[
        <p>In <a href="/blog/a-brief-introduction-to-php-namespacing">A Brief Introduction to PHP Namespacing</a>, I gave a quick introduction both to namespaces and to how PHP handles them.</p>
<p>But there are some higher-level architectural concerns regarding namespaces that a lot of folks have brought up to me recently, so I figured I'd get a little bit out on &quot;paper&quot;.</p>
<p>I've seen a few primary ways of organizing namespaces. I'll discuss the pros and cons of each.</p>
<h3>Notes Before We Begin</h3>
<ul>
<li>This is not an instructional post, because there may not be one method that is optimal for every situation. It's merely a discussion of a few options, and it's primarily targeted at simple namespace organization in a small-to-medium-sized app--not the enterprise, and not necessarily those with intricate architectural concerns.</li>
<li>&quot;Small&quot; and &quot;Medium&quot; and &quot;Large&quot; here purely relate to the number of classes &amp; entities, and have nothing to do with Lines of Code, the number of users of the site, or anything else.</li>
<li>We'll be using the example of a <code>Command</code> that sends a <code>Receipt</code> to a <code>User</code>.</li>
<li>Our global namespace right now will be <code>App</code> just for brevity, but you can replace that with <code>Vendor\Package</code>.</li>
</ul>
<h2>What's the purpose of namespaces?</h2>
<p>Before we even get to talking about the specific <em>ways</em> we can namespace, let's talk about <em>why</em> we're doing it. I'm indebted to [Shawn McCool]() (as always) for helping connect some of my vague thoughts here to actual computer science concepts.</p>
<p>As Shawn pointed out to me, the purpose of namespacing is <em>cohesion</em>: describing how connected some code is to other code. He pointed out that in other languages, namespaces are called &quot;Packages&quot; or &quot;Modules&quot;--and once you realize this, you understand that we're seeing sub-namespaces as little individual modules that should rely on other modules as little as possible (<a href="http://en.wikipedia.org/wiki/Encapsulation_%28object-oriented_programming%29">encapsulation</a>). If modularity is one of the primary end goals of our namespacing, then that becomes one (of several) metrics we can use to judge a particular style of namespacing.</p>
<p>Of course, even this statement--that modularity is a primary end goal of namespacing--is under debate. But when I hear it, I like it.</p>
<h2>Namespacing Approaches</h2>
<p>OK, let's get down to it.</p>
<ul>
<li><a href="#global-namespacing">Global namespacing</a></li>
<li><a href="#group-by-pattern">Group by pattern</a></li>
<li><a href="#group-by-context">Group by context</a></li>
<li><a href="#group-by-context-and-pattern">Group by context and pattern</a></li>
</ul>
<h2>Global namespacing</h2>
<pre><code class="language-php">&lt;?php namespace App;

class SendReceipt {}</code></pre>
<pre><code>src
    Receipt
    ReceiptRepository
    SendReceipt
    SendReceiptHandler
    User
    UserRepository
    CreateUser
    CreateUserHandler</code></pre>
<h3>Pros</h3>
<p>I guess it's simpler to not have to deal with sub-namespaces? On a <em>very small</em> app, this might be fine. If you have five classes, who's saying you need to sub-namespace them at all? If this is a single package with a single purpose, or an application that has a single &quot;module&quot;, it may not need anything other than a single global namespace.</p>
<h3>Cons</h3>
<p>The moment you get an application of any complexity, it's going to be hard to find your classes in the huge mush of your global namespace. If you have any separation of identity or purpose among your types of classes--for example, Users vs. Receipts--this global namespacing throws them together in a big pot. Not modular at all.</p>
<h2>Group by pattern</h2>
<pre><code class="language-php">&lt;?php namespace App\Commands;

class SendReceipt {}</code></pre>
<pre><code>src
    Commands
        SendReceipt
        CreateUser
    Entities
        Receipt
        User
    Handlers
        SendReceiptHandler
        CreateUserHandler
    Repositories
        ReceiptRepository
        UserRepository</code></pre>
<h3>Pros</h3>
<p>When you want to hunt down a command, you know exactly where it lives. If your brain says &quot;I need to edit one of my commands. Which one? The one that sends receipts&quot;, this is a good fit. This is one level more organized than ignoring namespaces, but not so deep that you'll be annoyed using it in a medium-sized site.</p>
<p>Additionally, your related classes (e.g. commands) can live next to each other; you can see any parallels there may be between <code>SendReceipt</code> and <code>SendReminder</code>, for example, and see how they all connect to each other.</p>
<p>This method also allows you to architect relationships between class types programatically. For example, a Command Bus might know that the Handler for a Command (which lives at <code>App\Commands\{commandName}</code>) always lives at <code>App\Handlers\{commandName}Handler</code>.</p>
<h3>Cons</h3>
<p>Doing it this way leaves you with classes in the same <em>context</em> spread across many different namespaces. For example, you might have <code>App\Commands\SendReceipt</code>, <code>App\Receipt</code> or <code>App\Entities\Receipt</code>, <code>App\Providers\ReceiptServiceProvider</code>, <code>App\Handlers\Commands\SendReceiptHandler</code>, <code>App\Repositories\ReceiptRepository</code>, and on and on. All of your Receipt logic, sprinkled all over the place.</p>
<p>If we're focusing on encapsulation and modularity, this grouping is not winning. Because we've spread all of the code about billing, for example, across our entire namespace landscape, the class organization isn't focusing on creating a billing module. Classes are next to each other purely because they happen to follow the same architectural pattern, not because they're actually related.</p>
<h2>Group by context</h2>
<pre><code class="language-php">&lt;?php namespace App\Billing;

class SendReceipt {}</code></pre>
<pre><code>src
    Billing
        Receipt
        ReceiptRepository
        SendReceipt
        SendReceiptHandler
    User
        User
        UserRepository
        CreateUser
        CreateUserHandler</code></pre>
<h3>Pros</h3>
<p>If you're purely working in Billing right now, you know you'll have <em>everything</em> billing-related together in one spot. For your receipts, the entity, the command, the command handler, the repository, and so on--all together in one nice, neat bundle, easy to address as a single group.</p>
<p>This is where we start experiencing encapsulation and modularity. All of our Billing-related classes, regardless of their design pattern, are together in one place--which helps us group them mentally, even starting to think of them as a unit which may be able to live external to this application.</p>
<h3>Cons</h3>
<p>Your commands are now sprinkled across the code base. Your repositories, too. And your entities. And your command handlers.</p>
<h2>Group by context and pattern</h2>
<pre><code class="language-php">&lt;?php namespace App\Billing\Commands;

class SendReceipt {}</code></pre>
<pre><code>src
    Billing
        Entities
            Receipt
        Repositories
            ReceiptRepository
        Commands
            SendReceipt
        Handlers
            SendReceiptHandler
    User
        Entities
            User
        Repositories
            UserRepository
        Commands
            CreateUser
        Handlers
            CreateUserHandler</code></pre>
<h3>Pros</h3>
<p>Separating it this way gives you the greatest level of namespace separation--that alone is a pro for some people. This is especially useful if you have a large codebase with a lot of classes--the more classes, the more you'll appreciate additional options for separation. Imagine adding an <code>UpdateUser</code> command, a <code>DeleteUser</code> command, a <code>Subscription</code> entity and repository and associated handlers...</p>
<p>Just like <a href="#group-by-pattern">Group by pattern</a>, you can programatically relate classes.</p>
<p>And while your classes are separated by pattern, they're still grouped by the context, so you still do have all of your <code>Receipt</code> code together in one place. We still get the benefit of modularity that we did in <a href="#group-by-context">Group by context</a>.</p>
<h3>Cons</h3>
<p>The longer the namespace definition is for your class, the more mental energy has to be spent understanding the entire namespace stack. There's more opportunity for typos and confusion. And with a small or medium-sized application, this may seem overkill.</p>
<p>Since you're grouping your classes by pattern at the lowest level, you don't get as much of the grouped-by-context benefit as the <a href="#group-by-context">Group by context</a> style.</p>
<h2>Sample</h2>
<p>OK, so that's a lot of abstract theory about it. But what about a concrete example? I've taken a few classes from <a href="http://savemyproposals.com/">SaveMyProposals</a> as an example. Let's look at how we manage Talks, Conferences, and how we propose talks to conferences:</p>
<p><strong>Global namespacing</strong></p>
<pre><code>app
    Conference
    ConferenceRepository
    CreateConference
    CreateConferenceHandler
    CreateTalk
    CreateTalkHandler
    DeleteConference
    DeleteConferenceHandler
    DeleteTalk
    DeleteTalkHandler
    ProposeTalkToConference
    ProposeTalkToConferenceHandler
    RetractTalkProposal
    RetractTalkProposalHandler
    Talk
    TalkRepository
    UpdateConference
    UpdateConferenceHandler
    UpdateTalk
    UpdateTalkHandler</code></pre>
<p><strong>Group by pattern</strong></p>
<pre><code>app
    Commands
        CreateConference
        CreateTalk
        DeleteConference
        DeleteProposal
        DeleteTalk
        ProposeTalkToConference
        RetractTalkProposal
        UpdateConference
        UpdateTalk
    Entities
        Conference
        Proposal
        Talk
    Handlers
        CreateConferenceHandler
        CreateTalkHandler
        CreateProposalHandler
        DeleteConferenceHandler
        DeleteProposalHandler
        DeleteTalkHandler
        ProposeTalkToConferenceHandler
        RetractTalkProposalHandler
        UpdateConferenceHandler
        UpdateTalkHandler
    Repositories
        ConferenceRepository
        TalkRepository</code></pre>
<p><strong>Group by context</strong></p>
<pre><code>app
    Conferences
        Conference
        ConferenceRepository
        CreateConference
        CreateConferenceHandler
        DeleteConference
        DeleteConferenceHandler
        UpdateConference
        UpdateConferenceHandler
    Talks
        CreateTalk
        CreateTalkHandler
        DeleteTalk
        DeleteTalkHandler
        ProposeTalkToConference
        ProposeTalkToConferenceHandler
        Talk
        TalkRepository
        RetractTalkProposal
        RetractTalkProposalHandler
        UpdateTalk
        UpdateTalkHandler</code></pre>
<p><strong>Group by context and pattern</strong></p>
<pre><code>app
    Conferences
        Commands
            CreateConference
            DeleteConference
            UpdateConference
        Entities
            Conference
        Handlers
            CreateConferenceHandler
            DeleteConferenceHandler
            UpdateConferenceHandler
        Repositories
            ConferenceRepository
    Talks
        Commands
            CreateTalk
            DeleteTalk
            ProposeTalkToConference
            RetractTalkProposal
            UpdateTalk
        Entities
            Talk
        Handlers
            CreateTalkHandler
            DeleteTalkHandler
            ProposeTalkToConferenceHandler
            RetractTalkProposalHandler
            UpdateTalkHandler
        Repositories
            TalkRepository</code></pre>
<h2>Conclusion</h2>
<p>So, what's the answer?</p>
<p><em>It depends.</em></p>
<p>It's <em>possible</em> that the simpler organizational structures work better for applications with less classes &amp; entities, whereas the larger organizational structures match better with the more robust organizational systems. But that's not a hard rule. I'm not even 100% sure it's a rule at all.</p>
<p>I think the modularity &amp; encapsulation ideas are work giving your brain some time with. Think about how you would design it if each sub-namespace were to be removed from the others.</p>
<p>But in the end, I'd say just try them all out. Figure out what you like. Figure out what bugs you. Figure out what benefits you gain from each. You'll figure this out.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/a-brief-introduction-to-php-namespacing</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/a-brief-introduction-to-php-namespacing"/>
        <title>A Brief Introduction to PHP Namespacing</title>
        <published>2015-02-07T00:00:00+00:00</published>
        <updated>2015-02-07T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">A bit of history
            In PHP prior to 5.3 (2009), any c...
        </summary>
        <content type="html"><![CDATA[
        <h2>A bit of history</h2>
<p>In PHP prior to 5.3 (2009), any class you define lived at the same global level as other classes.</p>
<p>Class <code>User</code>, class <code>Contact</code>, class <code>StripeBiller</code>--they're all together in the global namespace.</p>
<p>This may seem simple, but it makes organization tough, which is why PHP developers started using underscores to separate their class names. For example, if I were developing a package called <em>&quot;Cacher&quot;</em>, I might name the class <code>Mattstauffer_Cacher</code> so as to differentiate it from someone else's <code>Cacher</code>--or <code>Mattstauffer_Database_Cacher</code>, to differentiate it from an API cacher.</p>
<p>That worked decently, and there were even autoloading standards that separated out the underscores in class names for folders on the file system; for example, <code>Mattstauffer_Database_Cacher</code> would be assumed to live in the file <code>Mattstauffer/Database/Cacher.php</code>.</p>
<blockquote>
<p>An <strong>autoloader</strong> is a piece of code that makes it so that, instead of having to <code>require</code> or <code>include</code> all of the files that contain your class definitions, PHP knows where to find your class definitions based on a particular convention.</p>
</blockquote>
<p>But it was pretty messy, and often ended up with class names like <code>Zend_Db_Statement_Oracle_Exception</code> and worse. Thankfully, in PHP 5.3, real namespaces were introduced.</p>
<h2>The basics of namespaces</h2>
<p>Namespaces are like a virtual directory structure for your classes.
So <code>class Mattstauffer_Database_Cacher</code> could become <code>class Cacher</code> in the <code>Mattstauffer\Database</code> namespace:</p>
<pre><code class="language-php">&lt;?php

class Mattstauffer_Database_Cacher {}</code></pre>
<p>is now:</p>
<pre><code class="language-php">&lt;?php namespace Mattstauffer\Database;

class Cacher {}</code></pre>
<p>And we would refer to it elsewhere in the app as <code>Mattstauffer\Database\Cacher</code>.</p>
<h2>A real example</h2>
<p>Let's take <a href="https://karaniapp.com/">Karani</a>--it's a CRM with a financial component, so it tracks donors and receipts, among many other things.</p>
<p>Let's set <code>Karani</code> as our top-level namespace (sort of like the parent folder--usually named after your app or package). This might have some classes related to Contacts, and some related to Billing, so we're going to create a sub-namespace for each, <code>Karani\Billing</code> and <code>Karani\Contacts</code>.</p>
<p>Let's make a class or two in each:</p>
<pre><code class="language-php">&lt;?php namespace Karani\Billing;

class Receipt {}</code></pre>
<pre><code class="language-php">&lt;?php namespace Karani\Billing;

class Subscription{}</code></pre>
<pre><code class="language-php">&lt;?php namespace Karani\Contacts;

class Donor {}</code></pre>
<p>So, we're picturing a directory structure like this:</p>
<pre><code>Karani
    Billing
        Receipt
        Subscription
    Contacts
        Donor</code></pre>
<h3>Referencing other classes in the same namespace</h3>
<p>So, if a Subscription can send a Receipt, it's easy to refer to it:</p>
<pre><code class="language-php">&lt;?php namespace Karani\Billing;

class Subscription
{
    public function sendReceipt()
    {
        $receipt = new Receipt;
    }
}</code></pre>
<p>Since <code>Receipt</code> is in the same namespace as <code>Subscription</code>, you can just refer to it like you would if you weren't using namespaces.</p>
<h3>Referencing other classes in different namespaces</h3>
<p>OK, but what if I want to reference a Receipt inside of a Donor?</p>
<pre><code class="language-php">&lt;?php namespace Karani\Contacts;

class Donor
{
    public function sendReceipt()
    {
        // This won't work!
        $receipt = new Receipt;
    }
}</code></pre>
<p>You guessed it: This won't work.</p>
<p>We're in the <code>Karani\Contacts</code> namespace, so when we wrote <code>new Receipt</code>, PHP assumes we're talking about <code>Karani\Contacts\Receipt</code>. But that class doesn't exist, and that's not what we're looking for.</p>
<p>So, you'll get a <code>Class Karani\Contacts\Receipt not found</code> error. </p>
<p>You might be tempted to modify it to instead say <code>$receipt = new Karani\Billing\Receipt</code>--but even that won't work. Since we're in the <code>Karani\Contacts</code> namespace right now, it's seeing <em>anything</em> you write as being relative to the namespace you're in. So that would try to load a class named <code>Karani\Contacts\Karani\Billing\Receipt</code>, which also clearly doesn't exist.</p>
<h2><code>Use</code> blocks and Fully-Qualified Class Names</h2>
<p>Instead, you have two options:</p>
<p><strong>First</strong>, you can precede it with a slash to create its FQCN (Fully Qualified Class Name): <code>$receipt = new \Karani\Billing\Receipt;</code>, which sends the signal to PHP to escape out of the current namespace before looking for this class.</p>
<p>If you precede the <em>full namespace</em> with a slash, creating the FQCN, you can refer to this class <em>anywhere in your app</em> without worrying about your current namespace.</p>
<p>Or, <strong>Second</strong>, you can <code>use</code> the class at the top of the file, and then just reference it as <code>Receipt</code>:</p>
<pre><code class="language-php">&lt;?php namespace Karani\Contacts;

use Karani\Billing\Receipt;

class Donor
{
    public function sendReceipt()
    {
        $receipt = new Receipt;
    }
}</code></pre>
<p>As you can tell, <code>use</code> imports a class from a different namespace into this namespace so we can refer to it more easily. Once you've imported the class, any time you reference <code>Receipt</code> in this class, it'll assume you're pointing to the imported class.</p>
<h2>Aliasing</h2>
<p>But, what if you <em>also</em> have a <code>Receipt</code> class in your <em>current</em> namespace? What if your class needs access to both <code>Karani\Contacts\Receipt</code> <strong>and</strong> <code>Karani\Billing\Receipt</code>?</p>
<p>You can't just import the <code>Karani\Billing\Receipt</code> class, or you won't be able to use both--they'd both have the same name in this class.</p>
<p>Instead, you'll need to alias it. You can change the <code>use</code> statement to something like <code>use Karani\Billing\Receipt as BillingReceipt;</code>. Now you've aliased the class, and then you can refer to the imported class as <code>BillingReceipt</code> throughout your class.</p>
<h2>PSR-0/PSR-4 Autoloading</h2>
<p>You know the folder analogy I just used above?</p>
<p>It's easy to think about your classes that way, but there's actually <strong>not</strong> any inherent connection between your namespaces and your files' structure. Unless you use an autoloader, PHP doesn't have any idea <em>where</em> those classes actually live in your directory structure.</p>
<p>Thankfully, <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md">PSR-0</a> (now deprecated) and <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a> are autoloading standards that actually map your namespaces to real folders. So, if you're using PSR-0 or PSR-4--which is extremely likely if you're using <a href="https://getcomposer.org/">Composer</a> or any modern framework-- and a compatible autoloader, you can assume that the classes actually <em>are</em> in folders.</p>
<h3>Composer and PSR-4 Autoloading</h3>
<p>So, let's say I want the <code>Karani</code> namespace to live in my <code>src</code> folder.</p>
<p>Here's my folder structure for a generic, framework-independent project:</p>
<pre><code>app
public
src
    Billing
    Contacts
vendor</code></pre>
<p>As you can see, the <code>src</code> folder represents the <code>Karani</code> top level namespace. Since I'm using Composer as my autoloader, all I need to do to get my application to autoload my classes is teach Composer how to map namespaces to folders. Let's do that using PSR-4.</p>
<p>I'm going to open up <code>composer.json</code> and add a PSR-4 autoload section:</p>
<pre><code class="language-javascript">{
    "autoload": {
        "psr-4": {
            "Karani\\": "src/"
        }
    }
}</code></pre>
<p>So you can see: the left side is the namespace that we're defining (note that you need to escape the slash separators here by doubling them), and the right side is the directory.</p>
<h2>Conclude.</h2>
<p>As you can see, there's a lot going on here, but it's really pretty simple: 98% of the time, you're going to be working with a PSR-4-structured, Composer-autoloaded, set of classes.</p>
<p>So 98% of the time, you can check your <code>composer.json</code>, figure out where the root of the top level namespace lives, and assume you'll then have a one-to-one map of your namespace and the folders/files in that directory. Done.</p>
<p>And remember: next time you get <code>Class SOMETHING not found</code>, you probably just need to remember to import it with a <code>use</code> statement at the top of your file.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-custom-error-pages</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-custom-error-pages"/>
        <title>Laravel 5.0 - Custom Error Pages</title>
        <published>2015-02-01T00:00:00+00:00</published>
        <updated>2015-02-01T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">When you wanted to customize your error pages—fo...</summary>
        <content type="html"><![CDATA[
        <p>When you wanted to customize your error pages—for example, showing a particular cat GIF when your users hit a 404—you’d Google it and follow <a href="http://driesvints.com/blog/laravel-4-quick-tip-custom-error-pages">these instructions by Dries Vints</a>.</p>
<p>In Laravel 5 things have changed a bit. <a href="#how-to">TL;DR take me to the solution already</a></p>
<h2>Trace it through the code</h2>
<p>Now, all custom error and exception handling has moved to <code>app/Exceptions/Handler.php</code>. You’ll remember that that’s where we went to <a href="http://mattstauffer.co/blog/bringing-whoops-back-to-laravel-5">bring Whoops back</a>.</p>
<p>You’ll notice, however, that it does this by default:</p>
<pre><code class="language-php">    /**
     * Render an exception into an HTTP response.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Exception  $e
     * @return \Illuminate\Http\Response
     */
    public function render($request, Exception $e)
    {
        if ($this-&gt;isHttpException($e))
        {
            return $this-&gt;renderHttpException($e);
        }
        else
        {
            return parent::render($request, $e);
        }
    }</code></pre>
<p>For all HTTP Exceptions (like 404s and 503s), it uses the <code>renderHttpException()</code> method, which isn’t defined in this file. So, we check its parent, <code>\Illuminate\Foundation\Exceptions\Handler</code>, where we can find the <code>renderHttpException()</code> method:</p>
<pre><code class="language-php">    /**
     * Render the given HttpException.
     *
     * @param  \Symfony\Component\HttpKernel\Exception\HttpException  $e
     * @return \Symfony\Component\HttpFoundation\Response
     */
    protected function renderHttpException(HttpException $e)
    {
        if (view()-&gt;exists('errors.'.$e-&gt;getStatusCode()))
        {
            return response()-&gt;view('errors.'.$e-&gt;getStatusCode(), [], $e-&gt;getStatusCode());
        }
        else
        {
            return (new SymfonyDisplayer(config('app.debug')))-&gt;createResponse($e);
        }
    }
</code></pre>
<p>So, if the view exists for &quot;errors.{httpStatusCode}&quot;, it'll display it (and pass along a little bit of information).</p>
<p><a id="how-to"></a></p>
<h2>How ya do it</h2>
<p>So, if we have a view file accessible at “errors.{errorStatusCode}”, it’ll automatically display for that status code.</p>
<p>So that means customizing your 404 error page is as simple as adding a view at <code>resources/views/errors/404.blade.php</code>. Done!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-generating-missing-events</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-5.0-generating-missing-events"/>
        <title>Laravel 5.0 - Generating Missing Events</title>
        <published>2015-01-26T00:00:00+00:00</published>
        <updated>2015-01-26T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Sometimes it can seem like a lot of work to create...</summary>
        <content type="html"><![CDATA[
        <p>Sometimes it can seem like a lot of work to create an event, create its handler, and bind the two. Create a command, create its handler, bind the two. I've often wished for a workflow that handled the whole process together in one.</p>
<p>The artisan commands for generating commands and events are a good start--they both create their own entity and (optionally) its handler. But you still can spend an hour writing the command and handler, and then waste another 15 minutes trying to figure out why it's not working, only to realize you never actually <em>bound</em> the two together.</p>
<h2>Enter event:generate</h2>
<p>Well, dear reader, your white-knuckled wait is finally over. In Laravel 5, you can bind (non-existent) events and handlers in the <code>EventServiceProvider</code>, run <code>php artisan event:generate</code>, and Artisan will automatically generate the files for you--both for the Event and its Handler.</p>
<h2>Make it happen</h2>
<p>Check out our events and handlers directories before:</p>
<pre><code class="language-bash">app/
    Events/
        Event.php
    Handlers/
        Events/</code></pre>
<p>1) Open <code>app/providers/EventServiceProvider.php</code>. Find the <code>$listen</code> property, which is where you would normally bind your events, and add one in the following format:</p>
<pre><code class="language-php">    protected $listen = [
        DidSomethingEvent::class =&gt; [
            RespondOneWay::class,
            RespondAnotherWay::class
        ]
    ];</code></pre>
<p>2) Run <code>php artisan event:generate</code></p>
<p>3) Profit.</p>
<p>Check it out. </p>
<pre><code class="language-bash">app/
    Events/
        Event.php
        DidSomethingEvent.php
    Handlers/
        Events/
            RespondOneWay.php
            RespondAnotherWay.php</code></pre>
<p>Created. Bound. Ready to go. Even typehinted:</p>
<pre><code class="language-php">&lt;?php namespace App\Handlers\Events;
...
class RespondOneWay {
    ...
    public function handle(DidSomethingEvent $event)
    {
    }
}</code></pre>
<h2>That was easy, right?</h2>
<p>Yah, that's it. You can now design your eventing system abstractly--you could plan the entire thing without writing a single command or handler. And once you're ready to go, generate all of your events and handlers in a single command.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/extending-laravels-application</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/extending-laravels-application"/>
        <title>Extending Laravel&#039;s Application</title>
        <published>2015-01-25T00:00:00+00:00</published>
        <updated>2015-01-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">It&#039;s seldom that we need to extend Laravel&#039;s core,...</summary>
        <content type="html"><![CDATA[
        <p>It's seldom that we need to extend Laravel's core, and even when we do, it's most likely we're going to extend specific components, which is <a href="http://laravel.com/docs/4.2/extending">detailed in the docs</a>.</p>
<p>However, all of these instructions presume you're using the core Laravel Application (IOC Container) to extend the other classes. <strong>What if you want to extend the <code>Application</code> itself</strong>?</p>
<h2>This Is Actually A Real Example</h2>
<p>This has come up recently because <a href="https://github.com/laravel/framework/issues/7108">some folks are debating on whether or not Laravel 5 should make it easier to change the default folder paths</a>--e.g. changing <code>storage</code>'s location, or changing <code>public</code> to be <code>public_html</code>. There are, at the time of this writing, no easy ways to do that other than extending Application, and that has some folks worried.</p>
<p>So, let's do it. Let's take a Laravel 5 application, extend its <code>Application</code>, and change its storage path to be <code>/OMGStorage</code>.</p>
<h2>Extend it</h2>
<p>First, create an application class somewhere in your namespace, and have it extend <code>Illuminate\Foundation\Application</code>. For example:</p>
<pre><code class="language-php">&lt;?php namespace Confomo;

class Application extends \Illuminate\Foundation\Application
{
}
</code></pre>
<h2>Register it</h2>
<p>Now, let's find where <code>Illuminate\Foundation\Application</code> is bound. Thankfully, it's simple: <code>bootstrap/app.php</code>. The first non-comment code in the file is:</p>
<pre><code class="language-php">$app = new Illuminate\Foundation\Application(
    realpath(__DIR__.'/../')
);</code></pre>
<p>I think you can guess what's coming next. Just replace those lines with these:</p>
<pre><code class="language-php">$app = new Confomo\Application(
    realpath(__DIR__.'/../')
);</code></pre>
<p>That's it. We're now using our custom <code>Application</code> everywhere through the site.</p>
<h2>Override (extend) your methods</h2>
<p>So, if our goal is to override the functionality in <code>Application</code> that provides the location for the <code>storage</code> directory, the final step is to find that functionality and override it.</p>
<p>Thankfully again, a quick glance through the <code>Illuminate\Foundation\Application</code> class makes that very clear: there's a method named <code>storagePath</code>:</p>
<pre><code class="language-php">    /**
     * Get the path to the storage directory.
     *
     * @return string
     */
    public function storagePath()
    {
        return $this-&gt;basePath.'/storage';
    }</code></pre>
<p>... so, let's do our business. In our custom <code>Application</code>, let's override that method:</p>
<pre><code class="language-php">&lt;?php namespace Confomo;

class Application extends \Illuminate\Foundation\Application
{
    /**
     * Get the path to the storage directory.
     *
     * @return string
     */
    public function storagePath()
    {
        return $this-&gt;basePath.'/OMGstorage';
    }
}
</code></pre>
<p>... and done. We've now just customized this path. And, of course, we can use this same set of steps to extend anything else that the <code>Application</code> class provides to Laravel.</p>
<h2>Conclado</h2>
<p>That's it! I hope this gives you the freedom and power to take more control of your Laravel-based web sites, and also the encouragement to go look around the core even more to learn how everything works.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-events-and-handlers</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-events-and-handlers"/>
        <title>Laravel 5.0 - Events &amp; Handlers</title>
        <published>2015-01-21T00:00:00+00:00</published>
        <updated>2015-01-21T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            If you haven&#039;t read it yet, go read the Laravel 5...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>If you haven't read it yet, go read the <a href="http://mattstauffer.co/blog/laravel-5.0-commands-and-handlers">Laravel 5.0 - Commands &amp; Handlers</a> post. It'll give much-needed background for this article.</p>
</blockquote>
<p>With Laravel 5's Commands (and their handlers), you can, in a simple, direct, and encapsulated way, emit a <em>command</em> to the system. DoThis. HandleACommandThatIsTellingMeToDoThis. It's imperative. It's telling the system what to do.</p>
<p>But sometimes, either as a result of a command, or just in another context, we want to send out a much more abstract notification. You've likely seen that Laravel 4 could trigger events based on a string event name:</p>
<pre><code class="language-php">    $response = Event::fire('auth.login', array($user));</code></pre>
<p>This is sending a notice out to the world of the application: &quot;Hey! Someone logged in! Do whatever you want with this information&quot; It's <em>informative</em>. If you're familiar with the concept of PubSub, that's what going on with events.</p>
<p>Well, in Laravel 5, the eventing system has been upgraded and it looks a lot more like the command system we saw in the last post. Rather than identifying an event based on a string (<code>auth.login</code>), we're actually creating a PHP object and emitting that.</p>
<h2>Sample</h2>
<p>So, let's try it out.</p>
<h3>Generate event</h3>
<pre><code class="language-bash">php artisan make:event ThingWasDone</code></pre>
<p>... and that generates this:</p>
<pre><code class="language-php">&lt;?php namespace SaveMyProposals\Events;

use SaveMyProposals\Events\Event;

use Illuminate\Queue\SerializesModels;

class ThingWasDone extends Event {

    use SerializesModels;

    /**
     * Create a new event instance.
     *
     * @return void
     */
    public function __construct()
    {
        //
    }

}
</code></pre>
<p>You can attach data to this object by adding constructor parameters and setting them as properties of the class.</p>
<h3>Generate event handler</h3>
<p>You then create a handler:</p>
<pre><code class="language-bash">php artisan handler:event SendMailInSomeParticularContext --event="ThingWasDone"</code></pre>
<p>... which generates this:</p>
<pre><code class="language-php">&lt;?php namespace SaveMyProposals\Handlers\Events;

use SaveMyProposals\Events\ThingWasDone;

use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Queue\ShouldBeQueued;

class SendMailInSomeParticularContext {

    /**
     * Create the event handler.
     *
     * @return void
     */
    public function __construct()
    {
        //
    }

    /**
     * Handle the event.
     *
     * @param  ThingWasDone  $event
     * @return void
     */
    public function handle(ThingWasDone $event)
    {
        //
    }

}</code></pre>
<p>Note that the generator has already type-hinted a <code>ThingWasDone $event</code> parameter in the <code>handle</code> method. You can also use dependency injection, either in the constructor <em>or</em> in the <code>handle</code> method, to bring in whatever other tools you need to get this event handled.</p>
<h3>Bind the events</h3>
<p>Note that just creating an event and its handler doesn't inform the bus that they should be paired together. You need to bind the listening relationship in <code>app\Providers\EventServiceProvider</code>, on its <code>$listen</code> property:</p>
<pre><code class="language-php">// app\Providers\EventServiceProvider
    $listen = [
        ThingWasDone::class =&gt; [
            SendMailInSomeParticularContext::class,
            SaveSomeRecordInSomeOtherContext::class,
            DoSomethingElseInResponseToThingBeingDone::class
        ]
    ];</code></pre>
<p>As you can see, you're using <code>::class</code> to get a string representation of this event's class name, and then you're adding listeners (using <code>::class</code> as well).</p>
<h3>Ready, aim, <code>::fire</code></h3>
<p>OK, so it's finally time to trigger the event. Note that these are just simple PHP classes--you could instantiate an Event manually, and instantiate its Handler, and pass the Event to the handler method. But the Laravel-provided bus makes it easier, more consistent, <em>and</em> more global:</p>
<pre><code class="language-php">\Event::fire(new ThingWasDone($param1, $param2));</code></pre>
<p>That's it!</p>
<h2>ShouldBeQueued</h2>
<p>Just like with Commands, you can have your Event implement the <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> interface, and that'll make the handling of the event be pushed up on the queue; and you can add the <code>Illuminate\Queue\InteractsWithQueue</code> trait to give easy access to methods for handling interactions with the queue like deleting the current job.</p>
<h2>SerializesModels trait</h2>
<p>Note that, like in commands, if you want to attach an Eloquent model to an event, you should include the <code>SerializesModels</code> trait at the top of the class definition for that event. At the time of this writing, it's actually already included by default.</p>
<h2>Concluditation</h2>
<p>That's it! Once you understand commands and handlers in Laravel 5, events are simple: the triggering system is <em>informing</em> the surrounding world that something happened, rather than <em>demanding</em> that the surrounding world do something. But they're both means of encapsulating the intent of a message, and they can play very nicely together, too.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/bringing-whoops-back-to-laravel-5</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/bringing-whoops-back-to-laravel-5"/>
        <title>Bringing Whoops Back to Laravel 5</title>
        <published>2015-01-19T00:00:00+00:00</published>
        <updated>2015-01-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">You might be missing the &quot;prettier&quot; Whoo...</summary>
        <content type="html"><![CDATA[
        <p>You might be missing the &quot;prettier&quot; Whoops error handler from Laravel 4. If so, here's how to bring it back.</p>
<blockquote>
<p>Update: If you're using Laravel 5.2, check out <a href="https://laracasts.com/discuss/channels/laravel/whoops-20-laravel-52">this Laracasts thread on Whoops in Laravel 5.2</a>. I'll update this post soon with updated info, but for now just take a look there.</p>
</blockquote>
<p>First, <code>composer require filp/whoops:~1.0</code>.</p>
<p>Then open <code>app/Exceptions/Handler.php</code>, and in the <code>render()</code> method, add a Whoops handler in the <code>else</code> condition. Maybe something like this:</p>
<pre><code class="language-php">    /**
     * Render an exception into an HTTP response.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Exception  $e
     * @return \Illuminate\Http\Response
     */
    public function render($request, Exception $e)
    {
        if ($this-&gt;isHttpException($e))
        {
            return $this-&gt;renderHttpException($e);
        }

        if (config('app.debug'))
        {
            return $this-&gt;renderExceptionWithWhoops($e);
        }

        return parent::render($request, $e);
    }

    /**
     * Render an exception using Whoops.
     * 
     * @param  \Exception $e
     * @return \Illuminate\Http\Response
     */
    protected function renderExceptionWithWhoops(Exception $e)
    {
        $whoops = new \Whoops\Run;
        $whoops-&gt;pushHandler(new \Whoops\Handler\PrettyPageHandler());

        return new \Illuminate\Http\Response(
            $whoops-&gt;handleException($e),
            $e-&gt;getStatusCode(),
            $e-&gt;getHeaders()
        );
    }</code></pre>
<p>That's it!</p>
<p>Thanks to <a href="https://laracasts.com/discuss/channels/general-discussion/whoops-removed-from-laravel-5">this thread</a> on the Laracasts forum for getting me moving in the right direction.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/upgrading-from-laravel-4-to-laravel-5</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/upgrading-from-laravel-4-to-laravel-5"/>
        <title>Upgrading from Laravel 4 to Laravel 5</title>
        <published>2015-01-16T00:00:00+00:00</published>
        <updated>2015-01-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">It&#039;s very simple to get started in a new Laravel 5...</summary>
        <content type="html"><![CDATA[
        <p>It's very simple to get started in a new Laravel 5 app: <code>composer create-project laravel/laravel my-project-name-here dev-develop --prefer-dist</code>. But what if you have a Laravel 4 app you want to upgrade?</p>
<p>You might think the answer is to upgrade the Composer dependencies and then manually make the changes. Quite a few folks have created walkthroughs for that process, and it's possible—but there are a lot of little pieces you need to catch, and Taylor has said publicly that he thinks the better process is actually to start from scratch and copy your code in. So, that's what we're going to be doing.</p>
<p>This process took me 3 hours the first time (because I was writing this article), and 1 hour the second time. SaveMyProposals isn't <em>hugely</em> complex, but hopefully this guide will keep your upgrade time low.</p>
<h2>Getting Started</h2>
<p>So, we’re working on upgrading <a href="https://github.com/mattstauffer/savemyproposals">SaveMyProposals</a>, in my local <code>~/Sites/savemyproposals</code> directory.</p>
<p>We want to have a copy of the new site (a blank laravel 5 install) and the old site (the Laravel 4.2 savemyproposals from the github repo) next to each other, so we’ll do an additional clone of the savemyproposals repo into a parallel directory <code>l5smp</code>. I’m going to do the Laravel 5 upgrade in my NEW directory, not in my previous working directory, so that it’s easier to make sure I don’t lose any git-ignored configuration files in the process.</p>
<pre><code class="language-bash">cd ~/Sites
git clone git@github.com:mattstauffer/savemyproposals.git l5smp
cd l5smp
git checkout -b features/laravel-5</code></pre>
<p>OK, so now let’s clean out our <code>laravel-5</code> install. We want to delete <em>everything</em>; however, we can’t delete <code>.git</code>, or we’d be deleting our git repo entirely. So, here’s the fastest way I came up with, but I’d love someone to chip in if there’s a cleaner solution:</p>
<pre><code class="language-bash">cd ~/Sites/l5smp
rm -rf *
rm .gitattributes
rm .gitignore</code></pre>
<p>Also, if you have any other files in your home directory left over after this—e.g. <code>.scrutinizer.yml</code>—delete those too. We’ll be copying them over in a later step. You want nothing in your directory except <code>.git</code>.</p>
<p>That’s it. We now have a clean install. Let’s get Laravel 5 in there! If you’re like me, you’ll want a clean point you can revert back to, so I actually committed here:</p>
<pre><code>git commit -am "Delete everything in preparation for Laravel 5."</code></pre>
<blockquote>
<p>NOTE: If you commit this delete, you’ll be losing the continuity of the history of any files that you plan to bring back later. However, we can use git squash to merge this commit in later, which will bring that continuity back.</p>
</blockquote>
<p>OK, let's get the Laravel files in there. Thankfully, Isern Palaus (@ipalaus) got me a very simple version of this step.</p>
<pre><code class="language-bash">git remote add laravel https://github.com/laravel/laravel.git
git fetch laravel
git merge laravel/master --squash
git add .
git commit -am "Bring in Laravel 5 base."
composer install</code></pre>
<p>You should be able to check to make sure this app works (without anything in it) by running the following:</p>
<pre><code class="language-bash">php -S localhost:8090 -t public/</code></pre>
<p>And visiting <code>http://localhost:8090/</code> in your browser. If you see this, you’re doing good:</p>
<p><img src="/assets/images/content/Screen-Shot-2015-01-13-at-11.42.04-PM.png" alt="Laravel Start Screen" /></p>
<p>Now, to bring everything back. What I did was open the directories up in side-by-side panels in iTerm 2 and just start listing out the files in my old site (<code>~/Sites/savemyproposals</code>) and moving them into the right places in the new site (<code>~/Sites/l5smp</code>). Here are the steps; I’ll be referring to OLD and NEW, OLD being the directory for my laravel 4 code and NEW being the new blank Laravel 5 install.</p>
<h2>PSR-4 namespace</h2>
<p>If you already have a top-level PSR-0/PSR-4 namespace set up, like I did for SaveMyProposals, you’ll want to use the new app:name Artisan command.</p>
<pre><code class="language-bash">php artisan app:name SaveMyProposals</code></pre>
<h2>Your domain folder</h2>
<p>If you follow the common community practice of having a folder either at the top level or in <code>app</code> with the name of your top-level namespace—e.g. I have <code>app/SaveMyProposals</code> that is my PSR-0 source.</p>
<p>The easiest way to map this is just to move all of the folders under this folder into your <code>app</code> folder, and it'll just bring them into your already-established namespace. Done.</p>
<h2>Composer.json dependencies</h2>
<p>Work through your <code>composer.json</code> in OLD, praying as you go that all of your packages have been updated for Laravel 5, and move your dependencies and other customizations into NEW’s <code>composer.json</code>.</p>
<p>Now, try a <code>composer update</code> to see what you get.</p>
<h2>The app/ Directory</h2>
<h3>Commands</h3>
<p>Move from <code>app/commands</code> =&gt; <code>app/Console/Commands</code></p>
<p>Either namespace your commands, or add them to the <code>composer.json</code> classmap autoloader.</p>
<p>Note that, in Laravel 5, the default Inspire Command comes with a <code>handle()</code> method, but Laravel will call either <code>fire()</code> (old style) or <code>handle()</code> (new style), whichever it finds.</p>
<p>Move the bindings of your commands from <code>start/artisan.php</code> into <code>app/Console/Kernel.php</code>, where the <code>$commands</code> array lists out all of the commands to register.</p>
<h3>Config</h3>
<p>See <strong>Configuration</strong> below</p>
<h3>Controllers</h3>
<p>Move from <code>app/controllers</code> =&gt; <code>app/Http/Controllers</code></p>
<p>Either namespace your controllers (directions below) or drop the namespace from the abstract <code>app/Http/Controllers/Controller.php</code> and autoload the <code>app/Http/Controllers</code> directory via composer classmap.</p>
<h3>Database Migrations &amp; Seeds</h3>
<p>Move from <code>app/database</code> =&gt; <code>database</code></p>
<p>Delete the <code>2014_10_12_00000_create_users_table</code>, since you should already have this (although you should make sure that you have the <code>remember_token</code> field, which was added in 4.1.26). You can keep the password_reset migration--that's new in Laravel 5.</p>
<h3>Filters</h3>
<p>Laravel 5 has <a href="http://mattstauffer.co/blog/laravel-5.0-middleware-filter-style">moved to focusing on Middleware</a> for things we used to use filters for, but you can still port your old filters over. Just open up <code>app/Providers/RouteServiceProvider.php</code> and paste your bindings into <code>boot()</code>. E.g.</p>
<pre><code class="language-php">// app/filters.php
Router::filter('shall-not-pass', function() {
    return Redirect::to('shadow');
});</code></pre>
<p>could be moved in like this:</p>
<pre><code class="language-php">// app/Providers/RouteServiceProvider@boot()
$router-&gt;filter('shall-not-pass', function() {
    return \Redirect::to('shadow');
});</code></pre>
<p>Note that you don't need to move over any of the filters that come in by default; they're all here, but now as Middleware.</p>
<h3>Language files</h3>
<p>Move from <code>app/lang</code> =&gt; <code>resources/lang</code></p>
<h3>Models</h3>
<p>Laravel 5—and most of the advice from the community for quite some time—has done away with the concept of a <code>models</code> folder. But if your old app uses it, just create a <code>models</code> directory within <code>app</code> and classmap autoload it (by adding it to <code>composer.json</code>’s classmap autoload section):</p>
<pre><code class="language-javascript">"autoload": {
    "classmap": [
        "database",
        "app/models"
    ]
}</code></pre>
<p>Note that the <code>User.php</code> that comes with Laravel 5 lives in the <code>app</code> directory, so you could also place your model files there and put them in your top level namespace (e.g. <code>SaveMyProposals/Conference</code> for the Conference model).</p>
<h4>Soft Deletes</h4>
<p>If you use the <code>SoftDeletingTrait</code> on any of your models, you'll want to rename the trait to <code>SoftDeletes</code>.</p>
<h3>Routes</h3>
<p>Move <code>app/routes.php</code> =&gt; <code>app/Http/routes.php</code></p>
<p>Adjust any routes that use the built-in routes from, for example, <code>before</code> =&gt; <code>auth</code> to <code>middleware</code> =&gt; <code>auth</code>.</p>
<h3>Start</h3>
<p><strong>artisan.php</strong><br />
See notes above about moving command bindings.</p>
<p><strong>global.php</strong><br />
Global.php is a catchall for many people. Anything in here should likely be added to a Service Provider; but if not, you can register bindings in <code>SaveMyProposals\Providers\AppServiceProvider</code> in the <code>register()</code> method.</p>
<h3>Tests</h3>
<p>Move from <code>app/tests</code> =&gt; <code>tests</code></p>
<h3>Views</h3>
<p>Move from <code>app/views</code> =&gt; <code>resources/views</code></p>
<h2>Namespacing controllers, commands, etc.</h2>
<h3>Namespacing controllers</h3>
<p>If your controllers weren't namespaced in the old codebase, you can either bring them in with no namespace, or add namespaces to them.</p>
<p>If you want to add namespaces, just go to each controller and add <code>SaveMyProposals\Http\Controllers</code> as their namespace.</p>
<p>If you want to go without, edit <code>app/Providers/RouteServiceProvider.php</code> and set <code>protected $namespace</code> equal to <code>null</code>. Then add the controllers directory to <code>classmap</code> in the <code>composer.json</code> autoload section. Then edit the <code>map()</code> method to be <em>just</em> this (replace the entire <code>$this-&gt;loadRoutesFrom</code> line):</p>
<pre><code class="language-php">    include app_path('Http/routes.php');</code></pre>
<blockquote>
<p>Note: If you namespace your controllers, <strong>all of your internal façade calls will fail</strong>; the simpler way is to choose to not namespace controllers. If you do, you'll see something like <code>Class 'SaveMyProposals\Http\Controllers\Auth' not found.</code>. If this happens, you just need to <code>use Auth</code>, <code>use Session</code>, etc. at the top of the controller—or just prepend <code>\</code> to each inline (e.g. convert <code>Session::flash('stuff', 'other stuff');</code> to <code>\Session::flash('stuff', 'other stuff');</code>.)</p>
</blockquote>
<h3>Namespacing Artisan commands</h3>
<p>Just like controllers, you can either namespace or tweak the setup. Namespacing Artisan commands works just like with controllers. You can tweak the set up to work with non-namespaces commands by changing the referred-to namespace in <code>app/Console/Kernel.php</code>'s <code>$commands</code> property, and then <code>classmap</code> autoloading the <code>app/Console/Commands</code> directory in <code>composer.json</code>.</p>
<h2>Bootstrap directory</h2>
<p>If you’ve made any customizations to files in <code>bootstrap</code>—and if you made any, it was likely only <code>start.php</code>—you’ll want to move them over. Note that <code>detectEnvironment</code> behaves differently in Laravel 5, so don’t even worry about copying over anything about environment detection. You’re going to be re-doing this.</p>
<h2>Public directory</h2>
<p>You can delete every file out of NEW’s <code>public</code> directory except <code>index.php</code>, and move your OLD <code>public</code> files in.</p>
<p>You’ll notice that the Laravel 5 app structure puts the source Less files in <code>resources/assets/less</code>, so if you want to follow this convention you can put Sass or Less files and any other sources there. But you don’t <em>have</em> to, so for this walkthrough we won’t.</p>
<h2>Loose files in your top-level directory</h2>
<p>This is up to you. <code>readme.md</code>, <code>.scrutinizer.yml</code>, <code>.travis.yml</code>, <code>travis.php.ini</code>, <code>package.json</code>, <code>gulpfile.js</code>, whatever. Note that Laravel 5 ships with <code>package.json</code> and <code>gulpfile.js</code> by default, so you’ll want to check those out before you just overwrite them.</p>
<p>Also, be sure to bring in any customization you’ve made to <code>.gitignore</code>, <code>.gitattributes</code>, or <code>phpunit.xml</code>.</p>
<h2>Configuration</h2>
<h3>.env.local.php =&gt; .env</h3>
<p>I copied <code>.env.local.php</code> from OLD to NEW. I then edited it to turn it from a PHP array into a .env format, from this:</p>
<pre><code class="language-php">&lt;?php return [
'key' =&gt; 'value'
];</code></pre>
<p>to this:</p>
<pre><code>key=value</code></pre>
<p>I also edited <code>.env.example</code> to show what keys I expect in each <code>.env</code> file:</p>
<pre><code>key=valueHere</code></pre>
<p>I also added <code>APP_ENV</code> (set to &quot;local&quot;),<code>APP_DEBUG</code> (set to <code>true</code>), <code>APP_KEY</code> (set to my encryption key), <code>DB_HOST</code> &amp; <code>DB_DATABASE</code> &amp; <code>DB_USERNAME</code> &amp; <code>DB_PASSWORD</code> set to their appropriate values, and <code>CACHE_DRIVER</code> and <code>SESSION_DRIVER</code> set to 'file', as these are used internally in the framework.</p>
<h3>Config files</h3>
<p>Drop the concept of <code>local</code> vs. <code>production</code> vs. <code>staging</code> config files. Drop the idea of <code>.env.local.php</code>, <code>.env.staging</code>, etc. Configuration file loading, and environment detection, is endlessly simpler.</p>
<p>Every piece of config that's consistent across all installs should live in the very-familiar config files in the <code>config</code> directory.</p>
<p>Every piece of config that's specific to each install should live in <code>.env</code>, which should be git ignored.</p>
<p><code>.env.example</code> should show all of the fields that should be present in each <code>.env</code> file.</p>
<p>So, copy all of your OLD universal values from the config files into the NEW <code>config</code> directory, and then extract changing values into <code>.env</code> and <code>.env.example</code>, and then use those inline your code using <code>env('KEY_NAME_HERE')</code>.</p>
<h2>Auth &amp; Users</h2>
<p>The fastest trick is just to use the pre-existing User model, but if you can't do that, here's what you want to do:</p>
<p><strong>Delete the following from your <code>use</code> block:</strong></p>
<pre><code class="language-php">use Illuminate\Auth\UserInterface;
use Illuminate\Auth\Reminders\RemindableInterface;</code></pre>
<p><strong>Add the following to your <code>use</code> block:</strong></p>
<pre><code class="language-php">use Illuminate\Auth\Authenticatable;
use Illuminate\Auth\Passwords\CanResetPassword;
use Illuminate\Contracts\Auth\Authenticatable as AuthenticatableContract;
use Illuminate\Contracts\Auth\CanResetPassword as CanResetPasswordContract;</code></pre>
<p><strong>Remove the UserInterface and RemindableInterface interfaces</strong></p>
<p><strong>If you used them, remove <code>Illuminate\Auth\Reminders\RemindableTrait</code> and <code>Illuminate\Auth\UserTrait</code> from your use block and your class declaration.</strong></p>
<p><strong>Mark it as implementing the following interfaces:</strong></p>
<pre><code class="language-php">implements AuthenticatableContract, CanResetPasswordContract</code></pre>
<p><strong>Include the following <em>within the class declaration, to use them as traits</em>:</strong></p>
<pre><code class="language-php">use Authenticatable, CanResetPassword;</code></pre>
<p>And finally, either change the namespace of your <code>User</code> model to  your app namespace, or change the 'model' property in <code>config/auth.php</code> to the correct namespace (e.g. <code>User</code> instead of <code>SaveMyProposals\User</code>).</p>
<p>Finally, if you're using your own User model, you can delete <code>app/user.php</code>.</p>
<h2>Form &amp; HTML Helpers</h2>
<h3>Class Form not found</h3>
<p>If you're using Form or Html helpers, you'll see an error stating <code>class 'Form' not found</code> (or the same for Html). Just go to Composer and require <code>"illuminate/html": "~5.0"</code>.</p>
<p>You'll also need to get the Façade and the service provider working. Edit <code>config/app.php</code>, and add this line to the 'providers' array:</p>
<pre><code class="language-php">    'Illuminate\Html\HtmlServiceProvider',</code></pre>
<p>And add these lines to the 'aliases' array:</p>
<pre><code class="language-php">        'Form'      =&gt; 'Illuminate\Html\FormFacade',
        'Html'      =&gt; 'Illuminate\Html\HtmlFacade',</code></pre>
<h3>{{ }} escaping</h3>
<p>The best way to handle the change from <code>{{</code> to <code>{!!</code> for raw HTML output in Blade is to just use find and replace any time you KNOW you have to have raw output—for example, if you're using Laravel form helpers—and replace <code>{{</code> with <code>{!!</code> and <code>}}</code> with <code>!!}</code> in those contexts. Everywhere else, just leave it as <code>{{</code> and <code>}}</code>; that should be the default echo syntax from now on.</p>
<p>If for some reason you <em>need</em> to use the old Blade syntax, you can define that. Just add the following lines at the bottom of <code>AppServiceProvider@register()</code>:</p>
<pre><code class="language-php">        \Blade::setRawTags('{{', '}}');
        \Blade::setContentTags('{{{', '}}}');
        \Blade::setEscapedContentTags('{{{', '}}}');</code></pre>
<p>Note that if you change the raw tags this way, your comments with <code>{{--</code> will no longer work.</p>
<h2>Cleaning up</h2>
<p>If you did the commits along the way like I did, you can squash them together to get continuity with git squash. Run <code>git log</code> to see how many commits you used; I used 3. Then run <code>git rebase -i HEAD~3</code> (replace 3 with your number.)</p>
<p>This will open Git, and you can now squash the commits. If you're unfamiliar with git squash, check out my <a href="http://mattstauffer.co/blog/squashing-git-commits-with-interactive-rebase">tutorial on Squashing Git Commits</a>.</p>
<h2>Miscellaneous</h2>
<h3>Façades in namespaced controllers</h3>
<p>Because everything's namespaced, all of your controllers' <code>View::make()</code> (and any other façade accessed with your namespaced controllers) will break because it can't the top-level namespaced <code>View</code>, <code>Auth</code>, etc. Probably the simplest solution is to <code>use View</code> at the top of the file, although there are quite a few more architecturally &quot;pure&quot; ways.</p>
<h3>Whoops</h3>
<p>If you miss the Whoops error handler, I have <a href="http://mattstauffer.co/blog/bringing-whoops-back-to-laravel-5">a post on how you can bring it back</a>.</p>
<h3>Packages</h3>
<p><em>Lots</em> has changed in Laravel 5 with how packages work, so it's likely there will be a lot of wrinkles to be ironed out there. If you run into particular issues there, please leave notes in the comments so I can get this section more comprehensive. For now, Ryan Tablada warns: &quot;Be prepared for <code>function "package" does not exist</code>&quot;.</p>
<h3>What didn't move over?</h3>
<p>There are probably plenty of packagers that won't make it. Most Laravel-specific packages won't. In this codebase, bugsnag-laravel was the only such package.</p>
<h2>Concluding</h2>
<p>This was a quick run-through. I'm <em>confident</em> that I'm missing some pieces here, because I only picked up what happened for this particular site's upgrade. So, in a move counter to my usual policy, I'm going to open up comments on a Github Gist where folks can provide corrections/updates/etc.</p>
<p>That's it! As you can see, there are a lot of pieces, but this is actually a very simple and quick upgrade, considering that we're upgrading <em>major versions</em> of a framework here. Go Forth and Upgrade!</p>
<p><a href="https://gist.github.com/mattstauffer/4203242322e4e494e189">Comments Gist</a></p>
<h2>Troubleshooting</h2>
<h3>Eloquent</h3>
<p>If you see this error:</p>
<pre><code class="language-bash">PHP Fatal error:  Class 'Eloquent' not found in /path/to/YourModel.php</code></pre>
<p>... that means <code>YourModel</code> is extending <code>\Eloquent</code>. To make this work, just add this <code>use</code> to that model's use block:</p>
<pre><code class="language-php">use Illuminate\Database\Eloquent\Model as Eloquent;</code></pre>
<h3>String Given</h3>
<p>If you see this error:</p>
<pre><code>Catchable fatal error: Argument 1 passed to Illuminate\Foundation\Application::__construct() must be an instance of Illuminate\Http\Request, string given</code></pre>
<p>... you need to run <code>composer install</code>.</p>
<h3>Call to a member function domain() on a non-object</h3>
<p>If you see the error:</p>
<pre><code>Call to a member function domain() on a non-object</code></pre>
<p>It means one of your route actions isn't linking correctly. For example, if you're linking to a route named &quot;signup&quot; and you don't have a route with that name, you'll get this error. </p>
<p>More likely in a Laravel 5 upgrade, it has to do with the namespacing or non-namepsacing of your controllers. </p>
<h3>Illuminate\Session\TokenMismatchException</h3>
<p>If you start seeing <code>Illuminate\Session\TokenMismatchException</code> show up--likely in your logs--this is because, by default, Laravel 5 has CSRF protection enabled on all routes. You can remove the CSRF protection Middleware from the <code>$middleware</code> stack in <code>App\Http\Kernel</code> and move it to the <code>$routeMiddleware</code> stack as an optional key, <em>or</em> you can adjust all of your forms--even those in AJAX--to ensure they all use CSRF.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/scheduling-posts-with-sculpin</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/scheduling-posts-with-sculpin"/>
        <title>Scheduling posts with Sculpin (and other static site generators)</title>
        <published>2015-01-06T00:00:00+00:00</published>
        <updated>2015-01-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">One of the most difficult things about using stati...</summary>
        <content type="html"><![CDATA[
        <p>One of the most difficult things about using static site generators has been handling scheduling posts ahead of time. I have a few ideas about interesting ways to schedule posts, but most of them are very technically complex, so I'm trying to explore a few different solutions, and I'll write them up here as I try them. If you haven't read it yet, check out my post on <a href="http://mattstauffer.co/blog/starting-a-blog-with-sculpin-on-laravel-forge">Starting a Blog With Sculpin</a> so you know the context for what I'm talking about.</p>
<p>The metric for whether or not the scheduling process has been successful is: <strong>Can I, ahead of time, trigger a new episode of the <a href="http://fiveminutegeekshow.com/">Five Minute Geek Show</a> to publish at a certain time?</strong> This is important to me, because I have FMGS on a set schedule, but I'm not always at my main computer to deploy then.</p>
<h2>Infrastructure</h2>
<p>Normally, publishing to the site means just running the publish script locally. My <a href="https://github.com/FiveMinuteGeekShow/fiveMinuteGeekShow/blob/develop/publish.sh">particular publish script</a> generates the new files, moves them into a Git repository, and pushes up the git repo, relying on <a href="http://forge.laravel.com/">Forge</a> to catch the Github webhook and deploy.</p>
<p>Because we're scheduling it for the future, we can no longer rely on my local machine being running at the time of the deploy. So we need to find some other way to sync it up.</p>
<h2>How to Schedule on Linux</h2>
<p>When I first mentioned this on Twitter, Adam Wathan pointed out the <a href="http://askubuntu.com/questions/339298/conveniently-schedule-a-command-to-run-later"><code>at</code> command</a>, which is like a one-off cron job that lets you schedule a command later. I like it, and I'll be planning on that.</p>
<p>So, my command was this:</p>
<pre><code class="language-bash">$ at 10:00
at&gt; cd ~/fiveminutegeekshow.com
at&gt; do whatever commands I want here
at&gt; &lt;ctrl-d&gt;</code></pre>
<p>You can check which commands are scheduled later with <code>$ at -l</code>.</p>
<h2>Option 1: Upload the <em>source</em> to the production server and schedule a build</h2>
<p>The first option is to get rid of the idea of a &quot;distribution&quot; github repo entirely. We could upload the &quot;source&quot; repo up to the production server, along with its <code>output_prod</code> folder. Then we could schedule a <code>sculpin generate --env=prod</code> command at the given time.</p>
<p>We can just point Forge's web root to be <code>/home/fiveminutegeekshow.com/output_prod</code>, and then every time a new build is made, Forge will be serving the new content.</p>
<h2>Option 2: Disable the auto-deploy on the distribution repo and schedule a git pull command</h2>
<p>We could keep the situation just like it is right now, disable Forge's auto-deploy, and instead schedule a <code>git pull</code> in the proper directory at the given time.</p>
<h2>Option 3: The folder system</h2>
<p>Capistrano is a deploy system that has a clever idea: To avoid downtime, every new deploy of the site should have its own folder in a &quot;deploys&quot; directory. Then when it's time to actually publish the new version, all you need to do is symlink your &quot;current&quot; directory (which is what your web server is serving from) over to the new directory. This also makes it very easy to roll back to previous verisons.</p>
<p>We could do the same sort of thing. This is where it starts getting complex, though. We're talking about likely using something like Capistrano or Chef to deploy the code, and then still needing to schedule the symlink in advance. I know someone's going to suggest this way of doing it, which is why I'm bringing it up, but it seems crazy to me.</p>
<h2>The current conlusion</h2>
<p>For now I'm going to try Option 2. I have an episode going out at 10am Eastern today, so I'm going to see if I can get it set up for this afternoon, and report back here.</p>
<p>UPDATE: Option 2 worked like a charm!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-commands-and-handlers</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-commands-and-handlers"/>
        <title>Laravel 5.0 - Commands &amp; Handlers</title>
        <published>2015-01-02T00:00:00+00:00</published>
        <updated>2015-01-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">As you’ve probably read me mention on Twitter, I...</summary>
        <content type="html"><![CDATA[
        <p>As you’ve probably read me mention on Twitter, I’ve paused on blogging new Laravel 5 features to try to give Taylor some space to develop with a little less of “this Git commit happened; therefore this is how it’ll be forever!” But he’s <a href="https://laracasts.com/lessons/laravel-5-commands">announced a new feature today</a>, so I’d consider this one pretty likely to stick around.</p>
<p><strong>The new feature set is all around Commands, which already exist in Laravel, but are getting a lot of new love in Laravel 5.0.</strong></p>
<p>I’ll be using examples in this blog post from a new application I’m working on called <a href="http://savemyproposals.com/">SaveMyProposals</a>, which allows conference speakers to save talk proposals.</p>
<h2>What is a command? A command handler? A command bus?</h2>
<p>You can learn about the concept of a command, a command handler, and a command bus in more depth from <a href="http://shawnmc.cool/command-bus">Shawn McCool</a>, but essentially:</p>
<p>A <strong>command</strong> is a simple object that’s meant to be a <em>message</em>. It contains <em>only</em> the information you need in order to <em>do</em> something. Our example here will be “Duplicate Talk Command”, which is an imaginary command that our system (a controller or an Artisan command, likely) will dispatch any time a user has chosen to duplicate a talk proposal. The duplicate talk command will have all of the properties set on it that we need to duplicate a talk—likely either a serialized Talk object or a TalkId.</p>
<p>A <strong>command handler</strong> is a class tasked with doing <em>something</em> in response to the command. A command can be passed through one or many handlers; each pull out important information from the command and do something in response.</p>
<p>A <strong>command bus</strong> is the system that allows you to dispatch (create and send off) commands, that matches commands to their handlers, and that makes everything play together. Often folks write their own command busses, but Laravel is providing one out of the box so we don't need to worry about this in this article.</p>
<h2>Using Commands in Laravel</h2>
<p>Before we get into the entire structure of how to use commands in Laravel 5, let’s look at what the end use case will look like. Imagine a user visits a route something like <code>savemyproposals.com/talks/12345/duplicate</code>, which routes them to <code>TalkController@duplicate(12345)</code>.</p>
<p>We'll have a controller method to handle it:</p>
<pre><code class="language-php">// Http\Controllers\TalkController
...
    public function duplicate($talkId)
    {
        $talk = Talk::findOrFail($talkId);

        $this-&gt;dispatch(new DuplicateTalkCommand($talk));

        // Depending on implementation, this could also just be:
        // $this-&gt;dispatch(new DuplicateTalkCommand($talkId));
    }</code></pre>
<p>Then we'll have a command:</p>
<pre><code class="language-php">// Commands\DuplicateTalkCommand
...

class DuplicateTalkCommand extends Command
{
    public $talk;

    public function __construct(Talk $talk)
    {
        $this-&gt;talk = $talk;
    }
}</code></pre>
<p>And a command handler:</p>
<pre><code class="language-php">// Handlers\Commands\DuplicateTalkCommandHandler
...

class DuplicateTalkCommandHandler
{
    public function handle(DuplicateTalkCommand $command)
    {
        // Do something with $command
        dd($command);
    }
}</code></pre>
<p>As you can see, our controller creates a <code>DuplicateTalkCommand</code> with the necessary information, dispatches it using the built-in command bus dispatcher, and then it’s handled (automatically) by its handler.</p>
<h2>Architecture</h2>
<p>OK, so let’s look first at where those commands and handlers live, and then how we generate them.</p>
<h3>Folders</h3>
<p>There are two new folders in <code>app/</code>: <code>Commands</code> and <code>Handlers</code>, and <code>Handlers</code> has two subfolders: <code>Commands</code> and <code>Events</code> (which shows us we can look forward to Event handling, too.)</p>
<pre><code>    app/
        Commands/
        Handlers/
            Commands/
            Events/</code></pre>
<p>As you can guess, Commands go in the <code>app/Commands</code> folder, and Command Handlers go in the <code>app/Handlers/Commands/</code> folder—with the exact same name as their Command, but with <code>Handler</code> appended to the end.</p>
<h3>Artisan</h3>
<p>Thankfully, you don’t have to do this on your own. There’s a new Artisan generator that’ll make it simple to create your own command:</p>
<pre><code>$ php artisan make:command DuplicateTalkCommand</code></pre>
<p>By default, this creates a self-handling command that isn't pushed to the queue. Pass this the <code>--handler</code> flag to generate a handler, and the <code>--queued</code> flag to make it queued.</p>
<p>This generates two files: a Command (<code>app\Commands\DuplicateTalkCommand.php</code>) and a Handler (<code>app\Handlers\Commands\DuplicateTalkCommandHandler.php</code>) (if you passed the <code>--handler</code> flag), and the Handler’s <code>handle</code> method is generated automatically typehinted for its paired Command.</p>
<h2>Basic workflow</h2>
<p>So, in order to create a new <code>DuplicateTalkCommand</code>, you'd do the following:</p>
<ol>
<li><code>php artisan make:command DuplicateTalkCommand</code></li>
<li>Edit <code>DuplicateTalkCommand</code> and give it a public property of <code>$talk</code> and set it to be injected via the constructor</li>
<li>Edit <code>DuplicateTalkCommandHandler</code> and write its <code>handle()</code> method to do whatever you actually want to have happen--likely using a repository or other database access layer to duplicate the talk and save the duplicate.</li>
<li>Dispatch the command, likely in your controller or an Artisan command.</li>
</ol>
<p>That's it! You're now using commands in Laravel 5.0! Everything from here on out are just nitty gritty details about queues, traits, interfaces, and other special considerations and tricks.</p>
<h2>Queues</h2>
<h3>Queueing Commands</h3>
<p>If you want any command to be queued every time you dispatch it (instead of operating synchronously), all you need to do is have it implement the <code>ShouldBeQueued</code> interface. Laravel will read that as a signal to queue it, and it’ll be pushed onto whichever queue you’re using instead of running it inline.</p>
<pre><code class="language-php">...
class DuplicateTalkCommand extends Command implements ShouldBeQueued
{</code></pre>
<p>This means it’s now even easier than ever to integrate queues into your normal workflow.</p>
<h3>InteractsWithQueue trait</h3>
<p>Adding this trait to your command will give you all of the features on your command that you’re used to in traditional queue commands: <code>$command-&gt;release()</code>, <code>$command-&gt;delete()</code>, <code>$command-&gt;attempts()</code>, etc.</p>
<pre><code class="language-php">...
class DuplicateTalkCommand extends Command implements ShouldBeQueued, InteractsWithQueue
{</code></pre>
<h3>SerializesModels trait</h3>
<p>If you pass an Eloquent model in as a property, like I did in the example above, <em>and</em> you want to queue your commands (instead of just letting them run synchronously), it might cause you some trouble because of how Eloquent models serialize. But there’s a trait you can add to the command named <code>SerializesModels</code> that will smooth out any of those problems. Just use it at the top of your command:</p>
<pre><code class="language-php">...
class DuplicateTalkCommand extends Command implements ShouldBeQueued
{ 
    use SerializesModels;</code></pre>
<h2>The Dispatcher</h2>
<h3>DispatchesCommands trait</h3>
<p>You’ll notice that, in the example above, we were able to just use <code>$this-&gt;dispatch()</code> in the controller. This <em>is</em> controller magic, but it’s magic that’s accessible via a <code>DispatchesCommands</code> trait, which you can apply to anything other than a controller.</p>
<p>So, if you want a service class, for example, to be able to use <code>$this-&gt;dispatch()</code> in its methods, just use the <code>DispatchesCommands</code> trait on your service class and you’re good to go.</p>
<h3>Injecting the bus</h3>
<p>If you’d rather be more direct and clear with your use of the bus, instead of using the trait, you can actually inject the bus into your constructor or method. Just inject <code>Illuminate\Contracts\Bus\Dispatcher</code> and you’ll have a bus ready to dispatch from.</p>
<pre><code class="language-php">    ...
    public function __construct(\Illuminate\Contracts\Bus\Dispatcher $bus)
    {
        $this-&gt;bus = $bus;
    }

    public function doSomething()
    {
        $this-&gt;bus-&gt;dispatch(new Command);
    }</code></pre>
<h3>dispatchFrom(command::class, $request or any arrayAccessible)</h3>
<p>We’ve already seen that <code>$bus-&gt;dispatch(new Command(params...))</code> is the simplest way to dispatch a command. But sometimes the parameter list for a new command can get larger and larger—for example, when your command is handling a Form Request.</p>
<pre><code class="language-php">...
class CreateTalkCommand extends Command
{
    public function __construct($title, $description, $outline, $organizer_notes, $length, $type, $level)
    {</code></pre>
<p>Keeping up the instantiation call for this could get crazy.</p>
<pre><code class="language-php">    $this-&gt;dispatch(new CreateTalkCommand($input['title'], $input['description'], $input['outline'], $input['organizer_notes'], $input['length'], $input['type'], $input['level']));</code></pre>
<p>Hm, take a look at that. Often we’re just passing in properties with the same key, accessed from an array or a Request object, right? Thankfully, there’s a workaround to make that <em>very</em> easy:</p>
<pre><code class="language-php">    $this-&gt;dispatchFrom(‘NameOfCommand’, $objectThatImplementsPHPArrayAccessible);</code></pre>
<p>That’s it! So you could do this:</p>
<pre><code class="language-php">    $this-&gt;dispatchFrom(CreateTalkCommand::class, $input);</code></pre>
<p>... or even this:</p>
<pre><code class="language-php">    public function doSomethingInController(Request $request)
    {
        $this-&gt;dispatchFrom(CreateTalkCommand::class, $request);</code></pre>
<p>Laravel will auto-map the keys on that array or <code>arrayAccessible</code> object to the same property names in your command constructor.</p>
<h2>Self-handling commands</h2>
<p>If you’d rather avoid the hassle of a Command and a CommandHandler, you can make a Command “self-handling”, which just means that there’s only a single handler for it, and that handler is the command itself. Just add a <code>handle()</code> method on that command, and have the command implement the <code>SelfHandling</code> interface:</p>
<pre><code class="language-php">...
class DuplicateTalkCommand extends Command implements SelfHandling
{
...
    public function handle()
    {
        // Do stuff with $this-&gt;talk
    }</code></pre>
<h2>Miscellaneous Notes</h2>
<ul>
<li>Command handlers are resolved out of the IOC container, which means you can inject repositories, service classes, or whatever else into the constructor of your command handler in order to use them in the <code>handle()</code> method.</li>
<li>Almost all of these traits and interfaces live in the <code>Illuminate\Contracts\Bus</code> or <code>Illuminate\Contracts\Queue</code> namespaces. E.g. <code>Illuminate\Contracts\Bus\SelfHandling</code>.</li>
<li>If your command is queued, you don’t have to perform <code>$command-&gt;delete()</code> at the end of your handler. As long as your handler doesn’t throw any exceptions, Laravel will assume it completed properly and will delete the item off the queue.</li>
</ul>
<h2>Whew.</h2>
<p>That was a lot. If I missed anything or wasn’t particularly clear, please let me know—there’s a lot to cover in here, and I’m on vacation so I’m doing it in fits and spurts. But I hope this gives you a good idea of how it’s all going to work—and like I said, <a href="https://laracasts.com/lessons/laravel-5-commands">Taylor’s video on Laracasts</a> covers all this and more, and there’s plenty more to come.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/installing-a-fresh-craft-cms-installation-on-laravel-forge</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/installing-a-fresh-craft-cms-installation-on-laravel-forge"/>
        <title>Installing a fresh Craft CMS Installation on Laravel Forge</title>
        <published>2014-12-29T00:00:00+00:00</published>
        <updated>2014-12-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Whether you’re familiar with Forge but not Craft...</summary>
        <content type="html"><![CDATA[
        <p>Whether you’re familiar with Forge but not Craft, or familiar with Craft but not Forge, it’s worth checking out how simple it is to get a powerful Craft-based site up and running in Laravel Forge.</p>
<h2>1. Get your Forge Account set up and a Server Created</h2>
<p>If you haven’t done this, check out my post on <a href="http://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge">Getting Your First Site Up and Running in Laravel Forge</a>.</p>
<h2>2. Create a new site</h2>
<p>Create a new site with your appropriate domain—for example, <code>craft.mattstauffer.co</code>. Keep the web directory to <code>public</code>—this is the directorys your new site will serve its files from.</p>
<p><img src="/assets/images/content/craft-forge-1.png" alt="Add a new site" /></p>
<p>Once it's done installing, click the little pen icon under &quot;Manage&quot;.</p>
<p><img src="/assets/images/content/craft-forge-2.png" alt="See the site added" /></p>
<h2>3. Install Craft</h2>
<blockquote>
<p>Note: Forge just removed their auto-installers as of 2015-07-09. I'll try to update this guide as soon as possible to make this still work.</p>
</blockquote>
<p>When you spin up a new site on Forge, “Craft CMS” is one of the big options available to you when you configure your new site. Just choose that.</p>
<p><img src="/assets/images/content/craft-forge-3.png" alt="Choose the Craft CMS Installer" /></p>
<p>Pick a database name, and paste in the database password you got in an email from Forge when you first set up this server.</p>
<p><img src="/assets/images/content/craft-forge-4.png" alt="Enter database name and password" /></p>
<h2>4. Finish Installation</h2>
<p>Click the “Finish installation” button. At the time of this writing, it points to <a href="http://your-servers-ip-address/admin/install">http://your-servers-ip-address/admin/install</a>, which won’t work unless this is your only site on this server, so if you see a broken page, just navigate to <a href="http://your-craft-domain.com/admin/install">http://your-craft-domain.com/admin/install</a> (e.g. <a href="http://craft.mattstauffer.co/admin/install">http://craft.mattstauffer.co/admin/install</a>).</p>
<p><img src="/assets/images/content/craft-forge-6.png" alt="Finish installation" /></p>
<p>Now just walk your way through the installation process, and you’ll be ready to go!</p>
<p><img src="/assets/images/content/craft-forge-7.png" alt="Install!" /></p>
<h2>Using Craft</h2>
<p>If you’ve never used Craft before, it’s a really powerful content management system based on <em>channels</em> of content. Imagine if Wordpress were <em>originally designed</em> to be a CMS, instead of being designed as a blogging platform, <em>and</em> imagine the codebase were on top of a modern framework (Yii) instead of legacy procedural code. That’s Craft. (If you've ever used ExpressionEngine, it's like that, minus the drama and the CodeIgniter, run by one of the best plugin devs from the EE community)</p>
<p>Craft has a great <a href="https://buildwithcraft.com/">web site</a>, <a href="http://craftcms.stackexchange.com/">StackExchange</a>, <a href="http://straightupcraft.com/">community site</a>, and the <a href="https://buildwithcraft.com/docs/introduction">documentation</a> is improving every day. To learn a little bit about how great Craft is, check out the <a href="https://buildwithcraft.com/features/new">Features</a> section. </p>
<h2>Using Forge</h2>
<p>If you’ve never used Forge before, it’s a system that’s built to make administering custom VPSes like those you can get from Linode and DigitalOcean simpler and more consistent. You can check out <a href="http://mattstauffer.co/tags/forge">all of my blog posts on Forge</a> to learn a little more about how to use it and the options it provides. Forge also has a <a href="http://forge.besnappy.com/">customer support site</a> with some basic FAQs.</p>
<p>It's called &quot;Laravel Forge&quot; only because it's run by the guy beyond Laravel, Taylor Otwell. But it works fine for non-Laravel projects.</p>
<h2>That’s All, Folks!</h2>
<p>That’s it! You’re now up and running on a custom VPS with a powerful CMS. Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/starting-a-blog-with-sculpin-on-laravel-forge</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/starting-a-blog-with-sculpin-on-laravel-forge"/>
        <title>Starting a blog with Sculpin on Laravel Forge</title>
        <published>2014-12-24T00:00:00+00:00</published>
        <updated>2014-12-24T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I recently switched The Five Minute Geek Show&#039;s we...</summary>
        <content type="html"><![CDATA[
        <p>I recently switched <a href="http://fiveminutegeekshow.com/">The Five Minute Geek Show</a>'s web site over to <a href="http://sculpin.io/">Sculpin</a> for its content management. If you're not familiar, Sculpin is a static site generator, which means I have my content and template in markdown files, which I then run a script over, and the script generates static HTML files, which I then deploy to my server. This means there's no PHP or Ruby or Python or anything serving my files; by the time they hit my web server, they're just flat HTML.</p>
<p>Sculpin itself has pretty great documentation, but I still wanted to provide a run-down of the steps I took to get the Five Minute Geek Show's site running in Sculpin and hosted on Forge.</p>
<h2>Getting Sculpin running</h2>
<p>It's best to check out the <a href="https://sculpin.io/getstarted/">Sculpin Quick Start</a> to get up and running, but in short, here are the commands I ran:</p>
<pre><code class="language-bash">$ curl -O https://download.sculpin.io/sculpin.phar
$ chmod +x sculpin.phar
$ mv sculpin.phar ~/usr/local/bin/sculpin
$ cd ~/Sites
$ git clone https://github.com/sculpin/sculpin-blog-skeleton.git fiveMinuteGeekShowBlog
$ cd fiveMinuteGeekShowBlog
$ sculpin install
$ sculpin generate --watch --server
$ cd source/_posts
  # Edit whichever files
  # Preview in browser at http://localhost:8000/
$ sculpin generate --env=prod
$ rsync -avze 'ssh -p 999' output_prod/ user@example.com:public_html</code></pre>
<p>If you're new to Sculpin or static site generators in general, please read on. If you're not, please skip to the &quot;Sculpin on Forge&quot; section.</p>
<p>Here are the steps listed above, broken down:</p>
<h3>1. Install Sculpin</h3>
<pre><code class="language-bash">$ curl -O https://download.sculpin.io/sculpin.phar
$ chmod +x sculpin.phar
$ mv sculpin.phar ~/usr/local/bin/sculpin</code></pre>
<p>Our first lines are downloading the <code>sculpin.phar</code> executable file to our computer, marking it as executable, and then moving it into our <code>bin</code> directory so it's in our <code>PATH</code> and will be runnable from anywhere on the system (via the Terminal.) It's now installed &quot;globally,&quot; meaning it's not just connected to a particular folder or project.</p>
<p>This step has been run successfully if you can spin up a new Terminal window, navigate anywhere on your computer, and run <code>sculpin</code> and get a positive response. If not, the issue is likely with your <code>PATH</code>.</p>
<h3>2. Download a template</h3>
<pre><code class="language-bash">$ cd ~/Sites
$ git clone https://github.com/sculpin/sculpin-blog-skeleton.git fiveMinuteGeekShowBlog
$ cd fiveMinuteGeekShowBlog</code></pre>
<p>Sculpin can be used for a lot more than blogs, but the <code>sculpin-blog-skeleton</code> makes it really easy to get up and running with a Sculpin-based blog. So, we're now cloning a copy of the of the blog skeleton repository into where we keep our sites (I use <code>~/Sites</code>).</p>
<h3>3. Install Sculpin dependencies locally</h3>
<pre><code class="language-bash">$ sculpin install</code></pre>
<p><code>sculpin install</code> is basically a wrapper around <code>composer install</code>, so we're just installing our dependencies <em>locally</em> to this project.</p>
<h3>4. Generate a watching server</h3>
<pre><code class="language-bash">$ sculpin generate --watch --server</code></pre>
<p><code>sculpin generate</code> scans the <code>source</code> directory and generates static files in <code>output_dev</code> or, if the <code>--env ENVNAMEHERE</code> flag is used, the <code>output_ENVNAMEHERE</code> folder.</p>
<blockquote>
<p>NOTE: Usually you don't ever pass a <code>--env</code> flag. Sculpin defaults to --env=dev, and it automatically serves its previews from the <code>output_dev</code> folder, so you don't have to worry about that. And for prod, usually your publish script will have <code>--env=prod</code> and <code>output_prod</code> baked into them, so you won't have to think about this at all unless you're writing a publish script.</p>
</blockquote>
<p>Adding the <code>--watch</code> flag sets it as a long-running script (like Grunt or Gulp) that watches the filesystem and auto-generates on any changes.</p>
<p>Adding the <code>--server</code> flag spins up a server at <a href="http://localhost:8000/">http://localhost:8000/</a> (you can specify the port with <code>--port=8090</code>) for you to check your changes at.</p>
<h3>5. Edit files</h3>
<p>Now you can edit, add, or delete files from anywhere in the <code>source</code> directory. Blog posts, in this skeleton, go in <code>source/_posts</code>. Check out <code>app/config/sculpin_kernel.yml</code> to set the URL structure for your content types, or <code>app/config/sculpin_site.yml</code> to change site-wide variables. </p>
<p>For a great example (it's the one I used) of how to modify that skeleton for Podcast web sites, check out Adam Wathan's <a href="https://github.com/fullstackradio/fullstackradio">Full-Stack Radio repository</a>.</p>
<h3>6. Sync up</h3>
<pre><code class="language-bash">$ rsync -avze 'ssh -p 999' output_prod/ user@example.com:public_html</code></pre>
<p>The default prescribed method to move your files from your local site to your remote server is <em>not</em> git; you're saving your <em>source</em> in git, but you're not actually hooking up the production web site to your git repo. Rather, you're using this last line to copy the files from the <code>output_prod</code> folder of your local install up to the <code>public_html</code> (or whatever) folder on your production server.</p>
<h4>Breaking down the rsync command</h4>
<p><code>rsync -avze 'ssh -p 999'</code> set the basic context, flags, and permissions for this rsync session.</p>
<p><code>output_prod/</code> shows which directory to copy from.</p>
<p><code>user@example.com</code> is your username and domain for your remote server.</p>
<p><code>public_html</code> is the remote directly it should be uploading to.</p>
<h2>Sculpin on Forge</h2>
<p>If you've ever used Forge before, you know it's absurdly easy to spin up a server and hook it up to a Github repo.</p>
<p>So, I created a new Github repo--this is <em>not</em> the only way to do it, but it is definitely one option--named <a href="https://github.com/FiveMinuteGeekShow/FiveMinuteGeekShowPublic">FiveMinuteGeekShowPublic</a>--and made it empty. I then cloned it to my <code>~/Sites</code> directory.</p>
<p>I spun up a new site on Forge on a Linode box for <code>http://fiveminutegeekshow.com/</code>, told it to pull its data from this new repo, and then set it to &quot;Quick Deploy&quot; (meaning, every time I push to the master branch, it runs a certain script).</p>
<p>I edited the Quick Deploy script to be appropriate for this site:</p>
<pre><code class="language-bash">cd /home/forge/fiveminutegeekshow.com
git pull origin master</code></pre>
<p>Then I was ready to go. I set up a <a href="https://github.com/FiveMinuteGeekShow/fiveMinuteGeekShow/blob/develop/publish.sh">publish script</a> in my <code>FiveMinuteGeekShow</code> repo that generates production HTML, copies the files from Sculpin's <code>output_prod</code> folder over to my local <code>FiveMinuteGeekShowPublic</code> folder, and then git commits and pushes.</p>
<p>I ran <code>chmod +x publish.sh</code>, and now I publish my blog by navigating to the <code>fiveMinuteGeekShow</code> directory and typing <code>./publish.sh</code>.</p>
<h2>Cleaner publishing</h2>
<p>As you can tell, my publish script relies on a certain directory structure on my local machine, which is quick and easy but also a bit hacky.</p>
<p>You can see in Sculpin's default documentation that you can also just use <code>rsync</code> to copy the files directly up to your server. Check out the notes above of how your rsync command is actually structured.</p>
<p>You could do this with Forge. Just don't sync a Github repo, and use the credentials you were emailed when you first spun up this Forge server to set up the rsync to copy your <code>output_prod</code> folder up to the remote server. Same deal, and it doesn't rely on Git.</p>
<h2>404 and nginx config</h2>
<p>I have to thank <a href="http://twitter.com/adamwathan">Adam Wathan</a> for this one. I tried to get a custom 404 page by setting <code>error_page 404 /404/index.html</code> in my Forge nginx configuration and discovered that it wouldn't work.</p>
<p>Adam helped me realize that Forge's default references to all of the <code>.php</code> files would override it ever hitting the 404 page, so he helped me clean up my nginx config. It ended up looking like this:</p>
<pre><code>server {
    listen 80;
    server_name fiveminutegeekshow.com;
    root /home/forge/fiveminutegeekshow.com;
    error_page 404 /404/index.html;

    # FORGE SSL (DO NOT REMOVE!)
    # ssl_certificate;
    # ssl_certificate_key;

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

    index index.html index.htm;

    charset utf-8;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    access_log off;
    error_log  /var/log/nginx/fiveminutegeekshow.com-error.log error;

    location ~ /\.ht {
        deny all;
    }
}</code></pre>
<p>Now, any time someone visits a <a href="http://fiveminutegeekshow.com/fakeRouteFourOhFourBroooooo">bad route</a>, they'll get the <a href="https://github.com/FiveMinuteGeekShow/fiveMinuteGeekShow/blob/develop/source/404.html">404 page</a>.</p>
<h2>Conch shell lusion</h2>
<p>As you can see, wrapping your head around Sculpin--and static site generators in general--can take a minute, but once you get it, it's actually a very simple process, and hosting it on Forge is surprisingly simple.</p>
<p>Using Github pages or Heroku are also great options, but if you're already in the Forge space--or if you want to eventually add other functionality to the site other than just the static files being generated by Sculpin--Sculpin + Forge is a great combination.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/podcasts-and-vlogs-oh-my</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/podcasts-and-vlogs-oh-my"/>
        <title>Podcasts and Vlogs, oh my!</title>
        <published>2014-12-19T00:00:00+00:00</published>
        <updated>2014-12-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">It seems I&#039;ve been doing a lot of talking around t...</summary>
        <content type="html"><![CDATA[
        <p>It seems I've been doing a lot of talking around town lately, so I wanted to do a quick roundup.</p>
<h2>Bootstrapped</h2>
<p>On October 20th, I had the pleasure to join two of my good friends, Ian Landsman &amp; Andrey Butov, on their excellent Bootstrapped podcast. We talked about running a SaaS and a consultancy at the same time, why I'm so happy, Laravel, and a ton more.</p>
<p><a href="http://bootstrapped.fm/bootstrapped-episode-51-special-guest-matt-stauffer/">Bootstrapped, Episode 51, &quot;Special Guest: Matt Stauffer&quot;</a></p>
<h2>Full-Stack Radio</h2>
<p>I was honored to be the first guest on my friend Adam Wathan's Full Stack Radio podcast. We talked CSS, OOCSS, BEM, SMACSS, preprocessors, CSS architecture, and more.</p>
<p><a href="http://fullstackradio.com/episodes/1/">Episode 1: CSS Semantics with Matt Stauffer</a></p>
<h2>The Five-Minute Geek Show</h2>
<p>I started recording 5-minute YouTube videos talking about what I'm thinking about in dev, and it's turned into a podcast/videolog series. There's now 5 minutes of content in each, with intros and outros, so it turns out a bit longer than 5 minutes total.</p>
<ul>
<li><a href="http://fiveminutegeekshow.com">The Five-Minute Geek Show Web Site</a></li>
<li><a href="http://www.youtube.com/playlist?list=PLgJIx0-UaB9Q42Gthfg__0iynLVqcbXOQ">YouTube Channel</a></li>
<li><a href="https://itunes.apple.com/us/podcast/the-five-minute-geek-show/id952727637">iTunes for the podcast</a></li>
<li><a href="http://feeds.feedburner.com/FiveMinuteGeekShow">Audio RSS feed</a></li>
<li><a href="http://twitter.com/5minutegeekshow">Twitter @5minutegeekshow</a></li>
</ul>
<p>It's been a ton of fun, and I hope I continue to have the opportunity to share and teach and goof around.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-event-scheduling</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-event-scheduling"/>
        <title>Laravel 5.0 - Event Scheduling</title>
        <published>2014-11-20T00:00:00+00:00</published>
        <updated>2014-11-20T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Eric Barnes has a longer write up on this, so I&#039;ll...</summary>
        <content type="html"><![CDATA[
        <p>Eric Barnes has a longer write up on this, so I'll just keep it short:</p>
<p>Laravel 5.0 is introducing a pretty incredible cron-style scheduler (similar to <a href="https://github.com/indatus/dispatcher">Indatus' Dispatcher</a>) built into the core. Just point a cron job that's scheduled once a minute at <code>artisan schedule:run</code> and you're good to go.</p>
<pre><code class="language-bash">* * * * * php /path/to/artisan schedule:run 1&gt;&gt; /dev/null 2&gt;&amp;1</code></pre>
<p>For example, you can now bind the following event to clear your auth reminders daily:</p>
<pre><code class="language-php">$schedule
    -&gt;command('auth:clear-reminders')
    -&gt;daily()
    -&gt;sendOutputTo($logPath)
    -&gt;emailOutputTo('me@me.com');</code></pre>
<p>You can use <code>commmand()</code> to call artisan commands, <code>call</code> to call methods or functions, or <code>terminal()</code> to run command line scripts:</p>
<pre><code class="language-php">$schedule-&gt;call('YourClass@someMethod')-&gt;twiceDaily();</code></pre>
<pre><code class="language-php">$schedule-&gt;call(function() {
    // Do stuff
})-&gt;everyFiveMinutes();</code></pre>
<pre><code class="language-php">$schedule-&gt;terminal('cp oldThing newThing')-&gt;dailyAt('8:00');</code></pre>
<p>You can also use a callback to decide when something will or won't run, using <code>when()</code> or <code>skip()</code>:</p>
<pre><code class="language-php">$schedule
    -&gt;call('Mailer@BusinessDayMailer')
    -&gt;weekdays()
    -&gt;skip(function(TypeHintedDeciderClass $decider)
    {
        return $decider-&gt;isHoliday();
    }
);</code></pre>
<p>This is just a quick introduction, though; check out Eric's post for a fuller rundown: <a href="http://laravel-news.com/2014/11/laravel-5-scheduler/">Laravel 5 Scheduler on Laravel-News</a></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/introducing-laravel-homestead-2.0</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/introducing-laravel-homestead-2.0"/>
        <title>Introducing Laravel Homestead 2.0</title>
        <published>2014-11-17T00:00:00+00:00</published>
        <updated>2014-11-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">When Laravel Homestead first came out, it was a Gi...</summary>
        <content type="html"><![CDATA[
        <p>When <a href="http://laravel.com/docs/4.2/homestead">Laravel Homestead</a> first came out, it was a Github repository that included a base <code>Homestead.yaml</code> by default. There was no prescribed place to install it, no global commands for accessing the box, and any time you actually customized your <code>Homestead.yaml</code> file you instantly dirtied your Homestead Github clone, making upgrading difficult.</p>
<p>You can guess where I’m going with this. All of these things are problems no more. The latest version of the Homestead ecosystem has just been released, and it’s moved Homestead into a globally installable Composer package which copies <code>Homestead.yaml</code> (and any other user-editable files) into <code>~/.homestead</code> on your machine. This way there’s a clear future upgrade path; you get instant global access; and it’s clear where your config file should live.</p>
<h2>Installing fresh</h2>
<p>As always, the <a href="http://laravel.com/docs/4.2/homestead">Laravel docs</a> are the best place to go for the fullest installation instructions. But here’s the one section that’s most different from the past, copied directly from the docs:</p>
<blockquote>
<h3>Installing Homestead</h3>
<p>Once the box has been added to your Vagrant installation, you are ready to install the Homestead CLI tool using the Composer global command:</p>
<pre><code class="language-bash">composer global require "laravel/homestead=~2.0"</code></pre>
<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>homestead</code> executable is found when you run the <code>homestead</code> command in your terminal.</p>
<p>Once you have installed the Homestead CLI tool, run the init command to create the <code>Homestead.yaml</code> configuration file:</p>
<pre><code class="language-bash">homestead init</code></pre>
<p>The <code>Homestead.yaml</code> file will be placed in the <code>~/.homestead</code> directory. If you're using a Mac or Linux system, you may edit <code>Homestead.yaml</code> file by running the homestead edit command in your terminal:</p>
<pre><code class="language-bash">homestead edit</code></pre>
</blockquote>
<h2>Available commands</h2>
<p>When you look at the list of available commands, it’ll look a lot like what you had available through vagrant:</p>
<ul>
<li>Destroy</li>
<li>Edit</li>
<li>Halt</li>
<li>Init</li>
<li>Resume</li>
<li>Up</li>
<li>Update</li>
<li>Ssh</li>
<li>Status</li>
<li>Suspend</li>
</ul>
<p>What’s great now is that you can run any of these from anywhere on your machine by simply typing <code>homestead COMMAND</code>.</p>
<p>You’ll notice a few unique commands, however, that aren’t just maps to the same Vagrant command: </p>
<h3>Homestead edit</h3>
<p>Like you read in the docs, Homestead edit (on Mac and Linux machines) will automatically open up your <code>Homestead.yaml</code> file in your system’s default editor.</p>
<h3>Homestead init</h3>
<p>Homestead init creates the <code>~/.homestead</code> directory and places a skeleton new <code>Homestead.yaml</code> file in it, as well as <code>after.sh</code> and <code>aliases</code>, two additional files that allow you to customize your provisioning.</p>
<h3>Homestead update</h3>
<p>Homestead update runs <code>vagrant box update</code>, so you can update the Homestead machine image—for example, when Taylor adds PHP 5.7, this will be the way to upgrade your Homestead image.</p>
<h2>New &quot;database&quot; config</h2>
<p>In addition to <code>folders</code> and <code>sites</code> there’s now a <code>databases</code> option in <code>Homestead.yaml</code> that allows you to specify databases for the vagrant box to create when it provisions.</p>
<h2>New &quot;after.sh&quot; file</h2>
<p>When you get into your new <code>~/.homestead</code> directory, you’ll see two familiar files—<code>Homestead.yaml</code> and <code>aliases</code>—and one new one, <code>after.sh</code>.</p>
<pre><code class="language-bash">.
..
Homestead.yaml
after.sh
aliases</code></pre>
<p>From the internal <code>after.sh</code> docs:</p>
<pre><code>If you would like to do some extra provisioning you may
add any commands you wish to this file and they will
be run after the Homestead machine is provisioned.</code></pre>
<h2>The upgrade path</h2>
<blockquote>
<p>IMPORTANT: At the time of writing this, I don't know how to upgrade to the new version of Homestead without it just creating a new Homestead box from scratch. You won't <em>lose</em> your old box (you can always access the old way), but your new box will be fresh, not imported from the old one. Do you know how? Please let me know on Twitter: <a href="https://twitter.com/stauffermatt">@stauffermatt</a></p>
</blockquote>
<p>Most of you reading this already use Homestead. So, what does the upgrade path look like?</p>
<p>For starters, install it globally and make sure the Composer bin is in your PATH (like above).</p>
<p>Now, run <code>homestead init</code> anywhere in your terminal. You should see the following output:</p>
<pre><code>○ homestead init
Creating Homestead.yaml file... ✔
Homestead.yaml file created at: /Users/mattstauffer/.homestead/Homestead.yaml</code></pre>
<p>If you check out the new <code>./homestead</code> directory, you’ll see your skeleton config file. Now just copy over your old <code>aliases</code> file and <code>Homestead.yaml</code> file (e.g. <code>cp ~/OldHomesteadDirectory/Homestead.yaml ~/.homestead; cp ~/OldHomesteadDirectory.aliases ~/.homestead</code>).
Now add a chunk at the bottom of your <code>Homestead.yaml</code> file that looks like this:</p>
<pre><code>databases:
    - homestead</code></pre>
<p>Now, you should be able to run <code>homestead up</code> from anywhere and see the first provision. Note, like I wrote above: This is creating a new Homestead box from scratch (using your <code>Homestead.yaml</code> file), <em>not</em> importing your old one. So you'll have to re-migrate and -seed your databases, etc.</p>
<blockquote>
<p>Caveats: The first time I ran <code>homestead up</code> with the new version, I got a lot of errors. I upgraded my Homestead box (<code>homestead update</code>), and the next time I provisioned I didn't get any errors. I don't know whether the fix was just running it twice, or upgrading the machine image, but either way it all runs fine now.</p>
</blockquote>
<h1>Concleezy</h1>
<p>That's it. Migrating might be a bit of a pain (although this might be a motivation to create better migrations and seeds ;) ), but this is a much cleaner system with a much clearer upgrade path. Much rejoicing!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/using-php-cs-fixer-to-fix-up-your-php-code</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/using-php-cs-fixer-to-fix-up-your-php-code"/>
        <title>Using PHP-CS-Fixer to fix up your PHP code</title>
        <published>2014-11-12T00:00:00+00:00</published>
        <updated>2014-11-12T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Every time someone mentions Confomo, I’m inspire...</summary>
        <content type="html"><![CDATA[
        <p>Every time someone mentions <a href="https://github.com/mattstauffer/confomo">Confomo</a>, I’m inspired to work on it for a day or two. And then I let it slide. And then I forget about it for weeks.</p>
<p>This time around, I decided to clean it up a bit according to my most recent coding standards. I’ve been on a PSR-2 kick lately, so I figured why not finally try out fabpot’s <a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer">PHP-CS-Fixer</a>.</p>
<blockquote>
<p>Note: I wrote this post Friday, and was just getting around to editing and posting it today--and then I saw that <a href="http://fabien.potencier.org/article/76/php-cs-fixer-finally-reaches-version-1-0">it reached 1.0 today</a>. Great timing!</p>
</blockquote>
<h2>Installing PHP-CS-Fixer</h2>
<p>You can use Composer’s <code>global require</code> to install php-cs-fixer:</p>
<pre><code class="language-bash">$ composer global require fabpot/php-cs-fixer @stable</code></pre>
<p>Make sure your Composer vendor bin is in your path (in <code>.bash_profile</code> or <code>.zsh_profile</code> or whatever):</p>
<pre><code class="language-bash">export PATH="$PATH:$HOME/.composer/vendor/bin"</code></pre>
<p>If you’re using a Mac, you can also just install it with Homebrew:</p>
<pre><code class="language-bash">$ brew tap josegonzalez/homebrew-php
$ brew install php-cs-fixer</code></pre>
<p>Check out the <a href="https://github.com/fabpot/PHP-CS-Fixer">Github page</a> for full installation instructions for these and other methods.</p>
<h2>Running PHP-CS-Fixer</h2>
<p>By default, it runs “all PSR-2 fixers and some additional ones.” You can toggle the level you want to run with the <code>--level</code> flag, which I’ll be setting to <code>psr2</code> so that the “additional” checks, which are targeted at Symfony and go above-and-beyond PSR2, don’t throw me off. (It runs the entire stack by default, which is called level “symfony” and includes things like “Align equals signs in subsequent lines”).</p>
<p>Let’s try it out! First we’ll do a non-changing dry run to see which files it’s going to change:</p>
<pre><code class="language-bash">$ cd Sites/confomo
$ php-cs-fixer fix ./ --level=psr2 --dry-run</code></pre>
<p>... and the result:</p>
<pre><code>   1) app/commands/GrabTwitterProfilePicsCommand.php
   2) app/config/app.php
   3) app/config/auth.php
   (... and more, trimmed for blog post)
Fixed all files in 14.968 seconds, 5.250 MB memory used</code></pre>
<p>Looks like about everything. Note that this doesn't show me <em>what</em> will change, but just a list of <em>which files</em> will change. OK, let’s go:</p>
<pre><code class="language-bash">$ php-cs-fixer fix ./ --level=psr2</code></pre>
<p>Ahh… the sweet, sweet sound of thousands of tabs converting to spaces. Well, most of them. There are quite a few file types and structures that PHP-CS-Fixer had a little trouble parsing, so I had to still go in and do quite a bit of manual cleanup afterwards--but it got the job started for me.</p>
<h2>Saving configuration</h2>
<p>Like every good tool, PHP-CS-Fixer has a dotfile for configuration. It's going to be a file named <code>.php_cs</code> that's actually a PHP file, an instance of the <code>SymfonyCSConfigInterface</code>. Check out this example from the docs:</p>
<pre><code class="language-php">&lt;?php

$finder = Symfony\CS\Finder\DefaultFinder::create()
    -&gt;exclude('somedir')
    -&gt;in(__DIR__)
;

return Symfony\CS\Config\Config::create()
    -&gt;fixers(array('indentation', 'elseif'))
    -&gt;finder($finder)
;</code></pre>
<p>You can configure the levels, the &quot;fixers&quot;, the files, and the directories you want to analyze through that file.</p>
<h2>Conclude</h2>
<p>That’s it!</p>
<p>Choose your favorite method of installing, choose your level of sniffing, do a dry run to see what files it’ll fix, run it, rejoice, and read the docs for more configuration options.</p>
<p>Questions? Comments? Hit me up on Twitter at <a href="https://twitter.com/stauffermatt">@stauffermatt</a>.</p>
<h2>Postscript</h2>
<p>I was curious about how much of PSR-2 really got implemented as a result of PHP-CS-Fixer's PSR-2 toggle. I could've read through the checks, but instead I made the ugliest, most non-psr-1 and non-psr-2 compliant script I could, and ran it through it.</p>
<pre><code class="language-php">&lt;?php

use Exception, Awesome;
namespace Awesome\Stuff;
class bad_class
    extends \Exception{
    const camelCase = 'abc';
    public $awesome = 'unvisible'; public $_great = 'fabulous';

    function Do_something_snaked_cased(){
        // This is one really frigging long line. I wonder if PHP-CS-Fixer will trim this really frigging long line? It says no hard limit so I think it won't.

        if( isset ($abc) || TRUE )
        {
            // do stuff

        }

    }

    final static public function woop() {}

    function _invisible( $stuff = [] , $other_stuff ) {
        switch($stuff)
        {
        case 0:
        echo 'stuff';
        break;
        }
    }

}

echo "echo";

?&gt;</code></pre>
<p>I ran it and got the following:</p>
<pre><code class="language-php">&lt;?php

use Exception;
use Awesome;
namespace Awesome\Stuff;

class test
    extends \Exception
{
    const camelCase = 'abc';
    public $awesome = 'unvisible';
    public $_great = 'fabulous';

    public function Do_something_snaked_cased()
    {
        // This is one really frigging long line. I wonder if PHP-CS-Fixer will trim this really frigging long line? It says no hard limit so I think it won't.

        if (isset($abc) || TRUE) {
            // do stuff
        }
    }

    final public static function woop()
    {
    }

    public function _invisible($stuff = [], $other_stuff)
    {
        switch ($stuff) {
        case 0:
        echo 'stuff';
        break;
        }
    }
}

echo "echo";</code></pre>
<p>As you can see, it cleaned up my indendation (original was tabs, although it seems the code embedder for my blog is converting them to spaces on display), my use block, my line spacing, my brace spacing, the spaces around parentheses, and the closing <code>?&gt;</code>. It <em>didn't</em> help with case (camel v upper v studly v snake), leading underscores, switch indendation, paremeter orders, capitalization of TRUE/FALSE/NULL, split line class definition, and probably a few other I didn't notice.</p>
<p>It makes sense: It can't make fundamental changes to the properties of your app. It's not smart enough to know, for example, where <code>const camelCase</code> is used, so it can't feel comfortable changing it. So PHP-CS-Fixer <em>changes the things it can change without breaking your code</em>, which is great, but leaves anything else alone--meaning it's a good first step, but you still have to be running your own sniffers at the same time.</p>
<p>For a real answer and not this bogus mythbusters stuff I'm doing, check out <a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer">the Github page</a> for a listing of all the fixers PHP-CS-Fixer makes available.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-environment-detection-and-environment-variables</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-5.0-environment-detection-and-environment-variables"/>
        <title>Laravel 5.0 - Environment Detection &amp; Environment Variables</title>
        <published>2014-10-16T00:00:00+00:00</published>
        <updated>2014-10-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve followed my blog for a while, you&#039;ve pro...</summary>
        <content type="html"><![CDATA[
        <p>If you've followed my blog for a while, you've probably seen me struggle with Laravel's environment detection--especially regarding using environment variables. (<a href="http://mattstauffer.co/blog/laravel-forge-using-environment-variables-for-environment-detection">Example</a>)</p>
<p>Thankfully, Laravel 5.0 vastly simplifies environment detection. In 4, you could have multiple environment files based on the environment name (<code>.env.php</code>, <code>.env.local.php</code>, etc.). In all honesty, I never used the environment-specific aspect; I imagine you could theoretically use it to commit <em>all</em> of your environment files to your repo. But since we don't commit <em>any</em> of our environment files, it was a useless distinction--<em>and</em> it forced the delayed loading of the environment file, because it couldn't be loaded until <em>after</em> the environment was detected.</p>
<h2>Introducing PHP dotenv</h2>
<p>Well, NO MORE. Laravel 5.0 is using <a href="https://github.com/vlucas/phpdotenv">PHP dotenv</a>, a proven 3rd-party library that loads from a single <code>.env</code> file.</p>
<p>Every Laravel app now ships with a default <code>.env.example</code> file, which at the moment looks like this:</p>
<pre><code>APP_ENV=local
APP_KEY=SomeRandomString
DB_USERNAME=homestead
DB_PASSWORD=homestead</code></pre>
<p>In order to use this file, just copy it and name the copy <code>.env</code>. Why aren't we renaming the original? You'll see in a second.</p>
<p>Now, you can edit your <code>APP_ENV</code>--which, as you can tell from the default, is the primary way for us to set the application environment name. Check out the newer, simpler environment detection in <code>bootstrap/environment.php</code>:</p>
<pre><code class="language-php">$env = $app-&gt;detectEnvironment(function()
{
    return getenv('APP_ENV') ?: 'production';
});</code></pre>
<p>That's a beautiful thing! </p>
<h2>Customizing the example file</h2>
<p>So, why are we copying the <code>.env.example</code> instead of just renaming it? Well, imagine your app for a second. Imagine it has a consistent need for 10 environment variables to be defined. Sure, you'll have reasonable fallbacks if they're not defined, but it's still a better deal if you have them all.</p>
<p>Where are you going to store the directions for which variables each app's <code>.env</code> file should set? You could store it in the readme, sure... or you could just update the <code>.env.example</code> file to be the <em>directions for which variables each install of your app should have.</em></p>
<p>That's it! Need 10 variables for each install? Add those 10 variables to your <code>.env.example</code> file with sensible (or silly) defaults. This file <em>will</em> get committed to your source control, and then each new install can start out by running <code>cp .env.example .env</code> and then customizing <code>.env</code>.</p>
<h2>Referencing previous variables</h2>
<p>You can learn more from the PHP dotenv docs, but here's a clever note: You can reference environment variables in later environment variables. Check out this example from their readme:</p>
<pre><code>BASE_DIR=/var/webroot/project-root
CACHE_DIR=$BASE_DIR/cache
LOG_DIR=$BASE_DIR/logs</code></pre>
<p>That's clever.</p>
<h2>Requiring variables</h2>
<p>What if you want to ensure all the required variables are set <em>up front</em>, rather than waiting for the app to break when it accesses them?</p>
<pre><code class="language-php">Dotenv::required('DB_USERNAME');
// or
Dotenv::required(['DB_HOST', 'DB_NAME', 'DB_USERNAME', 'DB_PASSWORD']);</code></pre>
<p>Done. If it's not defined, it'll throw a <code>RuntimeException</code>.</p>
<h2>Conchl</h2>
<p>Simple, easy, powerful. And this will completely invalidate all of my blog posts, workarounds, and complaints about environment detection in Laravel. Now it's simple to define your environment name and your environment variables in a single, consistent, predictable manner.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-event-annotations</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-event-annotations"/>
        <title>Laravel 5.0 - Event Annotations (removed)</title>
        <published>2014-10-10T00:00:00+00:00</published>
        <updated>2014-10-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Note: Event Annotations were eventually removed f...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>Note: Event Annotations were eventually <a href="https://github.com/laravel/framework/commit/4d9f92ef77b3610a05f71110f539daff06e9081d">removed from core</a>, and separated to <a href="https://github.com/LaravelCollective/annotations">a package maintained by the Laravel Community</a>. The package should function the same as the documentation here, other than that it requires binding a custom service provider. Feedback can go to the Github issues for the project or to @artisangoose in the <a href="http://larachat.co">Larachat slack</a>.</p>
</blockquote>
<p>In 5.0, Laravel is moving more and more of the top-level, bootstrapped, procedural bindings and definitions into a more Object-Oriented, separation-of-concerns-minded structure. Filters are now objects, controllers are now namespaced, the PSR-4-loaded application logic is now separate from the framework configuration, and more.</p>
<p>We saw in the <a href="http://mattstauffer.co/blog/laravel-5.0-route-annotations">last post</a> that annotations are one of the ways Laravel 5.0 is making this change. Where routes used to be bound one after another in routes.php, they now can be bound with annotations on the controller class and method definitions.</p>
<h2>Setting the stage</h2>
<p>Another part of Laravel that has traditionally been bound with a list of calls one after another is event listeners, and this is the next target of the annotation syntax.</p>
<p>Consider the following code:</p>
<pre><code class="language-php">Event::listen('user.signup', function($user)
{
    $intercom = App::make('intercom');
    $intercom-&gt;addUser($user);
});</code></pre>
<p>Somewhere in your code—in a service provider, maybe, or maybe just in a global file somewhere—you've bound a listener (the closure above) to the &quot;user.signup&quot; event.</p>
<p>Of course, you're probably noticing that all that closure does is call a single method—so we could refactor it to this:</p>
<pre><code class="language-php">Event::listen('user.signup', 'Intercom@addUser');</code></pre>
<h2>Introducing Event Annotations</h2>
<p>Now, let's drop the need for the binding entirely, and replace it with an annotation.</p>
<pre><code class="language-php">&lt;?php namespace App;

class Intercom
{
    /**
     * @Hears("user.signup")
     */
    public function addUser(User $user)
    {
        return $this-&gt;api_wrapper-&gt;sendSomeAddThing(
            $user-&gt;email,
            $user-&gt;name
        );
    }
}</code></pre>
<p>As you can see, the <code>@Hears</code> annotation can take a string event name, but it can also take an array of event names (in annotations, arrays are surrounded by {} instead of []). </p>
<p>You also have to add the name of your classes to the <code>$scan</code> property on the <code>EventServiceProvider</code>. So, open up <code>App/Providers/EventServiceProvider.php</code>, find the <code>$scan</code> array, and update it:</p>
<pre><code class="language-php">&lt;?php
...
    protected $scan = [
        'App\Intercom'
    ];</code></pre>
<p>Now, run <code>artisan event:scan</code> and you'll get a file named <code>storage/framework/events.scanned.php</code>, with the following contents:</p>
<pre><code class="language-php">&lt;?php

$events-&gt;listen(array (
  0 =&gt; 'user.signup',
), 'App\Intercom@addUser');</code></pre>
<p>Instantly bound.</p>
<h2>Conclusion</h2>
<p>There are positives and negatives to working with your event system this way.</p>
<p><strong>The primary negative I see</strong> is that you could look at this annotation as being framework-specific; if that's the case, you're now placing framework-specific code directly into your domain. If you imagine this Intercom class being something you're passing around between several sites, its binding may be specific to this site--in which case you'd be better off using the classic style of binding. However, that's not always the case.</p>
<p>Note that this negative is <em>different</em> from the same situation in Route Annotations, which are only being applied to Controllers--which are not domain objects.</p>
<p><strong>The positives I can see</strong> at first glance are that first, you're defining the method's act of listening on the method itself, rather than elsewhere; and second, that you're defining the listener in a way that it can be programmatically accessed (meaning you could, at any point, replace <code>artisan event:scan</code> with a program of your own devising that outputs something <em>other</em> than a Laravel <code>events.scanned</code> file). There are likely smarter folks than me that'll weigh in on this.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-middleware-filter-style</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-middleware-filter-style"/>
        <title>Laravel 5.0 - Middleware (Filter-style)</title>
        <published>2014-10-10T00:00:00+00:00</published>
        <updated>2014-10-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve been following along with my previous bl...</summary>
        <content type="html"><![CDATA[
        <p>If you've been following along with my previous blog posts about Laravel 5.0, you may have noticed that route filters were first moved to be their own directory and class structure, and then eventually they mysteriously disappeared. You may have even noticed that references to Middleware showed up in their place.</p>
<p>Adding custom middleware to your Laravel app has actually been around for a while. For a great introduction to middleware, and how middleware worked in Laravel 4.1, check out Chris Fidao's <a href="http://fideloper.com/laravel-http-middleware">HTTP Middleware in Laravel 4.1</a>.</p>
<blockquote>
<p>NOTE: Filters still exist in the codebase, so you <em>can</em> still use them, but middleware is becoming the preferred practice and way of thinking about decorating your routes.</p>
</blockquote>
<h2>What is middleware?</h2>
<p>Middleware is actually a little hard. Take a look at the graphic below, from <a href="http://stackphp.com/">StackPHP</a>. If your application--your routing, your controllers, your business logic--is the green circle in the center, you can see that the user's request passes through several middleware layers, hits your app, and then passes out through more middleware layers. Any given middleware can operate before the application logic, after it, or both.</p>
<p>So, <strong>middleware is a series of wrappers around your application that decorate the requests and the responses in a way that isn't a part of your application logic.</strong></p>
<p><img src="http://stackphp.com/img/onion.png" alt="StackPHP Onion" />
(image attribution <a href="http://stackphp.com/">StackPHP.com</a>)</p>
<p>The way this works is that middleware implements a decorator pattern: it takes the request, does something, and returns another request object to the next layer of the stack.</p>
<p>Laravel uses middleware by default to handle encrypting/decrypting and queueing cookies, and reading and writing sessions, but you can also use it to add any sort of layer you'd like to your request/response cycle: rate limiting, custom request parsing, and much more.</p>
<h2>How do I write middleware?</h2>
<p><code>artisan make:middleware MyMiddleware</code></p>
<p>This will generate a simple middleware file:</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Middleware;

use Closure;
use Illuminate\Contracts\Routing\Middleware;

class MyMiddleware implements Middleware {

    /**
    * Handle an incoming request.
    *
    * @param  \Illuminate\Http\Request  $request
    * @param  \Closure  $next
    * @return mixed
    */
    public function handle($request, Closure $next)
    {
        //
    }

}</code></pre>
<p>As  you can see, the foundation of any middleware is the <code>handle</code> method, which takes two parameters: <code>$request</code>, which is an Illuminate Request object, and <code>$next</code>, which is a Closure (anonymous function) that runs the request through the rest of the middleware stack.</p>
<p>Remember my absurd example of a <a href="http://mattstauffer.co/blog/laravel-5.0-validateswhenresolved">ValidatesWhenResolved object that blocks odd request ports</a>? Well, we're bringing it back, Middleware-style.</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Middleware;

use Closure;
use Illuminate\Contracts\Routing\Middleware;

class MyMiddleware implements Middleware {

    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        // Test for an even vs. odd remote port
        if (($request-&gt;server-&gt;get('REMOTE_PORT') / 2) % 2 &gt; 0)
        {
            throw new \Exception("WE DON'T LIKE ODD REMOTE PORTS");
        }

        return $next($request);
    }

}</code></pre>
<h2>How do I use middleware?</h2>
<p>There are two primary ways to bind middleware in Laravel 5. Both start with <code>App\Http\Kernel</code>.</p>
<p>You'll notice that this new <code>Kernel</code> class has two properties: <code>$middleware</code> and <code>$routeMiddleware</code>. Both are arrays of middleware; the middlewares in <code>$middleware</code> run on every request and the middlewares in <code>$routeMiddleware</code> have to be enabled.</p>
<p>At the time of this writing, five middlewares run by default:</p>
<pre><code class="language-php">    protected $middleware = [
        'Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode',
        'Illuminate\Cookie\Middleware\EncryptCookies',
        'Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse',
        'Illuminate\Session\Middleware\StartSession',
        'Illuminate\View\Middleware\ShareErrorsFromSession',
        'Illuminate\Foundation\Http\Middleware\VerifyCsrfToken',
    ];</code></pre>
<p>and three are available as optional:</p>
<pre><code class="language-php">    protected $routeMiddleware = [
        'auth' = 'App\Http\Middleware\Authenticate',
        'auth.basic' =&gt; 'Illuminate\Auth\Middleware\AuthenticateWithBasicAuth',
        'guest' =&gt; 'App\Http\Middleware\RedirectIfAuthenticated',
    ];</code></pre>
<p>As you can see, the optional routes that are available by default are the same as the filters that were optional by default, except that--importantly--CSRF protection has now been enabled by default for <em>al</em> routes..</p>
<h3>Running middleware on every request</h3>
<p>So, let's start by running our middleware on every request. Simple add it to <code>$middleware</code>:</p>
<pre><code class="language-php">    protected $middleware = [
        'App\Http\Middleware\MyMiddleware',
        'Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode',
        'Illuminate\Cookie\Middleware\EncryptCookies',
        'Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse',
        'Illuminate\Session\Middleware\StartSession',
        'Illuminate\View\Middleware\ShareErrorsFromSession',
        'Illuminate\Foundation\Http\Middleware\VerifyCsrfToken',
    ];</code></pre>
<p>... and now it'll run on every request.</p>
<h3>Running middleware on specific routes</h3>
<p>OK, now let's move our custom middleware to the optional stack, with a key:</p>
<pre><code class="language-php">    protected $routeMiddleware = [
        'auth' = 'App\Http\Middleware\Authenticate',
        'auth.basic' =&gt; 'Illuminate\Auth\Middleware\AuthenticateWithBasicAuth',
        'guest' =&gt; 'App\Http\Middleware\RedirectIfAuthenticated',
        'absurd' =&gt; 'App\Http\Middleware\MyMiddleware',
    ];</code></pre>
<p>And now we can apply it using the <code>$this-&gt;middleware()</code> method on the base <code>Controller</code> or in <code>routes.php</code>.</p>
<h4>Middleware route annotation (removed)</h4>
<blockquote>
<p>Note: Annotations are no longer a part of Laravel 5 core, so middleware route annotation is no longer supported without using an external package.</p>
</blockquote>
<p>You can annotate a controller or a route to use specific middleware:</p>
<pre><code class="language-php">/**
 * @Resource("foobar/photos")
 * @Middleware("auth")
 * @Middleware("absurd", except={"update"})
 * @Middleware("csrf", only={"index"})
 */
class FoobarPhotosController
{}</code></pre>
<p>You can annotate a single controller method:</p>
<pre><code class="language-php">/**
 * @Middleware("auth.basic")
 */
public function index() {}</code></pre>
<h4>$this-&gt;middleware()</h4>
<p>Or, you can use the <code>$this-&gt;middleware()</code> method on any controller (or its methods) if the controller extends the base controller:</p>
<pre><code class="language-php">...
use Illuminate\Routing\Controller;

class AwesomeController extends Controller {

    public function __construct()
    {
        $this-&gt;middleware('csrf');
        $this-&gt;middleware('auth', ['only' =&gt; 'update'])
    }

}</code></pre>
<h4>Adding middleware in routes.php</h4>
<p>You can also assign middleware to run on a route in <code>routes.php</code>:</p>
<pre><code class="language-php">// Routes.php

// Single route
$router-&gt;get("/awesome/sauce", "AwesomeController@sauce", ['middleware' =&gt; 'auth']);

// Route group
$router-&gt;group(['middleware' =&gt; 'auth'], function() {
    // lots of routes that require auth middleware
});</code></pre>
<h2>How do I implement <em>before</em> vs. <em>after</em> filters in middleware?</h2>
<p>It took me a minute to follow this, but Taylor pointed out that the difference between a &quot;before&quot; middleware and an &quot;after&quot; middleware is based on whether the middleware's action happens <em>before</em> or after the <em>request</em> it's passed:</p>
<pre><code class="language-php">...
class BeforeMiddleware implements Middleware {

    public function handle($request, Closure $next)
    {
        // Do Stuff
        return $next($request);
    }

}</code></pre>
<pre><code class="language-php">...
class AfterMiddleware implements Middleware {

    public function handle($request, Closure $next)
    {
        $response = $next($request);
        // Do stuff
        return $response;
    }

}</code></pre>
<p>As you can see, the before middleware operates and <em>then</em> passes on the request. The after middleware, on the other hand, allows the request to be processed, and <em>then</em> operates on it.</p>
<h2>01000011 01101111 01101110 01100011 01101100 01110101 01110011 01101001 01101111 01101110</h2>
<p>If you're not familiar with it, it might take a minute to get your head wrapped around the concept of middleware. Filters are a little easier a jump from our normal thinking about controller route requests. But middleware—the concept of the stack which passes along only a request, allowing it to be decorated piece by piece--is cleaner, simpler, and more flexible.</p>
<p>Not only that, but middleware is just one more way of working with your request in a way that is both powerfully effective in your Laravel apps, but plays nicely elsewhere else. The Laravel 5.0 middleware syntax isn't <em>perfectly</em> compatible with StackPHP syntax, but if you structure your request/response stack along the organizational structure of middlewares it's a further work in the direction of separation of concerns--and modifying a Laravel Middleware to work in a separate, StackPHP-style syntax, would take minimal effort. </p>
<p>Questions? Comments? I'm <a href="http://twitter.com/stauffermatt">@stauffermatt</a> on Twitter.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-route-annotations</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-route-annotations"/>
        <title>Laravel 5.0 - Route Annotations (removed)</title>
        <published>2014-10-09T00:00:00+00:00</published>
        <updated>2014-10-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Note: Route Annotations were eventually removed f...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>Note: Route Annotations were eventually <a href="https://github.com/laravel/framework/commit/4d9f92ef77b3610a05f71110f539daff06e9081d">removed from core</a>, and separated to <a href="https://github.com/LaravelCollective/annotations">a package maintained by the Laravel Community</a>. The package should function the same as the documentation here, other than that it requires binding a custom service provider. Feedback can go to the Github issues for the project or to @artisangoose in the <a href="http://larachat.co">Larachat slack</a>.</p>
</blockquote>
<h2>Precursor: PHP Annotations</h2>
<p>If you're not familiar with how (or why) annotations exist, I'd suggest checking out <a href="http://www.rafaeldohms.com.br/">Rafael Dohms</a>' talk <a href="https://www.youtube.com/watch?v=wYccKQBy26Q">PHP Annotations: They Exist!</a>. In short, annotations are <em>notes</em> about your code that live in the DocBlock. But PHP has the ability to read and parse these notes, and so you can use them to give your code directions. Opinions on them are varied, but they've come to Laravel to stay.</p>
<h2>Setting the Stage</h2>
<p>One of the difficulties on Laravel sites--especially larger sites--is mentally mapping your routes to your controller methods.</p>
<p>Let's assume we're not using route Closures (because it's not the best practice <em>and</em> because we won't be able to take advantage of Laravel 5.0's route caching) and we're not using Implicit or Resource Controller routes, so all of our routes are going to be mapped explicitly to a controller method, somewhere.</p>
<p>So, we have something like this (note that Laravel 5.0 prefers <code>$router-&gt;get</code> instead of <code>Route::get</code>):</p>
<pre><code class="language-php">// routes.php
$router-&gt;get('awesome-sauce/{id}', [
    'as' =&gt; 'sauce',
    'uses' =&gt; 'AwesomeController@sauce'
]);</code></pre>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

class AwesomeController {

    public function sauce($id) {}

}</code></pre>
<p>...but imagine having dozens or hundreds of those links. What if we were able to make a more direct linkage? Say, if we were able to determine the route <em>in the controller</em>? Bum bum bum...</p>
<blockquote>
<p>Note: Laravel 5.0 uses POPO (Plain old PHP Objects) for controllers instead of children of the \Controller class. More on this later.</p>
</blockquote>
<h2>Introducing Route Annotations</h2>
<p>OK, it's clear what I'm leading up to here. Check it out:</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

class AwesomeController {

    /**
     * @Get("/awesome-sauce/{id}", as="sauce")
     */
    public function sauce($id) {}

}</code></pre>
<p><strike>... that's it.</strike></p>
<p>One more step. Open up <code>App/Providers/RouteServiceProvider.php</code>, and add <code>App\Http\Controllers\AwesomeController</code> to the <code>$scan</code> array:</p>
<pre><code class="language-php">...
    protected $scan = [
        'App\Http\Controllers\HomeController',
        'App\Http\Controllers\Auth\AuthController',
        'App\Http\Controllers\Auth\PasswordController',
        'App\Http\Controllers\AwesomeController'
    ];</code></pre>
<p>Run <code>artisan route:scan</code> and it'll automatically generate your route file at <code>storage/framework/routes.scanned.php</code>. It'll have a lot of default routes, but here is your new route down at the bottom:</p>
<pre><code class="language-php">&lt;?php
...

$router-&gt;get('awesome-sauce/{id}', [
    'uses' =&gt; 'App\Http\Controllers\AwesomeController@sauce',
    'as' =&gt; 'sauce',
    'middleware' =&gt; [],
    'where' =&gt; [],
    'domain' =&gt; NULL,
]);</code></pre>
<p>You're now determining your routes inline, using annotations, without touching <code>routes.php</code>. DONE.</p>
<h2>Two places to annotate</h2>
<p>Note that there are <em>two places</em> you can determine your route annotations: on the controller and on the method (or both). Check out the following controller (from the framework tests, but modified for demonstration):</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

/**
 * @Resource("foobar/photos", only={"index", "update"}, names={"index": "index.name"})
 * @Controller(domain="{id}.account.com")
 * @Middleware("FooMiddleware")
 * @Middleware("BarMiddleware", except={"update"})
 * @Middleware("BoomMiddleware", only={"index"})
 * @Where({"id": "regex"})
 */
class BasicController {

    /**
     * @Middleware("BazMiddleware")
     * @return Response
     */
    public function index() {}

    /**
     * @return Response
     */
    public function update($id) {}

    /**
     * @Put("/more/{id}", after="log")
     * @Middleware("QuxMiddleware")
     */
    public function doMore($id) {}

}</code></pre>
<p>Notice that some annotations are set on the controller and others on the methods. Also note the new emphasis on Middleware (and the absence of Before and After); I'll be writing a post soon about the new ways we'll be using Middleware.</p>
<h2>Available options</h2>
<p>Here are a few more options and use cases:</p>
<h3>Basic route mapping</h3>
<p>Use the verbs you're used to using in your routes file to annotate simple routes.</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

class BasicController {

    /**
     * @Get("awesome")
     */
    public function awesome() {}

    /**
     * @Post("sauce/{id}")
     */
    public function sauce($id) {}

    /**
     * @Put("foo/{id}", as="foo")
     */
    public function foo($id) {}

}</code></pre>
<h3>Resource Controllers</h3>
<p>Note that you can define a resource route with <code>@Resource("route-name")</code>; you can choose which routes are shown with <code>only={"method1", "method2"}</code>; and you can name routes with <code>names={"method": "name-for-method"}</code>.</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

/**
 * @Resource("foobar/photos", only={"index", "update"}, names={"index": "index.name"})
 */
class FoobarPhotosController
{

    public function index()
    {
        // Index, named as index.name
    }

    public function update()
    {
        // Update, un-named
    }

}</code></pre>
<h3>Sub-Domain Routing</h3>
<p>Just like in a normal route definition, annotations can control <a href="http://laravel.com/docs/4.2/routing#sub-domain-routing">Sub-Domain Routing</a>:</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

/**
 * @Controller(domain="{user-name}.my-multi-tenant-site.com")
 */
class MyStuffController
{
    // Do stuff 
}</code></pre>
<h3>Middleware</h3>
<p>Laravel 5.0 replaces Before and After Filters with Middleware; check back soon for a post introducing how the new implementation of Middleware works.</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

/**
 * @Middleware("FooMiddleware")
 */
class MiddlewaredController
{

    /**
     * @Middleware("BarMiddleware")
     */
    public function barred() {}

}</code></pre>
<h3>Route constraints</h3>
<p>You can apply route constraints, as well:</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

class RegexedController {

    /**
     * @Where({"id": "regex"})
     */
    public function show($id) {}

}</code></pre>
<h2>Local Scanning</h2>
<p>If your Environment is detected as <code>local</code>, Laravel will auto-scan your controllers <em>on every page view</em>. That way you don't have to <code>artisan route:scan</code> every time you make a change.</p>
<h2>Routes.php in Laravel 5</h2>
<p>Since I originally wrote this article, the default <code>routes.php</code> has been removed from the default project. In order to bring it back, edit <code>App\Providers\RouteServiceProvider</code>, and in the <code>map()</code> method, un-comment the line that says <code>require app_path('Http/routes.php')</code>. Now you can just create <code>App/Http/routes.php</code> and use it like you used to.</p>
<h2>Miscellany</h2>
<ul>
<li>If you use routes.php <em>and</em> annotations, the annotations will be listed first in the scanned file.</li>
<li>The double quotes in annotations must remain double. No single quotes.</li>
</ul>
<h2>Conclusion</h2>
<p>You can still use <code>routes.php</code> if it makes you more comfortable--or if you don't see the value behind this.</p>
<p>Once again, this new Laravel 5.0 feature both opens up new possibilities, and in my mind also helps us to write cleaner, better architected code. Since routes.php is simply a map between URL routes and controllers, route annotations moves the mapping into the controller and removes the need for a separate routes file entirely.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-method-injection</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-method-injection"/>
        <title>Laravel 5.0 - Method Injection</title>
        <published>2014-09-30T00:00:00+00:00</published>
        <updated>2014-09-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel 5.0 introduces the ability for the Contain...</summary>
        <content type="html"><![CDATA[
        <p>Laravel 5.0 introduces the ability for the Container to resolve depencies injected into any methods <em>that are resolved by the Container</em>. Read on to learn how, when, and why, it works.</p>
<h2>The basics of Dependency Injection</h2>
<p>One of the first things PHP developers learn as they start growing in modern coding practices is to use <em>dependency injection</em> in order to follow the <strong>D</strong> in <strong>SOLID</strong>: Dependency Inversion.</p>
<p>Laravel's <a href="http://laravel.com/docs/4.2/ioc">Container</a> is called an IOC (&quot;Inversion of Control&quot;) Container, and that's the case because it allows your control to happen at the top level of the app: you ask in your low-level code (controllers, implementation classes, etc.) for an instance of &quot;mailer&quot;, and the container gives you one. Your low-level code doesn't care about which service is actually <em>sending</em> your mail--Mandrill? Mailgun? Sendmail? It doesn't matter, as long as the interface to the mailer class is the same.</p>
<h2>Constructor injection in Laravel 4</h2>
<p>Here's a quick sample of traditional dependency injection.</p>
<pre><code class="language-php">...
class Listener
{
    protected $mailer;

    public function __construct(Mailer $mailer)
    {
        $this-&gt;mailer = $mailer;
    }

    public function userWasAdded(User $user)
    {
        // Do some stuff...

        $this-&gt;mailer-&gt;send('emails.welcome', ['user' =&gt; $user], function($message)
        {
            $message-&gt;to($user-&gt;email, $user-&gt;name)-&gt;subject('Welcome!');
        });
    }
}</code></pre>
<p>As you can see, we <em>inject</em> the Mailer class into the object using the constructor. And Laravel's Container makes it simple to instantiate this class, because it automates injection into the constructor. Notice that I can creat a <em>new</em> Listener without passing in a Mailer; that's because Laravel resolves it for me, and injects it in.</p>
<pre><code class="language-php">$listener = App::make('Listener');</code></pre>
<p>This is great because A) I can now make that decision about which Mailer I want <em>once</em> in the app, rather than <em>every time</em>, and B) this makes testing this class much easier.</p>
<h2>The conflict</h2>
<p>But what if you only need to use the injected class in a single method? Your constructor can get quite cluttered with single use injections.</p>
<p>Or what if you need to perform a particular action upon injection, but only want it to operate on that particular method? (<a href="http://mattstauffer.co/blog/laravel-5.0-form-requests">FormRequests</a> and <a href="http://mattstauffer.co/blog/laravel-5.0-validateswhenresolved">ValidatesUponResolved</a>)</p>
<h2>Solution</h2>
<p>Intro method injection: It's just like constructor injection, but it allows you to inject dependencies right into your methods--<em>when</em> those methods are called by the Container.</p>
<p>My guess is that the most common use case for method injection will be controllers. Like I mentioned above, the new FormRequests are a perfect example. But that's already been documented, so let's look at something else.</p>
<pre><code class="language-php">...
class DashboardController extends Controller
{
    public function showMoneyDashboard(MoneyRepository $money)
    {
        $usefulMoneyStuff = $money-&gt;getUsefulStuff();
        return View::make('dashboards.money')
            -&gt;with('stuff', $usefulMoneyStuff);
    }

    public function showTasksDashboard(TasksRepository $tasks)
    {
        $usefulTasksStuff = $tasks-&gt;getUsefulStuff();
        return View::make('dashboards.tasks')
            -&gt;with('stuff', $usefulTasksStuff);        
    }

    public function showSupervisionDashboard(SupervisionRepository $supervision)
    {
        $usefulSupervisionStuff = $supervision-&gt;getUsefulStuff();
        return View::make('dashboards.supervision')
            -&gt;with('stuff', $usefulSupervisionStuff);
    }
}</code></pre>
<p>Since public controller methods are called by the Container (when you map a route to them and the user visits that route), these dependencies will be auto-injected as soon as you hit that route. Nice and clean.</p>
<h2>When else will the Container resolve a method?</h2>
<p>So, we now know that controller methods are resolved by the Container. ServiceProvider's <code>boot</code> methods are, too. </p>
<p>But you can arbitrarily choose to have the Container resolve <em>any</em> method you'd like.</p>
<pre><code class="language-php">...
class ThingDoer
{
    public function doThing($thing_key, ThingRepository $repository)
    {
        $thing = $repository-&gt;getThing($thing_key);
        $thing-&gt;do();
    }
}</code></pre>
<p>... and we can call it from our Controller using <code>App::call()</code>, which optionally can take a second parameter which is an array of parameters:</p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

use Illuminate\Contracts\Container\Container;
use Illuminate\Routing\Controller;

class ThingController extends Controller
{
    public function doThing(Container $container)
    {
        $thingDoer = $container-&gt;make('ThingDoer');

        // Calls the $thingDoer object's doThing method with one parameter
        // ($thing_key) with a value of 'awesome-parameter-here'
        $container-&gt;call(
            [$thingDoer, 'doThing'],
            ['thing_key' =&gt; 'awesome-parameter-here']
        );
    }
}</code></pre>
<h2>DO CONCLUDE</h2>
<p>Method injection is, at its core, an enabler of some helpful system features like FormRequest--but don't let that stop you from using it. It's just one more way to clean up your code. And we all need cleaner code.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/nesting-sass-imports-with-bem</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/nesting-sass-imports-with-bem"/>
        <title>Nesting Sass @imports, with BEM</title>
        <published>2014-09-30T00:00:00+00:00</published>
        <updated>2014-09-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Yesterday Trey Piepmeier wrote a quick blog post s...</summary>
        <content type="html"><![CDATA[
        <p>Yesterday Trey Piepmeier wrote a quick blog post showing that you could <a href="http://codepen.io/trey/blog/nesting-sass-includes">import a Sass import <em>within</em> a selector</a>.</p>
<pre><code class="language-scss">// main.scss
.context {
    @import 'embed';
    font-size: 42px;
}</code></pre>
<pre><code class="language-scss">// _embed.scss
.child {
    color: red;
}</code></pre>
<p>Produces:</p>
<pre><code class="language-css">.context {
    font-size: 42px;
}
    .context .child {
        color: red;
    }</code></pre>
<p>This is a really clever trick; I've only ever used <code>@import</code> to pull in things to the top level of the document. Unfortunately, I can't use it, for two reasons:</p>
<p><strong>First, we don't like to use descendant selectors</strong>. Like I've written before, <a href="http://mattstauffer.co/blog/organizing-css-oocss-smacss-and-bem">we use BEM instead of descendant selectors in our CSS.</a></p>
<p><strong>Second, we've actually tried, and failed, to use style namespaces</strong>. For the most significant example, we tried namespacing the primary content section of our pages under <code>.content</code>. It seemed really clever, because we could then isolate the styles we were applying there to just apply in that context.</p>
<p>The problem was, every selector within that namespace instantly had <em>an increased specificity</em>. It was no longer <code>h1</code>--it was now <code>.content h1</code>, which means you <em>could no longer</em> style that h1 later by adding a single class like <code>.news-title</code>, because <code>.news-title</code> isn't as specific as <code>.content h1</code>. So, you'd have to write <code>.news-title, .content .news-title</code> just to make it work. It became a huge mess.</p>
<h2>BEM and nesting Sass imports</h2>
<p>Along comes BEM, to save the day. So, I thought, why can't we use Trey's trick for BEM? Turns out we can.</p>
<pre><code class="language-scss">// main.scss
.context {
    @import 'embed';
    font-size: 42px;
}</code></pre>
<pre><code class="language-scss">// _embed.scss
&amp;__child {
    color: red;
}</code></pre>
<p>Produces:</p>
<pre><code class="language-css">.context {
    font-size: 42px;
}
    .context__child {
        color: red;
    }</code></pre>
<h2>The end</h2>
<p>Granted, I'm not sure if <em>this is even useful</em>--why would you want to separate out the <em>children elements and modifiers</em> of a BEM module from their parent block? But maybe there are contexts where you'd want to. So, now you know: You can do it.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-cloud-file-drivers</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-cloud-file-drivers"/>
        <title>Laravel 5.0 - Cloud File Drivers</title>
        <published>2014-09-28T00:00:00+00:00</published>
        <updated>2014-09-28T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In Laravel 5, you can now use the same Filesystem ...</summary>
        <content type="html"><![CDATA[
        <p>In Laravel 5, you can now use the same Filesystem class which previously simplified interactions with the local filesystem, and now also use it with S3 and Rackspace. It's a simple interface, powered on the backend by <a href="https://twitter.com/frankdejonge">Frank de Jonge</a>'s <a href="https://github.com/thephpleague/flysystem">Flysystem</a>.</p>
<p>That means that you can write your app just like you did using local file storage:</p>
<pre><code class="language-php">/**
 * Save a thing
 * @param Thing  $thing
 * @param string $filename
 */
public function saveThing(Thing $thing, $filename)
{
    File::put('uploads/' . $filename, $thing);
}</code></pre>
<p>But now you can, at any point, change your production app settings to use an external host (we'll use s3 in our example) instead, without changing a line of your business logic.</p>
<h2>Making the switch to s3</h2>
<p>First, you have to add the cloud provider's dependency to composer.json; for s3, it's the AWS SDK (<code>aws\aws-sdk-php</code>).</p>
<pre><code class="language-bash">$ composer require aws\aws-sdk-php</code></pre>
<p>Then, edit <code>config/filesystems.php</code> (or <code>config/production/filesystems.php</code>, so you're only configuring for the production site), change the default driver from <code>local</code> to <code>s3</code>, and then add your s3 credentials to the <code>s3</code> section of the disks array:</p>
<pre><code class="language-php">return [
    'default' =&gt; 's3',
    'disks' =&gt; [
        's3' =&gt; [
            'driver' =&gt; 's3',
            'key' =&gt; 'fslkfqweoirqew',
            'secret' =&gt; '24j12oin12oi5nio251',
            'bucket' =&gt; 'my-awesome-website-bucket'                        
        ]
    ]
];</code></pre>
<h2>Cloud default vs. normal default</h2>
<p>Uniquely, the Filesystem config has <em>two</em> defaults: The Filesystem default (which is injected when you typehint <code>Illuminate\Contracts\Filesystem\Filesystem</code>, and also bound to the Container as <code>filesystem.disk</code>) and the Cloud default (which is injected when you typehint <code>Illuminate\Contracts\Filesystem\Cloud</code>, and also bound to the Container as <code>filesystem.cloud</code>). This way you can have any given environment have a default local <em>and</em> a default cloud filesystem config.</p>
<p>If you're using the façade, you're going to get the <em>default</em> default by default, rather than the <em>cloud</em> default. (Say that five times fast...)</p>
<h2>Notes</h2>
<ul>
<li>You could also use the same credentials for multiple environments and just use different buckets; or you could use different credentials; or you could even use different drivers. It's entirely up to you.</li>
<li>All of the usual File methods are available against these new drivers—put, get, etc.</li>
<li>Remember to inject the Filesystem Contract (<code>Illuminate\Contracts\Filesystem\Filesystem</code>) instead of using the façade if you're accessing files anywhere other than your controllers.</li>
<li>I didn't know this, but Jeffrey Way shows you how you can <em>in your code</em> (not in config) define which driver you want to use by injecting  the Filesystem Factory. Learn more at his Laracast about <a href="https://laracasts.com/series/whats-new-in-laravel-5/episodes/6">Multiple Filesystems</a></li>
</ul>
<h2>Conclusion</h2>
<p>Once you've installed the AWS SDK and edited <code>filesystems.php</code>, all of your file operations are now happening against your s3 account. That's it! No extra work, no extra steps: you're up and running, storing and accessing files in the cloud like a pro. Way to go.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-global-recipes-the-fastcgi-nginx-update</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-global-recipes-the-fastcgi-nginx-update"/>
        <title>Laravel Forge - Global Recipes &amp; the FastCGI Nginx Update</title>
        <published>2014-09-25T00:00:00+00:00</published>
        <updated>2014-09-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Yesterday I updated all of my packages on a Forge ...</summary>
        <content type="html"><![CDATA[
        <p>Yesterday I updated all of my packages on a Forge server (<code>sudo apt-get update &amp;&amp; sudo apt-get upgrade</code>) and I ended up with a white screen on all of my sites. I quickly found that it was PHP not serving correctly (MySQL and Nginx were both working fine), and after sending a help request to Taylor I learned that it's due to a breaking change in Nginx.</p>
<p>Thankfully, there's a quick fix to that, and even better, Taylor has now introduced Global Forge Recipes (<a href="https://twitter.com/laravelphp/status/515162787169849345">tweet</a>) to make fixes like this much simpler.</p>
<h2>What are global recipes?</h2>
<p>Forge has always had <a href="https://forge.laravel.com/recipes">Recipes</a>, which allow you to save shell scripts that you'd like to apply frequently or across all of your machines. But now, below the &quot;Your Recipes&quot; section, there's a &quot;Forge Recipes&quot; section, which are official recipes provided by Taylor.</p>
<p><img src="/assets/images/content/forge-global-recipes.png" alt="Forge Global Recipes" /></p>
<p>The first such recipe is &quot;Update Nginx FastCGI Parameters&quot;, which addresses the issue I mentioned above.</p>
<h2>How and why?</h2>
<p>To run a recipe, just click the green arrow next to it, choose which server you want to run it on, and click &quot;Run.&quot; Once the recipe has completed, Forge will email you a Recipe Report. You can also click the i (info) button to read a description of the recipe and its actual contents.</p>
<p><img src="/assets/images/content/forge-recipe-report.png" alt="Forge Recipe Report" /></p>
<p>This particular recipe either fixes your server (if you had the same error I did) or prepares your server so it will never break in the future. <strong>As such, I'd recommend running it on all of your Forge-managed servers.</strong></p>
<h2>Cibonclibusibion</h2>
<p>Forge's Official Recipes provide Forge users with formal, official recipes that are written and vetted by Taylor, and an easy mechanism to deploy them on single servers or all servers. I'd recommend running &quot;Update Nginx FastCGI Parameters&quot; on all of your servers today.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-fixing-the-cve-2014-6271-bash-vulnerability</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-fixing-the-cve-2014-6271-bash-vulnerability"/>
        <title>Laravel Forge - Fixing the CVE-2014-6271 Bash Vulnerability</title>
        <published>2014-09-24T00:00:00+00:00</published>
        <updated>2014-09-24T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">What is it?
            A dangerous vulnerability in bash, a s...
        </summary>
        <content type="html"><![CDATA[
        <h2>What is it?</h2>
<p>A dangerous vulnerability in <em>bash</em>, a shell that's enabled by default on pretty much every *nix ystem ever. <a href="http://askubuntu.com/questions/528101/what-is-the-cve-2014-6271-bash-vulnerability-and-how-do-i-fix-it">Learn more here</a>. In short, it's bad but it's wildly easy to fix.</p>
<h2>How do I fix it?</h2>
<blockquote>
<p><strong>UPDATE</strong>: Ubuntu <a href="http://www.ubuntu.com/usn/usn-2362-1/">released a patch to fix this vulnerability</a> after I wrote this post, and since Forge auto-applies security fixes nightly, all Forge-managed servers are now safe. You can read on for fun, but you're now safe.</p>
</blockquote>
<p><strike>It's likely going to be automatically fixed in an Ubuntu security update soon, but if you want to manually update your Forge-managed servers (or any other Ubuntu servers)--I would recommend this--just SSH into your server and run the following:</strike></p>
<pre><code>$ sudo apt-get update &amp;&amp; sudo apt-get install --only-upgrade bash</code></pre>
<p>This will get an updated list of available packages (<code>apt-get update</code>) and then just upgrade bash. It wouldn't hurt to reboot your server afterwards, although it's not necessary--you can do this through Forge or by running <code>sudo reboot</code> on your server.</p>
<h2>Not enough?:</h2>
<p>Per <a href="https://twitter.com/steveklabnik/status/514952529688272897">this tweet</a>, even this bash patch might not be ENOUGH--but it's better to apply and keep your eyes on the bug than to not apply.</p>
<h2>Is my server vulnerable?</h2>
<p>You can also run the following to check whether your server is even vulnerable:</p>
<pre><code>$ env x='() { :;}; echo vulnerable' bash -c "echo this is a test"</code></pre>
<p>If you see the following output, your server <em>is</em> vulnerable:</p>
<pre><code>vulnerable
this is a test</code></pre>
<p>If you see any other output, likely the following, your server is safe:</p>
<pre><code>bash: warning: x: ignoring function definition attempt
bash: error importing function definition for `x'
this is a test</code></pre>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-route-caching</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-route-caching"/>
        <title>Laravel 5.0 - Route Caching</title>
        <published>2014-09-20T00:00:00+00:00</published>
        <updated>2014-09-20T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Performance optimization within our PHP code isn&#039;t...</summary>
        <content type="html"><![CDATA[
        <p>Performance optimization within our PHP code isn't always something at the forefront of our minds, but our backend code--especially our more complex operations--can impact our sites' request times to the tune of tens and maybe even hundreds of milliseconds. It may not sound like much, but a <a href="http://www.nytimes.com/2012/03/01/technology/impatient-web-users-flee-slow-loading-sites.html?pagewanted=all&amp;_r=0">few hundred milliseconds can mean a huge difference in the perceived quickness of your applications</a>.</p>
<p>Whether or not you were aware of it, the routing logic in Laravel 4 and earlier--especially as you have more and more routes in your application--were one such place for performance bottlenecks. A site with just a few hundred routes could, in the past, lose up to a half second just for the framework to register those routes. Fear no more, as Laravel 5 introduces <strong>route caching</strong>, optimizing the performance of your routes (except Closure routes, so it's time to move them all to controllers).</p>
<h2>Using Route Caching</h2>
<p>There's not a lot to using this feature, honestly. There's a new Artisan command, <code>route:cache</code>, which serializes the results of your <code>routes.php</code> file--it's performing the operation of parsing the routes <em>once</em> and then storing those result. Sort of like pre-compiling a Handlebars template, if you've ever done that before.</p>
<p>That's it! Now your routes are being parsed from the cached file, not your routes file. You can make all the changes you want to <code>routes.php</code> and the routing of your app won't change until you re-cache.</p>
<h2>Pros and Cons</h2>
<p>The pros are pretty clear: your site gets faster.</p>
<p>The cons, however, need to be noted: Once you cache the site's routes once, you'll now have to re-cache your routes every time you make any changes to <code>routes.php</code>, or the changes won't show up. This could cause confusion for new developers, or even for you if you just happen to forget you were using caching.</p>
<p>Thankfully, there are two things that can help you here. First, you can run <code>artisan route:clear</code>, and artisan will delete your route cache. Second, you can consider <em>only</em> caching on your production server. Maybe only run <code>artisan route:cache</code> as a post-deploy hook in Git, or just run it as a part of your Forge deploy process.</p>
<h2>Konklużjoni</h2>
<p>The performance benefit of route caching might not be worth the potential confusion for you. If so, you can pretend this doesn't exist. But for groups with more managed deploy processes, the idea of something this simple trimming off a half second or more of load time <em>on every page</em> is huge.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-circles</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-circles"/>
        <title>Laravel Forge - Forge Plus and Circles</title>
        <published>2014-09-17T00:00:00+00:00</published>
        <updated>2014-09-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Forge is a great tool for administering your serve...</summary>
        <content type="html"><![CDATA[
        <p><a href="http://forge.laravel.com/">Forge</a> is a great tool for administering your servers. But what if you have a whole team that you want to grant access to one server? What if there's a <em>different</em> team that you want to give access to a different server?</p>
<h2>Introducing Forge Plus and Circles</h2>
<p>Forge now has a feature called <strong>Circles</strong>, which allows you to choose a group of people (Forge paid users or not; non-users will need to create a free Circles-only Forge account) who have access to one or more of your servers. At the same time this feature was added, a new plan called <strong>Forge Plus</strong> was added, which is the basic Forge (which is now limited to 5 servers) plus Circles and unlimited servers.</p>
<p><img src="/assets/images/content/Screen-Shot-2014-09-18-at-7.35.03-AM.png" alt="Forge Plus Pricing" /></p>
<h2>What's a Circle?</h2>
<p>A circle is a group of one or more users that you've grouped for the purpose of granting them access to some or all of your servers.</p>
<p><img src="/assets/images/content/forge-circles.png" alt="Forge Circles Admin page" /></p>
<p>Each user in a circle will be able to do anything to any server (add sites, admin sites, delete sites, etc.) other than delete or archive the server. They won't see your billing, or your authentication/API information to the host, but they'll be able to administer the servers and sites fully.</p>
<p><img src="/assets/images/content/forge-circle-edit.png" alt="Forge Edit Circles" /></p>
<h2>Other goodies</h2>
<p>Like I mentioned above, you now need to upgrade to a Forge Plus account ($20/mo instead of $10/mo) if you want to use Forge to manage more than 5 servers. I think this is a great move, because it leaves the majority of independent developers on the lowest plan, but allows business owners like myself to start paying for the greater level of use we get from Forge.</p>
<p>Another new update that came through with this change is a universal Sites dropdown, which allows you to navigate to a certain site without navigating to its server first. As you can see, it shows the site name, with the server name in parentheses:</p>
<p><img src="/assets/images/content/forge-sites-dropdown.png" alt="Forge Sites Dropdown" /></p>
<h2>Notes</h2>
<p>Despite the limitation of only 5 <em>servers</em> for the entry level plan, you can still administer unlimited <em>sites</em> across those servers.</p>
<p>If you have more than 5 servers already, you will be able to continue to use your existing servers, but you will have to upgrade in order to add any more. [<a href="https://twitter.com/laravelphp/status/512593003588767744">source</a>]</p>
<p>If your invitees can't visit the &quot;My Circles&quot; page in their account to accept an invitation, but instead are redirected to the Connect page, have them authenticate their Github account, skip the step about adding a Server Provider, and then their account will be allowed access to the My Circles page.</p>
<p>You can administer your circles by choosing &quot;My Circles&quot; from the account dropdown:</p>
<p><img src="/assets/images/content/forge-my-circles.png" alt="Forge My Circles Dropdown" /></p>
<h2>Závěr</h2>
<p>This is a great move for Forge, and one I'll benefit from greatly. Now, rather than having to share my individual login information with all of my developers--and our contractors--I can now choose specific permissions for each developer based on the project, <em>and</em> I can let them do it using their own logins instead of sharing my own password around. Good stuff.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-directory-structure-and-namespace</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-5.0-directory-structure-and-namespace"/>
        <title>Laravel 5.0 - Directory structure and namespace</title>
        <published>2014-09-12T00:00:00+00:00</published>
        <updated>2014-09-12T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">One of the big reasons Laravel 4.3 got moved to 5....</summary>
        <content type="html"><![CDATA[
        <p>One of the big reasons Laravel 4.3 got moved to 5.0 is because the directory structure can seem like a big shift in thinking.</p>
<p>I love it. The directory structure has been modified to now better reflect how a majority of Laravel developers either work or recommend working, and this will reduce some of the pain of comprehending &quot;best practices&quot;, <em>and</em> it makes the entire task of understanding Laravel simpler.</p>
<h2>What does it look like?</h2>
<pre><code>app
    Commands
    Console
    Events
    Handlers
        Commands
        Events
    Http
        Controllers
        Middleware
        Requests
    Providers
    Services
bootstrap
config
database
    migrations
    seeds
public
    package
resources
    lang
    views
storage
    cache
    logs
    meta
    sessions
    views
    work
tests</code></pre>
<p>Basically, the <code>app</code> directory has been trimmed down--and also boosted a little. Where it used to be a more classic Rails/CodeIgniter-style directory that holds all of your application's logic <em>and</em> framework config and templates and persistence and everything else, it's now primarily trying to hold your application's logic (including the business &quot;domain&quot;)--and it's loading it all as PSR-4 classes.</p>
<p>As a result, Laravel-specific configuration details are now in their own directory. Resources--language and views--are now in their own directory. Database-related information is now in its own directory.</p>
<blockquote>
<p>Note: There is a Legacy Service Provider (see the docs <a href="http://laravel.com/docs/upgrade?version=master#upgrade-4.3">here</a>) that'll allow you to serve a 5.0+ app from a 4.2- directory structure, so upgrading older Laravel apps to 5.0 won't require changing to the new directory structure. </p>
</blockquote>
<h2>What's better?</h2>
<p>So, why is this actually an improvement? </p>
<p>For starters, we're separating our concerns. The app directory was previously a bit of a catchall for pretty much all code other than frontend code. Now, it contains the core logic of your <strong>app</strong>--fittingly--and some of the particular implementation details live elsewhere.</p>
<p>Additionally, it's been considered best practice for quite a while to have an &quot;App&quot; style top level namespace for your domain logic. Getting started on a new project, for many of us, was <em>at the very least</em> deleting the models directory, adding a namespace folder named after our app, and PSR-4 autoloading that namespace. Now that's a native part of the folder structure, <em>and</em> it just got a lot easier to namespace Controllers and other aspects of your more framework-related code.</p>
<p>Finally, a lot of the code that used to be in procedural files (filters, for example) is now moved to classes and Service Providers. This makes execution easier to predict, reduces the amount of procedural code, and encourages more userland (i.e. &quot;in our code, not in the framework&quot;) usage of Service Providers.</p>
<p>It's a little too extreme to say that the code in your app directory should be framework independent; controllers, filters, commands, and service providers will extend Laravel classes, and all of your classes may inherit from or receive injections of Laravel classes. But, this change goes a long way to moving the primary logic of your applications into PSR-4 loaded classes that could theoretically exist independent of Laravel. </p>
<h2>Where does ___ go?</h2>
<p>If it's a class, or could be a class, it should go somewhere in <code>app/</code>. If it's an Eloquent model, it should go somewhere in <code>app/</code>. If it has to do with the traffic of your request through a web server (e.g. Controllers, FormRequests), it should go in <code>app/Http</code>. If it has to do with CLI (command line interface) requests, it should go in <code>app/Console</code>. If you would've put it in routes.php (but it isn't a route), or in start.php in the past, it should go into a Service Provider. And if it's a filter, it should now be its own class in <code>app/Http/Filters</code>.</p>
<p>Other than that, it should be pretty clear.</p>
<h2>How does the namespace work in code?</h2>
<p>By default, every Laravel app has a &quot;namespace&quot; that represents the top-level namespace for the app's classes. Out of the box it defaults to &quot;App&quot;, and it maps directly to the <code>app/</code> folder directly via PSR-4.</p>
<p>But you can easily rename the namespace with an artisan command that will also replace all instances of &quot;App/&quot; (in namespace declarations in Laravel classes) with your new namespace.</p>
<p>So if I was starting <a href="http://www.confomo.com/">Confomo</a> again, I'd create the new Laravel install, and then instantly run the artisan command to rename the namespace:</p>
<pre><code class="language-bash">$ php artisan app:name Confomo</code></pre>
<p>Now all of the default-included classes in the <code>/app</code> directory are namespaced to Confomo; the PSR-4 autoloading statement in <code>composer.json</code> is updated; and Laravel knows to look for its filters, controllers, etc. in that namespace.</p>
<h2>onclusion-Cay</h2>
<p>The new app structure and the app namespacing in Laravel 5.0 are helping us, step by step, increase the overall quality, consistency, and flexibility of our code. I like it.</p>
<p>Did I miss anything? I'm <a href="http://twitter.com/stauffermatt">@stauffermatt</a> on Twitter.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-validateswhenresolved</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-validateswhenresolved"/>
        <title>Laravel 5.0 - ValidatesWhenResolved</title>
        <published>2014-09-10T00:00:00+00:00</published>
        <updated>2014-09-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In creating FormRequest, Taylor separated out both...</summary>
        <content type="html"><![CDATA[
        <p>In creating FormRequest, Taylor separated out both an interface (ValidatesWhenResolved) and a trait (ValidatesWhenResolvedTrait) relating to validating a method when its dependencies are resolved (via the IOC container).</p>
<p>To be entirely honest with you, I haven't come up with a really clever use case for this code outside of FormRequests. But I hope documenting it here will allow people smarter than me to see if it brings any particularly useful possibilities.</p>
<p>So, if you read my last blog post, you know that FormRequest objects, when injected (via the IOC with dependency injection), can cancel execution of the method they're running on. If my form doesn't validate, the POST route for that form gets cancelled by my FormRequest class.</p>
<p>So, it turns out that that the aspect of the FormRequest that triggers the IOC container calling its validation on resolution is now available as a separate interface called <a href="https://github.com/illuminate/contracts/blob/master/Validation/ValidatesWhenResolved.php">ValidatesWhenResolved</a>. Because of this, you can now build your own class that similarly <em>intercepts</em> the request prior to your controller (or non-controller, theoretically) method loading and can choose to pass or fail the validation.</p>
<blockquote>
<p>NOTE: The route/method isn't actually cancelled on a failed validation. The FormRequest object simply throws an HTTP Exception, which then either gives an error JSON response or a redirect. Theoretically, you could do the exact same thing without the interface simply by throwing an exception in the constructor after validating. But the interface cleans it up a lot by performing the validation in an named method.</p>
</blockquote>
<h2>The interface</h2>
<p>At the time of this post, this is what the interface looks like:</p>
<pre><code class="language-php">&lt;?php namespace Illuminate\Contracts\Validation;

use Illuminate\Contracts\Container\Container;

interface ValidatesWhenResolved {

    /**
     * Validate the given class instance.
     *
     * @return void
     */
    public function validate();

}</code></pre>
<p>As you can see, we're only obligated to provid a <code>validate()</code> method. And really, the benefit that this class provides--other than the additional knowledge we gain about a class purely by observing that it's fulfilling a particular contract--is that the <code>validate()</code> method is called when it's resolved from the IOC container. So let's try creating our own non-FormRequest class that implements this interface.</p>
<h2>Non-FormRequest validation in controllers</h2>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

use App\Random\RandomAccess;
use Illuminate\Routing\Controller;
use Response;

class ValidatedController extends Controller
{
    public function random(RandomAccess $ram)
    {
        return Response::make('You made it!');
    }
}</code></pre>
<p>OK, so now we have a route. Let's try a <em>non-FormRequest</em> class:</p>
<pre><code class="language-php">&lt;?php namespace App\Random;

use Exception;
use Illuminate\Contracts\Validation\ValidatesWhenResolved;
use Illuminate\Http\Request;

class RandomAccess implements ValidatesWhenResolved
{
    public function __construct(Request $request)
    {
        $this-&gt;request = $request;
    }

    public function validate()
    {
        // Test for an even vs. odd remote port
        if (($this-&gt;request-&gt;server-&gt;get('REMOTE_PORT') / 2) % 2 &gt; 0)
        {
            throw new Exception("WE DON'T LIKE ODD REMOTE PORTS");
        }
    }
}</code></pre>
<p>Now that <em>controller method</em> is being intercepted randomly with an exception (depending on whether your request port is even or odd, which is perhaps the most useless example of all time).</p>
<p>As you can see, there's no magic happening here. Whether <code>validate()</code> returns true or false doesn't matter. You <em>could</em> use the ValidatesWhenResolvedTrait to share some of the <code>failedValidation()</code> workflow you have with FormRequest, but with the class I wrote above you're simply throwing an exception.</p>
<h2>FormRequest-style validation <em>not in controllers</em></h2>
<p>We can also use this elsewhere, <em>and</em> we can use a FormRequest-style validator using the ValidatesWhenResolvedTrait. I have yet to find a use case for this, though, so I'll leave this section short and simple. You could do it... but I don't yet know why you would. :)</p>
<h2>Real world examples</h2>
<p>I get it. You're not going to turn on a random exception toggler like my example. And in some ways, this may end up looking just like route filters. But I still suspect there's something really creative we could do here. Is there anything you're planning to inject into your controller anyway? Maybe make it implement this contract so it can auto-validate upon injection, rather than calling a validation method later.</p>
<h2>Zaključak</h2>
<p>As you can tell, I'm just fishing around here to see if I can find any clever or creative uses for this. Got any great ideas? Pass them along: <a href="http://twitter.com/stauffermatt">@stauffermatt</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-5.0-form-requests</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-5.0-form-requests"/>
        <title>Laravel 5.0 - Form Requests</title>
        <published>2014-09-10T00:00:00+00:00</published>
        <updated>2014-09-10T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel 5.0
            Laravel 5.0 is coming out in November,...
        </summary>
        <content type="html"><![CDATA[
        <h2>Laravel 5.0</h2>
<p>Laravel 5.0 is coming out in November, and there are a lot of features that have folks excited. The New Directory structure is, in my mind, a lot more in line with how most developers work; Flysystem integration will make working with files endlessly more flexible and powerful; Contracts is a great step towards making Laravel-friendly packages that aren’t Laravel-dependent; and Socialite looks about 100x easier than Opauth. Also, Method Injection opens up a lot of really exciting opportunities.</p>
<p>One of the most valuable aspects of Laravel for me is that it allows for rapid app development. Laravel, and other frameworks like it, automate out the repetitive work that you have to do on every project. And a lot of newer features have been focusing on this. Cashier, and now Socialite and Form Requests.</p>
<h2>The headache of form validation</h2>
<p>If you have ever tried to figure out the best practices for validation in Laravel, you’ll know that it’s a topic of much discussion and little agreement. Validate in the controller? In a service layer? In the model? In a custom validation wrapper? In Javascript (NO JUST KIDDING THAT’S NEVER OK)?</p>
<p>Laravel’s new Form Request feature provides both standardization (“best practice” ish) and also convenience (this is more powerful and convenient then all prior options) to the process of validating and authenticating in Laravel.</p>
<blockquote>
<p>NOTE: In this post I'm using the new <code>view()</code> helper instead of <code>View::make()</code>.</p>
</blockquote>
<h2>Form Requests to the rescue</h2>
<p>Laravel 5.0 introduces Form Requests, which are a special type of class devoted to validating and authorizing form submissions. Each class contains at least a <code>rules()</code> method which returns an array of rules and an <code>authorize()</code> method which returns a boolean of whether or not the user is authorized to perform their request.</p>
<p>Laravel then automatically passes the user's input into the request <em>before</em> parse through the POST route, meaning our validation can now be moved entirely into FormRequest objects and out of our controllers and models.</p>
<h2>Getting started: Spin up a Laravel 5.0 project</h2>
<p>If you don't have one yet, create a 5.0 project using the following command:</p>
<pre><code class="language-bash">$ composer create-project laravel/laravel my-awesome-laravel-4-3-project-omg dev-develop --prefer-dist</code></pre>
<p>Let’s imagine we’re going to be allowing a user to add a friend to our contact manager.</p>
<h3>1. Add your routes</h3>
<p><em>app/Http/routes.php</em></p>
<pre><code class="language-php">&lt;?php
Route::get('/', 'FriendsController@getAddFriend');
Route::post('/', 'FriendsController@postAddFriend');</code></pre>
<h3>2. Create your controller</h3>
<p><em>app/Http/Controllers/FriendsController:</em></p>
<pre><code class="language-php">&lt;?php namespace App\Http\Controllers;

use App\Http\Requests\FriendFormRequest;
use Illuminate\Routing\Controller;
use Response;
use View;

class FriendsController extends Controller
{
    public function getAddFriend()
    {
        return view('friends.add');
    }

    public function postAddFriend(FriendFormRequest $request)
    {
        return Response::make('Friend added!');
    }
}</code></pre>
<h3>3. Create your view</h3>
<p><em>resources/views/friends/add.blade.php</em></p>
<pre><code class="language-php">&lt;html&gt;&lt;body&gt;
    @foreach ($errors-&gt;all() as $error)
        &lt;p class="error"&gt;{{ $error }}&lt;/p&gt;
    @endforeach

    &lt;form method="post"&gt;
        &lt;label&gt;First name&lt;/label&gt;&lt;input name="first_name"&gt;&lt;br&gt;
        &lt;label&gt;Email address&lt;/label&gt;&lt;input name="email_address"&gt;&lt;br&gt;
        &lt;input type="submit"&gt;
    &lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<h3>4. Create your FormRequest</h3>
<p><em>app/http/requests/FriendFormRequest.php</em></p>
<pre><code class="language-php">&lt;?php namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Response;

class FriendFormRequest extends FormRequest
{
    public function rules()
    {
        return [
            'first_name' =&gt; 'required',
            'email_address' =&gt; 'required|email'
        ];
    }

    public function authorize()
    {
        // Only allow logged in users
        // return \Auth::check();
        // Allows all users in
        return true;
    }

    // OPTIONAL OVERRIDE
    public function forbiddenResponse()
    {
        // Optionally, send a custom response on authorize failure 
        // (default is to just redirect to initial page with errors)
        // 
        // Can return a response, a view, a redirect, or whatever else
        return Response::make('Permission denied foo!', 403);
    }

    // OPTIONAL OVERRIDE
    public function response()
    {
        // If you want to customize what happens on a failed validation,
        // override this method.
        // See what it does natively here: 
        // https://github.com/laravel/framework/blob/master/src/Illuminate/Foundation/Http/FormRequest.php
    }
}</code></pre>
<p>Now, spin up a server with <code>php artisan serve</code> or your favorite method. Submit the form and you can see our validation rules working without adding a line of validation logic to our controllers.</p>
<h2>Other use cases</h2>
<p>What about if we have different rules based on add vs. edit? What if we have conditional authorization based on the input? Here are a few examples, although we haven't yet established &quot;best practices&quot; on all of these.</p>
<h3>Separate form requests</h3>
<p>There's nothing stopping you from having two (or more) separate form request classes for add and edit. You could create <code>FriendFormRequest</code> with all the rules, and then extend it to make <code>addFriendFormRequest</code> or <code>editFriendFormRequest</code> or whatever else, and each child class can modify the default behavior.</p>
<h3>Conditional logic</h3>
<p>The benefit of <code>rules()</code> being a function instead of just a property is that <em>you can perform logic in rules()</em>.</p>
<pre><code class="language-php">&lt;?php
...
class UserFormRequest extends FormRequest
{
    ...
    protected $rules = [    
        'email_address' =&gt; 'required',
        'password' =&gt; 'required|min:8',
    ];

    public function rules()
    {
        $rules = $this-&gt;rules;

        if ($someTestVariableShowingThisIsLoginInsteadOfSignup)
        {
            $rules['password'] = 'min:8';
        }

        return $rules;
    }
}</code></pre>
<p>You can also perform logic in authorize. For example:</p>
<pre><code class="language-php">&lt;?php
...

class FriendFormRequest extends FormRequest
{
    ...
    public function authorize()
    {
        if ( ! Auth::check() )
        {
            return false;
        }

        $thingBeingEdited = Thing::find(Input::get('thingId'));
        if ( ! $thingBeingEdited || $thingBeingEdited-&gt;owner != Auth::id()) {
            return false;
        }

        return true;
    }
}</code></pre>
<h3>Custom Validator</h3>
<p>Or, if you want a greater level of control for all of this, you can actually overwrite the method that provides the Validator instance. I will be expanding this section of this blog post shortly.</p>
<pre><code class="language-php">&lt;?php
...
class FriendFormRequest extends FormRequest
{
    public function validator(ValidationService $service)
    {
        $validator = $service-&gt;getValidator($this-&gt;input());

        // Optionally customize this version using new -&gt;after()
        $validator-&gt;after(function() use ($validator) {
            // Do more validation

            $validator-&gt;errors()-&gt;add('field', 'new error');
        });
    }
}</code></pre>
<h2>ValidatesWhenResolved</h2>
<p>I'll be writing more on this in a new blog post soon, but the concept of validating methods/routes/etc. when the IOC resolves something is now a separated to an interface: <a href="https://github.com/illuminate/contracts/blob/master/Validation/ValidatesWhenResolved.php">https://github.com/illuminate/contracts/blob/master/Validation/ValidatesWhenResolved.php</a></p>
<h2>Other customizable parameters</h2>
<ul>
<li><code>$redirect</code>: the URI to redirect to if validation fails</li>
<li><code>$redirectRoute</code>: the route to redirect to if validation fails</li>
<li><code>$redirectAction</code>: the controller action to redirect to if validation fails</li>
<li><code>$dontFlash</code>: the input keys that should not be flashed on redirect (default: <code>['password', 'password_confirmation']</code>)</li>
</ul>
<h2>Abschluss</h2>
<p>As you can see, Form Requests are powerful and convenient ways to simplify validation and authentication for form requests. Have trouble following this? <a href="https://laracasts.com/series/whats-new-in-laravel-4-3/episodes/3">Check out the Laracast for Form Request</a>.</p>
<p>Since 5.0 is still under development, these things could change, or I may have missed something. Suggestions or corrections? Hit me up <a href="http://twitter.com/stauffermatt">on Twitter</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/thoughts-after-laracon-eu</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/thoughts-after-laracon-eu"/>
        <title>Thoughts after Laracon Eu</title>
        <published>2014-09-03T00:00:00+00:00</published>
        <updated>2014-09-03T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I recently returned from a trip that brought lot o...</summary>
        <content type="html"><![CDATA[
        <p>I recently returned from a trip that brought lot of firsts.</p>
<p>First time in Amsterdam.<br />
First time in The Netherlands, actually.<br />
First time in Europe as an adult.<br />
First time speaking at a conference not in the U.S.<br />
First time at Laracon Eu.<br />
First time eating (and burning my mouth on) <a href="http://en.wikipedia.org/wiki/Bitterballen">Bitterballen</a>.
First time speaking (a single word of) Dutch.</p>
<p><img src="/assets/images/content/laracon-eu-stagie.jpg" alt="Laracon Eu 2014 Stagie" /></p>
<p>First time meeting dozens of incredible folks in person who I previously only knew online, and plenty of others who I didn't know at all.</p>
<p>Before it all fades away, I wanted to share a few reflections.</p>
<h2>My talk</h2>
<p><strong>I'm actually pretty satisfied with how my talk went.</strong> You can view more information about it here:</p>
<p><a href="http://joind.in/talk/view/11688">joind.in reviews</a> | <a href="https://speakerdeck.com/mattstauffer/sharing-laravel-bringing-laravels-best-assets-to-any-project">slide deck</a> | <a href="https://www.youtube.com/watch?v=Qu6o4wTMo38&amp;hd=1">video</a></p>
<p>I spoke on bringing the best assets of Laravel to other projects--both the <em>good things</em> that Laravel has that aren't unique to Laravel, like coding standards and design patterns, and also the things Laravel uniquely brings, including Illuminate components.</p>
<p>I spoke too quickly, partially because I was nervous and partially because my run-through the night before had been a few minutes over time. I ended up 5 minutes <em>under</em> time, though, so I'll definitely remember to slow it down next time.</p>
<p>I've gotten only incredible feedback, including from <a href="http://rosstuck.com/notes-from-laraconeu/">Ross Tuck</a>, who's a brilliant speaker, and so I'm overjoyed at how it went.</p>
<p><img src="/assets/images/content/canal.jpg" alt="A Canal scene" /></p>
<h2>The state of Laravel</h2>
<p>Laravel is a bit of a dark horse in a lot of PHP circles. Some of my friends have told me that Laravel folks are over-sensitive to this, but my experiences at Laracon Eu, and on social media during and after, have actually strengthened this perception for me.</p>
<p><strong>It's a joy to see how many of the speakers were <em>not</em> Laravel users.</strong> It was funny to watch them share &quot;I've never used Laravel before&quot; and expect to be stoned, and instead just receive a few chuckles. I had great conversations with <a href="https://twitter.com/rdohms">Rafael Dohms</a> about some of the reasons folks perceive Laravel like they do--including the fact that there's a big difference between the mass of people using Laravel vs. the attitudes and relationships within the community's &quot;regulars&quot;, if you will. </p>
<p><strong>Honestly, I think that the majority of Laravel-related drama comes from the usual Internet Problem: Forgetting that the people on the other side of your tweet, blog post, or angry Pull Request are <em>real people</em>, with real motivations and real insecurities.</strong> It's encouraging to see tweets like <a href="https://twitter.com/rdohms/status/506800007702650880">this</a> from Raf: &quot;[T]heir community feel a lot different from the inside.&quot; When you see the Laravel community as a large and diverse community of developers at various stages in their growth, rather than a monolothic giant where every opinion constrains to the Lowest Common Denominator, it's a lot easier to understand why the community has grown as it has.</p>
<p><img src="/assets/images/content/bimhuis-moevenpick.jpg" alt="Bimhuis and Mövenpick Hotel" /></p>
<h2>Diversity?</h2>
<p>If you follow me <a href="https://twitter.com/stauffermatt">on Twitter</a> or <a href="http://blog.mattstauffer.org/">at my other blog</a>, you know diversity, multiethnicity, and justice are really important to me. So, I was very glad to see not one but two talks about diversity and openness: <a href="http://joind.in/talk/view/11684">Coding Like a Girl</a> and <a href="http://joind.in/talk/view/11695">The Code Manifesto: Empowering Our Community</a>. I was less glad to see a few of the responses to their talks, but thankfully the primary response was openness, supportiveness, and curiosity.</p>
<p>Over the last year I've emailed a few organizations that are targeted at helping women and people of color learn to code. I said, &quot;I'm interested in partnering with you to help create a hiring pipeline--I love what you're doing and I have connections to folks who are hiring supervisors at their (tech) companies.&quot; I sadly wasn't able to get in touch with anyone, and asked a group of people about ideas for how to address this.</p>
<p>The speakers from the two talks I linked above heard this and decided to act on it, so Gabi and Kayla created <a href="http://wediversi.fi/">WeDiversifi</a>, with the goal of it becoming a portal for hiring supervisors who want to be a part of increasing diversity in the tech workforce. I'm very interested to see where they go with this, and to hear any other voices on possible next steps for hiring supervisors to be a part of encouraging historically underrepresented groups to thrive in the tech community.</p>
<h2>Conclusie</h2>
<p>Shawn and company threw a great conference with Laracon Eu, and I'd gladly attend again. It was a joy to meet so many people, to speak and to hear talks, to receive such helpful feedback on my talk, and to enjoy hanging out with friends old and new.</p>
<p>I would love to think more deeply and journal longer about my experiences at the conference, but a week away from work doesn't leave a lot of free time upon return. My overburdened inbox beckons...</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laracon-eu-talk-sharing-laravel-bringing-laravels-best-assets-to-any-project
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laracon-eu-talk-sharing-laravel-bringing-laravels-best-assets-to-any-project"/>
        <title>Laracon Eu Talk: Sharing Laravel: Bringing Laravel&#039;s Best Assets to Any Project</title>
        <published>2014-08-29T00:00:00+00:00</published>
        <updated>2014-08-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">The slide deck is now available for my Laracon Eu ...</summary>
        <content type="html"><![CDATA[
        <p>The slide deck is now available for my Laracon Eu talk:</p>
<p>[<a href="https://speakerdeck.com/mattstauffer/sharing-laravel-bringing-laravels-best-assets-to-any-project](Sharing">https://speakerdeck.com/mattstauffer/sharing-laravel-bringing-laravels-best-assets-to-any-project](Sharing</a> Laravel: Bringing Laravel's Best Assets to Any Project)</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/illuminating-non-laravel-projects</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/illuminating-non-laravel-projects"/>
        <title>&quot;Illuminating&quot; non-Laravel projects</title>
        <published>2014-08-25T00:00:00+00:00</published>
        <updated>2014-08-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">As a part of preparing for my talk at Laracon Eu, ...</summary>
        <content type="html"><![CDATA[
        <p>As a part of preparing for my talk at Laracon Eu, &quot;Sharing Laravel's Best Assets With Other Projects,&quot; I planned to teach about the basics of using Illuminate components in other projects. But a small section of a 45-minute talk isn't nearly enough time to cover such a broad topic, so <strong>I decided to create a Github project called &quot;<a href="https://github.com/mattstauffer/IlluminateNonLaravel">Illuminate Non-Laravel</a>&quot; to teach and share more about best practices for using Illuminate components outside of Laravel.</strong></p>
<p>The point of this project is to show developers, especially those working with legacy projects in frameworks like CodeIgniter, how they can use Laravel components (which are called Illuminate components) in their projects.</p>
<p>I want to have a simplest-use-case example for each component, with as few dependencies and as little bootstrapping as possible, but also I'd be happy to have more complicated examples and even hopefully a standard bootstrap to get a Laravel-style Application instance and Service Provider structure. (For an already-running Github project that is similar to this bootstrap I'm describing, check out <a href="https://github.com/jeremyvaught/CodeIgniter-Service-Level">Jeremy Vaught's CodeIgniter Service Level</a>, which I haven't yet had the chance to work with.)</p>
<p>So, please check out the repo (<a href="https://github.com/mattstauffer/IlluminateNonLaravel">mattstauffer/IlluminateNonLaravel</a>) and watch it for the future, or if you have some experience working with this sort of stuff, please send a Pull Request to share some code.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/squashing-git-commits-with-interactive-rebase</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/squashing-git-commits-with-interactive-rebase"/>
        <title>Squashing git commits with Interactive Rebase</title>
        <published>2014-08-07T00:00:00+00:00</published>
        <updated>2014-08-07T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Squashing git commits (using git&#039;s interactive reb...</summary>
        <content type="html"><![CDATA[
        <p>Squashing git commits (using git's interactive rebase mode) is a great way to trim up mistakes, typos, and overzealously granular commits. But when you first get started, it can seem very overwhelming.</p>
<p>I recorded a quick 5-minute video as an intro to squashing with git.</p>
<blockquote>
<p>NOTE: All of the editors that pop up will use your system-wide default editor. I use Vim, but <a href="https://help.github.com/articles/associating-text-editors-with-git">you can set it to anything you'd like</a>.</p>
</blockquote>
<iframe width="560" height="315" src="//www.youtube.com/embed/7IfkL8swmFw?rel=0" frameborder="0" allowfullscreen></iframe>
<p>Basically, when you're ready to squash some commits, just figure out how many commits back you'd like to include in your rebase-ing session. Let's say it's 24 commits. Now run this from your project directory:</p>
<pre><code class="language-bash">$ git rebase -i HEAD~24</code></pre>
<p>Now you're in interactive rebase mode. Change &quot;pick&quot; to &quot;squash&quot; for any lines that you want to merge <em>into the commit above them</em>, and then follow the prompts to set the commit messages for the new commits.</p>
<p>Check out the video for more details and examples.</p>
<blockquote>
<p>Note: If you're actually going to be doing something like I did in the video, it'll be a lot easier to get a commit hash from git log rather than counting down 42 commits. Just copy the hash--the gibberish at the beginning of each log line--and use it like so: <code>git rebase -i 01j93091</code></p>
</blockquote>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/organizing-css-oocss-smacss-and-bem</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/organizing-css-oocss-smacss-and-bem"/>
        <title>Organizing CSS: OOCSS, SMACSS, and BEM</title>
        <published>2014-07-29T00:00:00+00:00</published>
        <updated>2014-07-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Eric Barnes, the author of Laravel News, mentioned...</summary>
        <content type="html"><![CDATA[
        <p>Eric Barnes, the author of <a href="http://laravel-news.com/">Laravel News</a>, mentioned in his newsletter this week that he's been looking for a better way to organize his CSS. He mentioned three methods he'd looked into: SMACSS, OOCSS, and BEM, and that he had seen me writing in BEM in <a href="http://mattstauffer.co/blog/screencast-converting-a-flattened-pdf-to-html-css-in-45-minutes">the video I posted last week</a>.</p>
<p>I wanted to clarify a little bit, and hope this could add a little to the conversation around well-architected, modular CSS: At <a href="http://tighten.co/">Tighten</a> we do use BEM... but we also use OOCSS. And SMACSS. <strong>At the same time.</strong></p>
<p>I'd love to share why and how.</p>
<h2>What is OOCSS?</h2>
<p>OOCSS is a programming paradigm. OOCSS stands for Object Oriented CSS, so it's best understood in the context of Object Oriented programming: classic (spaghetti) CSS vs. OOCSS is a bit like procedural (spaghetti) backend code vs. Object-Oriented backend code.</p>
<p>OOCSS focuses on flexible, modular, swappable components that do One Thing Well. OOCSS focuses on the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>, <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>, and much more of the foundational concepts of Object Oriented Programming.</p>
<p>For a great introduction to OOCSS, <a href="http://www.stubbornella.org/content/2010/06/25/the-media-object-saves-hundreds-of-lines-of-code/">this post on the OOCSS Media Object</a> (written by the/one of the people behind OOCSS) shows an example of what a CSS object looks like, and some of the benefits of using one.</p>
<p>Here's a sample, from that post, of an OOCSS object:</p>
<pre><code class="language-css">.media {}
.media .img {}
.media .img img {}
.media .imgExt {}
.bd {}</code></pre>
<p>As you can see, <code>.media</code> is an object, and the goal is to make that object independent of its surroundings so that it can be placed anywhere in your site.</p>
<h2>What is SMACSS?</h2>
<p>SMACSS stands for Scalable and Modular Architecture for CSS. It's a book and a methodology for writing CSS (created by Jonathan Snook), but its most significant and influential aspect is its organizational system, which is designed to provide a set of buckets into which CSS should be organized. To learn more, check out the <a href="https://smacss.com/">SMACSS web site</a> and read or order the book there.</p>
<h2>What is BEM?</h2>
<p>BEM is a specific concrete application of OOCSS. BEM stands for Block Element Modifier, and it describes the pattern of each CSS object's class name. We use a modified form of BEM, described best by <a href="http://csswizardry.com/2013/01/mindbemding-getting-your-head-round-bem-syntax/">CSS Wizardry's post titled MindBEMding</a>.</p>
<p>Essentially, each BEM class starts with a block, which is an object name. Let's start with <code>.byline</code>. Then, for children of that block, you add an element, separating it with two underscores: <code>.byline__name</code>. Finally, you can modify any class (block or element) by adding a modifier, separated with two hyphens: <code>.byline--expanded</code>.</p>
<pre><code class="language-css">.byline {}
.byline__name {}
.byline__title {}
.byline__picture {}
.byline--expanded {}
.byline--expanded__bio {}</code></pre>
<p>Here's the OOCSS media object in BEM syntax:</p>
<pre><code class="language-css">.media {}
.media__img {}
.media__img--rev {}
.media__body {}</code></pre>
<p>This post isn't the best place to describe the merits of BEM, but a few quick benefits: modularity, a shallow selector structure, and a much decreased likeliness of class name overlap are some of the biggest benefits of using BEM.</p>
<h2>How does Tighten use all three?</h2>
<p>Since OOCSS is an abstract coding methodology, BEM is a concrete application of OOCSS, and SMACSS is an OOCSS-focused organizational structure, they actually play together very nicely--especially when you throw Sass into the mix.</p>
<p>Each of our applications have a core <code>style.scss</code> file, which includes several partials. We use a SMACSS-inspired organizational structure, so we'll usually end up with a few basic files:</p>
<h3>style.scss</h3>
<p>Core file: imports the others.</p>
<h3>_base.scss</h3>
<p>Includes <code>normalize.css</code>, and also sets styles on base elements: <code>html</code>, <code>body</code>, <code>a</code>, <code>ul</code>, <code>li</code>, etc.</p>
<h3>_layout.scss</h3>
<p>Depending on the complexity of the site, we will likely have a file dedicated to layout. Grids, responsive frameworks, wrappers, etc. all live here.</p>
<h3>_modules.scss</h3>
<p>Includes definitions for our modules, or <strong>objects</strong>. The goal is for as much code to exist in here as possible, making it flexible and reusable. This file will just be a list of modules defined (and documented) one after another.</p>
<h3>_other.scss</h3>
<p>The name for this partial varies, but essentially this is all the code that doesn't fit in <code>_base</code>, <code>_layout</code>, or <code>_modules</code>. Code we just couldn't make modular; glue between modules; top level layouts; etc.</p>
<h3>_shame.scss</h3>
<p>Also from CSS Wizardry (<a href="http://csswizardry.com/2013/04/shame-css/">see CSS Wizardry's post on shame.css</a>), a <code>_shame</code> file is something we've been trying out only recently. This file is a place where you put all the code you're not proud of, with the intention of A) isolating it and B) fixing it later. The goal is for this file to be empty, but some times you just have to throw that hack in there to get it working.</p>
<p>We may also add a <code>_javascript.scss</code> if we're not using Gulp or Grunt to concatenate the styles for our Javascript plugins.</p>
<h2>Using BEM in Sass</h2>
<p>In the past, a lot of the benefits of nesting with Sass was lost when you switched to BEM:</p>
<pre><code class="language-scss">/* Sass pre-BEM: */
.object {
    color: red;

    .descendant {
        color: black;
    }
}
/* Generates:
    .object {
        color: red;
    }
    .object .descendant {
        color: black;
    }
*/

/* Sass with BEM: */
.object {
    color: red;
}
    .object__descendant {
        color: black;
    }
/* Generates:
    .object {
        color: red;
    }
    .object__descendant {
        color: black
    }
*/</code></pre>
<p>But with <a href="http://mikefowler.me/2013/10/17/support-for-bem-modules-sass-3.3/">Sass 3.3</a>, we can finally get Sass nesting with BEM modules using the &amp; to prefix our elements or modifiers:</p>
<pre><code class="language-scss">/* Sass 3.3+ w/BEM: */
.object {
    color: red;

    &amp;__descendant {
        color: black;
    }
}

/* Generates:
    .object {
        color: red;
    }
    .object__descendant {
        color: black
    }
*/</code></pre>
<h2>Hitimisho</h2>
<p>As you can see, OOCSS, SMACSS, and BEM <em>can</em> play together nicely. And, as a result, we start to see a lot of the benefits of Object Orientation come to fruition in even our frontend code. It's a beautiful thing.</p>
<p>Do you have tips, tricks, or corrections? Let me know on Twitter at <a href="http://twitter.com/stauffermatt">@stauffermatt</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/syncing-remote-craft-sites-to-your-development-machine</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/syncing-remote-craft-sites-to-your-development-machine"/>
        <title>Syncing remote Craft sites to your development machine</title>
        <published>2014-07-28T00:00:00+00:00</published>
        <updated>2014-07-28T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Keeping multiple Craft sites in sync is one of the...</summary>
        <content type="html"><![CDATA[
        <p>Keeping multiple <a href="http://buildwithcraft.com/">Craft</a> sites in sync is one of the few painful aspects of developing with Craft. When I'm working on my blog, I write all of my posts on the remote server, but when I want to make changes to the code I want to do it locally. So, on a regular basis, my production blog gets ahead of my local development copy, and in the past I had to manually sync down my data and uploaded assets.</p>
<p>I <a href="http://craftcms.stackexchange.com/questions/1415/is-there-an-easy-way-to-download-the-assets-directory-to-a-local-install">asked a question about this on the Craft StackExchange</a>, and I got some great answers. I came away thinking there's no perfect solution, so I built two new solutions, and want to present them together with a few great suggestions I got in that thread. Please note that I don't think any of these solutions are perfect for every setting, but instead that they're all tools in the belt of a Craft developer.</p>
<p>In order of ease-of-use, the solutions I've found for syncing assets from a remote Craft site to a local one are the following:</p>
<ol>
<li>My <a href="https://github.com/mattstauffer/craftcms-downloadAssets">DownloadAssets plugin</a></li>
<li>My <a href="https://github.com/mattstauffer/syncCraft">SyncCraft shell script</a></li>
<li>Rsync via Gulp (easier if you're already using Gulp)</li>
<li>Rsync via Grunt (easier if you're already using Grunt)</li>
<li>Capistrano or other automation tools</li>
</ol>
<blockquote>
<p>Note that, just because rsync via Gulp/Grunt may be harder to implement <em>if you're not running Gulp or Grunt already</em>, if you <em>are</em> already running Gulp or Grunt, you'll absolutely want to consider a solution that fits in with a tool you're already using. I personally use Gulp on all of my sites, and will strongly consider using Rsync via Gulp if I can get it to be as flexible as syncCraft. However, I'll be using syncCraft for the moment, since it also syncs my database.</p>
</blockquote>
<h2>1. DownloadAssets plugin</h2>
<p><a href="https://github.com/mattstauffer/craftcms-downloadAssets">DownloadAssets</a> is a Craft plugin that adds a dashboard widget that makes it simple to download a Zip archive of all of your assets, either by source or for the entire site. Note that it only downloads the assets from Local sources (not S3, etc.).</p>
<h2>2. syncCraft</h2>
<p><a href="https://github.com/mattstauffer/syncCraft">SyncCraft</a> is a simple shell script that allows you to download and import your Craft database <em>and</em> sync down only new assets into your local asset directory. The initial configuration can be a little bit of work, but once it's set up, syncing down your remote data and files is a snap.</p>
<h2>3. Rsync via Gulp</h2>
<p><a href="http://craftcms.stackexchange.com/a/1435/77">Dave Coggins wrote this fantastic answer on StackOverflow</a> on how to use Rsync via Gulp:</p>
<p>Another alternative to grunt is to use <a href="http://gulpjs.com/">http://gulpjs.com/</a>. This is what I use for minifying css js and assets etc. I've been meaning to setup a way of syncing folders so I've put together gulp task to do it. I have roughly tested it but you might want to look over the code before you use it on a production site :) Be aware that it is setup to sync the folder so it will remove any local files that are not present on your staging/production server.</p>
<p>To use gulp you need to have node.js installed with npm. First install gulp globally:</p>
<pre><code class="language-bash">$ npm install -g gulp</code></pre>
<p>You might need to run that as sudo.</p>
<p>Next, in the root of your craft project create a gulpfile.js that looks something like this:</p>
<pre><code class="language-javascript">// Gulp
var gulp = require('gulp');

// Plugins
var rsync = require("rsyncwrapper").rsync;

// Pull down assets and sync local folder
gulp.task('synclocal', function(){
    rsync({
        src: "username@hostname.com:/path/to/assets",
        dest: "assets",
        ssh: true,
        recursive: true,
        syncDest: true,
        compareMode: "checksum"
    },function (error,stdout,stderr,cmd) {
        if ( error ) {
            // failed
            console.log(error.message);
        } else {
            // success
            console.log("folder synced!")
        }
    });
});</code></pre>
<p>Finally we need to make sure rsyncwrapper is install. You can do this by running:</p>
<pre><code class="language-bash">$ npm install rsyncwrapper</code></pre>
<p>You should now be able to run the task by typing:</p>
<pre><code class="language-bash">$ gulp synclocal</code></pre>
<h2>4. Rsync via Grunt</h2>
<p><a href="http://craftcms.stackexchange.com/a/1434/77">Marion Newlevant shared a similar tip</a>, but for Rsync with Grunt instead of Gulp.</p>
<h2>5. Capistrano etc.</h2>
<p><a href="http://capistranorb.com/">Capistrano</a> is one of several tools built for
automating common tasks on multiple servers. It's extremely powerful and built for managing this type of workflow, but it's also a lot of work to learn. However, if you're looking for something with a lot of power and flexibility, one of these tools will certainly be your best option.</p>
<h2>Gabagabo</h2>
<p>I hope this writeup will help you get in a better place for keeping your  assets in sync between your Craft installs. Do you have suggestions, corrections, or requests for my scripts? Let me know on Twitter at <a href="http://twitter.com/stauffermatt">@stauffermatt</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-hosting-on-aws</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-hosting-on-aws"/>
        <title>Laravel Forge - Hosting on AWS</title>
        <published>2014-07-25T00:00:00+00:00</published>
        <updated>2014-07-25T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Note: Forge now supports AWS out of the box, but ...
        </summary>
        <content type="html"><![CDATA[
        <blockquote>
<p>Note: <a href="https://twitter.com/laravelphp/status/615527905955840000">Forge now supports AWS out of the box</a>, but much of  this tutorial still applies for other non-native VPSes.</p>
</blockquote>
<p>Laravel Forge originally had support for Rackspace and AWS (Amazon Web Services), but for various reasons it now supports three options: DigitalOcean, Linode, and &quot;Custom VPS.&quot;</p>
<p>Today we're going to get a rudimentary single-instance application running on AWS, managed by Forge, using the &quot;Custom VPS&quot; option. This post assumes little-to-no experience with AWS, but does assume general competency with managing servers, and experience with Forge.</p>
<h2>1. Sign up for AWS</h2>
<p>Visit <a href="http://aws.amazon.com/console">http://aws.amazon.com/console</a> and choose Sign Up. Have a credit card and a phone ready to verify your identity and to add payment information.</p>
<p>Even though you're entering your credit information, what we're setting up today will keep you on the <a href="https://aws.amazon.com/free/">Free tier</a>, so you don't have to worry about being charged immediately.</p>
<p><img src="/assets/images/content/aws-free-tier.png" alt="AWS Free Tier" /></p>
<h2>2. Visit the AWS console</h2>
<p>Once you're signed up and have verified your account, visit the <a href="https://console.aws.amazon.com">AWS console</a>. Click on the &quot;EC2&quot; button to take you to the management console for EC2, or &quot;Elastic Compute Cloud&quot;--Amazon's service for creating and managing Virtual Machines.</p>
<h2>3. Launch a new Instance</h2>
<p>From here, click &quot;Launch Instance&quot;.</p>
<p><img src="/assets/images/content/aws-dashboard-initial.png" alt="AWS ECS Dashboard" /></p>
<h2>4. Choose your Machine Image</h2>
<p>This allows you to specify which Machine Image--that is, which pre-created recipe for a Virtual Machine--you'd like to base this intance off of. For Forge, you'll want to use <strong>Ubuntu Server 14.04 LTS (HVM)</strong>, so <strong>Select</strong> that one.</p>
<p><img src="/assets/images/content/aws-select-machine.png" alt="AWS Select Machine image" /></p>
<h2>5. Choose Instance Type</h2>
<p>For this demo, we'll go for the lowest power, free option: t2.micro.</p>
<p><img src="/assets/images/content/aws-instance-type.png" alt="AWS Instance Type" /></p>
<p>Rather than Launching now, let's walk piece by piece through the configuration process.</p>
<h2>6. Configure Instance Details</h2>
<p>You can now configure all the specific configuration details for this instance.</p>
<p>The defaults here are fine for a demo, although if you plan to rely on this simple server for anything you'll probably want to check <strong>Enable Termination Protection</strong> so the server will reboot if anything happens to shut it down. When you're done, move to the next screen.</p>
<p><img src="/assets/images/content/aws-instance-details.png" alt="AWS Instance Details" /></p>
<h2>7. Add Storage</h2>
<p>We can configure the amount and type of storage our instance will have available. The default is an 8<a href="http://en.wikipedia.org/wiki/Gibibyte">GiB</a> SSD drive, so let's just keep that as-is and move on.</p>
<p><img src="/assets/images/content/aws-add-storage.png" alt="AWS Add Storage" /></p>
<h2>8. Tag Instance</h2>
<p>AWS allows you to tag each instance with up to 10 key/value pairs. This can be useful if you want to sort or add permissions to instances later (using IAM roles) based on client (Client=Bob), environment (Environment=Staging), management service (Managed-By=Forge), or more.</p>
<p>If this is confusing, feel free to just skip it. I just added Managed-By=Forge.</p>
<p><img src="/assets/images/content/aws-tags.png" alt="AWS Tag Instance" /></p>
<h2>9. Configure Security Group</h2>
<p>Security Groups allow you to associate multiple instances together with a single set of security permissions. Security Groups allow you to both apply the same settings to multiple instances, <em>and</em> create an instant firewall surrounding just the members of that group--one of the primary permissions options for rules is &quot;only members of this security group.&quot;</p>
<p>Therefore, you'll want to create a new security group for each project you're working on.</p>
<p>Depending on your needs, you'll want to add an entry for each. I added SSH, HTTP, MySQL, and you could also add IMAP/SMTP/POP3 if you need mail. You'll see the dropdown contains many other options for adding security access rules.</p>
<p><img src="/assets/images/content/aws-security-group.png" alt="AWS Security Groups" /></p>
<p>For now, add:</p>
<ul>
<li>An SSH entry with &quot;Anywhere&quot; (you'll want to lock this down to just specific IP addresses later)</li>
<li>An HTTP entry with &quot;Anywhere&quot;</li>
<li>A MySQL entry for &quot;My IP&quot;&quot;</li>
</ul>
<blockquote>
<p><strong>SECURITY CAUTION FROM AMAZON:</strong> If you use 0.0.0.0/0 (&quot;Anywhere&quot;) for SSH, you enable all IP addresses to access your instance using SSH. This is acceptable for a short time in a test environment, but it's unsafe for production environments. In production, you'll authorize only a specific IP address or range of addresses to access your instance.  </p>
<p><strong>NOTE:</strong> I'm not entirely certain of what the correct settings are for SSH to allow Forge to connect. For now, the only way I know is to open SSH access from &quot;Anywhere&quot;, but I've messaged Taylor to see if there's a better configuration that both allows Forge access, but locks down your SSH access a bit.</p>
</blockquote>
<p>If, later, you're creating a multiple-instance application stack, you will be able to set a Custom IP of &quot;this security group&quot; and allow any instances within this server to talk to each other.</p>
<h2>10. Download key pair</h2>
<p>You might be familiar with SSH key authentication. AWS uses the .pem format, which is yet another way for you to download pieces of a security certificate for authenticating with other machines, etc. If you're not familiar, this file you're downloading will allow you to authenticate yourself to AWS without needing to type a password every time.</p>
<p>This is another great chance to have a specific key per project; but it's entirely up to you. You could also choose to have one key for all of your Forge accounts, one key for the entirety of your Amazon account, or whatever else. You'll see in the screenshots I created one for laravel-forge, but again, I would likely do this project-specific in the future.</p>
<p><img src="/assets/images/content/aws-key-pair.png" alt="AWS Key Pairs" /></p>
<p>Download the file, and place it in a location you'll remember. I created a <code>pem</code> directory in <code>~/.ssh</code> and placed it there (<code>~/.ssh/pem/laravel-forge.pem</code>).</p>
<h2>11. Review and Launch Instance</h2>
<p><img src="/assets/images/content/aws-review-instance-launch.png" alt="AWS Review Instance" /></p>
<p>Finally, it's time! Review everything you have set, and once you're satisfied, <strong>Launch</strong> the instance.</p>
<p><img src="/assets/images/content/aws-launched.png" alt="AWS Site Launched" /></p>
<blockquote>
<p>Note: you can optionally click &quot;Creating Billing Alerts&quot; to set up notices for when you get billed over a certain amount.</p>
</blockquote>
<p>Wait a bit for it to get up and running, and then go back to <strong>View Instances</strong> and check the instance. Now, down at the bottom of the screen, you'll be able to view all the important information about this instance.</p>
<p><img src="/assets/images/content/aws-view-instances.png" alt="AWS View Instance" /></p>
<h2>12. Add Forge Site</h2>
<p>Log into Forge, and add a new site with the &quot;Custom VPS&quot; tab. Fill in all the fields with the values from the &quot;View Instance&quot; screen on the AWS Console (the screenshot above).</p>
<p><img src="/assets/images/content/forge-add-custom-vps.png" alt="Forge Add Custom VPS" /></p>
<p>Now click &quot;Create Server&quot;. You'll get a popup with a code snippet:</p>
<p><img src="/assets/images/content/forge-provision-instructions.png" alt="Forge Custom Provision Instructions" /></p>
<p>Copy the code from there, paste it somewhere temporary, and adjust where it says <code>bash forge.sh</code> to instead say <code>sudo bash forge.sh</code>--without <code>sudo</code>, you won't have the permissions to run it on your AWS instance.</p>
<blockquote>
<p>Note: Running <code>sudo</code> on a script you're downloading from the Internet can be dangerous. But I trust Taylor, and this is an https connection, so I think we're safe. If you know otherwise, please let me know.</p>
</blockquote>
<p>Open up your local terminal. Before we SSH using the .pem file we downloaded earlier, we'll need to set its permissions appropriately. From the command line, <code>chmod 400</code> the file:</p>
<pre><code class="language-bash">$ chmod 400 ~/.ssh/pem/laravel-forge.pem</code></pre>
<p>Now, ssh in using the following format:</p>
<pre><code class="language-bash">$ ssh -i ~/path-to-pem-file ubuntu@instance-public-dns</code></pre>
<p>For example, based on my configuration, you'll get:</p>
<pre><code class="language-bash">$ ssh -i ~/.ssh/pem/laravel-forge.pem ubuntu@ec2-54-191-246-246.us-west-2.compute.amazonaws.com</code></pre>
<p><img src="/assets/images/content/chmod-and-ssh.png" alt="Chmod and SSH for AWS" /></p>
<p>Now you're SSH'ed into your new instance! Finally, run the command from Taylor. The first half downloads a shell script named <code>forge.sh</code> and the second half (remember, <code>sudo bash forge.sh</code>) runs it.</p>
<p>You should see a ton of notices scrolling by, and eventually see the server reboot (and kick you off of SSH).</p>
<p><img src="/assets/images/content/reboot-after-forge-sh.png" alt="Reboot after Forge/AWS installation" /></p>
<p>If you see this, it means Forge has successfully linked with your instance, and you should see a Forge provisioning email show up in your email inbox any minute!</p>
<p><img src="/assets/images/content/forge-welcome-email.png" alt="Forge Welcome Email" /></p>
<h2>13. Set up your DNS</h2>
<p>Now, just like with any site on Forge, head over to your DNS and add an A record pointing to your new Public IP:</p>
<p><img src="/assets/images/content/dns-record.png" alt="Add instance DNS record" /></p>
<h2>Miscellany</h2>
<ul>
<li>All of your files that are deployed via Forge will be owned by the Forge user, not the ubuntu user. So, to easily edit your Forge-deployed files (or to use Git with them), be sure to SSH in as <code>forge</code> instead of as <code>ubuntu</code>. I recommend adding an entry to your ssh config file to make it easier: <img src="/assets/images/content/ssh-config.png" alt="SSH Config settings" />  Then you can just ssh with <code>$ ssh aws-demo</code></li>
<li>Your MySQL settings in database.php should point to your <em>private IP</em>, not your <em>public IP</em>.</li>
<li>Here are the settings you'll want to set up Sequel Pro or a similar SQL client. Please note that the SQL password are from the Forge provisioning email, and we're using our .pem file to authenticate SSH: <img src="/assets/images/content/sequel-pro.png" alt="Sequel Pro Settings for AWS instance" /></li>
</ul>
<h2>Casgliad</h2>
<p>That's it! You now have a fully-functional, single-instance application running on AWS, with a MySQL server, managed by Forge, with a domain pointing at it. There's a lot more to do from here--especially if you want to really take hold of the opportunities AWS makes available to you--but you've got the basics now!</p>
<p>Questions? Concerns? Did I royally screw something up (I'm new at this AWS thing, so please do let me know)? Hit me up on <a href="http://twitter.com/stauffermatt">Twitter</a>. Otherwise, enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/screencast-converting-a-flattened-pdf-to-html-css-in-45-minutes</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/screencast-converting-a-flattened-pdf-to-html-css-in-45-minutes"/>
        <title>Screencast: Converting a flattened PDF to HTML/CSS in 45 minutes</title>
        <published>2014-07-23T00:00:00+00:00</published>
        <updated>2014-07-23T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I recorded a brief video of me converting a flatte...</summary>
        <content type="html"><![CDATA[
        <p>I recorded a brief video of me converting a flattened PDF mockup of a web site into a HTML/CSS landing page in about 45 minutes.</p>
<iframe width="560" height="315" src="//www.youtube.com/embed/dVtKNyNZRe8?rel=0" frameborder="0" allowfullscreen></iframe>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/screencast-ionic-framework-demo</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/screencast-ionic-framework-demo"/>
        <title>Screencast: Ionic Framework Demo</title>
        <published>2014-07-17T00:00:00+00:00</published>
        <updated>2014-07-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I spoke at the Frontend Awesome meetup in Gainesvi...</summary>
        <content type="html"><![CDATA[
        <p>I spoke at the Frontend Awesome meetup in Gainesville FL and gave a brief demo of the Ionic Framework.</p>
<iframe width="420" height="315" src="//www.youtube.com/embed/nh9EARpk-dc?rel=0" frameborder="0" allowfullscreen></iframe>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-using-recipes</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-using-recipes"/>
        <title>Laravel Forge - Using Recipes</title>
        <published>2014-07-09T00:00:00+00:00</published>
        <updated>2014-07-09T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Forge comes with a lot of built-in functionality, ...</summary>
        <content type="html"><![CDATA[
        <p>Forge comes with a lot of built-in functionality, but what if you want to make some changes on your own? You can always SSH into your servers to make individual changes, but some times there are changes you want to make on a regular basis, or to every one of your servers.</p>
<p>To address this need--regularly running the same, pre-written script across one or many servers--Forge has the concept of a Recipe. Let's try one out.</p>
<h2>Step 1: Find a recipe</h2>
<p>Visit <a href="http://forgerecipes.com/">Forge Recipes</a> and find a recipe you like. We'll be using <a href="http://blog.enge.me/">artisangoose's</a> recipe <a href="http://forgerecipes.com/recipes/9">&quot;Install ElasticSearch&quot;</a> for our demo. Select all of the content of the recipe and copy it to your clipboard.</p>
<p><img src="/assets/images/content/ElasticSearch-Recipe.png" alt="ElasticSearch Recipe" /></p>
<h2>Step 2: Add the recipe</h2>
<p>Go to the <a href="https://forge.laravel.com/recipes">Recipes page</a> on Forge, and add the recipe.</p>
<p><img src="/assets/images/content/Add-Recipe.png" alt="Add Recipe" /></p>
<h2>Step 3: Run the recipe</h2>
<p>You'll now see your recipe at the bottom of this page in the &quot;Your Recipes&quot; section.</p>
<p><img src="/assets/images/content/Your-Recipes.png" alt="Your Recipes" /></p>
<p>Click the green &quot;play&quot; button to show a popup of all of your servers; check the servers you want to run the script on, press the &quot;Run&quot; button, and that's it!</p>
<p><img src="/assets/images/content/run-recipe.png" alt="Run Recipe" /></p>
<p>Once the recipe is finished running, Forge will email you the results.</p>
<h2>Ter afsluiting</h2>
<p>Now you can create your own arsenal of readymade recipes and run them at your will on your server(s). Once the collection of recipes at ForgeRecipes really grows, there's a ton of potential for these recipes to be the means by which we install and update features that Forge doesn't manage out of the box.</p>
<p>That's it! Enjoy!</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/laravel-on-heroku-using-a-buildpack-locally-to-mimic-your-heroku-environment-nginx
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-on-heroku-using-a-buildpack-locally-to-mimic-your-heroku-environment-nginx"/>
        <title>Laravel on Heroku - Using a Buildpack locally to mimic your Heroku environment (Nginx)</title>
        <published>2014-06-29T00:00:00+00:00</published>
        <updated>2014-06-29T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">So by this point you&#039;ve got your app and running, ...</summary>
        <content type="html"><![CDATA[
        <p>So by this point you've got your app and running, and deployed to Heroku. You probably even have a ClearDB MySQL database connected to it on Heroku.</p>
<p>But your local environment and database are not particularly in sync with your production environment. Thankfully, Heroku provides the ability to run their &quot;buildpacks&quot; locally to ensure a local environment that's in sync with your remote environment.</p>
<blockquote>
<p>Note: I wrote a blog post to get this running on a local Apache install, but the number of steps and configuration issues it required was out of reach for a simple tutorial. The folks at Heroku have shared that they're in the middle of making changes to the Apache configuration for the buildpack, so I expect it'll get easier soon. For now, let's roll with Nginx.</p>
</blockquote>
<p>Open up your app's composer.json and add the following to the end of it (or just add the buildpack to your require-dev section, if you already have one):</p>
<pre><code>  "require-dev": {
    "heroku/heroku-buildpack-php": "dev-master"
  }</code></pre>
<p>Run <code>composer update</code>, and you'll now have the Heroku PHP Buildpack installed locally. Now, create a file in your project root directory named <code>.env</code> and place the following code into it:</p>
<pre><code>CLEARDB_DATABASE_URL=mysql://root:123abc@127.0.0.1/my_laravel_heroku_database_name</code></pre>
<p>This file is a configuration file for the Buildpack, setting an environment var named <code>CLEARDB_DATABASE_URL</code> and setting its value to <code>mysql://root:123abc@127.0.0.1/my_laravel_heroku_database_name</code>. This version we created is just for local testing, so add it to your <code>.gitignore</code>.</p>
<p>Note that you'll need to update the username (<code>root</code>), password (<code>123abc</code>), and database name (<code>my_laravel_heroku_database_name</code>) for your local environment. Heroku's local buildpack won't be serving MySQL for you, so you'll need MySQL running.</p>
<blockquote>
<p>NOTE: If you don't have a command-line mysql accessible and working, Mac/Homebrew users can <code>brew install mysql</code> and then follow the directions to have launchd start mysql at login. I believe the default username is <code>root</code> and the default password is blank.</p>
</blockquote>
<p>Finally, run <code>foreman start</code> (unfamiliar with Foreman? Check out my <a href="http://mattstauffer.co/blog/using-a-procfile-to-streamline-your-local-development">blog post introducing Procfiles</a>) to get everything up and running.</p>
<blockquote>
<p>Note: If you get the following response: <code>This program requires PHP 5.5.11 or newer; check your 'php' command.</code>, it means your local version of PHP is not up to date with what Heroku is expecting. Run <code>php -v</code> on the command line to find what version you're running. Hopefully you're on a Mac using Homebrew, because if you are it's a relatively painless fix: run <code>brew update</code>, then <code>brew install --with-fpm php55</code> and then `brew install php55-mcrypt'. Follow the instructions that are output after you run the installer and you should have PHP 5.5 up and running shortly.</p>
</blockquote>
<p>You'll now have a CLEARDB_DATABASE_URL env var available for use in your local database.php just like <a href="http://mattstauffer.co/blog/laravel-on-heroku-using-a-mysql-database">we did in the production database.php</a> (but note we've added a bit to the code to allow for null passwords locally). The benefit of using the <code>.env</code> file like is this it that we can use the same <code>database.php</code> on dev and prod, and just rely on the <code>.env</code> file to change up the database credentials:</p>
<pre><code class="language-php">$url = parse_url(getenv("CLEARDB_DATABASE_URL"));

$host = $url["host"];
$username = $url["user"];
$password = array_key_exists('pass', $url) ? $url["pass"] : '';
$database = substr($url["path"], 1);

return array(
    'mysql' =&gt; array(
        'driver'    =&gt; 'mysql',
        'host'      =&gt; $host,
        'database'  =&gt; $database,
        'username'  =&gt; $username,
        'password'  =&gt; $password,
        'charset'   =&gt; 'utf8',
        'collation' =&gt; 'utf8_unicode_ci',
        'prefix'    =&gt; '',
    )
);</code></pre>
<p>With that, you have a development-ready local environment that mimicks the Heroku PHP buildpack. Just visit <a href="localhost:5000">localhost:5000</a> in your browser and you're good to go!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-wildcard-subdomains</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-wildcard-subdomains"/>
        <title>Laravel Forge - Wildcard Subdomains</title>
        <published>2014-06-23T00:00:00+00:00</published>
        <updated>2014-06-23T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;ve ever used a site like Harvest or Slack, ...</summary>
        <content type="html"><![CDATA[
        <p>If you've ever used a site like <a href="http://www.getharvest.com/">Harvest</a> or <a href="http://slack.com/">Slack</a>, you've experienced group-specific subdomains. If your company is named <a href="http://tighten.co/">Tighten</a>, you'll get <code>tighten.slack.com</code>, <code>tighten.harvestapp.com</code>, etc.</p>
<p>In order to implement a feature like this on your own Forge-hosted site, you'll need to be able to create a Site that accepts not just one domain but many. Thankfully, this is easy with Wildcard Subdomains.</p>
<h2>Allow Wildcard Sub-Domains</h2>
<p>When you add a new site, notice that there's a checkbox at the bottom of the form that says &quot;Allow Wildcard Sub-Domains.&quot; If you check this box, any subdomain under the domain you enter in the &quot;Root Domain&quot; will be passed to this Site.</p>
<p><img src="/assets/images/content/forge-wildcard-subdomains.png" alt="Forge Add Wildcard Subdomain Checkbox" /></p>
<h2>How does this work?</h2>
<p>Well, imagine you're setting yourself up a Harvest competitor named Schmarvest. You want to set up <code>Schmarvestapp.com</code> so that every subdomain underneath it is reserved for a different user, but you want all of those thousands of subdomains to all be served from one single Laravel app.</p>
<p><img src="/assets/images/content/schmarvest.jpg" alt="Schmarvest" /></p>
<p>If you just create a new site in Forge for <code>Schmarvestapp.com</code>, and <em>don't</em> use the Wildcard Sub-domains checkbox, you'll see your primary domain (<code>schmarvestapp.com</code>) will work just fine. But if you try to visit one of your subdomains, nothing will happen. <code>tighten.schmarvestapp.com</code> won't go anywhere. You could, if you wanted, add a new Site for each of those subdomains, but they'd each be hosted on a completely separate codebase.</p>
<p>Instead, add a Site for <code>schmarvestapp.com</code> that has the &quot;Allow Wildcard Sub-Domains&quot; option checked. Now if you visit any subdomain under your domain (and if your DNS is pointed to Forge correctly), you'll still always hit your one install.</p>
<h2>DNS for wildcard</h2>
<p>So, all of this has been assuming you have your domain routing set correctly at your DNS. But what <em>is</em> the appropriate routing?</p>
<p>The most appropriate option is a wildcard A record. So, in your DNS provider's editor, add a new &quot;A&quot; record for your domain.</p>
<p>Set the &quot;Name&quot; field to be <code>*</code> (or <code>*.yourdomain.com</code>, depending on the prompts your registrar gives you for format). Set the &quot;Address&quot; field to that of your Forge Server's IP address. And do whatever you'd like with your TTL.</p>
<p><img src="/assets/images/content/schmarvest-a-record.png" alt="Schmarvest A Record" /></p>
<p>That's it! Wait for an hour or so and now all requests to this domain and its subdomains will head over to your Forge server.</p>
<h2>Ikadii</h2>
<p>That's it! Time for Schmarvest world domaination.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-password-protect-a-folder</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-password-protect-a-folder"/>
        <title>Laravel Forge - Password Protect a Folder</title>
        <published>2014-06-17T00:00:00+00:00</published>
        <updated>2014-06-17T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Now that the initial hubbub of trying out new Lara...</summary>
        <content type="html"><![CDATA[
        <p>Now that the initial hubbub of trying out new Laravel apps in Forge is over, we've started to put more non-Laravel sites on Forge as well.</p>
<p>Today I needed to get an old CodeIgniter site online <em>somewhere</em>, password-protected, to train someone on. So, I spun up a new site on one of my Forge servers, uploaded the code, ran the migrations, and was ready to go--until I realized I didn't know how to password protect a folder in Nginx.</p>
<p>Thankfully, it's almost easier than it is in Apache.</p>
<h1>Generate htpasswd file</h1>
<p>Just like when you're password protecting a folder in Apache, you'll need to generate a <code>htpasswd</code> file. You can <a href="http://g33kinfo.com/info/archives/3351">create the htpasswd file locally</a> or use <a href="http://tools.dynamicdrive.com/password/">DynamicDrive's web-based htpasswd generator</a>. Either way, you should end up with a small text file that convention suggests you name <code>.htpasswd</code>.</p>
<p>Upload this file to your remote server. I like to put it in the web root for my site and then git ignore it (and, of course, if you're serving the site from the web root you'll want to move it above that level). So my file will live in <code>/home/forge/my-site-name-here/.htpasswd</code>.</p>
<h1>Point Nginx config to htpasswd</h1>
<p>Now log into Forge. Edit the site you want to password protect. Click the edit icon in the lower right hand corner of the site edit panel, and a box to edit your Nginx config file will pop up.</p>
<p><img src="/assets/images/content/forge-edit-icon.png" alt="Forge Site Edit Icon" /></p>
<p>If you want to password protect the entire site, just append a few lines to the end of the <code>location /</code> block, taking it from this:</p>
<pre><code>location / {
        try_files $uri $uri/ /index.php?$query_string;
    }</code></pre>
<p>to this:</p>
<pre><code>location / {
        try_files $uri $uri/ /index.php?$query_string;

        auth_basic            "Restricted Area";
        auth_basic_user_file  /home/forge/my-site-name-here/.htpasswd;
    }</code></pre>
<p>If you want to just password protect a particular folder, create a new <code>location {}</code> block and place the auth instructions there. <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location">Learn more about location blocks</a> at the Nginx docs.</p>
<p>Now save the Nginx config in Forge. Forge will auto-apply the config, so you won't need to restart Nginx manually.</p>
<h1>That's it</h1>
<p>Next time you visit this site, you'll see the (probably) familiar HTTP authentication popup. All done!</p>
<p><img src="/assets/images/content/forge-password-prompt.png" alt="Forge Password Prompt" /></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/using-a-procfile-to-streamline-your-local-development</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/using-a-procfile-to-streamline-your-local-development"/>
        <title>Using a Procfile to streamline your local development</title>
        <published>2014-06-11T00:00:00+00:00</published>
        <updated>2014-06-11T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">I&#039;m currently working on an app that I&#039;m developin...</summary>
        <content type="html"><![CDATA[
        <p>I'm currently working on an app that I'm developing with the <a href="http://ionicframework.com/">Ionic framework</a>. As is common lately, I have multiple processes I want running concurrently as I develop the app: I want to have Gulp running while I develop in order to manage my assets, and I want a quick and dirty local web server to preview it.</p>
<p>Every time I opened up my terminal to work on this site, I'd open up three tabs. One for gulp, one for the server, and one for general folder management: <code>git</code>, <code>ls</code>, <code>cp</code>, etc. And I'd have to re-create this tab layout every time.</p>
<blockquote>
<p>(Note: I know one of the solutions for this would be to start using <a href="http://tmux.sourceforge.net/">tmux</a>, and the moment I do I'll write it up.)</p>
</blockquote>
<h2>Introducing Foreman</h2>
<p><img src="/assets/images/content/procfile-ionic.png" alt="Procfile running" /></p>
<p>But there's a simple solution for this: <a href="https://github.com/ddollar/foreman">Foreman</a>. Foreman is a tool that allows you to declare the processes that are necessary in order to run your app in a file called a <code>Procfile</code>. Then just run Foreman and it'll start up all of your processes together, at once, with a nice color-coded output.</p>
<h2>Installing Foreman</h2>
<p>Assuming you have Ruby running on your system, simply run <code>gem install foreman</code> from anywhere on your commandline and you're good to go.</p>
<h2>Creating your first Procfile</h2>
<p>A Procfile is comprised of lines that follow this syntax:</p>
<pre><code class="language-bash">process_nickname: shell_command_to_run_process</code></pre>
<p>So in order to create a process nicknamed &quot;gulp&quot; which runs <code>gulp watch</code>, I'd add the following line to my Procfile:</p>
<pre><code class="language-bash">gulp: gulp watch</code></pre>
<p>That's it! You can run as many of these as you want at a time.</p>
<h2>My Ionic Procfile</h2>
<p>So, here's my Procfile for Ionic:</p>
<pre><code class="language-bash">gulp: gulp watch
serve: ionic serve</code></pre>
<h2>Running Foreman</h2>
<p>Now that I have a working Procfile (named <code>Procfile</code>) in the root of my project, I simply run <code>foreman start</code> and I can see the processes start up and echo out their notices. I can quit out at any point with CTRL-C.</p>
<p>Personally, I like to run this from my IDE's built-in Terminal, and then if I use my IDE's folder/file management and VCS (Git) tools, I can completely stay out of the Terminal while I develop this app. Less alt-tabbing means more focus, which I can't complain about!</p>
<h2>Isiphetho</h2>
<p>That's it! Go forth and Procfile!</p>
<p>Questions? Favorite procfiles you want to share? <a href="http://twitter.com/stauffermatt">Hit me up on Twitter</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-adding-an-ssl-cert</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-adding-an-ssl-cert"/>
        <title>Laravel Forge - Adding an SSL Cert</title>
        <published>2014-06-02T00:00:00+00:00</published>
        <updated>2014-06-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Christopher Pitt has written a fantastic article ...
        </summary>
        <content type="html"><![CDATA[
        <p><a href="https://medium.com/laravel-4/forge-ssl-66b4252db7d8"><img src="/assets/images/content/Screen_Shot_2014-06-02_at_7.40.21_AM.png" alt="Christopher Pitt's Forge + SSL header" /></a></p>
<p>Christopher Pitt has written a fantastic article about adding an SSL cert in Forge, so I'm not going to duplicate that work.</p>
<p>Check out his post <a href="https://medium.com/laravel-4/forge-ssl-66b4252db7d8">Forge + SSL</a>.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-scheduling-a-cron-job</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/laravel-forge-scheduling-a-cron-job"/>
        <title>Laravel Forge - Scheduling a Cron Job</title>
        <published>2014-06-02T00:00:00+00:00</published>
        <updated>2014-06-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">PHP by its nature acts in response to a request. A...</summary>
        <content type="html"><![CDATA[
        <p>PHP by its nature acts in response to a request. A visitor comes to your URL, and your app spins up, processes the request, performs the appropriate actions in response, and then shuts down. Visit twenty pages in a row? This process happens twenty times in a row. But what about when you're not around?</p>
<p>We've already covered <a href="http://mattstauffer.co/blog/laravel-forge-adding-a-queue-worker-with-beanstalkd">queues and queue workers</a>, and we'll talk about daemons soon. But cron jobs are the simplest way to keep things moving in the background, rather than relying on user requests to perform all of your app's logic and heavy lifting. Let's set up our first cron job on Forge.</p>
<h2>Forge Scheduler</h2>
<p><img src="/assets/images/content/forge-add-cron-job.png" alt="Forge Add Cron Job Screen" /></p>
<p>Honestly, there's not much to explain here.</p>
<p>That's the best part about cron jobs on Forge: You no longer have to memorize the <a href="http://en.wikipedia.org/wiki/Cron#Format">order of the time slots on the cron format</a>. You no longer have to fight hosts who don't offer crons. Click the &quot;Scheduler&quot; tab on your Forge server, choose the path and frequency, hit Schedule Job, and you're done.</p>
<h2>Command</h2>
<p>The default path is <code>php /home/forge/default/artisan scheduled:run</code>, which shows you that the simplest use of cron in Laravel is to trigger Artisan commands.</p>
<p>We have an internal app that consumes the Harvest API. But it's painfully slow when we allow the users' visits to trigger the API sync. So now, we have this running every hour in the background:</p>
<pre><code class="language-bash">php /home/forge/sauce/artisan harvest:sync</code></pre>
<p>Note that you're not limited to Artisan commands. Run MySQL backups, run custom shell scripts, copy files around, or whatever else you'd prefer. If you can run it on the command line, you can run it here.</p>
<h2>User</h2>
<p>Determine the system user who's running this command. Keep it at <code>forge</code> unless you know what you're doing. :)</p>
<h2>Frequency</h2>
<p>This does what it says on the tin. Note that the custom schedule option allows you to use the familiar asterisk-style scheduler. </p>
<p><img src="/assets/images/content/forge-schedule.png" alt="Forge Scheduler Options" /></p>
<p>A quick reminder of what that means:</p>
<blockquote>
<p>From left to right, Minutes Hours Day-of-Month Month Day-of-Week </p>
<ul>
<li>First asterisk = Minutes: 0-59 </li>
<li>Second asterisk = Hours: 0-23 </li>
<li>Third asterisk = Day of Month: 1 - 31 </li>
<li>Fourth asterisk = Month: 1 - 12 </li>
<li>Fifth asterisk = Day of Week: 0 - 6 (0 is Sunday, 6 is Saturday) </li>
</ul>
<p><code>*</code> means &quot;every&quot;. So <code>* * * * *</code> means &quot;every minute of every hour of every day of every month&quot;. </p>
</blockquote>
<h2>Logs</h2>
<p>For any cron jobs that are running, you can view logs for the output of your cron jobs, so you can diagnose any errors (or just see that they're working).</p>
<p><img src="/assets/images/content/forge-cron-logs.png" alt="View Forge Cron Logs" /></p>
<h2>Conclucado</h2>
<p>That's it! Go forth and schedule!</p>    ]]></content>
    </entry>
    <entry>
        <id>
            https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-3-dotfiles-rc-files-and-ssh-config
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-3-dotfiles-rc-files-and-ssh-config"/>
        <title>Setting up a new (OS X) development machine: Part 3 - Dotfiles and custom SSH config</title>
        <published>2014-05-28T00:00:00+00:00</published>
        <updated>2014-05-28T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">So far we&#039;ve gotten our core files synced, our ter...</summary>
        <content type="html"><![CDATA[
        <p>So far we've gotten our core files synced, our terminal beautiful and customized, and our global package managers installed and running many of our command-line and GUI apps. But we've left a littered heap of configuration files laying around and there's a lot more customization we haven't even touched.</p>
<h2>Dotfiles</h2>
<h3>What are Dotfiles?</h3>
<p>If you're not familiar with the concept of dotfiles, check out <a href="http://dotfiles.github.io/">Github's dotfiles page</a> to learn more about them. Essentially, when someone says &quot;dotfiles&quot; they mean maintaining your command-line preferences in a Git repository (sort of like how I use Dropbox to manage my preference files for TextExpander, etc.) that you install on every computer.</p>
<p>The name <strong>dotfiles</strong> refers to the fact that most of the files that perform this sort of configuration start with a dot. The Zsh configuration file, for example, is <code>.zshrc</code>. The SSH configuration folder is <code>.ssh</code>. And on. So the concept of &quot;dotfiles&quot; just means &quot;versioning your configuration files.&quot;</p>
<p>Your dotfiles will help you create powerful and consistent shell shortcuts and functions, settings for your editors, color coding and layouts for your shell, preferences and authentication for ssh and mysql and other protocols, and more.</p>
<p>I recently forked my old Bash dotfiles as a <a href="https://github.com/mattstauffer/ohmyzsh-dotfiles">ZSH dotfiles</a> project, but they're still a bit of a work in progress, so user beware. </p>
<blockquote>
<p>NOTE: There are a lot of dotfiles floating around on the Internet. <a href="https://github.com/holman/dotfiles">Zack Holman has a well-known collection</a>, as do Paul Irish and Matthias Bynens (all three of these are very Internet-trustworthy, for what that's worth). Be careful installing dotfiles from a source you don't trust. Blindly running a dotfiles installer, or even just adding particular config files to your machine, can add some un-safe settings if you don't understand what you're doing.</p>
</blockquote>
<h3>Common dotfiles</h3>
<ul>
<li><code>.zhsrc</code>, <code>.bashrc</code>, <code>.bash_profile</code>, <code>.bash_prompt</code>, etc: These are the configuration files for your shell. From here you can set up aliases (shortcuts), functions, environment variables, and even include other configuration files.</li>
<li><code>.curlrc</code>, <code>.gvimrc</code>, <code>.vimrc</code>, <code>.wgetrc</code>, etc.: These are configuration files for particular command-line programs. You might be setting font information, default connection information, and more.</li>
<li><code>.gitattributes</code>, <code>.gitconfig</code>: Global git configuration</li>
<li><code>.screenrc</code>, <code>.inputrc</code>, <code>.hushlogin</code>: These are files configuring specific aspects of your connection to the shell and/or the terminal.</li>
</ul>
<h3>Installing dotfiles</h3>
<p>Depending on the dotfiles repository you're using (or if you're just managing it on your own), there are many different options for configuring and managing your dotfiles' installation process.</p>
<p>Any dotfiles repo will expect you to clone the dotfiles repo to your local computer (I do mine at ~/.dotfiles) and then use any method to copy or link those files down into your root directory.</p>
<p>Paul Irish/Mathias Bynens' dotfiles (which mine are branched from) use a script that <em>copies</em> the dotfiles from your dotfiles repo. I actually think this <em>isn't</em> a great idea, because it makes making and syncing changes with the repo a pain. I much prefer Zack Holman's method, which <em><a href="http://en.wikipedia.org/wiki/Symbolic_link">symlinks</a></em> the files instead, allowing you to git pull and watch your dotfiles instantly update.</p>
<p>You can also manually copy files from your dotfiles directory to your root, or you can use one of several dotfiles maintenance apps--I don't have any experience with them, but a friend whom I trust recommended <a href="http://robots.thoughtbot.com/rcm-for-rc-files-in-dotfiles-repos">rcm</a>, so I'll probably be trying that out soon, too.</p>
<h3>Tweaking your dotfiles after installation</h3>
<p>No matter where you got your dotfiles from, they're <em>not</em> unchangeable rules. They're just suggestions. I suggest that if you get someone else's dotfiles repo, you start by reading through <em>every</em> file and understand what they're doing--and disabling anything you don't like.</p>
<p>If you want to make a change later, just go to your home directory and edit those files. If you want to save your changes, and you're working from someone else's repo, <em>fork</em> that repo and clone the forked version instead. That way you can make your changes, and (if you're symlinked, simply, and if you're not symlinked, with a wee bit of work) push your changes back up to your repo. Want to learn more? Check out Zack Holman's excellent post <a href="http://zachholman.com/2010/08/dotfiles-are-meant-to-be-forked/">Dotfiles Are Meant to Be Forked</a>.</p>
<h3>Which to fork?</h3>
<p>After talking up Zach Holman's dotfiles so much, I hope you'll consider checking them out. But--they weren't around when I really started digging into dotfiles, so I have my own, somewhat less modern set of dotfiles. I did update them a bit this week, but they're still based on copying instead of symlinking, etc. Check both out (<a href="https://github.com/holman/dotfiles">Zack's</a> | <a href="https://github.com/mattstauffer/ohmyzsh-dotfiles">Mine</a>) and pick those which you think are best. FYI, my next free weekend will be trying out Zack's, so mine might be on their way to the graveyard soon.</p>
<h2>SSH</h2>
<h3>SSH config file</h3>
<p>Another set of configurations that I don't want available through the public repo is my SSH config, where I store shortcuts, SSH usernames and URLs, and more. But, I do want it to sync across my devices. So I set it up in my Dropbox folder and then symlink that file into my ssh folder. For example:</p>
<pre><code class="language-bash">$ touch ~/Dropbox/.ssh-config
$ ln -s ~/Dropbox/.ssh-config ~/.ssh/config</code></pre>
<p>Now we have an ssh config file that lives in our dropbox directory and will be synced across all of our machines <em>every</em> time we make a change -- without relying on putting our SSH information publicly on Github.</p>
<p>Here's a snippet of what an SSH config file might look like:</p>
<pre><code class="language-bash"># My Awesome Web Site
Host awesome
    Hostname 141.141.141.141
    User me_duh
    IdentityFile=/Users/me/.ssh/id_for_awesome_site.rsa

# My Other Awesome Web Site
Host other
    Hostname ps12345.awesomehost.com
    User me_still</code></pre>
<p>Now, I can just type the following and I'll be instantly SSH'ed in (after typing the password, if I haven't set up SSH key authentication):</p>
<pre><code class="language-bash">$ ssh awesome</code></pre>
<p>Done. No more remembering ip addresses, fumbling with command line switches for multiple SSH IDs, or even remembering your ssh usernames. There are many more features you can manage via your SSH config file, if you want--ports, tunneling, and more. Check out the <a href="http://linux.die.net/man/5/ssh_config">ssh_config docs</a> for more information.</p>
<h3>SSH keygen</h3>
<p>If you're not familiar with SSH Key authentication, you might be confused at how you could possibly authenticate with those web sites above <em>without</em> a password. Well, you could type your password every time. But there's a much faster way, if you're willing to do some leg work up front.</p>
<p>I don't have the space here to give a full intro, but here's a quick <a href="https://help.github.com/articles/generating-ssh-keys">Github Guide to generating an SSH Key on your new machine</a>. Or, if you're a pro:</p>
<pre><code class="language-bash">$ ssh-keygen -t rsa -C 'your@email.com'
  [ follow prompts ]
$ pbcopy &lt; ~/.ssh/id_rsa.pub</code></pre>
<p>Now you have the public version of the key copied to your clipboard, ready to add to Github, Forge, or even upload to your remote site. Again, there's not enough space to do a full intro here to remote SSH key authentication, but here's the short walkthrough to the super-hacky version <strong>if you're already familiar</strong>:</p>
<pre><code class="language-bash">$ pbcopy &lt; ~/.ssh/id_rsa.pub
$ ssh my_username@myhost.host
  [ type password ]
$ cd ~/.ssh
$ vim authorized_keys
  [ paste your key at the end of the file]
  [ save file and quit ]</code></pre>
<p>If you're not familiar with it, though, please don't just follow the above instructions. They're very hacky, and assume you know what to do if they files and folders aren't there, you know how to use Vim/emacs/pico, and a lot more. If you're new to that world, I suggest you check out other tutorials online to get a better grasp on that. I've never found a tutorial I'm 100% satisfied with, but here are a few: (<a href="http://articles.slicehost.com/2010/10/18/ubuntu-maverick-setup-part-1">Slicehost</a> <a href="http://www.cyberciti.biz/tips/ssh-public-key-based-authentication-how-to.html">nixCraft</a> <a href="http://code.tutsplus.com/tutorials/ssh-what-and-how--net-25138">TutsPlus</a>)</p>
<p>There's a utility named <code>ssh-copy-id</code> that aims to simplify this process, but I've had mixed results with it. You can also do it with <code>scp</code>, but you need to know what you're doing so you don't potentially overwrite someone else's keys. Are you a guru on this? <a href="http://twitter.com/stauffermatt">Hit me up on Twitter</a> and I'll update this section with any tips you have to offer.</p>
<blockquote>
<p>NOTE: If you're using Forge, you don't have to follow this step about <code>authorized_keys</code>. Just <code>pbcopy</code> your <code>id_rsa.pub</code> and paste it into the SSH keys box in Forge. That's it!</p>
</blockquote>
<h2>Conclusion</h2>
<p>I could write an entire blog series about all of the things that my and Zack's dotfiles do. Coloring your grep output, boosting your <code>ls</code> commands, adding plugins to vim, optimizing your <code>curl</code> and <code>wget</code>, adding convenient functions and methods  for your day-to-day work in the terminal... But I'll leave that to you, dear reader, to explore and discover when you read the dotfiles <em>before</em> you install them. Right? Right.</p>
<p>My hope is, even if I haven't explained every piece of every dotfile, you'll come away from this blog post feeling excited and ready to try out versioning your dotfiles and maybe learning a bit from others'.</p>
<p>Do you have any tips about dotfiles or SSH config that I missed here? Do you think I should add another blog post to this series, or add to the existing posts? <a href="http://twitter.com/stauffermatt">Hit me up on Twitter</a> and let me know. Thanks, and I hope you've enjoyed! Check out my next (and, for now, final) post showing a stripped-down walkthrough my of my install process, without explanations.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-2-global-package-managers</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-2-global-package-managers"/>
        <title>Setting up a new (OS X) development machine: Part 2 - Global Package Managers</title>
        <published>2014-05-28T00:00:00+00:00</published>
        <updated>2014-05-28T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In the last post, we synced down our core configur...</summary>
        <content type="html"><![CDATA[
        <p>In the last post, we synced down our core configuration files and customized our terminal. Next we'll set up global package managers to manage our system-level (and app-level) dependencies, including installing most of our command-line and GUI apps.</p>
<p>Package managers are the best way to simplify the installation process, because they require minimal work from the user's perspective and provide greater flexibility, consistency, and automation of the install process than installing apps manually.</p>
<h2>RVM (Ruby Version Manager)</h2>
<p>If you're working with Ruby--even if it's just for Sass and Compass--you <em>absolutely</em> want to use a version manager. The old standby, which I'm most familiar with, is RVM, but of you're familiar with Rbenv that'll do fine as well. Either way, a Ruby version manager will make it easy to install, manage, and switch between multiple versions of Ruby on the same system.</p>
<p>Install RVM:</p>
<pre><code class="language-bash">$ \curl -sSL https://get.rvm.io | bash -s stable --ruby</code></pre>
<p>Now you have convenient command-line methods to install, manage, and switch to Ruby versions easily. </p>
<p>Learn more about how to handle your Ruby versions at RVM's site: <a href="http://rvm.io/rvm/basics">RVM basics</a></p>
<h2>Install NPM (Node Package Manager) &amp; Node</h2>
<p>If you're working with Node--even if it's just for Gulp or Grunt--you already know that you need Node &amp; NPM. You technically <em>can</em> install these with package managers like Homebrew, but I've heard that NPM and Homebrew often battle each other and that it's worth installing it separately.</p>
<p>Thankfully, Node's installer packages are extremely easy to use: <a href="http://nodejs.org/download/">Install Node</a> (Note: there is a <a href="https://github.com/creationix/nvm">Node Version Manager</a>, if you need to be able to swap out versions of Node. If you're a NodeJS developer, you'll probably want to look there.)</p>
<h2>Homebrew</h2>
<p>Homebrew is a package manager like Composer, NPM, or RubyGems, but the apps it installs are OS X system-wide command-line (and, with the addition of cask, system-wide GUI) apps for the Mac. Almost any app you've ever installed and used from the Mac command line--php, mysql, optipng, etc.--can likely be installed and managed via Homebrew.</p>
<blockquote>
<p>NOTE: Before you install Homebrew, you'll need the latest version of the Xcode command line tools. Thankfully, recent versions of OS X have started auto-prompting you to download it when you try to do anything relatively complex from the command line, so I'm not going to attempt to provide instructions for that here.</p>
</blockquote>
<h3>Installing Homebrew</h3>
<p>You can visit the <a href="http://brew.sh/">Homebrew home page</a> to learn more, or just run the following command to install Homebrew:</p>
<pre><code class="language-bash">$ ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</code></pre>
<h3>Installing your Homebrew packages</h3>
<p>To install a package with Homebrew, you can do one of two things. The classic way of installing a package using Homebrew is to just pass the package (recipe) name as a parameter to the command line app:</p>
<pre><code class="language-bash">$ brew install package_name_here</code></pre>
<p>However, it's still pretty awkward and manual to paste in a massive list of packages to install using this method. So, Homebrew folks created a Brewfile, which is like a Gemfile (or composer.json, or package.json).</p>
<blockquote>
<p>NOTE: The syntax and tooling for Brewfiles have changed. I hope to update this post soon, but for now look here: <a href="https://github.com/Homebrew/homebrew-bundle">github/homebrew-bundle</a></p>
</blockquote>
<p>A Brewfile is just a text file listing out all of the commands you'd like Homebrew to run in order, one command for each line.</p>
<blockquote>
<p>Note: if you ever see <code>brew tap repo_name_here</code>, it's helpful to know that the <code>tap</code> command allows you to add Github repositories to your list of installable Homebrew packages. This way you can install packages that aren't a part of the core Homebrew list of available recipes.</p>
</blockquote>
<h3>Creating your Brewfile</h3>
<p>Of course, since we're talking about automating here, I prefer the Brewfile option. Thoughtbot has written a great article entitled <a href="http://robots.thoughtbot.com/brewfile-a-gemfile-but-for-homebrew">Brewfile: a Gemfile, but for Homebrew</a> that will give you all the details you need. We'll end up with a file looking something like this:</p>
<blockquote>
<p>NOTE: This entire section is now a bit out-of-date. I hope to update it very soon (would love help if you want to translate it into modern brewfile-ese for me) but if you're following this, <a href="https://github.com/Homebrew/homebrew-bundle">check out the GitHub README</a> for instructions for how it works these days.</p>
</blockquote>
<pre><code class="language-ruby"># Matt Stauffer's awesome Brewfile
tap josegonzalez/php
tap homebrew/dupes
install openssl
install php54-mcrypt
install josegonzalez/php/composer
install wget
install optipng
install redis
install mysql
install phpunit
install postgresql</code></pre>
<p>As you can tell, Homebrew just runs each line as if you had run <code>brew tap josegonzalez/php</code>, <code>brew tap homebrew/dupes</code>, <code>brew install openssl</code>, etc., one after another.</p>
<p>Now, once I've installed Homebrew, I can just navigate to the directory with my Brewfile and run <code>brew bundle</code>. Done.</p>
<h3>Homebrew casks</h3>
<p>Up until recently, Homebrew only installed command-line programs. But the <a href="http://caskroom.io/">homebrew-cask</a> project allows you to manage GUI apps--that is, apps with a graphical interface like Chrome and Skype--via Homebrew as well. Recipes that are for GUI apps are called casks.</p>
<p>First, let's install cask:</p>
<pre><code class="language-bash">$ brew install caskroom/cask/brew-cask</code></pre>
<p>Next, let's try our first install:</p>
<pre><code class="language-bash">$ brew cask install google-chrome</code></pre>
<p>And just like that, you have Google Chrome installed. No navigating to the web site, no downloads, no mounting installers... just run <code>brew cask install app-name</code> and you're ready to go.</p>
<blockquote>
<p>NOTE: In order to make your Casks install to sensible and predictable locations, I recommend adding the following line to your ~/.zshrc or ~/.bash_profile. <code>export HOMEBREW_CASK_OPTS="--appdir=/Applications"</code></p>
</blockquote>
<p>But that can still take a while. If only we could have some sort of file that listed out all of our casks. Something like... a <em>Caskfile</em>. Yes! There's a Caskfile! Can our lives get any easier here?</p>
<p>There's actually no difference between a Caskfile and a Brewfile, which means we'll need to preface all of our lines with <code>cask</code>--<em>but</em>, that means we can even install cask within our caskfile!</p>
<p>Check it out:</p>
<pre><code class="language-ruby"># Matt's awesome caskfile
# Install Cask
install caskroom/cask/brew-cask

# Install Casks
cask install alfred
cask install caffeine
cask install flux

cask install virtualbox
cask install vagrant

cask install google-chrome
cask install iterm2
cask install phpstorm
cask install sequel-pro
cask install macvim

cask install adium
cask install nvalt
cask install rdio
cask install slack
cask install textexpander
cask install vlc
cask install the-unarchiver</code></pre>
<p>If you want to run <code>brew bundle</code> on a file that's not named <code>Brewfile</code>, just append the file to the end of the command:</p>
<pre><code class="language-bash">$ brew bundle Caskfile</code></pre>
<p>That's it! As you can tell, a Caskfile is really just a Brewfile that we decided to give a different name and a focused set of commands.</p>
<p>Now that I showed you how to create a separate Caskfile, I'm going to flip the script: You could just move your entire Caskfile up into your Brewfile above, run it, and call it a day. Single file installs everything.</p>
<h3>Matt's Sample Brewfile</h3>
<pre><code class="language-ruby"># Matt Stauffer's awesome Brewfile With Casks
tap josegonzalez/php
tap homebrew/dupes
install openssl
install php54-mcrypt
install josegonzalez/php/composer
install wget
install optipng
install redis
install mysql
install phpunit
install postgresql

# Install Cask
install caskroom/cask/brew-cask

# Install Casks
cask install alfred
cask install caffeine
cask install flux

cask install virtualbox
cask install vagrant

cask install google-chrome
cask install iterm2
cask install phpstorm
cask install sequel-pro

cask install adium
cask install nvalt
cask install rdio
cask install slack
cask install textexpander</code></pre>
<p>We now have a single Brewfile that will cover 75% of the apps you need to operate your computer, all with one simple install.</p>
<p>Do you have any favorite casks or essential Homebrew recipes that I missed? <a href="http://twitter.com/stauffermatt">Shout out on Twitter</a>.</p>
<p>In my next post I'll talk about creating and syncing dotfiles across your computers, and a Brewfile (or a Caskfile) would be a perfect candidate for that.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-1-core-files-and-custom-shell
        </id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/setting-up-a-new-os-x-development-machine-part-1-core-files-and-custom-shell"/>
        <title>Setting up a new (OS X) development machine: Part 1 - Core Files and Custom Shell</title>
        <published>2014-05-27T00:00:00+00:00</published>
        <updated>2014-05-27T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Between onboarding new developers, wiping old comp...</summary>
        <content type="html"><![CDATA[
        <p>Between onboarding new developers, wiping old computers and starting from scratch, and buying new computers, I've done a fresh install of my development environment at least a dozen times in the last year or so. Over this time I've started identifying ways I can optimize my experience of getting a new machine started.</p>
<p>I'd love to share some of these tips with you, and I'd also love to hear your tips from you <a href="http://twitter.com/stauffermatt">on Twitter</a> and add them to this post.</p>
<h2>Sync your &quot;core&quot; files</h2>
<p>The first thing I do when I'm setting up a new machine is get my core files in. There are many ways to sync these core preferences and configuration files--storing them on a thumb drive, in your email, Github, etc.--but I use Dropbox to sync them. So, before I do anything else, I start the Dropbox syncing process. 1password, Alfred, zsh, textexpander, and many of my other apps rely on configuration files that I sync across my machines with Dropbox, so Dropbox sync is vital.</p>
<p><img src="/assets/images/content/dropbox-oh-my-zsh.png" alt="Dropbox shortcut" /></p>
<h2>Set up your terminal environment</h2>
<p>Now that we have our core files synced, we're ready to start customizing our terminal.</p>
<p>Before I do any work in the terminal, I'll be sure to install iTerm2. I actually install it using Homebrew Cask, but we won't get to that until the next blog post, so for now just <a href="http://www.iterm2.com/">download iTerm2</a> and install it.</p>
<p>iTerm2 is free, highly used and tested, and adds a ton of custom functionality that you can add <em>later</em> if you'd like, and also handles some <em>default</em> functionality and styles better than OS X Terminal. So, even if you don't notice the difference, just start with iTerm2 now for the sake of future you.</p>
<h3>Zsh/OhMyZSH</h3>
<p>You may not know this, but even when you open the terminal, you're interacting with one particular &quot;shell&quot;--the default on your Mac is called Bash. You can choose which shell you're most comfortable with, although the default for most people is going to be Bash.</p>
<p>For years I maintained a set of configuration files for exactly how I wanted my Bash configured, which I had stolen and cobbled from others. You can still see it at <a href="http://www.github.com/mattstauffer/dotfiles">github.com/mattstauffer/dotfiles</a>.</p>
<p>But about a year ago, I discovered that there's a shell called <a href="http://www.zsh.org/">Zsh</a>, and together with a plugin infrastructure called <a href="http://ohmyz.sh/">OhMyZSH</a>, it had all of my desired features (and many more) right out of the box. I can't recommend Zsh+OhMyZSH enough.</p>
<p><img src="/assets/images/content/ohmyzsh.jpg" alt="Oh-My-ZSH preview" /></p>
<p>Installing OhMyZSH is extremely easy, and Zsh is already available on your system:</p>
<pre><code class="language-bash">$ curl -L http://install.ohmyz.sh | sh</code></pre>
<p>Run that, follow the prompts, edit your <code>~/.zshrc</code> file to set a <a href="http://zshthem.es/">theme</a> and choose your plugins, and you're ready to go!</p>
<h3>.zshrc</h3>
<p>Your <code>~/.zshrc</code> file is the configuration file for Zsh. <a href="http://en.wikipedia.org/wiki/Rc_file">(What are RC files?)</a></p>
<p>When you first install OhMyZSH, it'll create a <code>.zshrc</code> with some default settings and options that allow you to choose your OhMyZSH theme, plugins, and settings.</p>
<p>Edit the file in your favorite editor and change the default settings to whatever you'd prefer, and check back in a few posts to see my favorite defaults for my own <code>.zshrc</code>.</p>
<h2>Next: RVM, NPM, Homebrew, and Cask</h2>
<p>At this point you have a nicely styled, turbo-boosted terminal and synced access to all of your core config files.</p>
<p>Next, we're going to talk about using Homebrew to install command-line and GUI apps, manage dependencies and Ruby versions with NPM and RVM, and use dotfiles to configure your terminal, your editors, and your SSH connections.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-adding-a-queue-worker-with-beanstalkd</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-adding-a-queue-worker-with-beanstalkd"/>
        <title>Laravel Forge - Adding a Queue Worker with Beanstalkd</title>
        <published>2014-05-23T00:00:00+00:00</published>
        <updated>2014-05-23T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Laravel has a suite of features offering the abili...</summary>
        <content type="html"><![CDATA[
        <p>Laravel has a suite of features offering the ability to push data and/or functionality onto queues, and to assign &quot;workers&quot; to pull items off the queue one-by-one and operate on them.</p>
<p>There a plenty of use cases for this, but one common one is that it saves your users from waiting while the server peforms a complex operation like processing an uploaded image. With queues, the user's interaction pushes the &quot;process image&quot; task (along with any details about the particular image, the user's id, etc.) onto a queue. Then it releases the user back to whatever they were doing. Meanwhile, the queue worker is silently popping one more task off the top of the queue, acting on it, deleting it, and moving on to the next.</p>
<p>There are many different drivers for Laravel; the default is &quot;sync&quot;, which just runs the code as if there were no queue. You can use queues on external services, like Iron.io and Amazon SQS. Or you can run your own queue locally, which is what Laravel Forge provides with beanstalkd. In addition, Forge makes it simple to start up a queue worker to run down any of your queues, whether locally on beanstalkd or remotely on Iron.io, and act on them.</p>
<h2>Warning: No detectEnvironment closures</h2>
<p>I've <a href="http://mattstauffer.co/blog/laravel-forge-using-environment-variables-for-environment-detection">written about this before</a>, but using a Closure (often with environment variables) to detect your environment instead of an array of hostnames is a little bit of a second-class citizen in Laravel and even more so in Forge. By this, I mean this won't work in Forge:</p>
<pre><code class="language-php">$env = $app-&gt;detectEnvironment(function() {
   return getenv('APP_ENV') ?: 'production';
});</code></pre>
<p>Well, this is even more true with Queue Workers--so much that, unless someone shows me what I'm missing, I'm ready to say <strong>it is impossible</strong> (or at least wildly impractical) to use Laravel beanstalkd queues together with a detectEnvironment Closure. Not only does the detectEnvironment Closure not have the environment variables available to it, but <strong>when you're running commands from a queue, it ignores detectEnvironment entirely if you're using a Closure</strong>.</p>
<p>I could only get my push queues to work (including correctly detecting environment) if A) I switched detectEnvironment to use a hostnames array or B) was satisfied with the environment always being &quot;production&quot; (which is fallback response if you use a Closure for your detectEnvironment).</p>
<p>I would guess this is more of a bug or an oversight than an intentional design decision. Or, it's me just doing something wrong. I hope to dig through the source soon and try to wrap my brain around the Artisan bootstrap to understand it better. But for now: If you use a closure to detect your environment, and the environment name for your Forge server isn't &quot;production,&quot; you'll have to hold off on this for now. (Am I wrong? Please <a href="http://twitter.com/stauffermatt">let me know</a>!)</p>
<h2>Writing your code</h2>
<p>Assuming we're OK with either A) detecting environment using hostname or B) defaulting to the environment name 'production' for all queues, we're ready to go.</p>
<p>First, you'll want to write a Job Handler, which is really any class with a 'fire' method (and you can even customize which method name gets called). At the end of the fire method, make sure to delete that job so it's removed from the qeueue. You can learn a lot more about Laravel queues at the <a href="http://laravel.com/docs/queues">docs</a>.</p>
<pre><code class="language-php">namespace Company\Twitter;

class ProfilePuller
{
    public function fire($job, $data)
    {
        // do something with $data['twitter_handle']

        $job-&gt;delete();
    }
}
</code></pre>
<p>Now that you have a job handler, you'll want to push a job up to your queue, referencing that class and passing some data, somewhere in your code--in a controller, for example:</p>
<pre><code class="language-php">Queue::push('Company/Twitter/ProfilePuller', [
    'twitter_handle' =&gt; 'stauffermatt'
]);</code></pre>
<p>At this point, if you run your code that triggers this queue it's going to work perfectly. Wait, is it that easy to get your queues set up?</p>
<p>Not quite. The Laravel default queue driver is 'sync', which means &quot;run this code synchronously as if we weren't using queues at all.&quot; When the controller hits that <code>Queue::push</code> line, it runs the code in your job handler just like it was inline code. But we want it to run asynchronously. </p>
<h2>Updating your config</h2>
<p>The next step is telling your app to use your beanstalkd queue instead of the 'sync' queue.</p>
<p>Find the config files for your present environment. For me it was <code>app/config/forge/queue.php</code> (create this file and structure it like the default queue.php if it doesn't exist).</p>
<p>The queue config file has a parameter that's named 'default', which is set to 'sync'. If you've ever edited your app's database settings, this format will be very familiar. Change 'sync' to 'beanstalkd' and your queue pushes will now hit your Forge Beanstalkd queue.</p>
<pre><code class="language-php">return array(
    'default' =&gt; 'beanstalkd'
);</code></pre>
<h2>Requiring Pheanstalk</h2>
<p>There's a composer package that Laravel requires in order to interact with beanstalkd: <code>pda/pheanstalk</code>. Add this to your composer.json and install it.</p>
<pre><code class="language-bash">$ composer require pda/pheanstalk</code></pre>
<h2>Starting the worker</h2>
<p>Push your code up to your Forge server.</p>
<p>Log into Forge, click through the interface to your Site, click the Queue Workers tab, and click Start Worker with all the defaults still entered. These defaults will start a worker that uses the beanstalkd driver, the &quot;default&quot; queue, and some default timeouts and tolerances. You now have a worker up and running, hitting your default queue on your beanstalkd server, managed and kept running by <a href="http://supervisord.org/">Supervisor</a>.</p>
<p><img src="/assets/images/content/add-new-queue-worker.png" alt="Start new Laravel Forge Queue Worker" /></p>
<h2>Watching the worker do its thing</h2>
<p>That's it! Go trigger your <code>Queue::push</code> code from earlier. That'll push the queue task up onto beanstalkd, the worker will pull it down and act on it, and then delete it, and the queue will be clean again. You're good to go, and now your users can breeze around your app, unaware of the raw processing power being thrown at their tasks. There are also plenty of other use cases for queues, but other people (and the docs) have already covered that well. </p>
<p>If you are having any trouble, or want to see evidence of the queue working, go check your logs--which, of course, by this point, are <a href="http://mattstauffer.co/blog/laravel-forge-logging-with-papertrail">logging to Papertrail</a>, right? Nice and easy.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-using-environment-variables-for-environment-detection</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-using-environment-variables-for-environment-detection"/>
        <title>Laravel Forge - Using Environment Variables for Environment Detection</title>
        <published>2014-05-19T00:00:00+00:00</published>
        <updated>2014-05-19T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">NOTE: This post has been completely re-written bec...</summary>
        <content type="html"><![CDATA[
        <p><strong>NOTE: This post has been completely re-written because of some changes in Forge's environment variable handling.</strong></p>
<p>At any given point in your Laravel app's life, it'll have a particular &quot;environment&quot; defined, which is a string that identifies which environment (local, production, staging, etc.) you're running in. There are two hard-coded environments (production and testing) that have Laravel-specific meanings, but you can create as many as you want.</p>
<p>The ruleset you provide Laravel for detecting your environment happens in <code>bootstrap/start.php</code>. The default is to pass in an associative array, which allows you to change your environment based on your machine's hostname:</p>
<pre><code class="language-php">$env = $app-&gt;detectEnvironment(array(
    'local' =&gt; array('your-machine-name'),
));</code></pre>
<p>You can also pass a Closure (anonymous function) to detectEnvironment. Our team at Tighten often uses Environment Variables:</p>
<pre><code class="language-php">$env = $app-&gt;detectEnvironment(function() {
    if (getenv('APP_NAME_ENV')) {
        return getenv('APP_NAME_ENV');
    } else {
        return 'local'; // Default
    }
});</code></pre>
<p>Forge originally only stored its environment variables in <code>.env.ENVIRONMENTNAMEHERE.php</code> files, which cause problems with this method of environment detection. This is no longer the case.</p>
<p><strong>However</strong>, based on some of my experiences with queues and other aspects of Forge, I'd still highly recommend you use the associative array form of environment detection rather than using a Closure. Try the following:</p>
<pre><code class="language-php">$env = $app-&gt;detectEnvironment(array(
    'production' =&gt; array('your-forge-staging-server-host-name-here'),
    'local' =&gt; array('homestead', '.local')
));</code></pre>
<p>This means: Set the environment to &quot;production&quot; on my Forge server, set it to &quot;local&quot; if it's running on my Homestead vagrant VM, and set it to &quot;local&quot; if it's running locally on anyone's development machine (<a href="http://en.wikipedia.org/wiki/.local">learn more about .local</a>).</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-forge-logging-with-papertrail</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-forge-logging-with-papertrail"/>
        <title>Laravel Forge - Logging With Papertrail</title>
        <published>2014-05-16T00:00:00+00:00</published>
        <updated>2014-05-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;re up and running with a Laravel Forge serv...</summary>
        <content type="html"><![CDATA[
        <p>If you're up and running with a Laravel Forge server, you can monitor your app's logs using the traditional Laravel log functionality, and you can also SSH in and tail your log files manually.</p>
<blockquote>
<p>Note: Forge's Papertrail option is no longer baked in to the UI, but it's still possible to manually connect your Forge servers to Papertrail.</p>
</blockquote>
<p>But Forge has a pre-built connection with an app called <a href="http://papertrailapp.com/">Papertrail</a> that takes all of your logs and pulls them into one, easy-to-view SAAS. And it's painfully easy to set up.</p>
<h2>Step 1: Get your Forge server up and running</h2>
<p>Sign up for Forge. Get your server up and running. Go to the Server page and click the Monitoring tab.</p>
<h2>Step 2: Sign up for Papertrail</h2>
<p>Sign up at <a href="http://papertrailapp.com/">papertrailapp.com</a> and navigate to the <a href="https://papertrailapp.com/systems/setup">Setup Systems page</a>. Grab the &quot;your systems will log to&quot; URL and copy it.</p>
<p><img src="/assets/images/content/forge-papertrail-get.png" alt="Get Papertrail URL" /></p>
<h2>Step 3: Sync</h2>
<p>Paste this value into your Forge Monitoring tab. Wait for it to provision--this should just take a few minutes.</p>
<p><img src="/assets/images/content/forge-papertrail-set.png" alt="Paste Papertrail URL" /></p>
<h2>Step 4: Add a syslog handler</h2>
<p>At this point Papertrail is logging your system logs, but not your Laravel logs. To add Laravel logs, you'll need to add a Syslog Monolog handler.</p>
<p>This would be best in a service provider, but if you just want to test it out you can put at the top of <code>app/routes.php</code>.</p>
<p>We're basically going to create a new Syslog handler for Monolog and push it onto the logging stack.</p>
<pre><code class="language-php">$monolog = Log::getMonolog();
$syslog = new \Monolog\Handler\SyslogHandler('papertrail');
$formatter = new \Monolog\Formatter\LineFormatter('%channel%.%level_name%: %message% %extra%');
$syslog-&gt;setFormatter($formatter);

$monolog-&gt;pushHandler($syslog);
</code></pre>
<p>As you can see, we're creating a syslog handler, naming it, providing it a formatter template (which you can customize to your liking), and then pushing it on the monolog handler stack.</p>
<h2>Step 5: Profit</h2>
<p>Go back to your Papertrail account and view your logs. That's it! Try throwing an exception in your code to see your Laravel logs show up in your Papertrail account.</p>
<p><img src="/assets/images/content/forge-papertrail-logs-preview.png" alt="Papertrail preview" /></p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/getting-your-first-site-up-and-running-in-laravel-forge"/>
        <title>Getting your first site up and running in Laravel Forge</title>
        <published>2014-05-15T00:00:00+00:00</published>
        <updated>2014-05-15T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">If you&#039;re here, you&#039;ve likely already heard about ...</summary>
        <content type="html"><![CDATA[
        <p>If you're here, you've likely already heard about Taylor Otwell's announcement at Laracon about <a href="https://vagrantcloud.com/laravel/homestead">Homestead</a> and <a href="https://forge.laravel.com/">Forge</a>.</p>
<p>For an interview with Taylor, the story of how Taylor released hints and puzzles to the community before Laracon, and for a little bit about why Forge is great, check out Adam Engebretson's post <a href="http://blog.enge.me/post/laravel-forge-how-taylor-just-saved-us-hours-of-work">Laravel Forge - How Taylor Just Saved Us Hours of Work</a>.</p>
<h3>What is Forge and how can I use it today?</h3>
<p>Here, we'll be focusing mainly on the gritty details of Forge. What does it do? How? How can I use it today?</p>
<p><a href="https://vagrantcloud.com/laravel/homestead"><strong>Homestead</strong></a> is a way to develop your Laravel sites locally that provides a consistent environment that's in line with Taylor's preferred development stack: Nginx, MySQL/PostgreSQL, Beanstalk, Redis, Memcached, and PHP 5.5 (at the moment.) Homestead is a pre-configured Vagrant box that matches the stack provided by Forge. Learn more about Homestead <a href="http://laravel.com/docs/homestead">here</a>.</p>
<p><a href="http://forge.laravel.com/"><strong>Forge</strong></a> is a way to host your Laravel sites on a consistent, predictable, and flexible environment. It's a PAAS (platform as a service) that manages and simplifies the deployment of your code to Digital Ocean, Linode, Amazon EC2, or Rackspace, including creating a remote hosting environment with feature parity to Homestead so your dev and prod environments can be as close as possible. If you're familiar with FortRabbit, Heroku, or EngineYard Cloud, Forge is similar to those--but it's also pretty unique in a few ways.</p>
<p>So! Let's walk through the steps to getting your first Laravel app deployed on Forge.</p>
<h2>Sign up</h2>
<p><a href="https://forge.laravel.com/auth/register">Sign up for Forge</a>. Simple enough.</p>
<h2>Authenticate Github</h2>
<p>In order to give Forge access to your sites' codebases, you want to visit the Dashboard to give Forge permission to access your Github account.</p>
<p>You will be able to manually SSH into your sites at any point, but the automated code deployment features--and there are quite a few of them--all depend on Github.</p>
<p>Also, every new server will automatically be authenticated to your Github account via an SSH key, so even if you deploy manually, Forge's Github connection will make it simpler and smoother.</p>
<p><img src="/assets/images/content/forge-github-authenticate.png" alt="Github Authentication" /></p>
<h2>Authenticate with a cloud provider</h2>
<p>On the <a href="https://forge.laravel.com/servers">servers page</a> you'll find the first option is to create a new server. Now is a good time to talk about the distinction between the various hosts.</p>
<p>The four hosts you can use with Forge (DigitalOcean, Linode, Rackspace, and Amazon) all allow the user (or a service like Forge acting in your stead) to configure the settings for a virtual machine that will run your web site. In creating Homestead and Forge, Taylor has created a single &quot;preferred&quot; environment for Laravel, and allowed you (via Homestead) to develop locally using it and (via Forge) to deploy to any of these four services.</p>
<p>So, the environment will be the same no matter which server you use. If you don't have an account with any of the four servers, DigitalOcean is easy and user-friendly, and if you sign up with <a href="https://www.digitalocean.com/?refcode=74cfe5250e9c">this link</a> I get a referral bonus. :)</p>
<h3>Finding your API keys</h3>
<p>In order to grant Forge control over your servers, you'll need to give it API keys (and possibly other pieces of information, depending on the server).</p>
<h4>DigitalOcean</h4>
<p>Log in. In the left nav, the bottom item says &quot;API&quot;; click that and you'll get your Client ID and be able to generate or retrieve an API key.</p>
<p><img src="/assets/images/content/forge-digitalocean.png" alt="DigitalOcean API" /></p>
<h4>Linode</h4>
<p>Create or revoke API keys under <a href="https://manager.linode.com/profile/">My Profile</a></p>
<h4>Rackspace</h4>
<p><a href="http://www.rackspace.com/knowledge_center/article/rackspace-cloud-essentials-generating-your-api-key">Generating Rackspace API Key</a></p>
<h4>Amazon</h4>
<p><a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">Getting your Access Key ID and Secret Access Key</a></p>
<h2>Create your first server</h2>
<p>Once you've entered your authentication information, it's time to create your first server!</p>
<p><img src="/assets/images/content/forge-add-server.png" alt="Create New Server" /></p>
<h3>Name</h3>
<p>Every server needs to have a unique name. Refresh the page a few times and you'll see that Forge is auto-generating readable nonsense names. You can put anything you want in here, but note that it'll need to be unique across your provider's servers, so you probably won't get away with &quot;my-web-site&quot; or something similar.</p>
<h3>Server Size</h3>
<p>Pick your poison. I always start with the cheapest option and upgrade as needed.</p>
<h3>Region</h3>
<p>Many hosts have servers all across the world. If you don't have any other infrastructure-related reason to choose a particular region, try to pick the region closest to the majority of your userbase.</p>
<h3>Database Name (optional)</h3>
<p>If you create your first database here, you'll save yourself the step below titled &quot;Create Your Database.&quot;</p>
<h3>HHVM/Hack</h3>
<p>For now, just leave this unchecked. These are experimental and flaky (in general, and more so on Forge). Save that for an experiment on a later day.</p>
<h3>Click Create</h3>
<p>That's it! You'll see the server appear down below with the status; it'll start with <em>Building</em> and then move on to <em>Provisioning</em>, and within a few minutes you'll be up and running with an <em>Active</em> server.</p>
<p>Once the server goes active, you can click the Manage button...</p>
<h2>Configuring your first server</h2>
<p>OK, so you now have a Forge-provisioned server up and running. It's actually live on the Internet! In the Status Bar at the top of the page, you'll see two IP addresses, one with parentheses around it.</p>
<p><img src="/assets/images/content/forge-server-page.png" alt="Server Page" /></p>
<p>The first (non-parentheses-wrapped) IP address is your server's public IP address, and if you type this IP into a browser you'll see the `phpinfo()`` for your server.</p>
<p>The second (parentheses-wrapped) IP address is your server's internal IP address. Just leave that one alone for now.</p>
<h2>SSH key</h2>
<p>You should be receiving an email in a moment with all of the configuration details you need, but you won't be able to use them until you upload your SSH key to Forge. </p>
<p>Click the SSH Keys tab and upload your local SSH Key. <a href="https://help.github.com/articles/generating-ssh-keys">How to create and copy an SSH Key?</a></p>
<p><img src="/assets/images/content/forge-ssh-keys.png" alt="SSH Keys" /></p>
<h2>Point your domain</h2>
<p>If you intend to visit the site you're setting up via a real domain (versus just testing it by visiting the IP address), you should set that up now, because DNS record changes can take a while to update. Go to your domain name provider, add an ANAME record for the domain or subdomain, and point it to the public IP address of your server. That's it!</p>
<h2>Create your first site</h2>
<p>Every Forge <em>server</em> can have many <em>sites</em> on it. Traditionally, a site will be one site/one domain/one repository, although if you have multiple subdomains or domains served from the same Laravel repo, you may have multiple domains served from one site. But the hard rule is that there is <em>always</em> a one site to one repo relationship.</p>
<p>By default there's a &quot;default&quot; site installed, which you can use if you plan on this server only serving one web site (or if you're just trying this out and plan to access the app only via its IP address). Otherwise, delete it and follow the directions below to create your first site.</p>
<p><img src="/assets/images/content/forge-add-site.png" alt="Add Site" /></p>
<h3>Configure domain and web directory</h3>
<p>First, set a domain for the site, and optionally set a web directory. The domain is the domain name you expect to access this site from; the web directory is the directory <em>within your repo</em> that you want the files served from. As you can see, the default is &quot;public&quot; because that's the directory Laravel sites serve from.</p>
<p><img src="/assets/images/content/forge-site-panel.png" alt="Site page" /></p>
<h2>Create your database</h2>
<p>Before you attach your Laravel codebase to your Forge site, you'll want to create its database--otherwise your initial migrations will fail. You may have done this already in the &quot;Create your first server&quot; step, but if not, or if you'd just like to get access to the database server now, here's how to do it.</p>
<p>Follow the instructions at the Docs' <a href="http://forge.besnappy.com/laravel-forge#databases">Databases Section</a> section to get your SQL admin app connected (use Sequel Pro if you don't have one). Note that the usernames and passwords you're entering there are not accessible from Forge, but will have arrived in an email from Forge titled &quot;Server Provisioned.&quot; <em>Save this information.</em> That's the only place it lives now.</p>
<p>Connect to your database server, and add a database with the name of your Laravel app's expected database. Now, when you first hook up your Laravel codebase, Forge will be able to run your migrations correctly.</p>
<h2>Modify your Laravel code</h2>
<p>You'll want to modify your app's code for whichever environment this will be. Update your database settings to use the host, username, and password specified in the &quot;Server Provisioned&quot; email. Now push your Forge-ready code up to Github.</p>
<h3>Quick tip</h3>
<p>Something I learned from Heroku: I store my server IP, database username, and database password in environment variables (see Forge's Site manager, and the Environment tab). Then in my database.php I just set the host, username, and password to be <code>getenv('db_host')</code>, <code>getenv('db_username')</code>, and <code>getenv('db_password')</code>, which gets the environment variables with those names.</p>
<p><img src="/assets/images/content/forge-database-with-envs.png" alt="Database env" /></p>
<p>When you're setting environment variables in Forge, note that the &quot;Environment (optional)&quot; flag allows you to determine which Laravel environment these will be passed to; the default is &quot;production&quot;.</p>
<p><img src="/assets/images/content/forge-environment-variables.png" alt="Forge Environment Variables" /></p>
<h3>Configure Github link</h3>
<p>Once the site is ready for you, and you've created your database and updated your app and pushed the changes to Github, click the Manage button for your site. Choose a github repo (for example, <a href="http://github.com/mattstauffer/confomo">http://github.com/mattstauffer/confomo</a> would be &quot;mattstauffer/markedstyle&quot;), branch (default to &quot;master&quot;), and sync strategy (Quick Deploy deploys the code to your Forge server <em>every</em> time you push to your chosen Github branch; not using Quick Deploy means you can push manually via Envoy or SSH, or use the &quot;Deploy Now&quot; button whenever you're ready).</p>
<p>You can also choose how to handle Composer and migrations. By default I would check both.</p>
<p>Once you complete this step Forge will download your files and (optionally) run <code>composer install</code> and <code>artisan migrate</code>. </p>
<h2>Check it out</h2>
<p>If everything went smoothly, your site should be up and running on your server, ready for you to go visit it. You can visit the public IP and you'll see the default site.</p>
<p>You should also be able to visit any domains you pointed to this server earlier. Check it out--you just set up your first Forge-provisioned site!</p>
<h2>Other common tasks</h2>
<h3>SSH in</h3>
<p>But what if you want to git pull manually? To live-edit the site with Vim (NO!)? To run your database seeds? Or whatever other mischevious things you might want to do with SSH access?</p>
<p>You can use an SSH config file to create easy shortcuts to your Forge server, but even without that, you can just <code>ssh YOUR_IP_HERE</code> from the command line and, since you've already uploaded your SSH key, you should be good to go. <code>ls</code> from your root directory and you'll see a folder for every site you set up.</p>
<h3>Setting up a few basic envoy scripts</h3>
<p>If you decide to manage deploying your site manually, you can always use the &quot;Deploy Site&quot; button in the control panel, but you can also set up an Envoy script. For example:</p>
<pre><code class="language-php">@servers(['forge' =&gt; 'YOUR_IP_HERE'])

@task('deploy', ['on' =&gt; 'forge'])
    cd your-site-domain-here/
    git pull
@endtask

@task('full-deploy', ['on' =&gt; 'forge'])
    cd your-site-domain-here/
    git pull
    composer install
    php artisan migrate
@endtask%
</code></pre>
<h3>Customizing the deploy script</h3>
<p>By default, all manual deploys and quick deploys from Forge will use the following general script:</p>
<pre><code class="language-bash">cd {dir}
git pull origin {branch}
composer install
php artisan migrate</code></pre>
<p>But if you want to customize this, you can click Edit Deploy Script on the Site details page.</p>
<h2>Recipes</h2>
<p>Forge recipes are pre-written Bash scripts (shell scripts) that you can run at any point on any of your servers. Symlinks, installations, downloads, or whatever else you want--write simple shell scripts, give them a name, and easily run them any time you want, with a checkbox for each server you might want to run it on.</p>
<p><img src="/assets/images/content/forge-add-recipe.png" alt="Add recipe" /></p>
<p>Forge also emails the output of the script to you after it's done running.</p>
<p><img src="/assets/images/content/forge-receipe-email.png" alt="Forge Recipe Output" /></p>
<h2>Workers and Crons</h2>
<p>Forge has server tabs for Scheduler and Daemons and Site tabs for Queue Workers.</p>
<p>Scheduler allows you to create and delete cron jobs, and view logs from previous cron runs.</p>
<p>Daemons are long-running scripts managed by Supervisor.</p>
<p>Queue workers are <a href="http://laravel.com/docs/queues">Artisan queue</a> workers, managed by Supervisor, based on beanstalkd. </p>
<p><img src="/assets/images/content/forge-new-worker.png" alt="Forge Queue Workers" /></p>
<h2>Private Networking</h2>
<p>Link your servers via private networking, create app &amp; database server, etc. -- choose the servers you want to link together and Forge will automatically create private networks between your servers. Just configure your firewalls in the Forge GUI and they'll be up and talking together.</p>
<h2>Archive Servers</h2>
<p>If you want to use Forge to set up your account and then remove its access to your servers, just Archive your server and Forge will be disconnected. You can always un-archive it later if you need to use Forge again for something else.</p>
<h2>Events &amp; Monitoring</h2>
<p>The bottom of your dashboard has a Recent Events section where you can see every significant event that hass happened across all of your servers.</p>
<p><img src="/assets/images/content/forge-dashboard-events.png" alt="Dashboard Events" /></p>
<p>The best way to monitor your apps, though, is to go to the Monitoring tab on a server and connect the server directly to your NewRelic and/or Papertrail accounts.</p>
<h2>Notes on using Environment Variables for environment detection</h2>
<p>Forge originally only used <code>.env.ENVIRONMENTNAMEHERE.php</code> files for environment variables, so there were some difficulties using env vars in your environment detection in bootstart/start.php. This is no longer the case.</p>
<p>This having been said, based on some of my experiences with queues and other services, I would highly recommend using hostnames to set your environment, <em>not</em> env vars. For example:</p>
<pre><code class="language-php">    $env = $app-&gt;detectEnvironment(array(
        'production' =&gt; array('your-forge-server-name-here'),
        'local' =&gt; array('homestead', '.local'),
    ));</code></pre>
<p>This will set your homestead instance to be &quot;local&quot;, many local dev machines (Mac and Linux, not sure about Windows) to automatically be &quot;local&quot;, and set your Forge server as &quot;production&quot;.</p>
<h2>Notes on your IP address</h2>
<p>Your site will, by default, be accessible via your public IP. Be careful that this doesn't leave you showing the depths of your site to the world--for example, if your <code>detectEnvironment</code> settings in <code>bootstrap/start.php</code> defaults to an environment with <code>debug</code> set to <code>true</code>, someone might be able to get a dev-style Whoops page by visiting your IP address, which would reveal config details about your app that you don't want public.</p>
<h2>What makes Forge unique?</h2>
<ul>
<li><strong>Pricing</strong>: Forge's pricing is nearly nothing, and it's completely transparent. One price for unlimited access to Forge, and then just your normal pricing with your cloud host. The pricing on Forge is <em>incredible</em>, and honestly, we're almost stealing from Taylor by using this service at this price.</li>
<li><strong>Direct host access</strong>: You're allowing Forge to manage your <em>pre-existing</em> account with your cloud service provider (which you can log in to on your own); other services don't give you direct access to the Amazon account, for example, that is actually serving your content. This means more power and more flexibility</li>
<li><strong>Consistent configuration</strong>: Forge has a single, Laravel-optimized server configuration. You have flexibility from there, but it's definitely operating in the space of an &quot;opinionated&quot; default. Less time worrying about your environment, more time building something awesome</li>
<li><strong>Private networking</strong>: Forge allows you to easily network multiple servers, with one acting as a database, one for workers, one for serving the site, etc.--all from a simple-to-use interface. There's a ton of potential power here, all configurable through a simple GUI</li>
</ul>
<h2>Conclusion</h2>
<p>Over the next few weeks I'll be posting how-to's about various aspects of using Forge: multiple domains and subdomains in one environment, advanced environment variables and environment detection, queues and daemons, PostgreSQL, and more.</p>
<p>Check back here, or follow me at <a href="http://twitter.com/stauffermatt">@stauffermatt</a> to see when I post more. </p>
<p>Did I make any mistakes, or do you have any questions? <a href="http://twitter.com/stauffermatt">@stauffermatt</a> for that too. Thanks!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-on-heroku-using-a-postgresql-database</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-on-heroku-using-a-postgresql-database"/>
        <title>Laravel on Heroku - Using a PostgreSQL database</title>
        <published>2014-05-02T00:00:00+00:00</published>
        <updated>2014-05-02T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">In the last two posts we got Laravel up and runnin...</summary>
        <content type="html"><![CDATA[
        <p>In the last two posts we got Laravel up and running on Heroku, and then connected it with MySQL. But Heroku natively prefers <a href="http://www.postgresql.org/">PostgreSQL</a>, and you'll find that PostgreSQL can do everything MySQL can do, and a lot more. So let's get it running on our Laravel Heroku app.</p>
<h2>Adding PostgreSQL to your Heroku app</h2>
<p>First, navigate to your app directory and add PostgreSQL as a Heroku add-on (if you haven't followed the first tutorial, you'll need to do that first to install the Heroku toolset, get this Laravel app connected to a Heroku app, etc.):</p>
<pre><code class="language-bash">$ heroku addons:add heroku-postgresql:dev</code></pre>
<p>You should see output like this:</p>
<pre><code class="language-bash">Adding heroku-postgresql:dev on app-name-here... done, v14 (free)
Attached as HEROKU_POSTGRESQL_COLOR_URL
Database has been created and is available
 ! This database is empty. If upgrading, you can transfer
 ! data from another database with pgbackups:restore.
Use `heroku addons:docs heroku-postgresql` to view documentation.</code></pre>
<p>The environment variable for your PostgreSQL database URL has a <code>COLOR</code> variable in the name itself: <code>HEROKU_POSTGRESQL_PINK_URL</code>, <code>HEROKU_POSTGRESQL_BLUE_URL</code>, etc... and depending on the server you're on, that color may be different. That means you can't necessarily rely on the name of that environment variable always being the same, so you want to be sure to <em>not rely on the <code>HEROKU_POSTGRESQL_COLOR_URL</code> for your database configurations.</em> Read on for how to handle it instead.</p>
<p>At any point, you can find both the name of your PostgreSQL variable and its value by running the following:</p>
<pre><code class="language-bash">$ heroku config | grep HEROKU_POSTGRESQL</code></pre>
<p>You should see something like the following:</p>
<pre><code class="language-bash">HEROKU_POSTGRESQL_RED_URL: postgres://user3123:passkja83kd8@ec2-117-21-174-214.compute-1.amazonaws.com:6212/db982398</code></pre>
<p>If you check out your <code>heroku config</code>, you should now see that you have a <code>DATABASE_URL</code> that's set to the same value as the <code>HEROKU_POSTGRESQL_COLOR_URL</code>. <em>That</em> is the environment variable you want to work from.</p>
<p>On apps with multiple databases, or if you didn't get the <code>DATABASE_URL</code> set properly for some reason, you can promote a particular server to be the primary database:</p>
<pre><code class="language-bash">$ heroku pg:promote HEROKU_POSTGRESQL_RED_URL</code></pre>
<p>At this point your database should be up and running. Now, let's edit your Laravel config to point to the PostgreSQL database.</p>
<h3>Configuring Laravel to use PostgreSQL</h3>
<p>Once again, if this is real app, you're going to want to only be making these changes in your production configuration settings, but for now we're just hacking at a dummy app. </p>
<p>First, change the value of <code>'default'</code> in <code>app/config/database.php</code> to <code>'pgsql'</code>.</p>
<pre><code class="language-php">    'default' =&gt; 'pgsql',</code></pre>
<p>Then, just like we did with MySQL, set the following at the top of your database.php:</p>
<pre><code class="language-php">$url = parse_url(getenv("DATABASE_URL"));

$host = $url["host"];
$username = $url["user"];
$password = $url["pass"];
$database = substr($url["path"], 1);</code></pre>
<p>Then change your <code>pgsql</code> entry in that same file to be the following:</p>
<pre><code class="language-php">    'pgsql' =&gt; array(
        'driver'   =&gt; 'pgsql',
        'host'     =&gt; $host,
        'database' =&gt; $database,
        'username' =&gt; $username,
        'password' =&gt; $password,
        'charset'  =&gt; 'utf8',
        'prefix'   =&gt; '',
        'schema'   =&gt; 'public',
    ),</code></pre>
<p>That's it! Commit and push and migrate:</p>
<pre><code class="language-bash">$ git add .
$ git commit -m "Convert to use Heroku PostgreSQL database"
$ git push heroku master
$ heroku run php /app/artisan migrate</code></pre>
<p>Check out your Heroku URL in the browser, and you should see the app running just like it was when it was MySQL:</p>
<pre><code>[]</code></pre>
<p>Congratulations! You're now a Laravel + Heroku + database pro.</p>
<h2>Notes</h2>
<ul>
<li>Heroku has a page dedicated to helping you <a href="https://devcenter.heroku.com/articles/heroku-mysql">migrate your data from MySQL to PostgreSQL</a></li>
</ul>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/laravel-on-heroku-using-a-mysql-database</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/laravel-on-heroku-using-a-mysql-database"/>
        <title>Laravel on Heroku - Using a MySQL database</title>
        <published>2014-05-01T00:00:00+00:00</published>
        <updated>2014-05-01T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">My last post was about getting Laravel up and runn...</summary>
        <content type="html"><![CDATA[
        <p>My <a href="http://mattstauffer.co/blog/installing-a-laravel-app-on-heroku">last post</a> was about getting Laravel up and running on Heroku. But, of course, that's not enough; how many Laravel apps don't have some sort of data store?</p>
<p>So, there's good news and bad news (but more good than bad).</p>
<p>First, the bad: Heroku doesn't use MySQL on its servers. But that's it for the bad news.</p>
<p>The good news: Heroku uses PostgreSQL, which is significantly better than MySQL in many ways. Also, Laravel has a PostgreSQL driver built in. Also, there is a MySQL Herku add-on you can purchase for smaller scale work, <em>and</em> it has a free intro version.</p>
<p>As you can see, we're in great shape here. This post will cover Laravel, Heroku, and MySQL, and the next post will cover the same with PostgreSQL.</p>
<h2>Adding ClearDB to your app</h2>
<p>If you're set on MySQL, there's a Heroku Add-on called <a href="https://addons.heroku.com/cleardb">ClearDB</a> that provides relatively first-class MySQL support to Heroku apps.</p>
<p>So, first, let's install ClearDB. Navigate to your app directory locally and use the Heroku toolbelt to install the add-on:</p>
<pre><code class="language-bash">$ heroku addons:add cleardb</code></pre>
<p>You should see the following:</p>
<pre><code class="language-bash">Adding cleardb on app-name-here... done, v6 (free)
Use `heroku addons:docs cleardb` to view documentation.</code></pre>
<p>You're now on the limited free tier of the ClearDB add-on. You can retrieve your database URL at any point by running the following command, which retrieves your Heroku config and then greps out just the line beginning with CLEARDB_DATABASE_URL:</p>
<pre><code class="language-bash">$ heroku config | grep CLEARDB_DATABASE_URL</code></pre>
<p>It should look something like this:</p>
<pre><code class="language-bash">CLEARDB_DATABASE_URL: mysql://h95b1k2b5k2kj:ont1948@us-cdbr-east-05.cleardb.net/heroku_nt9102903498235n?reconnect=true</code></pre>
<p>Don't worry about writing that down, though, because it's going to be passed into our app as an environment variable.</p>
<p>For more thorough instructions on setting up ClearDB, check out <a href="https://devcenter.heroku.com/articles/cleardb#provisioning-the-add-on">their provisioning docs</a>.</p>
<h2>Authenticating to ClearDB in your Laravel site</h2>
<p>Next, let's modify our Laravel app to connect to ClearDB. </p>
<p>First, let's add a few quick lines to our Laravel app that make it actually need a database. Thankfully, there's already a user authentication model and system built into Laravel, so let's just hit it for our default route. Edit <code>routes.php</code> and change its contents to the following:</p>
<pre><code class="language-php">Route::get('/', function()
{
    return User::all();
});</code></pre>
<p>Now generate a migration to create the users table:</p>
<pre><code class="language-bash">$ php artisan migrate:make create_users_table --create=users</code></pre>
<p>Next, let's add in our Heroku creds. Again, if you're actually working on a real site, you should be making sure you're just editing the database credentials specifically for your <code>production</code> environment here, but since we're just hacking out a dummy app here, we're going to edit <code>app/config/database.php</code> directly.</p>
<p>For now let's just do a bit of procedural code at the top of database.php. We're telling our app to get the CLEARDB_DATABASE_URL environment variable and then split it out.</p>
<pre><code class="language-php">$url = parse_url(getenv("CLEARDB_DATABASE_URL"));

$host = $url["host"];
$username = $url["user"];
$password = $url["pass"];
$database = substr($url["path"], 1);</code></pre>
<p>Remember, the <code>CLEARDB_DATABASE_URL</code> value we looked at before was just a URL, so we're using PHP's <code>parse_url</code> function to pull out the pieces of that URL and convert them into Laravel-config-friendly variables.</p>
<p>Now just find the <code>'mysql'</code> entry in the database.php config array, and change the values accordingly:</p>
<pre><code class="language-php">    'mysql' =&gt; array(
        'driver'    =&gt; 'mysql',
        'host'      =&gt; $host,
        'database'  =&gt; $database,
        'username'  =&gt; $username,
        'password'  =&gt; $password,
        'charset'   =&gt; 'utf8',
        'collation' =&gt; 'utf8_unicode_ci',
        'prefix'    =&gt; '',
    ),</code></pre>
<p>Of course, this will break locally, so let's test it out on Heroku.</p>
<pre><code class="language-bash">$ git add .
$ git commit -m "Add Heroku creds and update default route to hit the DB."
$ git push heroku master</code></pre>
<p>Now we need to remotely run our migration, which we do with the following:</p>
<pre><code class="language-bash">$ heroku run php /app/artisan migrate</code></pre>
<p>If everything runs without errors, you should be able to visit your site in your browser and see the seeds of your future Laravel app:</p>
<pre><code>[]</code></pre>
<p>(This is the JSON-encoded dump of your users table, which, at the moment, is empty).</p>
<p>That's it! You now know how to use MySQL on Heroku, run migrations and other artisan commands remotely, and deploy your code to your Heroku app.</p>
<h2>Conclusion</h2>
<p>You can see that it takes a bit of work, but you can get MySQL databases up and running on Heroku with Laravel quickly and simply. Check out my next post for how to get Laravel working with Heroku PostgreSQL.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/installing-a-laravel-app-on-heroku</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/installing-a-laravel-app-on-heroku"/>
        <title>Installing a Laravel app on Heroku</title>
        <published>2014-04-30T00:00:00+00:00</published>
        <updated>2014-04-30T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Heroku has had PHP support for a while, but it&#039;s b...</summary>
        <content type="html"><![CDATA[
        <p>Heroku has had PHP support for a while, but it's been a definitively second-class citizen. Yesterday
Heroku <a href="https://blog.heroku.com/archives/2014/4/29/introducing_the_new_php_on_heroku">announced a huge boost in their PHP support</a>, including out-of-the-box Composer support and an intention to become a legitimate destination for hosting modern PHP apps.</p>
<p>So, let's take a look at the fastest and simplest way to get a stock Laravel install up and running on Heroku.</p>
<h2>Pre-requisite:</h2>
<p><a href="https://id.heroku.com/signup">Sign up for a Heroku account</a> and <a href="https://toolbelt.heroku.com/">install the Heroku toolbelt</a>, a command-line toolkit for managing your Heroku apps.</p>
<h2>Create the project</h2>
<p>However you prefer, get your Laravel project initialized.</p>
<pre><code class="language-bash">$ laravel new laravel-heroku
$ cd laravel-heroku</code></pre>
<h2>Add your Procfile</h2>
<p>Heroku knows which processes to run for your app based on a configuration file called a <code>Procfile</code>. The default <code>apache2</code> process (if you don't use a <code>Procfile</code>) points to the web root, not to <code>/public</code>... so we need to create a custom <code>Procfile</code> to serve the site from <code>/public</code>.</p>
<p>Add a file with the name <code>Procfile</code> (capitalization matters) that contains this line:</p>
<pre><code>web: vendor/bin/heroku-php-apache2 public</code></pre>
<p>(more details: <a href="https://devcenter.heroku.com/articles/custom-php-settings#setting-the-document-root"><a href="https://devcenter.heroku.com/articles/custom-php-settings#setting-the-document-root">https://devcenter.heroku.com/articles/custom-php-settings#setting-the-document-root</a></a>)</p>
<blockquote>
<p>IMPORTANT: Heroku has made some changes recently, and you will likely have to run the following code in order for your Heroku app to detect that it's PHP: <code>heroku config:set BUILDPACK_URL=https://github.com/heroku/heroku-buildpack-php</code>. Thanks <a href="https://twitter.com/themccallister/status/562798460777545728">Jason McCallister</a>!</p>
</blockquote>
<h2>Initialize the git repo</h2>
<p>OK, our code is ready to go. Let's get it into git.</p>
<pre><code>$ git init
$ git add .
$ git commit -m "Initial commit of stock Laravel install."</code></pre>
<h2>Create the Heroku app</h2>
<p>Since you have the Heroku Toolbelt installed, you can create and modify your apps directly from the command line.</p>
<pre><code class="language-bash">$ heroku create</code></pre>
<p>The output/prompt should look something like this:</p>
<pre><code class="language-bash">± heroku create
Enter your Heroku credentials.
Email: [enter]
Password (typing will be hidden): [enter]
Creating app-name-here... done, stack is cedar
http://app-name-here.herokuapp.com/ | git@heroku.com:app-name-here.git
Git remote heroku added</code></pre>
<p>Write down or just remember the &quot;app-name-here&quot;; this is the unique identifier for the Heroku app you just created. The app will run on the <a href="https://devcenter.heroku.com/articles/cedar">Heroku Cedar stack</a> by default.</p>
<h2>Deploy your code to the Heroku app</h2>
<p>With Heroku, you push new code to your site by pushing to the <code>heroku</code> git remote.</p>
<pre><code class="language-bash">$ git push heroku master</code></pre>
<p>Look for this at the end: </p>
<pre><code class="language-bash">----&gt; Launching... done, v3
       http://app-name-here.herokuapp.com/ deployed to Heroku</code></pre>
<h2>Celebrate!</h2>
<p>Check it:
<img src="/assets/images/content/laravel-on-heroku.png" alt="Laravel install success graphic" /></p>
<h2>Notes</h2>
<p>Heroku's PHP support is not the only thing that has gotten an upgrade; their PHP support documentation is now fantastic. Check it out for many more tutorials and much more in-depth introductions.
<a href="https://devcenter.heroku.com/articles/getting-started-with-php">Heroku - Getting Started With PHP</a></p>
<h2>Postscript</h2>
<p>2015/10/28: I haven't run this recently, but I've heard from a few folks that we need an extra step or two. The first is that you need to log into Heroku and add a config variable for <code>APP_KEY</code>, and set it to any 32-character-long string.</p>
<p>If you have any issues with this walkthrough, please <a href="http://twitter.com.stauffermatt">let me know on Twitter</a> so i can keep this up-to-date. Thanks!</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/markedstyle-managing-styles-for-marked-with-laravel</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/markedstyle-managing-styles-for-marked-with-laravel"/>
        <title>Markedstyle: Managing Styles for Marked With Laravel</title>
        <published>2013-12-06T00:00:00+00:00</published>
        <updated>2013-12-06T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">What are Markdown and Marked? See the footer.
            TL;D...
        </summary>
        <content type="html"><![CDATA[
        <p><em>What are Markdown and Marked? See the <a href="#what-is-note">footer</a>.</em></p>
<p>TL;DR: I just wrote an app called <a href="http://markedstyle.com/">Markedstyle</a>, a centralized repository for custom Marked CSS styles.</p>
<p>I've been looking for an opportunity to rapidly prototype a simple web app using <a href="http://laravel.com/">Laravel 4</a> (the best way to learn is to practice), so when I saw <a href="http://brettterpstra.com/2013/11/27/a-collection-of-custom-styles-for-marked/">Brett Terpstra's recent post</a> on collecting styles for his app <a href="http://marked2app.com/">Marked</a> I knew I had a perfect opportunity.</p>
<p>I wish I had run an actual timer, but within a few very brief evening programming sessions I had a basic REST-ish app allowing me to create, view, and edit styles and users. I used Bootstrap for rapid front-end prototyping, but followed the tips at <a href="https://coderwall.com/p/wixovg">Bootstrap without all the debt</a> to save myself the pain of Bootstrap classes in the HTML.</p>
<p>The ease with which I can prototype an app in Laravel is incredible, but even more important is that I feel confident that I wouldn't have to change much to consider this a production app. Getting the basic resource routes and controllers up and running, as well as database schemas and seeds prepared, was incredibly simple. Suffice it to say that I'm in love with Laravel.</p>
<p>I filled the app with the styles currently available at Brett's Git repo, and made a wishlist for features I hope to develop soon--voting, Sass/SCSS style upload, etc. I then deployed it to <a href="http://arcustech.com/">ArcusTech</a>, so it should be incredibly fast.</p>
<p>The site is online at <a href="http://markedstyle.com/">markedstyle.com</a> and the source code is publicly viewable at <a href="http://github.com/mattstauffer/markedstyle">github.com/mattstauffer/markedstyle</a>. I know this isn't a login-every-day kind of thing, and that it'll be a lot more useful once I'm tracking clicks and votes, but I figured I'd put it out there for now and see what the Marked and Laravel communities think of it.</p>
<p>Thanks! Please share any thoughts (or if I totally screwed up the code, pull requests).</p>
<p><a name="what-is-note"></a></p>
<h2>What are Markdown and Marked?</h2>
<p><a href="http://daringfireball.net/2004/03/introducing_markdown">Markdown</a> is an incredible tool for formatting text in a light, clean manner; text written in Markdown is legible before it's processed, easily written by hand, and easily processed by computer.</p>
<p><a href="http://marked2app.com/">Marked</a> is a simple, clean program that monitors local Markdown files and actively updates a preview window every time they change.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/download-latest-sql-backup-every-day</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/download-latest-sql-backup-every-day"/>
        <title>Download Latest SQL Backup Every Day</title>
        <published>2013-10-16T00:00:00+00:00</published>
        <updated>2013-10-16T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Today I got a question from a Karani user about ou...</summary>
        <content type="html"><![CDATA[
        <p>Today I got a question from a <a href="https://karaniapp.com/">Karani</a> user about our backups. We maintain backups on-server, and our host maintains backups off-site, so I felt comfortable assuring the user of the security of our backups. But inside I thought--wouldn't it be great if I could get a daily copy of the latest SQL backup? Turns out it's extremely easy.</p>
<p>StackOverflow <a href="http://stackoverflow.com/questions/4111967/bash-script-to-scp-newest-file-in-a-directory-on-a-remote-server">to the</a> <a href="http://stackoverflow.com/questions/15395479/using-cron-on-mac-osx-mountain-lion">rescue</a>. This is focused around Unix-based systems, so, sorry Windows folks.</p>
<h2>Step 1: Create a shell script to use scp to download your latest backup</h2>
<p>Here's mine:</p>
<pre><code class="language-bash">remote_dir=/www/remote-user-name/sql_backup_directory
target_dir=~/local_sql_directory
destination=ssh_username@hostname
scp $destination:`ssh $destination ls -1td $remote_dir/\* | head -1` $target_dir</code></pre>
<p>Of course, you'll want to update remote_dir, target_dir, and destination's values to be appropriate for your system.</p>
<p>Note: When I first created this file, the permissions weren't correct for cron to run it. I chmod'ed the file to 777 to test to make sure it works, but I still need to figure out what the absolute best chmod value would be.</p>
<p>Note 2: You'll need to have <a href="http://sshkeychain.sourceforge.net/mirrors/SSH-with-Keys-HOWTO/SSH-with-Keys-HOWTO-4.html">ssh key authorization</a> already set up for this domain so scp &amp; ssh can access it properly.</p>
<h2>Step 2: Use cron to run that shell script every day</h2>
<p>First, edit your crontab:</p>
<pre><code class="language-bash">$ crontab -e</code></pre>
<p>Then, paste your line:</p>
<pre><code class="language-bash">0 2 * * * /path/to/shell/script.sh</code></pre>
<p>The above line runs the script at 2am every day, but you can adjust the timing--<a href="http://en.wikipedia.org/wiki/Cron">learn more about cron timing</a>.</p>
<h2>Step 3: Profit</h2>
<p>That's it! You now have a local cron job running once a day, copying your remotely generated files to your local computer.</p>
<h2>Tips:</h2>
<h3>Using the crontab editor</h3>
<p>By default, the crontab editor uses vim. Trust me when I tell you that learning vim is absolutely worth it--check out the intro to vim that ships with vim by running <code>$ vimtutor</code> to learn the basics in 5-10 minutes. But if you need to just get by for now:</p>
<p>Type <code>i</code> to enter Insert mode, and now you can type. To save, type <code>esc</code> and then type <code>:x</code> and hit <code>return</code>. That's it!</p>
<h3>Cron job for running SQL backup</h3>
<p>Are you looking for a server-side cron job to set up daily SQL dumps? Here's mine:</p>
<pre><code class="language-bash">0 1 * * * /usr/bin/mysqldump -h host-name-here -uusername-here -ppassword-here --databases database-name-here &gt; /path/to/sql/dumps/$( date + \%Y-\%m-\%d).sql</code></pre>
<p>That generates files with the date name as the file name, every night at 1am. You can adjust the timing, and be sure to put your own: route to mysqldump, MySQL host name, username, password, and database name. Notice that the user flags and password flags do <em>not</em> have spaces--so if your username is <code>bob</code> and your password is <code>secret</code>, those flags would be <code>-ubob</code> and <code>-psecret</code> .</p>
<h3>Emailing the results</h3>
<p>How do you debug problems? If you add the following line to the top of your cron job, it will email you any output from the script.</p>
<pre><code class="language-bash">MAILTO=youremailaddress@hotmail.com</code></pre>
<p>I haven't yet tested to see if this works locally, though, so I'll update this when I have.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/even-shorter-ternary-operators-in-php-using</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/even-shorter-ternary-operators-in-php-using"/>
        <title>Even shorter ternary operators in PHP using ?:</title>
        <published>2013-09-03T00:00:00+00:00</published>
        <updated>2013-09-03T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">Today I discovered something about PHP&#039;s ternary o...</summary>
        <content type="html"><![CDATA[
        <p>Today I discovered something about PHP's ternary operator that gave my <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> soul a little bit of joy.</p>
<p>The PHP ternary operator is often a key player in the terseness vs. clarity argument. A brief refresher: The PHP ternary operator allows you to write single-line comparisons, replacing code like the following:</p>
<pre><code class="language-php">&lt;?php
if (isset($value)) {
    $output = $value;
} else {
    $output = 'No value set.';
}</code></pre>
<p>with this:</p>
<pre><code class="language-php">&lt;?php
$output = isset($value) ? $value : 'No value set.';</code></pre>
<p>The second code example is clearly simpler, and in many cases (although certainly not all), it still retains enough clarity to be a worthy tool. There's plenty of debate about whether the ternary operator sacrifices clarity at the expense of conciseness; let's just say it's a tool, and like any tool, it can be used well or poorly.</p>
<p>The syntax for the regular ternary operator is <code>(expression) ? value if truthy : value if falsy</code>. The expression can also just be a single variable, which will test whether the variable is truthy or falsy:</p>
<pre><code class="language-php">&lt;?php
$output = $value ? $value : 'No value set.';</code></pre>
<p>The problem is, the above example is both <em>common</em> and <em>annoyingly repetitive</em>: Having to write <code>$value</code> twice like that just feels wrong.</p>
<p><strong>Well, I discovered today that PHP 5.3 introduced an even terser syntax for this use of the ternary operator</strong>. You can learn more <a href="http://www.php.net/manual/en/control-structures.if.php#102060">at the docs</a>, but here's how we could make the above example even more concise:</p>
<pre><code class="language-php">&lt;?php
$output = $value ?: 'No value set.';</code></pre>
<p>If this looks familiar, it's because it is: this is exactly how PHP shortens other operators, like shortening this:</p>
<pre><code class="language-php">&lt;?php
$value = $value . $other_value;</code></pre>
<p>to this:</p>
<pre><code class="language-php">&lt;?php
$value .= $other_value;</code></pre>
<p>For the sake of clarity, just because we <em>can</em> shorten something doesn't mean we <em>should</em>. But, when we can write terse code that is <em>also</em> appopriately clear, we should, and this feature allows us to DRY up the ternary operator in many cases.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/falling-in-love-with-php-again</id>
        <link type="text/html" rel="alternate" href="https://mattstauffer.co/blog/falling-in-love-with-php-again"/>
        <title>Falling in love with PHP--again</title>
        <published>2013-07-31T00:00:00+00:00</published>
        <updated>2013-07-31T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">PHP is one of the most maligned languages today--e...</summary>
        <content type="html"><![CDATA[
        <p>PHP is one of the most maligned languages today--even more hated than JavaScript, which says a lot.</p>
<p>The problem is that there are thousands of PHP sites, PHP apps (and PHP developers) that are low quality, untested, procedural, antiquated, poorly designed and poorly commented. Much PHP code is flaky, hackable, and ugly, and the language itself was clearly not designed with modern coding standards and conventions in mind--its naming is inconsistent, its OOP features are frustratingly-designed afterthoughts, and it suffers from myriad other painful little problems that sum up to a big pain in the rear.</p>
<p>I've developed in CodeIgniter, a PHP-based MVC framework, for years, and while the addition of a framework and of the MVC methodology have brought some much-needed structure to my PHP world, I've still longed for the beauty, simplicity, and expressiveness of Ruby on Rails. After working on a few Rails apps for work, I came close to fully changing over my loyalties.</p>
<p>And then came Laravel. <a href="http://laravel.io/">Laravel</a> is a light, flexible, expressive framework that capitalizes on the best parts of PHP and does its best to supplant the places where PHP is most lacking. Laravel is powerful, extensible, rewritable, and is in active development by some really brilliant people. The learning curve is low, the power is high, and I cannot begin to express the joy it's given me to work in this framework.</p>
<p>Laravel has singlehandedly rekindled my love for PHP, and my hope that it may actually contend with Ruby (especially on Rails) as a legitimate language for web app development.</p>
<p><a href="http://taylorotwell.com/">Taylor Otwell</a>, I owe you a beer. And my PHP-coding life.</p>    ]]></content>
    </entry>
    <entry>
        <id>https://mattstauffer.co/blog/what-is-an-accidental-bootstrap-founder</id>
        <link type="text/html" rel="alternate"
              href="https://mattstauffer.co/blog/what-is-an-accidental-bootstrap-founder"/>
        <title>What is an accidental bootstrap founder?</title>
        <published>2013-04-14T00:00:00+00:00</published>
        <updated>2013-04-14T00:00:00+00:00</updated>
        <author>
            <name>Matt Stauffer</name>
        </author>
        <summary type="html">
            Before LessConf 2013, I didn&#039;t see myself an entr...
        </summary>
        <content type="html"><![CDATA[
        <p><img src="/assets/images/content/lessconf-sand.jpg" alt="LessConf Sand Sculpture" /></p>
<p>Before <a href="http://lessconf.lesseverything.com/">LessConf 2013</a>, I didn't see myself an entrepreneur, let alone a &quot;startup founder.&quot; I knew what an entrepreneur and a founder looked like, and I was neither.</p>
<p>I worked as a freelance web developer during college, but after graduation I left the tech world to work at a non-profit. My job included raising funds to support my salary, something I was ill equipped to do. One of the hardest parts of my job was the administrative work&#8212;tracking contacts, interactions, gifts, pledges.</p>
<hr />
<p>I eventually built a simple web app to simplify that administration, and soon added user accounts to let my friends use it. But to keep it fast and secure, I had to spend time and money, so I started charging a small fee to use it. Eventually I named the app <a href="https://karaniapp.com/">Karani for Fundraisers</a>, got an accountant, and incorporated <a href="http://karaniproductions.com/">Karani Productions Inc.</a></p>
<hr />
<p>Then my wife had a beautiful baby boy and I got an amazing <a href="http://goodfoodpro.com/">job</a>, and I hired some folks part time to help out with running Karani. Today Karani has a few hundred users, bringing in a few thousand dollars a month, which goes right out the door to pay my employees. Since leaving my non-profit job I've worked with a variety of startups, enterprises, and development shops, but I've still never considered myself an entrepreneur.</p>
<p>So when I went to LessConf, I was interested in learning at the feet of creators &amp; entrepreneurs. I didn't place myself in the same space as the folks who make up the bulk of LessConf: entrepreneurs, creators, and innovators. I was just a strategist, an implementor.</p>
<p>Over the span of the conference I realized something: I <em>founded</em> Karani. Before I founded it, it didn't exist, and it does now--it's a startup. I did the entire thing without any funding, so it's a <em>bootstrapped</em> startup. And it all just sort of happened, without me knowing terms like <em>churn</em> and <em>angel investor</em> (or reading Hacker News or TechCrunch). So, there I am: an accidental bootstrap founder.</p>
<p>Further, my day job is entrepreneurial--pioneering technologies, consulting for startups, expanding our development team, updating our technology stack, and now joining the leadership team of the company. At day, at night, I'm creating, innovating, starting, founding--I just needed some superfriends to help me realize it.</p>    ]]></content>
    </entry>
</feed>
